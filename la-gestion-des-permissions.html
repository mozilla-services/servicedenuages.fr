<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Service de nuages, ">

        <link rel="alternate"  href="http://www.servicedenuages.fr/feeds/all.atom.xml" type="application/atom+xml" title="Service de nuages Full Atom Feed"/>

        <title>La gestion des permissions // Service de nuages // </title>


    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.3.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://www.servicedenuages.fr/theme/css/pure.css">
    <link rel="stylesheet" href="http://www.servicedenuages.fr/theme/css/pygments.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.0.1/jquery.fitvids.min.js"></script>
    <script>
        $(document).ready(function(){
            $(".content").fitVids();
        });
    </script>
</head>

<body>
<div class="pure-g-r" id="layout">
    <div class="sidebar sidebar-article pure-u">
        <header class="header-article">
            <hgroup>
                <h5>Publi√©</h5>
                <p title="~1998 mots">~8mn de lecture üïë</p>
                <p>mar. 12 mai 2015</p>
                <a href="/">&larr;Liste des articles</a>
            </hgroup>
        </header>
    </div>
    <div class="pure-u">
        <div class="content">
            <section class="post">
                <header class="post-header">
                    <h1>La gestion des permissions</h1>
                </header>
            </section>
                        <p><a href="http://www.servicedenuages.fr/en/handling-permissions">Read the english version</a></p>
            <p>Dans le cadre de la cr√©ation d'un service de stockage de donn√©es personnelles
(Kinto), la gestion des permissions est un des gros challenges : qui doit avoir
acc√®s √† quoi, et comment le d√©finir ?</p>
<p><strong>tl;dr: Quelques retours sur le vocabulaire des syst√®mes de permission et sur nos id√©es pour l'implementation des permissions dans un stockage g√©n√©rique.</strong></p>
<div class="section" id="la-problematique">
<h2>La probl√©matique</h2>
<p>La probl√©matique est simple : des donn√©es sont stock√©es en ligne, et il
faut un moyen de pouvoir les partager avec d'autres personnes.</p>
<p>En regardant les cas d'utilisations, on se rend compte qu'on a plusieurs types
d'utilisateurs :</p>
<ul class="simple">
<li>les utilisateurs "finaux" (vous) ;</li>
<li>les applications qui interagissent en leurs noms.</li>
</ul>
<p>Tous les intervenants n'ont donc pas les m√™mes droits : certains doivent
pouvoir lire, d'autres √©crire, d'autres encore cr√©er de nouveaux
enregistrements, et le contr√¥le doit pouvoir s'effectuer de mani√®re fine : il
doit √™tre possible de lire un enregistrement mais pas un autre, par exemple.</p>
<p>Nous sommes partis du constat que les solutions disponibles n'apportaient pas
une r√©ponse satisfaisante √† ces besoins.</p>
</div>
<div class="section" id="un-probleme-de-vocabulaire">
<h2>Un probl√®me de vocabulaire</h2>
<p>Le principal probl√®me rencontr√© lors des r√©flexions f√ªt le vocabulaire.</p>
<p>Voici ci-dessous une explication des diff√©rents termes.</p>
<div class="section" id="le-concept-de-principal">
<h3>Le concept de ¬´ principal ¬ª</h3>
<p>Un <em>principal</em>, en s√©curit√© informatique, est une entit√© qui peut √™tre
authentifi√©e par un syst√®me informatique. <a class="footnote-reference" href="#id2" id="id1">[1]</a> En Fran√ßais il s'agit
du ¬´ commettant ¬ª, l'acteur qui commet l'action (oui, le terme est conceptuel !)</p>
<p>Il peut s'agir aussi bien d'un individu, d'un ordinateur, d'un
service ou d'un groupe regroupant l'une de ces entit√©s, ce qui
est plus large que le classique ¬´ <em>user id</em> ¬ª.</p>
<p>Les permissions sont alors associ√©es √† ces <em>principals</em>.</p>
<p>Par exemple, un utilisateur est identifi√© de mani√®re unique lors de la
connexion par le syst√®me d'authentification dont le r√¥le est de
d√©finir une liste de <em>principals</em> pour l'utilisateur se connectant.</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label"></col><col></col></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Pour en savoir plus sur les <em>principals</em> :
<a class="reference external" href="https://en.wikipedia.org/wiki/Principal_%28computer_security%29">https://en.wikipedia.org/wiki/Principal_%28computer_security%29</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="la-difference-entre-role-et-groupe">
<h3>La diff√©rence entre r√¥le et groupe</h3>
<p>De but en blanc, il n'est pas √©vident de d√©finir pr√©cis√©ment la
diff√©rence entre ces deux concepts qui permettent d'associer
des permissions √† un groupe de <em>principals</em>. <a class="footnote-reference" href="#id4" id="id3">[2]</a></p>
<p>La diff√©rence est principalement s√©mantique. Mais on peut y voir une
diff√©rence dans la ¬´ direction ¬ª de la relation entre les deux concepts.</p>
<ul class="simple">
<li>Un r√¥le est une liste de permissions que l'on associe √† un <em>principal</em>.</li>
<li>Un groupe est une liste de <em>principals</em> que l'on peut associer √† une permission.</li>
</ul>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label"></col><col></col></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[2]</a></td><td>Plus d'informations :
<a class="reference external" href="http://stackoverflow.com/questions/7770728/group-vs-role-any-real-difference">http://stackoverflow.com/questions/7770728/group-vs-role-any-real-difference</a></td></tr>
</tbody>
</table>
</div>
<div class="section" id="la-difference-entre-permission-acl-ace">
<h3>La diff√©rence entre permission, ACL, ACE</h3>
<blockquote class="epigraph">
<p>Une ACL est une liste d‚ÄôAccess Control Entry (ACE) ou entr√©e de contr√¥le d'acc√®s
donnant ou supprimant des droits d'acc√®s √† une personne ou un groupe.</p>
<p class="attribution">‚Äî<a class="reference external" href="https://fr.wikipedia.org/wiki/Access_Control_List">https://fr.wikipedia.org/wiki/Access_Control_List</a></p>
</blockquote>
<p>Je dirais m√™me plus, dans notre cas, ¬´ √† un <em>principal</em> ¬ª. Par exemple:</p>
<div class="highlight"><pre>create_record: alexis,remy,tarek
</pre></div>
<p>Cet ACE donne la permission <tt class="docutils literal">create</tt> sur l'objet <tt class="docutils literal">record</tt> aux
utilisateurs Tarek, R√©my et Alexis.</p>
</div>
</div>
<div class="section" id="la-delegation-de-permissions">
<h2>La d√©l√©gation de permissions</h2>
<p>Imaginez l'exemple suivant, o√π un utilisateur stocke deux types de donn√©es en
ligne :</p>
<ul class="simple">
<li>des contacts ;</li>
<li>une liste de t√¢ches √† faire qu'il peut associer √† ses contacts.</li>
</ul>
<p>L'utilisateur a tous les droits sur ses donn√©es.</p>
<p>Cependant il utilise deux applications qui doivent elles avoir un acc√®s restreint :</p>
<ul class="simple">
<li>une application de gestion des contacts √† qui il souhaite d√©l√©guer
la gestion int√©grale de ses contacts : <tt class="docutils literal">contacts:write</tt> ;</li>
<li>une application de gestion des t√¢ches √† qui il souhaite d√©l√©guer la
gestion des t√¢ches : <tt class="docutils literal">contacts:read tasks:write</tt></li>
</ul>
<p>Il souhaite que son application de contacts ne puisse pas acc√©der √†
ses t√¢ches et que son application de t√¢ches ne puisse pas modifier ses
contacts existants, juste √©ventuellement en cr√©er de nouveaux.</p>
<p>Il lui faut donc un moyen de d√©l√©guer certains de ses droits √† un tiers
(l'application).</p>
<p>C'est pr√©cis√©ment le r√¥le des <a class="reference external" href="http://tools.ietf.org/html/rfc6749#page-23">scopes OAuth2</a>.</p>
<p>Lors de la connexion d'un utilisateur, une fen√™tre lui demande quels
acc√®s il veut donner √† l'application qui va agir en son nom.</p>
<p>Le service aura ensuite acc√®s √† ces <em>scopes</em> en regardant le jeton
d'authentification utilis√©. Cette information doit √™tre
consid√©r√©e comme une entr√©e utilisateur (c'est √† dire qu'on ne peut
pas lui faire confiance). Il s'agit de ce que l'utilisateur souhaite.</p>
<p>Or, il est √©galement possible que l'utilisateur n'ait pas acc√®s aux donn√©es
qu'il demande. Le service doit donc utiliser deux niveaux de permissions :
celles de l'utilisateur, et celles qui ont √©t√© d√©l√©gu√©es √† l'application.</p>
</div>
<div class="section" id="espace-de-noms">
<h2>Espace de noms</h2>
<p>Dans notre impl√©mentation initiale de <em>Kinto</em> (notre service de stockage en
construction), l'espace de nom √©tait implicite : les donn√©es stock√©es √©taient
n√©cessairement celles de l'utilisateur connect√©.</p>
<p>Les donn√©es d'un utilisateur √©taient donc cloisonn√©es et impossible √† partager.</p>
<p>L'utilisation d'espaces de noms est une mani√®re simple de g√©rer le partage des donn√©es.</p>
<p>Nous avons choisi de reprendre le mod√®le de GitHub et de Bitbucket, qui
utilisent les ¬´ organisations ¬ª comme espaces de noms.</p>
<p>Dans notre cas, il est possible de cr√©er des "buckets", qui correspondent √† ces
espaces de noms. Un bucket est un conteneur de collections et de groupes
utilisateurs.</p>
<p>Les ACLs sur ces collections peuvent √™tre attribu√©es √† certains groupes du
<em>bucket</em> ainsi qu'√† d'autres <em>principals</em> directement.</p>
</div>
<div class="section" id="notre-proposition-d-api">
<h2>Notre proposition d'API</h2>
<div class="section" id="les-objets-manipules">
<h3>Les objets manipul√©s</h3>
<p>Pour mettre en place la gestion des permissions, nous avons identifi√© les
objets suivants :</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%"></col>
<col width="77%"></col>
</colgroup>
<thead valign="bottom">
<tr><th class="head">Objet</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><strong>bucket</strong></td>
<td>On peut les voir comme des espaces de noms. Ils
permettent d'avoir diff√©rentes collections portant
le m√™me nom mais stock√©es dans diff√©rents <em>buckets</em> de
mani√®re √† ce que les donn√©es soient distinctes.</td>
</tr>
<tr><td><strong>collection</strong></td>
<td>Une liste d'enregistrements.</td>
</tr>
<tr><td><strong>record</strong></td>
<td>Un enregistrement d'une collection.</td>
</tr>
<tr><td><strong>group</strong></td>
<td>Un groupe de commetants (¬´ <em>principals</em> ¬ª).</td>
</tr>
</tbody>
</table>
<p>Pour la d√©finition des ACLs, il y a une hi√©rarchie et les objets ¬´ h√©ritent ¬ª des
ACLs de leur parents :</p>
<div class="highlight"><pre>           +---------------+
           | Bucket        |
           +---------------+
    +-----&gt;+ - id          +&lt;---+
    |      | - permissions |    |
    |      +---------------+    |
    |                           |
    |                           |
    |                           |
    |                           |
    |                           |
+---+-----------+        +------+---------+
| Collection    |        | Group          |
+---------------+        +----------------+
| - id          |        |  - id          |
| - permissions |        |  - members     |
+------+--------+        |  - permissions |
       ^                 +----------------+
       |
       |
+------+---------+
| Record         |
+----------------+
|  - id          |
|  - data        |
|  - permissions |
+----------------+
</pre></div>
</div>
<div class="section" id="les-permissions">
<h3>Les permissions</h3>
<p>Pour chacun de ces objets nous avons identifi√© les permissions suivantes :</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%"></col>
<col width="77%"></col>
</colgroup>
<thead valign="bottom">
<tr><th class="head">Permission</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><strong>read</strong></td>
<td>La permission de lire le contenu de
l'objet et de ses sous-objets.</td>
</tr>
<tr><td><strong>write</strong></td>
<td>La permission de modifier et
d'administrer un objet et ses sous-
objets. La permission <em>write</em> permet la
lecture, modification et suppression
d'un objet ainsi que la gestion de ses
permissions.</td>
</tr>
<tr><td><strong>create</strong></td>
<td>La permission de cr√©er le sous-objet
sp√©cifi√©. Par exemple:
<tt class="docutils literal">collections:create</tt></td>
</tr>
</tbody>
</table>
<p>√Ä chaque permission sp√©cifi√©e sur un objet est associ√©e une liste de
<em>principals</em>.</p>
<p>Dans le cas de la permission <tt class="docutils literal">create</tt> on est oblig√© de sp√©cifier
l'objet enfant en question car un objet peut avoir plusieurs types
d'enfants. Par exemple : <tt class="docutils literal">collections:create</tt>, <tt class="docutils literal">groups:create</tt>.</p>
<p>Nous n'avons pour l'instant pas de permission pour <cite>delete</cite> et <cite>update</cite>,
puisque nous n'avons pas trouv√© de cas d'utilisation qui les n√©cessitent.
Quiconque avec le droit d'√©criture peut donc supprimer un enregistrement.</p>
<p>Les permissions d'un objet sont h√©rit√©es de son parent. Par exemple,
un enregistrement cr√©√© dans une collection accessible √† tout le monde
en lecture sera lui aussi accessible √† tout le monde.</p>
<p>Par cons√©quent, les permissions sont cumul√©es. Autrement dit, il n'est pas
possible qu'un objet ait des permissions plus restrictives que son parent.</p>
<p>Voici la liste exhaustive des permissions :</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%"></col>
<col width="32%"></col>
<col width="47%"></col>
</colgroup>
<thead valign="bottom">
<tr><th class="head">Objet</th>
<th class="head">Permissions associ√©es</th>
<th class="head">Commentaire</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Configuration
(.ini)</td>
<td><cite>buckets:create</cite></td>
<td>Les <em>principals</em> ayant le droit
de cr√©er un bucket sont d√©finis
dans la configuration du serveur.
(<em>ex. utilisateurs authentifi√©s</em>)</td>
</tr>
<tr><td rowspan="4"><tt class="docutils literal">bucket</tt></td>
<td><cite>write</cite></td>
<td>C'est en quelque sorte le droit
d'administration du <em>bucket</em>.</td>
</tr>
<tr><td><cite>read</cite></td>
<td>C'est le droit de lire le contenu
de tous les objets du <em>bucket</em>.</td>
</tr>
<tr><td><cite>collections:create</cite></td>
<td>Permission de cr√©er des
collections dans le <em>bucket</em>.</td>
</tr>
<tr><td><cite>groups:create</cite></td>
<td>Permission de cr√©er des groupes
dans le <em>bucket</em>.</td>
</tr>
<tr><td rowspan="3"><tt class="docutils literal">collection</tt></td>
<td><cite>write</cite></td>
<td>Permission d'administrer tous les
objets de la collection.</td>
</tr>
<tr><td><cite>read</cite></td>
<td>Permission de consulter tous les
objets de la collection.</td>
</tr>
<tr><td><cite>records:create</cite></td>
<td>Permission de cr√©er des nouveaux
enregistrement dans la collection.</td>
</tr>
<tr><td rowspan="2"><tt class="docutils literal">record</tt></td>
<td><cite>write</cite></td>
<td>Permission de modifier ou de
partager l'enregistrement.</td>
</tr>
<tr><td><cite>read</cite></td>
<td>Permission de consulter
l'enregistrement.</td>
</tr>
<tr><td rowspan="2"><tt class="docutils literal">group</tt></td>
<td><cite>write</cite></td>
<td>Permission d'administrer le
groupe</td>
</tr>
<tr><td><cite>read</cite></td>
<td>Permission de consulter les
membres du groupe.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="les-principals">
<h3>Les ¬´ <em>principals</em> ¬ª</h3>
<p>Les acteurs se connectant au service de stockage peuvent s'authentifier.</p>
<p>Ils re√ßoivent alors une liste de <em>principals</em> :</p>
<ul class="simple">
<li><tt class="docutils literal">Everyone</tt>: le <em>principal</em> donn√© √† tous les acteurs (authentifi√©s ou pas) ;</li>
<li><tt class="docutils literal">Authenticated</tt>: le <em>principal</em> donn√© √† tous les acteurs authentifi√©s ;</li>
<li>un <em>principal</em> identifiant l'acteur, par exemple <tt class="docutils literal">fxa:32aa95a474c984d41d395e2d0b614aa2</tt></li>
</ul>
<p>Afin d'√©viter les collisions d'identifiants, le <em>principal</em> de l'acteur d√©pend
de son type d'authentification (<tt class="docutils literal">system</tt>, <tt class="docutils literal">basic</tt>, <tt class="docutils literal">ipaddr</tt>, <tt class="docutils literal">hawk</tt>,
<tt class="docutils literal">fxa</tt>) et de son identifiant (unique par acteur).</p>
<p>En fonction du <em>bucket</em> sur lequel se passe l'action, les groupes dont
fait partie l'utilisateur sont √©galement ajout√©s √† sa liste de
<tt class="docutils literal">principals</tt>. <tt class="docutils literal">group:moderators</tt> par exemple.</p>
<p>Ainsi, si Bob se connecte avec <em>Firefox Accounts</em> sur le <em>bucket</em>
<tt class="docutils literal">servicedenuages_blog</tt> dans lequel il fait partie du groupe
<tt class="docutils literal">moderators</tt>, il aura la liste de <em>principals</em> suivante :
<tt class="docutils literal">Everyone, Authenticated, fxa:32aa95a474c984d41d395e2d0b614aa2, group:moderators</tt></p>
<p>Il est donc possible d'assigner une permission √† Bob en utilisant l'un de
ces quatre <em>principals</em>.</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">Le <em>principal</em> <tt class="docutils literal">&lt;userid&gt;</tt> d√©pend du <em>back-end</em> d'authentification (e.g.
<tt class="docutils literal">github:leplatrem</tt>).</p>
</div>
</div>
<div class="section" id="quelques-exemples">
<h3>Quelques exemples</h3>
<p><strong>Blog</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="35%"></col>
<col width="18%"></col>
<col width="46%"></col>
</colgroup>
<thead valign="bottom">
<tr><th class="head">Objet</th>
<th class="head">Permissions</th>
<th class="head">Principals</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><tt class="docutils literal">bucket:blog</tt></td>
<td><tt class="docutils literal">write</tt></td>
<td><tt class="docutils literal"><span class="pre">fxa:&lt;blog</span> owner id&gt;</tt></td>
</tr>
<tr><td rowspan="2"><tt class="docutils literal">collection:articles</tt></td>
<td><tt class="docutils literal">write</tt></td>
<td><tt class="docutils literal">group:moderators</tt></td>
</tr>
<tr><td><tt class="docutils literal">read</tt></td>
<td><tt class="docutils literal">Everyone</tt></td>
</tr>
<tr><td><tt class="docutils literal">record:569e28r98889</tt></td>
<td><tt class="docutils literal">write</tt></td>
<td><tt class="docutils literal"><span class="pre">fxa:&lt;co-author</span> id&gt;</tt></td>
</tr>
</tbody>
</table>
<p><strong>Wiki</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="35%"></col>
<col width="18%"></col>
<col width="46%"></col>
</colgroup>
<thead valign="bottom">
<tr><th class="head">Object</th>
<th class="head">Permissions</th>
<th class="head">Principals</th>
</tr>
</thead>
<tbody valign="top">
<tr><td><tt class="docutils literal">bucket:wiki</tt></td>
<td><tt class="docutils literal">write</tt></td>
<td><tt class="docutils literal"><span class="pre">fxa:&lt;wiki</span> administrator id&gt;</tt></td>
</tr>
<tr><td rowspan="2"><tt class="docutils literal">collection:articles</tt></td>
<td><tt class="docutils literal">write</tt></td>
<td><tt class="docutils literal">Authenticated</tt></td>
</tr>
<tr><td><tt class="docutils literal">read</tt></td>
<td><tt class="docutils literal">Everyone</tt></td>
</tr>
</tbody>
</table>
<p><strong>Sondages</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="34%"></col>
<col width="31%"></col>
<col width="35%"></col>
</colgroup>
<thead valign="bottom">
<tr><th class="head">Objet</th>
<th class="head">Permissions</th>
<th class="head">Principals</th>
</tr>
</thead>
<tbody valign="top">
<tr><td rowspan="2"><tt class="docutils literal">bucket:poll</tt></td>
<td><tt class="docutils literal">write</tt></td>
<td><tt class="docutils literal"><span class="pre">fxa:&lt;admin</span> id&gt;</tt></td>
</tr>
<tr><td><tt class="docutils literal">collection:create</tt></td>
<td><tt class="docutils literal">Authenticated</tt></td>
</tr>
<tr><td rowspan="2"><tt class="docutils literal"><span class="pre">collection:&lt;poll</span> id&gt;</tt></td>
<td><tt class="docutils literal">write</tt></td>
<td><tt class="docutils literal"><span class="pre">fxa:&lt;poll</span> author id&gt;</tt></td>
</tr>
<tr><td><tt class="docutils literal">record:create</tt></td>
<td><tt class="docutils literal">Everyone</tt></td>
</tr>
</tbody>
</table>
<p><strong>Cartes colaboratives</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="34%"></col>
<col width="31%"></col>
<col width="35%"></col>
</colgroup>
<thead valign="bottom">
<tr><th class="head">Objet</th>
<th class="head">Permissions</th>
<th class="head">Principals</th>
</tr>
</thead>
<tbody valign="top">
<tr><td rowspan="2"><tt class="docutils literal">bucket:maps</tt></td>
<td><tt class="docutils literal">write</tt></td>
<td><tt class="docutils literal"><span class="pre">fxa:&lt;admin</span> id&gt;</tt></td>
</tr>
<tr><td><tt class="docutils literal">collection:create</tt></td>
<td><tt class="docutils literal">Authenticated</tt></td>
</tr>
<tr><td rowspan="2"><tt class="docutils literal"><span class="pre">collection:&lt;map</span> id&gt;</tt></td>
<td><tt class="docutils literal">write</tt></td>
<td><tt class="docutils literal"><span class="pre">fxa:&lt;map</span> author id&gt;</tt></td>
</tr>
<tr><td><tt class="docutils literal">read</tt></td>
<td><tt class="docutils literal">Everyone</tt></td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">record:&lt;record</span> id&gt;</tt></td>
<td><tt class="docutils literal">write</tt></td>
<td><tt class="docutils literal"><span class="pre">fxa:&lt;maintainer</span> id&gt;</tt>
(<em>ex. event staff member
maintaining venues</em>)</td>
</tr>
</tbody>
</table>
<p><strong>Plateformes</strong></p>
<p>Bien s√ªr, il y a plusieurs fa√ßons de mod√©liser les cas d'utilisation typiques.
Par exemple, on peut imaginer une plateforme de wikis (√† la wikia.com), o√π les
wikis sont priv√©s par d√©faut et certaines pages peuvent √™tre rendues publiques :</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%"></col>
<col width="30%"></col>
<col width="38%"></col>
</colgroup>
<thead valign="bottom">
<tr><th class="head">Objet</th>
<th class="head">Permissions</th>
<th class="head">Principals</th>
</tr>
</thead>
<tbody valign="top">
<tr><td rowspan="3"><tt class="docutils literal">bucket:freewiki</tt></td>
<td><tt class="docutils literal">write</tt></td>
<td><tt class="docutils literal"><span class="pre">fxa:&lt;administrator</span> id&gt;</tt></td>
</tr>
<tr><td><tt class="docutils literal">collection:create</tt></td>
<td><tt class="docutils literal">Authenticated</tt></td>
</tr>
<tr><td><tt class="docutils literal">group:create</tt></td>
<td><tt class="docutils literal">Authenticated</tt></td>
</tr>
<tr><td rowspan="2"><tt class="docutils literal"><span class="pre">collection:&lt;wiki</span> id&gt;</tt></td>
<td><tt class="docutils literal">write</tt></td>
<td><tt class="docutils literal"><span class="pre">fxa:&lt;wiki</span> owner id&gt;</tt>,
<tt class="docutils literal"><span class="pre">group:&lt;editors</span> id&gt;</tt></td>
</tr>
<tr><td><tt class="docutils literal">read</tt></td>
<td><tt class="docutils literal"><span class="pre">group:&lt;readers</span> id&gt;</tt></td>
</tr>
<tr><td><tt class="docutils literal"><span class="pre">record:&lt;page</span> id&gt;</tt></td>
<td><tt class="docutils literal">read</tt></td>
<td><tt class="docutils literal">Everyone</tt></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="l-api-http">
<h3>L'API HTTP</h3>
<p>Lors de la cr√©ation d'un objet, l'utilisateur se voit
attribu√© la permission <tt class="docutils literal">write</tt> sur l'objet :</p>
<div class="highlight"><pre><span class="nf">PUT</span> <span class="nn">/v1/buckets/servicedenuages_blog</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer 0b9c2625dc21ef05f6ad4ddf47c5f203837aa32ca42fced54c2625dc21efac32</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>

HTTP/1.1 201 Created
Content-Type: application/json; charset=utf-8

{
    "id": "servicedenuages_blog",
    "permissions": {
        "write": ["fxa:49d02d55ad10973b7b9d0dc9eba7fdf0"]
    }
}
</pre></div>
<p>Il est possible d'ajouter des permissions √† l'aide de <tt class="docutils literal">PATCH</tt> :</p>
<div class="highlight"><pre><span class="nf">PATCH</span> <span class="nn">/v1/buckets/servicedenuages_blog/collections/articles</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Authorization</span><span class="o">:</span> <span class="l">Bearer 0b9c2625dc21ef05f6ad4ddf47c5f203837aa32ca42fced54c2625dc21efac32</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">application/json</span>

{
    "permissions": {
        "read": ["+system.Everyone"]
    }
}

HTTP/1.1 201 Created
Content-Type: application/json; charset=utf-8

{
    "id": "servicedenuages_blog",
    "permissions": {
        "write": ["fxa:49d02d55ad10973b7b9d0dc9eba7fdf0"],
        "read": ["system.Everyone"]
    }
}
</pre></div>
<p>Pour le <tt class="docutils literal">PATCH</tt> nous utilisons la syntaxe pr√©fix√©e par un <tt class="docutils literal">+</tt> ou
par un <tt class="docutils literal">-</tt> pour ajouter ou enlever des <em>principals</em> sur un ACL.</p>
<p>Il est √©galement possible de faire un <tt class="docutils literal">PUT</tt> pour r√©initialiser les ACLs,
sachant que le <tt class="docutils literal">PUT</tt> va ajouter l'utilisateur courant √† la
liste automatiquement mais qu'il pourra se retirer avec un <tt class="docutils literal">PATCH</tt>.
Ajouter l'utilisateur courant permet d'√©viter les situations o√π plus
personne n'a acc√®s aux donn√©es.</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">La permission <tt class="docutils literal">create</tt> est valable pour <tt class="docutils literal">POST</tt> mais aussi pour <tt class="docutils literal">PUT</tt>
lorsque l'enregistrement n'existe pas.</p>
</div>
</div>
<div class="section" id="le-cas-specifique-des-donnees-utilisateurs">
<h3>Le cas sp√©cifique des donn√©es utilisateurs</h3>
<p>Une des fonctionnalit√©s actuelles de <em>Kinto</em> est de pouvoir g√©rer des
collections d'enregistrements par utilisateur.</p>
<p>Sous <em>*nix</em> il est possible, pour une
application, de sauvegarder la configuration de l'utilisateur courant
dans son dossier personnel sans se soucier de l'emplacement sur
le disque en utilisant <tt class="docutils literal">~/</tt>.</p>
<p>Dans notre cas si une application souhaite sauvegarder les contacts d'un
utilisateur, elle peut utiliser le raccourci <tt class="docutils literal">~</tt> pour faire r√©f√©rence au
<em>bucket</em> <strong>personnel</strong> de l'utilisateur : <tt class="docutils literal"><span class="pre">/buckets/~/collections/contacts</span></tt></p>
<p>Cette URL retournera le code <tt class="docutils literal">HTTP 307</tt> vers le <em>bucket</em> de l'utilisateur courant :</p>
<div class="highlight"><pre><span class="nf">POST</span> <span class="nn">/v1/buckets/~/collections/contacts/records</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>

{
   "name": "R√©my",
   "emails": ["remy@example.com"],
   "phones": ["+330820800800"]
}

HTTP/1.1 307 Temporary Redirect
Location: /v1/buckets/fxa:49d02d55ad10973b7b9d0dc9eba7fdf0/collections/contacts/records
</pre></div>
<p>Ainsi il est tout √† fait possible √† Alice de partager ses contacts
avec Bob. Il lui suffit pour cela de donner la permission <tt class="docutils literal">read</tt> √†
Bob sur sa collection et de donner l'URL compl√®te
<tt class="docutils literal">/v1/buckets/fxa:49d02d55ad10973b7b9d0dc9eba7fdf0/collections/contacts/records</tt>
√† Bob.</p>
</div>
<div class="section" id="la-delegation-des-permissions">
<h3>La d√©l√©gation des permissions</h3>
<p>Dans le cas de <em>Kinto</em>, nous avons d√©fini un format pour restreindre les
permissions via les scopes OAuth2:
<tt class="docutils literal"><span class="pre">storage:&lt;bucket_id&gt;:&lt;collection_id&gt;:&lt;permissions_list&gt;</span></tt>.</p>
<p>Ainsi, si on reprend l'exemple pr√©c√©dent de la liste de t√¢ches, il est possible pour
Bob de cr√©er un token OAuth sp√©cifique avec les <em>scopes</em> suivants :
<tt class="docutils literal">profile storage:todolist:tasks:write <span class="pre">storage:~:contacts:read+records:create</span></tt></p>
<p>Donc, bien que Bob a la permission <tt class="docutils literal">write</tt> sur ses contacts,
l'application utilisant ce token pourra uniquement lire les contacts
existants et en ajouter de nouveaux.</p>
<p>Une partie de la complexit√© est donc de r√©ussir √† pr√©senter ces <em>scopes</em> de
mani√®re lisible √† l'utilisateur, afin qu'il choisisse quelles permissions
donner aux applications qui agissent en son nom.</p>
<p>Voil√† o√π nous en sommes de notre r√©flexion !</p>
<p>Si vous avez des choses √† ajouter, des points de d√©saccord ou autres
r√©flexions, n'h√©sitez pas √† nous interrompre pendant qu'il est encore temps !</p>
</div>
</div>

            <div class="hr"></div>
            <a href="#" class="go-top">Revenir au d√©but</a>
<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = "servicedenuages"; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div><footer class="footer">
    <p>&copy; Service de nuages &ndash;
        D√©velopp√© avec <a href="https://github.com/PurePelicanTheme/pure">Pure Theme</a>
        et <a href="http://blog.getpelican.com/">Pelican</a>
    </p>
</footer>        </div>
    </div>
</div>
    <script>
        var $top = $('.go-top');

        // Show or hide the sticky footer button
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $top.fadeIn(200);
            } else {
                $top.fadeOut(200);
            }
        });

        // Animate the scroll to top
        $top.click(function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop: 0}, 300);
        })

        // Makes sure that the href="#" attached to the <a> elements
        // don't scroll you back up the page.
        $('body').on('click', 'a[href="#"]', function(event) {
            event.preventDefault();
        });
    </script>
</body>
</html>