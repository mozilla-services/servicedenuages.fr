<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Service de nuages</title><link href="http://www.servicedenuages.fr/en/" rel="alternate"></link><link href="http://www.servicedenuages.fr/feeds/all.atom.xml" rel="self"></link><id>http://www.servicedenuages.fr/en/</id><updated>2018-01-09T00:00:00+01:00</updated><entry><title>Kinto at Mozilla</title><link href="http://www.servicedenuages.fr/en/kinto-at-mozilla" rel="alternate"></link><published>2018-01-09T00:00:00+01:00</published><updated>2018-01-09T00:00:00+01:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2018-01-09:/en/kinto-at-mozilla</id><summary type="html">&lt;p class="first last"&gt;A summary of how Kinto is used at Mozilla&lt;/p&gt;
</summary><content type="html">&lt;p&gt;During the last company all hands, we heard many mentions of &lt;em&gt;Kinto&lt;/em&gt;, mostly from people that we hadn't met before or that weren't aware we were the authors. Part of this fame may probably be due to the success of &lt;a class="reference external" href="https://testpilot.firefox.com/experiments/notes"&gt;Firefox Notes&lt;/a&gt;, and the recent addition of the long awaited notes synchronization features.&lt;/p&gt;
&lt;p&gt;It's amazing how much we've accomplished with this project in very heterogenous contexts, and sadly we haven't really taken the time to celebrate. This post intends to present the different use-cases we are aware of at Mozilla, with some architecture and metrics details.&lt;/p&gt;
&lt;div class="section" id="firefox-remote-settings"&gt;
&lt;h2&gt;Firefox remote settings&lt;/h2&gt;
&lt;p&gt;The original one!&lt;/p&gt;
&lt;p&gt;Firefox engineers edit remote settings like blocklist or certificate revocation lists via the &lt;a class="reference external" href="https://github.com/Kinto/kinto-admin/"&gt;Kinto Admin UI&lt;/a&gt;. There are several buckets for each category of settings listed below.&lt;/p&gt;
&lt;p&gt;The hundreds of millions of Firefox browsers regularly poll for changes using the &lt;a class="reference external" href="https://github.com/Kinto/kinto-changes"&gt;kinto-changes&lt;/a&gt; endpoint. Two instances are deployed with the same database, a public one read-only behind a CDN, and a private one only accessible via a secured VPN.&lt;/p&gt;
&lt;p&gt;Since the remote settings are critical, and served via a CDN, we use &lt;a class="reference external" href="https://github.com/Kinto/kinto-signer"&gt;kinto-signer&lt;/a&gt; to sign the data in order to guarantee authenticity and integrity. It also brings reviewing and sign-off features as well as the previewing changes feature for the QA team. The &lt;a class="reference external" href="https://kinto.readthedocs.io/en/latest/api/1.x/history.html"&gt;history plugin&lt;/a&gt; allows us to track the changes over time.&lt;/p&gt;
&lt;p&gt;The client lies in the Firefox codebase, implemented with &lt;a class="reference external" href="https://github.com/Kinto/kinto.js/"&gt;kinto.js&lt;/a&gt;. It verifies &lt;a class="reference external" href="https://martinthomson.github.io/http-miser/draft-thomson-http-miser.html"&gt;content signatures&lt;/a&gt; to verify that settings are conformant, and has a specific adapter to store local data in SQLite instead of IndexedDB. Some &lt;a class="reference external" href="https://telemetry.mozilla.org/"&gt;Telemetry data&lt;/a&gt; is sent when remote settings are synchronized locally in order to track uptake globally.&lt;/p&gt;
&lt;p&gt;In order to manage buckets and collections, as well as groups and their related permissions, we use &lt;a class="reference external" href="https://github.com/Kinto/kinto-wizard/"&gt;kinto-wizard&lt;/a&gt; that reads a YAML file from a Github private repo, and creates or updates the missing objects.&lt;/p&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;Summary&lt;/dt&gt;
&lt;dd&gt;A few admins edit a source of truth that millions of clients synchronize locally&lt;/dd&gt;
&lt;dt&gt;Instance&lt;/dt&gt;
&lt;dd&gt;&lt;a class="reference external" href="https://firefox.settings.services.mozilla.com"&gt;https://firefox.settings.services.mozilla.com&lt;/a&gt;&lt;/dd&gt;
&lt;dt&gt;Production date&lt;/dt&gt;
&lt;dd&gt;December 2015&lt;/dd&gt;
&lt;dt&gt;Average requests/sec&lt;/dt&gt;
&lt;dd&gt;1000-2000&lt;/dd&gt;
&lt;/dl&gt;
&lt;img alt="Datadog screenshot of requests per second graph for Firefox Settings stack" src="http://www.servicedenuages.fr/en/../images/kinto-at-mozilla-blocklists-rps.png" style="width: 793px; height: auto; max-width: 100%;"/&gt;
&lt;div class="section" id="blocklists"&gt;
&lt;h3&gt;Blocklists&lt;/h3&gt;
&lt;p&gt;The blocklists are used to remotely disable malware addons, malicious or unstable plugins, or some graphical drivers that turned out to be unstable on certain hardware. A custom plugin, kinto-amo, was implemented to serve the blocklist in the same XML format as addons.mozilla.org used to have (or old Firefox versions).&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="certificate-revocation"&gt;
&lt;h3&gt;Certificate revocation&lt;/h3&gt;
&lt;p&gt;Certicates sometimes need to be invalidated before they expire. The OneCRL (certificates revocation list) fulfils that goal.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="certificate-pinning"&gt;
&lt;h3&gt;Certificate pinning&lt;/h3&gt;
&lt;p&gt;When the browser reaches a website via https for the first time, it downloads its certificate. To make sure the certificate is genuine, we use a list of public keys (HPKP) to be compared on the client side.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="android-assets"&gt;
&lt;h3&gt;Android assets&lt;/h3&gt;
&lt;p&gt;In order to reduce the size of the Android installer, some assets — like fonts or hyphenations dictionaries — are downloaded asynchronously. The client polls files from &lt;em&gt;Firefox remote settings&lt;/em&gt;, leveraging &lt;a class="reference external" href="http://github.com/Kinto/kinto-attachment"&gt;kinto-attachment&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="android-and-ios-experiments"&gt;
&lt;h3&gt;Android and iOS experiments&lt;/h3&gt;
&lt;p&gt;This stack is also used to deliver A/B testing features on Android and iOS. The client receives metadata for the on-going experiments.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="resist-fingerprinting-with-fonts-whitelist"&gt;
&lt;h3&gt;Resist fingerprinting with fonts whitelist&lt;/h3&gt;
&lt;p&gt;&lt;a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1336208"&gt;The idea&lt;/a&gt; is to deliver some fonts to avoid downloading them while browsing. The client globally works like the Android assets.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="possible-evolutions"&gt;
&lt;h3&gt;Possible evolutions&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;There is certainly going to be more types of settings for new use-cases&lt;/li&gt;
&lt;li&gt;The stack currently uses &lt;a class="reference external" href="https://github.com/Kinto/kinto-ldap"&gt;kinto-ldap&lt;/a&gt; to authenticate users. We'll switch to &lt;a class="reference external" href="https://github.com/Kinto/kinto/pull/1425"&gt;OpenID Connect&lt;/a&gt; now that the company uses Auth0 everywhere.&lt;/li&gt;
&lt;li&gt;The &lt;a class="reference external" href="https://github.com/mozilla-services/autopush"&gt;Push team&lt;/a&gt; is working on a solution to replace frequent polling with a push (at that scale nothing is trivial).&lt;/li&gt;
&lt;li&gt;The Sync team is working on a new data store for profile data. We'll probably replace the current SQLite adapter.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="webextensions-storage-sync-api"&gt;
&lt;h2&gt;WebExtensions storage.sync API&lt;/h2&gt;
&lt;p&gt;The tough one!&lt;/p&gt;
&lt;p&gt;Firefox is now compatible with the Web Extensions APIs, that allow addons developers to share a common code-base between different browsers. One of these APIs allows addons to store and sync some data (eg. user-preferences).&lt;/p&gt;
&lt;p&gt;In our implementation, the client encrypts the data before sending it to our servers to guarantee privacy. This might not be the case in Chrome by the way. It uses kinto.js and leverages the Firefox Accounts encryption keys.&lt;/p&gt;
&lt;p&gt;This stack allowed us to really stress test Kinto. When popular extensions like AdblockPlus switched to Web Extensions, we had database congestions and lots of 5XX errors. We should have been a lot more thorough with load testing, and hence discovered race conditions and scaling bugs the hard way. Most of them are fixed now though.&lt;/p&gt;
&lt;p&gt;The &lt;a class="reference external" href="https://kinto.readthedocs.io/en/latest/api/1.x/quotas.html"&gt;quota plugin&lt;/a&gt; restricts the amount of objects allowed to be stored. It relies on two Memcache instances as cache backends, mainly used for caching authentication.&lt;/p&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;Summary&lt;/dt&gt;
&lt;dd&gt;Many users have their own private bucket and collections with a limited amount of records&lt;/dd&gt;
&lt;dt&gt;Instance&lt;/dt&gt;
&lt;dd&gt;&lt;a class="reference external" href="https://webextensions.settings.services.mozilla.com"&gt;https://webextensions.settings.services.mozilla.com&lt;/a&gt;&lt;/dd&gt;
&lt;dt&gt;Production date&lt;/dt&gt;
&lt;dd&gt;July 2017&lt;/dd&gt;
&lt;dt&gt;Average requests/sec&lt;/dt&gt;
&lt;dd&gt;1100 (70K/min)&lt;/dd&gt;
&lt;dt&gt;Data size&lt;/dt&gt;
&lt;dd&gt;4M buckets, 11M collections, 13M records&lt;/dd&gt;
&lt;/dl&gt;
&lt;div class="section" id="id1"&gt;
&lt;h3&gt;Possible evolutions&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;We still have some &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Time_of_check_to_time_of_use"&gt;TOCTOU issues&lt;/a&gt; that we would like to tackle.&lt;/li&gt;
&lt;li&gt;At some point, we might have to consider some sharding strategy too.&lt;/li&gt;
&lt;/ul&gt;
&lt;img alt="WebExtensions requests per seconds graphs" src="http://www.servicedenuages.fr/en/../images/kinto-at-mozilla-we-rps.png" style="width: 522px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="firefox-test-pilot"&gt;
&lt;h2&gt;Firefox Test Pilot&lt;/h2&gt;
&lt;p&gt;Authentication is provided by Firefox Accounts and assured by &lt;a class="reference external" href="https://github.com/mozilla-services/kinto-fxa/"&gt;kinto-fxa&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The main challenge here was to reuse the same stack for different Test Pilot extensions, while being able to maintain data isolation and client side encryption.&lt;/p&gt;
&lt;p&gt;Each test pilot addon has its own scope, so that an extension has no permission to read the server data produced by another one (using a kinto-fxa trick that adds prefixes to user ids). Plus, the client side code fetches a different encryption key per extension, which means an extension has no way to decrypt the local data produced by another one.&lt;/p&gt;
&lt;p&gt;By using raw &lt;cite&gt;kinto.js&lt;/cite&gt; on a dedicated stack instead of the storage.sync API, the data produced by Test Pilot extensions can be read outside the browser (eg. native mobile apps).&lt;/p&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;Summary&lt;/dt&gt;
&lt;dd&gt;Many users have their own private bucket and collections with a limited amount of records&lt;/dd&gt;
&lt;dt&gt;Instance&lt;/dt&gt;
&lt;dd&gt;&lt;a class="reference external" href="https://testpilot.settings.services.mozilla.com"&gt;https://testpilot.settings.services.mozilla.com&lt;/a&gt;&lt;/dd&gt;
&lt;dt&gt;Production date&lt;/dt&gt;
&lt;dd&gt;November 2017&lt;/dd&gt;
&lt;dt&gt;Average requests/sec&lt;/dt&gt;
&lt;dd&gt;&amp;lt;1 (40 req/min)&lt;/dd&gt;
&lt;dt&gt;Data size:&lt;/dt&gt;
&lt;dd&gt;700 buckets, 700 collections, 700 records (&lt;em&gt;only one record per sheet of notes&lt;/em&gt;)&lt;/dd&gt;
&lt;/dl&gt;
&lt;img alt="Screenshot of NewRelic overview for the TestPilot Kinto stack" src="http://www.servicedenuages.fr/en/../images/kinto-at-mozilla-testpilot-overview.png" style="width: 1057px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;div class="section" id="buildhub"&gt;
&lt;h2&gt;Buildhub&lt;/h2&gt;
&lt;p&gt;This summer we worked on a comprehensive and standard database of Mozilla product builds. There was no standard solution and many systems within the company were doing it their own way. Our goal was to provide a simple JSON API that applications or scripts could query in order to obtain information about build ids, versions, update channels etc.&lt;/p&gt;
&lt;img alt="Buildhub UI (using SearchKit)" src="http://www.servicedenuages.fr/en/../images/kinto-at-mozilla-buildhub-ui.png" style="width: 800px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;We could have developed a custom solution, but using Kinto allowed us to start very quickly and take advantage of the existing ecosystem as well as our deployment automations.&lt;/p&gt;
&lt;p&gt;In order to provide efficient and advanced query capabilities we developed &lt;a class="reference external" href="https://github.com/Kinto/kinto-elasticsearch/"&gt;kinto-elasticsearch&lt;/a&gt;, a simple plugin that adds a &lt;tt class="docutils literal"&gt;/search&lt;/tt&gt; endpoint to collections of records. It's super powerful for filtering or aggregating records, and it's blazing fast!&lt;/p&gt;
&lt;p&gt;The records are created from an Amazon Lambda function that is triggered every time a new archive is published on &lt;a class="reference external" href="https://archive.mozilla.org"&gt;https://archive.mozilla.org&lt;/a&gt; (which is itself powered by S3).&lt;/p&gt;
&lt;p&gt;We use the recent &lt;a class="reference external" href="https://kinto.readthedocs.io/en/latest/api/1.x/accounts.html"&gt;Kinto Accounts feature&lt;/a&gt; for authentication, where the only user with write access is the lambda one.
To initialize a Kinto instance for buildhub development, most for collection indexing metadata, we also use &lt;a class="reference external" href="https://github.com/Kinto/kinto-wizard/"&gt;kinto-wizard&lt;/a&gt;.&lt;/p&gt;
&lt;dl class="docutils"&gt;
&lt;dt&gt;Summary&lt;/dt&gt;
&lt;dd&gt;A set of scripts update a single collection of many records that are looked up by a few clients&lt;/dd&gt;
&lt;dt&gt;Instance&lt;/dt&gt;
&lt;dd&gt;&lt;a class="reference external" href="https://buildhub.prod.mozaws.net"&gt;https://buildhub.prod.mozaws.net&lt;/a&gt;&lt;/dd&gt;
&lt;dt&gt;Production date&lt;/dt&gt;
&lt;dd&gt;July 2017&lt;/dd&gt;
&lt;dt&gt;Average requests/sec&lt;/dt&gt;
&lt;dd&gt;&amp;lt;0.1 (1 req/min)&lt;/dd&gt;
&lt;dt&gt;Data size&lt;/dt&gt;
&lt;dd&gt;1 collection with ~800K records (&lt;em&gt;and growing&lt;/em&gt;)&lt;/dd&gt;
&lt;/dl&gt;
&lt;div class="section" id="id3"&gt;
&lt;h3&gt;Possible evolutions&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;We may want to split the big single collection into one per update channel (stable, beta, nightly...)&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="packaging"&gt;
&lt;h2&gt;Packaging&lt;/h2&gt;
&lt;p&gt;Since we have a variety of plugins, we bundled them into a &lt;em&gt;distribution&lt;/em&gt; package. &lt;a class="reference external" href="https://github.com/Kinto/kinto-dist/"&gt;kinto-dist&lt;/a&gt; is like a meta-package that gathers all the necessary plugins and dependencies for our stacks.&lt;/p&gt;
&lt;p&gt;We use Docker in production, following the &lt;a class="reference external" href="https://github.com/mozilla-services/Dockerflow"&gt;Dockerflow&lt;/a&gt; conventions.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="the-future"&gt;
&lt;h2&gt;The future...&lt;/h2&gt;
&lt;p&gt;Test Pilot is probably the setup where Kinto fits most our initial vision. Frontend apps synchronizing strongly encrypted data, using keys that are obtained from user identity. The only blocker to apply the same approach to any Web app is that Firefox Accounts (and its keys API) is still restricted to Mozilla applications.&lt;/p&gt;
&lt;p&gt;The only type of use-case that we don't have yet in production at Mozilla is a collaborative application, where several users interact with the same collection of data, leveraging our sharing and push events features.&lt;/p&gt;
&lt;p&gt;We tend to believe that Kinto is feature complete. Some of the external plugins are stable enough to be promoted as built-in plugins, which may improve the developer experience. Polishing the documentation could be one of our top priorites. Same goes for the product and marketing aspects, but that doesn't depend only on us.&lt;/p&gt;
&lt;p&gt;Of course, there is some amount of technical debt that could be tackled here and there. And to be honest we don't see a huge amount of external contributions and pull requests on the Kinto Github org. The &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Bus_factor"&gt;bus factor&lt;/a&gt; is quite high!&lt;/p&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>Enabling Slack automatic updates on Debian and Ubuntu</title><link href="http://www.servicedenuages.fr/en/slack-deb-automatic-updates" rel="alternate"></link><published>2017-07-18T00:00:00+02:00</published><updated>2017-07-18T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2017-07-18:/en/slack-deb-automatic-updates</id><summary type="html">&lt;p class="first last"&gt;A little tip to enable automatic updates of Slack with Debian and Linux&lt;/p&gt;
</summary><content type="html">&lt;div class="section" id="installing-slack-on-linux"&gt;
&lt;h2&gt;Installing Slack on Linux&lt;/h2&gt;
&lt;p&gt;The proper way to install Slack is to download the installer for your
Operating System on the &lt;a class="reference external" href="https://slack.com/downloads"&gt;Slack website&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;However I realized my Slack client was not really up-to-date.&lt;/p&gt;
&lt;p&gt;When installing Slack, a daily cronjob is installed automatically
which is supposed to configure the automatic updates.&lt;/p&gt;
&lt;p&gt;However for some reason on my computer the cronjob while running never
installed anything.&lt;/p&gt;
&lt;p&gt;It is only when I started to encounter problems with my Slack client
that I realized I had an outdated version.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="how-to-verify-if-slack-is-correctly-configured"&gt;
&lt;h2&gt;How to verify if Slack is correctly configured?&lt;/h2&gt;
&lt;p&gt;The configuration should create the following file: &lt;tt class="docutils literal"&gt;/etc/apt/sources.list.d/slack.list&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;If this file is missing, you can use the following steps to install it manually.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="configuring-apt-for-slack-updates"&gt;
&lt;h2&gt;Configuring APT for Slack updates&lt;/h2&gt;
&lt;p&gt;There is a tutorial and an automatic script that you can find here:
&lt;a class="reference external" href="https://packagecloud.io/slacktechnologies/slack/install"&gt;https://packagecloud.io/slacktechnologies/slack/install&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;But if you want to do it step by step, here is how to do it.&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;First add the &lt;a class="reference external" href="https://packagecloud.io/app/slacktechnologies/slack/gpg#gpg-apt"&gt;repository key&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;wget -O - https://packagecloud.io/slacktechnologies/slack/gpgkey  &lt;span class="p"&gt;|&lt;/span&gt; sudo apt-key add -
&lt;/pre&gt;&lt;/div&gt;
&lt;ol class="arabic simple" start="2"&gt;
&lt;li&gt;Enter your password and you should see the following result.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;--201X-XX-XX XX:XX:28--  https://packagecloud.io/slacktechnologies/slack/gpgkey
-                         &lt;span class="m"&gt;100&lt;/span&gt;%&lt;span class="o"&gt;[===================================&lt;/span&gt;&amp;gt;&lt;span class="o"&gt;]&lt;/span&gt;   &lt;span class="m"&gt;3&lt;/span&gt;,86K  --.-KB/s    in 0s
201X-XX-XX XX:XX:30 &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="m"&gt;59&lt;/span&gt;,8 MB/s&lt;span class="o"&gt;)&lt;/span&gt; — &lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="m"&gt;3954&lt;/span&gt;/3954&lt;span class="o"&gt;]&lt;/span&gt;

OK
&lt;/pre&gt;&lt;/div&gt;
&lt;ol class="arabic simple" start="3"&gt;
&lt;li&gt;Create the file &lt;strong&gt;/etc/apt/sources.list.d/slack.list&lt;/strong&gt; with the following content&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;deb https://packagecloud.io/slacktechnologies/slack/debian/ jessie main
&lt;/pre&gt;&lt;/div&gt;
&lt;ol class="arabic simple" start="4"&gt;
&lt;li&gt;Run &lt;tt class="docutils literal"&gt;sudo apt update&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;Run &lt;tt class="docutils literal"&gt;sudo apt install &lt;span class="pre"&gt;slack-desktop&lt;/span&gt;&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;That's it, Slack is now installed and will update itself automatically with APT.&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>Kinto and ElasticSearch</title><link href="http://www.servicedenuages.fr/en/kinto-elasticsearch" rel="alternate"></link><published>2017-06-21T00:00:00+02:00</published><updated>2017-06-21T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2017-06-21:/en/kinto-elasticsearch</id><summary type="html">&lt;p class="first last"&gt;Introducing our ElasticSearch plugin for Kinto&lt;/p&gt;
</summary><content type="html">&lt;div class="section" id="elasticsearch-integration"&gt;
&lt;h2&gt;ElasticSearch integration&lt;/h2&gt;
&lt;p&gt;Kinto is a generic API on top of a storage backend.
ElasticSearch is a generic API on top of an indexing backend. When combining both,
your data is stored in a persistent database, and you can search, aggregate and
filter it efficiently.&lt;/p&gt;
&lt;p&gt;This integration has been sitting around for a long time, since it was the subject of
our &lt;a class="reference external" href="http://kinto.readthedocs.io/en/7.0.1/tutorials/write-plugin.html"&gt;Kinto plugin tutorial&lt;/a&gt;. But recently, we had a concrete use-case at Mozilla
so we published it as &lt;a class="reference external" href="https://github.com/Kinto/kinto-elasticsearch/"&gt;an official plugin&lt;/a&gt;!&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="use-case"&gt;
&lt;h2&gt;Use case&lt;/h2&gt;
&lt;p&gt;Mozilla publishes its products for several platforms, in a lot of different locales (&lt;em&gt;70-100 regions/languages&lt;/em&gt;),
and at different stages of maturity (&lt;em&gt;nightly, beta, release, ESR&lt;/em&gt;). And currently there
is no comprehensive or official database for every released version and its associated
metadata (revision, build date, ...).&lt;/p&gt;
&lt;p&gt;Our task was to build an API to allow third-party scripts and tools to publish or query
metadata about released products, as well as a nice UI to explore and browse the catalog.&lt;/p&gt;
&lt;p&gt;Kinto gives us a ready-to-use JSON storage API, whose accessibility via &lt;tt class="docutils literal"&gt;curl&lt;/tt&gt; is rather intuitive,
and for which we can manage authentication and permissions using simple tokens or LDAP.
ElasticSearch gives us a rocket fast index that powers the faceted search of our catalog.&lt;/p&gt;
&lt;img alt="Prototype UI using SearchKit" src="http://www.servicedenuages.fr/en/../images/buildhub-searchkit-screenshot.png" style="width: 1253px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;div class="section" id="how-does-it-work"&gt;
&lt;h2&gt;How does it work?&lt;/h2&gt;
&lt;p&gt;Basically, when enabling the plugin a new endpoint is available: &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;/buckets/{bid}/collections/{cid}/search&lt;/span&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;When the collection is created, a dedicated index is created on the underlying ElasticSearch cluster/instance.
When a record is created, it is duplicated in the collection index.
The &lt;tt class="docutils literal"&gt;/search&lt;/tt&gt; on the collection is just a pass-through endpoint of the collection, where you post a query and obtain the results.
You can only access it if you have the permission to read the whole collection.&lt;/p&gt;
&lt;p&gt;By default, ElasticSearch will infer the field types from the posted data. But it is possible to define and force the mapping schema in the collection metadata.&lt;/p&gt;
&lt;p&gt;The installation is straightforward:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pip install kinto-elasticsearch
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And activation is done as usual in the settings:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="na"&gt;kinto.includes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;kinto_elasticsearch&lt;/span&gt;
&lt;span class="na"&gt;kinto.elasticsearch.hosts&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;localhost:9200&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="example-with-geographical-data"&gt;
&lt;h2&gt;Example with geographical data&lt;/h2&gt;
&lt;p&gt;ElasticSearch supports geospatial indices, which allow — for example — to filter points contained in a rectangle (aka. bounding box).&lt;/p&gt;
&lt;p&gt;In this example, we'll import some OpenStreetMap data into a Kinto collection. &lt;a class="reference external" href="https://kinto.github.io/kinto-elasticsearch/"&gt;A simple Leaflet map&lt;/a&gt; will then display all records as dots on the map, and filter the list of results based on the current map extent using the search endpoint.&lt;/p&gt;
&lt;div class="section" id="loading-the-data"&gt;
&lt;h3&gt;Loading the data&lt;/h3&gt;
&lt;p&gt;We can obtain some OSM export on &amp;lt;&lt;a class="reference external" href="http://overpass-turbo.eu"&gt;http://overpass-turbo.eu&lt;/a&gt;&amp;gt;. For example, the following query will return every pizzeria of Italy:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
area[name="Italia"];(node["cuisine"="pizza"](area););out;
&lt;/pre&gt;
&lt;p&gt;We export and save the result as &lt;tt class="docutils literal"&gt;export.geojson&lt;/tt&gt;.&lt;/p&gt;
&lt;img alt="Screenshot of query on overpass-turbo.eu" src="http://www.servicedenuages.fr/en/../images/overpass-turbo.png" style="width: 1569px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;We load it into Kinto using &lt;a class="reference external" href="https://github.com/Kinto/kinto-http.py"&gt;kinto-http.py&lt;/a&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;kinto_http&lt;/span&gt;

&lt;span class="n"&gt;server&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"http://localhost:8888/v1"&lt;/span&gt;
&lt;span class="n"&gt;bucket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"restaurants"&lt;/span&gt;
&lt;span class="n"&gt;collection&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"pizzerias"&lt;/span&gt;
&lt;span class="n"&gt;auth&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"user"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"pass"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="c1"&gt;# Create the destination bucket.&lt;/span&gt;
&lt;span class="n"&gt;client&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;kinto_http&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Client&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;server_url&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;auth&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;auth&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create_bucket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;bucket&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;if_not_exists&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We define the index and permissions. Each pizzeria will have a name and a location (long, lat).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# Define the ElasticSearch mapping in the collection metadata.&lt;/span&gt;
&lt;span class="n"&gt;collection_metadata&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;"index:schema"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="s2"&gt;"properties"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="s2"&gt;"name"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="s2"&gt;"type"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"text"&lt;/span&gt;
            &lt;span class="p"&gt;},&lt;/span&gt;
            &lt;span class="s2"&gt;"location"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="s2"&gt;"type"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"geo_point"&lt;/span&gt;
            &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="c1"&gt;# Let anonymous users read the records (online map demo).&lt;/span&gt;
&lt;span class="n"&gt;collection_permissions&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;"read"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;"system.Everyone"&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create_collection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;bucket&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;bucket&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;collection_metadata&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                         &lt;span class="n"&gt;permissions&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;collection_permissions&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;if_not_exists&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Create a record for each «feature» in the GeoJSON file, using batched requests (one HTTP request includes many creations):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;export&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;load&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"export.geojson"&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;client&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;batch&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;batch&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;pizzeria&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;export&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;"features"&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
        &lt;span class="n"&gt;record&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="s2"&gt;"name"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;pizzeria&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;"properties"&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"name"&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
            &lt;span class="s2"&gt;"location"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;pizzeria&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;"geometry"&lt;/span&gt;&lt;span class="p"&gt;][&lt;/span&gt;&lt;span class="s2"&gt;"coordinates"&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="n"&gt;batch&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create_record&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;record&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;bucket&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;bucket&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;collection&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="web-mapping"&gt;
&lt;h3&gt;Web mapping&lt;/h3&gt;
&lt;p&gt;Now that the data is loaded in Kinto, indexed in ElasticSearch, and publicly available, we'll render a map.&lt;/p&gt;
&lt;p&gt;Leaflet.js is a nice piece of software that makes webmapping really pleasant.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;// A map with OpenStreetMap background.&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;map&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;L&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'map'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="nx"&gt;L&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;tileLayer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'http://{s}.tile.osm.org/{z}/{x}/{y}.png'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;attribution&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'&amp;amp;copy; &amp;lt;a href="http://osm.org/copyright"&amp;gt;OpenStreetMap&amp;lt;/a&amp;gt; contributors'&lt;/span&gt;
&lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;addTo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Using &lt;a class="reference external" href="https://github.com/Kinto/kinto-http.js/"&gt;kinto-http.js&lt;/a&gt;, it is also quite intuitive to retrieve the whole list of records:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;// Fetch all records from Kinto to populate the map layer.&lt;/span&gt;
&lt;span class="c1"&gt;// (Note: this also could have been done using ES.)&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;kinto&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;KintoClient&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;server&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="nx"&gt;kinto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;bucket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;bucket&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;listRecords&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(({&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;pizzerias&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// ...&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Showing records on the map is done like this. (Note: it would have been even simpler if Leaflet &lt;a class="reference external" href="https://macwright.org/2016/07/15/longitude-latitude-is-the-right-way.html"&gt;hadn't followed&lt;/a&gt; GMaps and used {long, lat} instead of {lat, long}.)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;// Add a circle on the map for each record.&lt;/span&gt;
&lt;span class="nx"&gt;pizzerias&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nx"&gt;pizzeria&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="c1"&gt;// Leaflet maps use [lat, lng] and GeoJSON uses [lng, lat].&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;latlng&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;pizzeria&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nx"&gt;pizzeria&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]];&lt;/span&gt;

  &lt;span class="nx"&gt;L&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;circleMarker&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;latlng&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;color&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'purple'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;fillOpacity&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mf"&gt;0.7&lt;/span&gt;
  &lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;setRadius&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;addTo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In order to query the search endpoint, we use the &lt;a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API"&gt;fetch API&lt;/a&gt; and post a query that defines a filter using a rectangle:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nx"&gt;async&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;searchExtent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;bbox&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;query&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;query&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nx"&gt;bool&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;must&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
          &lt;span class="nx"&gt;match_all&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{},&lt;/span&gt;
        &lt;span class="p"&gt;},&lt;/span&gt;
        &lt;span class="nx"&gt;filter&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
          &lt;span class="nx"&gt;geo_bounding_box&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
              &lt;span class="nx"&gt;top&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;bbox&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getNorthWest&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;lat&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
              &lt;span class="nx"&gt;left&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;bbox&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getNorthWest&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;lng&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
              &lt;span class="nx"&gt;bottom&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;bbox&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getSouthEast&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;lat&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
              &lt;span class="nx"&gt;right&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;bbox&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getSouthEast&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;lng&lt;/span&gt;
            &lt;span class="p"&gt;}&lt;/span&gt;
          &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
      &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;};&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nx"&gt;server&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="sb"&gt;/buckets/&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nx"&gt;bucket&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="sb"&gt;/collections/&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nx"&gt;collection&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="sb"&gt;/search`&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;hits&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;hits&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;await&lt;/span&gt; &lt;span class="nx"&gt;postJSON&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;query&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;hits&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nx"&gt;async&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;postJSON&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;body&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;await&lt;/span&gt; &lt;span class="nx"&gt;fetch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;url&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;body&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;stringify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;body&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
    &lt;span class="nx"&gt;method&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"POST"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;"Content-Type"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"application/json"&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;await&lt;/span&gt; &lt;span class="nx"&gt;response&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;json&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now that we know how to render the map and obtain the list of records on a rectangle, we just need to listen to the map move event and refresh the list of results:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;on&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'load moveend'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;async&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="c1"&gt;// Query ElasticSearch with the current map bounds as search extent.&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;bbox&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;target&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getBounds&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;hits&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;await&lt;/span&gt; &lt;span class="nx"&gt;searchExtent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;bbox&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

  &lt;span class="c1"&gt;// Render the results as a list of bullet points.&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;listing&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"listing"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="nx"&gt;listing&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;innerHTML&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;""&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="nx"&gt;hits&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(({&lt;/span&gt;&lt;span class="nx"&gt;_source&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;pizzeria&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;node&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;createElement&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"li"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;textnode&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;createTextNode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;pizzeria&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;name&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="s2"&gt;"(No name)"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nx"&gt;node&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;appendChild&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;textnode&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nx"&gt;listing&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;appendChild&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;node&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here you go!&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://kinto.github.io/kinto-elasticsearch/"&gt;Online demo&lt;/a&gt;&lt;/p&gt;
&lt;img alt="kinto-elasticsearch map search extent" src="http://www.servicedenuages.fr/en/../images/kinto-elasticsearch-demo.gif" style="width: 812px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>Getting started with Elm</title><link href="http://www.servicedenuages.fr/en/getting-started-with-elm" rel="alternate"></link><published>2017-04-13T00:00:00+02:00</published><updated>2017-04-13T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2017-04-13:/en/getting-started-with-elm</id><summary type="html">&lt;p class="first last"&gt;What is Elm? how does it work? How can I try it really fast?&lt;/p&gt;
</summary><content type="html">&lt;div class="section" id="introduction"&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;The past two weeks we have been traveling and meeting a bunch of
developers.&lt;/p&gt;
&lt;p&gt;It was a chance for us to tell them about &lt;a class="reference external" href="http://www.elm-lang.org/"&gt;Elm&lt;/a&gt; through talks at
conferences and to present a short one-hour workshop.&lt;/p&gt;
&lt;p&gt;You can find the slides of the two talks here:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://slides.com/n1k0/elm"&gt;a short introduction to Elm by Niko&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://natim.github.io/django-slides/elm-json/"&gt;Talking JSON with Elm by Natim&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;However, this article is a summary of the take aways of this workshop
for those who would like to know a bit more about Elm.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="what-is-elm-and-why-should-i-be-interested"&gt;
&lt;h2&gt;What is Elm and why should I be interested?&lt;/h2&gt;
&lt;p&gt;&lt;a class="reference external" href="http://www.elm-lang.org/"&gt;Elm&lt;/a&gt; is a Web application development platform, providing a programming
language, a compiler, an architecture and tooling around. It focuses
on making sure your app state and the HTML that reflects it are always
in sync.&lt;/p&gt;
&lt;p&gt;If you have been doing any frontend development during the last couple
of years, you might have seen that the JavaScript ecosystem is a bit
wild. Keeping up-to-date with the growing number of competing
frameworks can take a lot of energy, not to mention the challenge in
making sure your app works on all the available browser versions.&lt;/p&gt;
&lt;p&gt;In addition, writing tests for the front-end can be tedious and
supporting &lt;a class="reference external" href="https://flow.org/en/"&gt;Flow&lt;/a&gt; or &lt;a class="reference external" href="https://www.typescriptlang.org/"&gt;TypeScript&lt;/a&gt;, while tremendously useful, is yet
another layer to setup, configure and maintain in your stack.&lt;/p&gt;
&lt;p&gt;You can think of the Elm platform as the equivalent combined feature
set of &lt;a class="reference external" href="https://facebook.github.io/react/"&gt;React&lt;/a&gt;, &lt;a class="reference external" href="http://redux.js.org/"&gt;Redux&lt;/a&gt;, &lt;a class="reference external" href="https://github.com/reactjs/react-redux"&gt;react-redux&lt;/a&gt;, &lt;a class="reference external" href="https://babeljs.io/"&gt;Babel&lt;/a&gt;, &lt;a class="reference external" href="http://eslint.org/"&gt;eslint&lt;/a&gt;, Flow/Typescript
and &lt;a class="reference external" href="https://webpack.github.io/"&gt;Webpack&lt;/a&gt; all bundled in a single homogeneous and consistent package!&lt;/p&gt;
&lt;p&gt;Elm brings functional programming to your browser. The language is
statically typed, so with Elm you won't see any runtime errors caused
by inconsistent typing. Being functional and pure, Elm let you write code
that is completely decoupled, which makes your code more reusable and
easier to refactor.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="how-is-elm-different"&gt;
&lt;h2&gt;How is Elm different?&lt;/h2&gt;
&lt;p&gt;Most of the time, using Elm, the two lines it takes to load your app
from the HTML file is all the JavaScript you will write, as your Elm
code will be compiled to JavaScript by the Elm compiler.&lt;/p&gt;
&lt;p&gt;Most mistakes you make will be caught at compilation time, which
means that you will barely ever encounter exceptions at runtime in the
browser. Also that means less unit tests and defensive programming to
write, which is always good.&lt;/p&gt;
&lt;p&gt;Because there is a compilation step, Elm forces you to handle every
possible case of your model state. It makes sure you covered them on
the rendering side.&lt;/p&gt;
&lt;p&gt;Also, the Elm compiler is &lt;em&gt;super&lt;/em&gt; smart. It always does its best to
help you with meaningful messages, provides guidance to fix your types
and handle uncovered edge cases. It even finds your typos!&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Cannot find variable &lt;span class="sb"&gt;`&lt;/span&gt;nane&lt;span class="sb"&gt;`&lt;/span&gt;

&lt;span class="m"&gt;13&lt;/span&gt;&lt;span class="p"&gt;|&lt;/span&gt;     hello ++ &lt;span class="s2"&gt;", "&lt;/span&gt; ++ nane ++ &lt;span class="s2"&gt;"!"&lt;/span&gt;
                         ^^^^
Maybe you want one of the following?

    name
    tan
    Cmd.none
    Sub.none

Detected errors in &lt;span class="m"&gt;1&lt;/span&gt; module.
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The tooling is great. &lt;a class="reference external" href="https://github.com/tomekwi/elm-live"&gt;elm-live&lt;/a&gt; automatically updates the browser
code to reflect your code update in realtime. It comes with a debugger
that will show you the list of events and state of your application at
a given point in time — you can even go back in time and replay previous
events. &lt;a class="reference external" href="https://github.com/avh4/elm-format"&gt;elm-format&lt;/a&gt; will also format your code automatically to avoid
fighting over coding styles.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="getting-started"&gt;
&lt;h2&gt;Getting started&lt;/h2&gt;
&lt;div class="section" id="installing-elm"&gt;
&lt;h3&gt;Installing Elm&lt;/h3&gt;
&lt;p&gt;First of all install &lt;tt class="docutils literal"&gt;elm&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;elm-format&lt;/span&gt;&lt;/tt&gt; using &lt;a class="reference external" href="https://www.npmjs.com/"&gt;npm&lt;/a&gt; — the nodejs
package manager.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;npm install -g elm elm-format
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="looking-for-an-ide"&gt;
&lt;h3&gt;Looking for an IDE?&lt;/h3&gt;
&lt;p&gt;Have a look at &lt;a class="reference external" href="https://atom.io/"&gt;Atom&lt;/a&gt;. Combined with the
&lt;a class="reference external" href="https://atom.io/packages/elm-format"&gt;appropriate extension&lt;/a&gt;, it will
run &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;elm-format&lt;/span&gt;&lt;/tt&gt; each time you save your file – which is super handy.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://atom.io/packages/elmjutsu"&gt;Elmjutsu&lt;/a&gt; is another useful package providing type-aware autocompletion
among other niceties.&lt;/p&gt;
&lt;p&gt;Take a moment to make sure your text editor is configured to work well
with Elm files.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="starting-your-first-project"&gt;
&lt;h2&gt;Starting your first project&lt;/h2&gt;
&lt;p&gt;No need for boilerplate here, you can just start by running
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;elm-package&lt;/span&gt; install&lt;/tt&gt; to install the core packages required to start
creating your app:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;~/tutorial$ elm-package install

Some new packages are needed. Here is the upgrade plan.

  Install:
    elm-lang/core &lt;span class="m"&gt;5&lt;/span&gt;.1.1
    elm-lang/html &lt;span class="m"&gt;2&lt;/span&gt;.0.0
    elm-lang/virtual-dom &lt;span class="m"&gt;2&lt;/span&gt;.0.4

Do you approve of this plan? &lt;span class="o"&gt;[&lt;/span&gt;Y/n&lt;span class="o"&gt;]&lt;/span&gt; Y
Starting downloads...

  ● elm-lang/html &lt;span class="m"&gt;2&lt;/span&gt;.0.0
  ● elm-lang/virtual-dom &lt;span class="m"&gt;2&lt;/span&gt;.0.4
  ● elm-lang/core &lt;span class="m"&gt;5&lt;/span&gt;.1.1

Packages configured successfully!
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You now have an &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;elm-package.json&lt;/span&gt;&lt;/tt&gt; file in your project as well as a
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;elm-stuff/&lt;/span&gt;&lt;/tt&gt; directory that contains libraries that &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;elm-package&lt;/span&gt;&lt;/tt&gt;
installed. &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;elm-package.json&lt;/span&gt;&lt;/tt&gt; is to Elm projects what
&lt;tt class="docutils literal"&gt;package.json&lt;/tt&gt; is to nodejs ones.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;~/tutorial$ tree -L2
├── elm-package.json
└── elm-stuff
    ├── exact-dependencies.json
    └── packages

&lt;span class="m"&gt;2&lt;/span&gt; directories, &lt;span class="m"&gt;2&lt;/span&gt; files
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="creating-your-first-file"&gt;
&lt;h2&gt;Creating your first file&lt;/h2&gt;
&lt;p&gt;To get started you can simply create a new file named &lt;tt class="docutils literal"&gt;Main.elm&lt;/tt&gt;
with the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import &lt;/span&gt;&lt;span class="nc"&gt;Html&lt;/span&gt;
&lt;span class="kr"&gt;main &lt;/span&gt;&lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="kt"&gt;Html&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;text&lt;/span&gt; &lt;span class="s"&gt;"Hello world"&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Elm benefits from a full featured module system, with a broad
ecosystem of external packages avaiable. &lt;tt class="docutils literal"&gt;Html&lt;/tt&gt; is part of the core.&lt;/p&gt;
&lt;div class="section" id="playing-with-elm-format"&gt;
&lt;h3&gt;Playing with elm-format&lt;/h3&gt;
&lt;p&gt;If your editor is well configured with &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;elm-format&lt;/span&gt;&lt;/tt&gt;, you should see
this as soon as you save it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;module &lt;/span&gt;&lt;span class="nc"&gt;Main&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;

&lt;span class="kn"&gt;import &lt;/span&gt;&lt;span class="nc"&gt;Html&lt;/span&gt;


&lt;span class="kr"&gt;main &lt;/span&gt;&lt;span class="nf"&gt;=&lt;/span&gt;
    &lt;span class="kt"&gt;Html&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;text&lt;/span&gt; &lt;span class="s"&gt;"Hello world!"&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If not, you can run &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;elm-format&lt;/span&gt;&lt;/tt&gt; manually on your file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;~/tutorial$ elm-format --yes Main.elm
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="opening-your-app-in-the-browser"&gt;
&lt;h3&gt;Opening your app in the browser&lt;/h3&gt;
&lt;p&gt;One way to run your app is to use &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;elm-reactor&lt;/span&gt;&lt;/tt&gt;, the core app browser
provided by the platform:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;~/tutorial$ elm-reactor
elm-reactor &lt;span class="m"&gt;0&lt;/span&gt;.18.0
Listening on http://localhost:8000
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then open &lt;a class="reference external" href="http://localhost:8000/Main.elm"&gt;http://localhost:8000/Main.elm&lt;/a&gt; in your favorite Web browser.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="learning-about-the-elm-virtual-dom"&gt;
&lt;h2&gt;Learning about the Elm virtual DOM&lt;/h2&gt;
&lt;p&gt;Virtual DOM functions to generate HTML are in the &lt;tt class="docutils literal"&gt;Html&lt;/tt&gt; module.&lt;/p&gt;
&lt;p&gt;The &lt;tt class="docutils literal"&gt;Html&lt;/tt&gt; module we used above to render some text also exposes many
more functions for rendering HTML tags. You can import them all using:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import &lt;/span&gt;&lt;span class="nc"&gt;Html&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that unlike with some other languages, the Elm compiler will
complain if you try to import symbols already defined in the current
module, which makes it actually useful and really enjoyable to use.&lt;/p&gt;
&lt;p&gt;You can then use &lt;tt class="docutils literal"&gt;text&lt;/tt&gt; directly for instance:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;main &lt;/span&gt;&lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;text&lt;/span&gt; &lt;span class="s"&gt;"Hello world"&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The Virtual DOM HTML nodes are functions named after standard HTML
tags, and take two parameters:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;A list of attributes&lt;/li&gt;
&lt;li&gt;A list of children&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If I want to create a &lt;tt class="docutils literal"&gt;div&lt;/tt&gt; with a link it would look like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;module &lt;/span&gt;&lt;span class="nc"&gt;Main&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;

&lt;span class="kn"&gt;import &lt;/span&gt;&lt;span class="nc"&gt;Html&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;
&lt;span class="kn"&gt;import &lt;/span&gt;&lt;span class="nc"&gt;Html.Attributes&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;


&lt;span class="kr"&gt;main &lt;/span&gt;&lt;span class="nf"&gt;=&lt;/span&gt;
    &lt;span class="nv"&gt;div&lt;/span&gt;
        &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;class&lt;/span&gt; &lt;span class="s"&gt;"container"&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;a&lt;/span&gt;
            &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;href&lt;/span&gt; &lt;span class="s"&gt;"http://www.servicedenuages.fr/"&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
            &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;text&lt;/span&gt; &lt;span class="s"&gt;"Blog"&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can also create a list of links in our div:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;module &lt;/span&gt;&lt;span class="nc"&gt;Main&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;

&lt;span class="kn"&gt;import &lt;/span&gt;&lt;span class="nc"&gt;Html&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;
&lt;span class="kn"&gt;import &lt;/span&gt;&lt;span class="nc"&gt;Html.Attributes&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;


&lt;span class="kr"&gt;main &lt;/span&gt;&lt;span class="nf"&gt;=&lt;/span&gt;
    &lt;span class="nv"&gt;div&lt;/span&gt;
        &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;class&lt;/span&gt; &lt;span class="s"&gt;"container"&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;ul&lt;/span&gt;
            &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;class&lt;/span&gt; &lt;span class="s"&gt;"links"&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
            &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;li&lt;/span&gt;
                &lt;span class="p"&gt;[]&lt;/span&gt;
                &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;a&lt;/span&gt;
                    &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;href&lt;/span&gt; &lt;span class="s"&gt;"http://www.servicedenuages.fr/"&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
                    &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;text&lt;/span&gt; &lt;span class="s"&gt;"Blog"&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
                &lt;span class="p"&gt;]&lt;/span&gt;
            &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;li&lt;/span&gt;
                &lt;span class="p"&gt;[]&lt;/span&gt;
                &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;a&lt;/span&gt;
                    &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;href&lt;/span&gt; &lt;span class="s"&gt;"http://www.elm-lang.org/"&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
                    &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;text&lt;/span&gt; &lt;span class="s"&gt;"Elm lang"&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
                &lt;span class="p"&gt;]&lt;/span&gt;
            &lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="adding-some-state"&gt;
&lt;h2&gt;Adding some state&lt;/h2&gt;
&lt;p&gt;Now that you know how to render your page in HTML, let's see how to
write a program that handles events.&lt;/p&gt;
&lt;p&gt;The way Elm handles that is by having:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;a &lt;tt class="docutils literal"&gt;Model&lt;/tt&gt;, an Elm record: a bit like a JavaScript object with
properties, that keep the state of the app&lt;/li&gt;
&lt;li&gt;an update function that will handle all the app events and update
the model state accordingly&lt;/li&gt;
&lt;li&gt;a view function that will return the Virtual DOM that matches the state
every time it's updated.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For those who know &lt;a class="reference external" href="http://redux.js.org/"&gt;Redux&lt;/a&gt;, it has been heavily inspired by
Elm. Basically &lt;tt class="docutils literal"&gt;update&lt;/tt&gt; is a reducer.&lt;/p&gt;
&lt;p&gt;The events and their parameters are defined in a &lt;tt class="docutils literal"&gt;Msg&lt;/tt&gt; type, which
is a bit like a enum that would take parameters.&lt;/p&gt;
&lt;p&gt;In order to create our application that handle states, we can use the
&lt;tt class="docutils literal"&gt;beginnerProgram&lt;/tt&gt; from the Html package:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;module &lt;/span&gt;&lt;span class="nc"&gt;Main&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;

&lt;span class="kn"&gt;import &lt;/span&gt;&lt;span class="nc"&gt;Html&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;


&lt;span class="kr"&gt;type&lt;/span&gt; &lt;span class="kt"&gt;Msg&lt;/span&gt;
    &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="kt"&gt;NoOp&lt;/span&gt;


&lt;span class="kr"&gt;type&lt;/span&gt; &lt;span class="kr"&gt;alias&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;String&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;


&lt;span class="kr"&gt;main &lt;/span&gt;&lt;span class="nf"&gt;=&lt;/span&gt;
    &lt;span class="nv"&gt;beginnerProgram&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="s"&gt;"Rémy"&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="nv"&gt;view&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;view&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;update&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;update&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;


&lt;span class="nv"&gt;update&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Msg&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt;
&lt;span class="nv"&gt;update&lt;/span&gt; &lt;span class="nv"&gt;msg&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt;
    &lt;span class="nv"&gt;model&lt;/span&gt;


&lt;span class="nv"&gt;view&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Html&lt;/span&gt; &lt;span class="kt"&gt;Msg&lt;/span&gt;
&lt;span class="nv"&gt;view&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt;
    &lt;span class="nv"&gt;text&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;"Hello "&lt;/span&gt; &lt;span class="nf"&gt;++&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;name&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can now handle an event and change the name when we click on it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;module &lt;/span&gt;&lt;span class="nc"&gt;Main&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;

&lt;span class="kn"&gt;import &lt;/span&gt;&lt;span class="nc"&gt;Html&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;
&lt;span class="kn"&gt;import &lt;/span&gt;&lt;span class="nc"&gt;Html.Attributes&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;
&lt;span class="kn"&gt;import &lt;/span&gt;&lt;span class="nc"&gt;Html.Events&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;


&lt;span class="kr"&gt;type&lt;/span&gt; &lt;span class="kt"&gt;Msg&lt;/span&gt;
    &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="kt"&gt;Switch&lt;/span&gt;


&lt;span class="kr"&gt;type&lt;/span&gt; &lt;span class="kr"&gt;alias&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;String&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;


&lt;span class="kr"&gt;main &lt;/span&gt;&lt;span class="nf"&gt;=&lt;/span&gt;
    &lt;span class="nv"&gt;beginnerProgram&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="s"&gt;"Rémy"&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="nv"&gt;view&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;view&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;update&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;update&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;


&lt;span class="nv"&gt;update&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Msg&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt;
&lt;span class="nv"&gt;update&lt;/span&gt; &lt;span class="nv"&gt;msg&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt;
    &lt;span class="kr"&gt;case&lt;/span&gt; &lt;span class="nv"&gt;msg&lt;/span&gt; &lt;span class="kr"&gt;of&lt;/span&gt;
        &lt;span class="kt"&gt;Switch&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt;
            &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="s"&gt;"Séverine"&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;


&lt;span class="nv"&gt;view&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Html&lt;/span&gt; &lt;span class="kt"&gt;Msg&lt;/span&gt;
&lt;span class="nv"&gt;view&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt;
    &lt;span class="nv"&gt;div&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
        &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;text&lt;/span&gt; &lt;span class="s"&gt;"Hello "&lt;/span&gt;
        &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;a&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;href&lt;/span&gt; &lt;span class="s"&gt;"#"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;onClick&lt;/span&gt; &lt;span class="kt"&gt;Switch&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;text&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can refresh the page and try it.&lt;/p&gt;
&lt;p&gt;If we want to switch back to &lt;tt class="docutils literal"&gt;Rémy&lt;/tt&gt; when we click on &lt;tt class="docutils literal"&gt;Séverine&lt;/tt&gt; we can add a &lt;tt class="docutils literal"&gt;if&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;module &lt;/span&gt;&lt;span class="nc"&gt;Main&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;

&lt;span class="kn"&gt;import &lt;/span&gt;&lt;span class="nc"&gt;Html&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;
&lt;span class="kn"&gt;import &lt;/span&gt;&lt;span class="nc"&gt;Html.Attributes&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;
&lt;span class="kn"&gt;import &lt;/span&gt;&lt;span class="nc"&gt;Html.Events&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;


&lt;span class="kr"&gt;type&lt;/span&gt; &lt;span class="kt"&gt;Msg&lt;/span&gt;
    &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="kt"&gt;Switch&lt;/span&gt;


&lt;span class="kr"&gt;type&lt;/span&gt; &lt;span class="kr"&gt;alias&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;String&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;


&lt;span class="kr"&gt;main &lt;/span&gt;&lt;span class="nf"&gt;=&lt;/span&gt;
    &lt;span class="nv"&gt;beginnerProgram&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="s"&gt;"Rémy"&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="nv"&gt;view&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;view&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;update&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;update&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;


&lt;span class="nv"&gt;update&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Msg&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt;
&lt;span class="nv"&gt;update&lt;/span&gt; &lt;span class="nv"&gt;msg&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt;
    &lt;span class="kr"&gt;case&lt;/span&gt; &lt;span class="nv"&gt;msg&lt;/span&gt; &lt;span class="kr"&gt;of&lt;/span&gt;
        &lt;span class="kt"&gt;Switch&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt;
            &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="nf"&gt;==&lt;/span&gt; &lt;span class="s"&gt;"Rémy"&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt;
                &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="s"&gt;"Séverine"&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
            &lt;span class="kr"&gt;else&lt;/span&gt;
                &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="s"&gt;"Rémy"&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;


&lt;span class="nv"&gt;view&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Html&lt;/span&gt; &lt;span class="kt"&gt;Msg&lt;/span&gt;
&lt;span class="nv"&gt;view&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt;
    &lt;span class="nv"&gt;div&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
        &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;text&lt;/span&gt; &lt;span class="s"&gt;"Hello "&lt;/span&gt;
        &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;a&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;href&lt;/span&gt; &lt;span class="s"&gt;"#"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;onClick&lt;/span&gt; &lt;span class="kt"&gt;Switch&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;text&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="enabling-auto-updates-with-elm-live"&gt;
&lt;h2&gt;Enabling auto updates with &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;elm-live&lt;/span&gt;&lt;/tt&gt;&lt;/h2&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;elm-reactor&lt;/span&gt;&lt;/tt&gt; is good to get started but if you want hot-reloading of
your app, you might want to setup &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;elm-live&lt;/span&gt;&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;To install it, you can use: &lt;tt class="docutils literal"&gt;npm install &lt;span class="pre"&gt;-g&lt;/span&gt; &lt;span class="pre"&gt;elm-live&lt;/span&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Once installed, run:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ elm-live Main.elm --open
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you have to use the debugger, you can use the &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--debug&lt;/span&gt;&lt;/tt&gt; option:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ elm-live Main.elm --open --debug
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It will automatically generate an &lt;tt class="docutils literal"&gt;index.html&lt;/tt&gt; file with the
compiled JavaScript, and open it in your default Web browser.&lt;/p&gt;
&lt;p&gt;You can use the &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--output&lt;/span&gt;&lt;/tt&gt; option to save the JavaScript in its own
file and load it in the HTML yourself.&lt;/p&gt;
&lt;p&gt;First update the &lt;tt class="docutils literal"&gt;index.html&lt;/tt&gt; to make it looks like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="cp"&gt;&amp;lt;!DOCTYPE html&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;meta&lt;/span&gt; &lt;span class="na"&gt;charset&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;"utf-8"&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;Hello world&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;title&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;meta&lt;/span&gt; &lt;span class="na"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;"viewport"&lt;/span&gt; &lt;span class="na"&gt;content&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;"width=device-width, initial-scale=1"&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;head&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;

  &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt; &lt;span class="na"&gt;src&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;"elm.js"&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;app&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;Elm&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;Main&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;fullscreen&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
    &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;script&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
  &lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;body&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="p"&gt;&amp;lt;/&lt;/span&gt;&lt;span class="nt"&gt;html&lt;/span&gt;&lt;span class="p"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then you can run elm-live with the &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--output&lt;/span&gt;&lt;/tt&gt; option:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ elm-live Main.elm --open --debug --output elm.js
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now each time you will update your Elm code it will refresh the app in
the browser.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="handling-a-second-event"&gt;
&lt;h2&gt;Handling a second event&lt;/h2&gt;
&lt;p&gt;Let's add an input to let people choose who to great.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;module &lt;/span&gt;&lt;span class="nc"&gt;Main&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;

&lt;span class="kn"&gt;import &lt;/span&gt;&lt;span class="nc"&gt;Html&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;
&lt;span class="kn"&gt;import &lt;/span&gt;&lt;span class="nc"&gt;Html.Attributes&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;
&lt;span class="kn"&gt;import &lt;/span&gt;&lt;span class="nc"&gt;Html.Events&lt;/span&gt; &lt;span class="nv"&gt;exposing&lt;/span&gt; &lt;span class="nf"&gt;(..)&lt;/span&gt;


&lt;span class="kr"&gt;type&lt;/span&gt; &lt;span class="kt"&gt;Msg&lt;/span&gt;
    &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="kt"&gt;Switch&lt;/span&gt;
    &lt;span class="nf"&gt;|&lt;/span&gt; &lt;span class="kt"&gt;NewName&lt;/span&gt; &lt;span class="kt"&gt;String&lt;/span&gt;


&lt;span class="kr"&gt;type&lt;/span&gt; &lt;span class="kr"&gt;alias&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;String&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;


&lt;span class="kr"&gt;main &lt;/span&gt;&lt;span class="nf"&gt;=&lt;/span&gt;
    &lt;span class="nv"&gt;beginnerProgram&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="s"&gt;"Rémy"&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="nv"&gt;view&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;view&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;update&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;update&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;


&lt;span class="nv"&gt;update&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Msg&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt;
&lt;span class="nv"&gt;update&lt;/span&gt; &lt;span class="nv"&gt;msg&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt;
    &lt;span class="kr"&gt;case&lt;/span&gt; &lt;span class="nv"&gt;msg&lt;/span&gt; &lt;span class="kr"&gt;of&lt;/span&gt;
        &lt;span class="kt"&gt;Switch&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt;
            &lt;span class="kr"&gt;if&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="nf"&gt;==&lt;/span&gt; &lt;span class="s"&gt;"Rémy"&lt;/span&gt; &lt;span class="kr"&gt;then&lt;/span&gt;
                &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="s"&gt;"Séverine"&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
            &lt;span class="kr"&gt;else&lt;/span&gt;
                &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="s"&gt;"Rémy"&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;

        &lt;span class="kt"&gt;NewName&lt;/span&gt; &lt;span class="nv"&gt;new_name&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt;
            &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;|&lt;/span&gt; &lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt; &lt;span class="nv"&gt;new_name&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;


&lt;span class="nv"&gt;view&lt;/span&gt; &lt;span class="nf"&gt;:&lt;/span&gt; &lt;span class="kt"&gt;Model&lt;/span&gt; &lt;span class="nf"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="kt"&gt;Html&lt;/span&gt; &lt;span class="kt"&gt;Msg&lt;/span&gt;
&lt;span class="nv"&gt;view&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt; &lt;span class="nf"&gt;=&lt;/span&gt;
    &lt;span class="nv"&gt;div&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
        &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;text&lt;/span&gt; &lt;span class="s"&gt;"Hello "&lt;/span&gt;
        &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;a&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;href&lt;/span&gt; &lt;span class="s"&gt;"#"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;onClick&lt;/span&gt; &lt;span class="kt"&gt;Switch&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;text&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;name&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;br&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
        &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;input&lt;/span&gt;
            &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nv"&gt;onInput&lt;/span&gt; &lt;span class="kt"&gt;NewName&lt;/span&gt;
            &lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nv"&gt;value&lt;/span&gt; &lt;span class="nv"&gt;model&lt;/span&gt;&lt;span class="nf"&gt;.&lt;/span&gt;&lt;span class="nv"&gt;name&lt;/span&gt;
            &lt;span class="p"&gt;]&lt;/span&gt;
            &lt;span class="p"&gt;[]&lt;/span&gt;
        &lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;tt class="docutils literal"&gt;NewName&lt;/tt&gt; event will be emitted with the content of the input each time we type in it.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;That's about it. You now know more than you think about Elm. I hope
you try it on your next project and enjoy Elm as much as we do.&lt;/p&gt;
&lt;p&gt;If you want to learn more about it, don't hesitate to look at some of
our projects or ask questions on the &lt;a class="reference external" href="http://kinto.readthedocs.io/en/stable/community.html#communication-channels"&gt;#kinto chan&lt;/a&gt;.&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/n1k0/myshows"&gt;https://github.com/n1k0/myshows&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/leplatrem/systemaddons-versions"&gt;https://github.com/leplatrem/systemaddons-versions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/addons-shipping/stepfunction-dashboard/"&gt;https://github.com/addons-shipping/stepfunction-dashboard/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/Natim/twitter-elm-wall/"&gt;https://github.com/Natim/twitter-elm-wall/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/kinto/kinto-alwaysdata/"&gt;https://github.com/kinto/kinto-alwaysdata/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/Natim/social-dashboard/"&gt;https://github.com/Natim/social-dashboard/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>Building software as a way to learn</title><link href="http://www.servicedenuages.fr/en/building-software-as-a-way-to-learn" rel="alternate"></link><published>2017-04-12T00:00:00+02:00</published><updated>2017-04-12T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2017-04-12:/en/building-software-as-a-way-to-learn</id><summary type="html">&lt;p class="first last"&gt;Having multiple people working on a big project is not as easy as it seems.
Here are some elements to move projects forward as a team.&lt;/p&gt;
</summary><content type="html">&lt;img alt="New Mozilla 2017 Logo" class="align-center" src="http://www.servicedenuages.fr/en/../images/mozilla-logo.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Today, I realized that I've been working for Mozilla for three years
already.&lt;/p&gt;
&lt;p&gt;I've learned a lot, and with the storage team we have been part of a
number of different projects:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Firefox Hello: Building a WebRTC signaling service.&lt;/li&gt;
&lt;li&gt;MSISDN auth: Building a password less BrowserID authentication
service using a phone number.&lt;/li&gt;
&lt;li&gt;Syncto: Browsing Firefox Sync using the Kinto protocol.&lt;/li&gt;
&lt;li&gt;Kinto: Building synchronization services with backup and sharing
capabilities in mind.&lt;/li&gt;
&lt;li&gt;RemoteServiceWorker: Building a Firefox Service Worker that does
heavy calculation in the cloud, to save battery life on mobile.&lt;/li&gt;
&lt;li&gt;WebPush channels: Building a PubSub on top of WebPush&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;While most of these projects have been built, deployed to production
and eventually decommissioned, some of them are still actively used by
Firefox users everyday.&lt;/p&gt;
&lt;div class="section" id="how-do-you-keep-motivated-building-things-that-are-thrown-away"&gt;
&lt;h2&gt;How do you keep motivated building things that are thrown away?&lt;/h2&gt;
&lt;img alt="Mozilla Dino Wallpaper" class="align-center" src="http://www.servicedenuages.fr/en/../images/dino.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Let's be honest: everything we build — cars, houses, and even software —
is meant to be eventually thrown away. That's why recycling is so
important.&lt;/p&gt;
&lt;p&gt;The question is why do we keep building them nevertheless?&lt;/p&gt;
&lt;p&gt;Our daily job is to help Mozilla make the web a safe place for users
and prevent their privacy from being compromised.&lt;/p&gt;
&lt;p&gt;One way of doing so is to build software that empowers people to
freely use the Internet while keeping them in charge of their own
data.&lt;/p&gt;
&lt;p&gt;When users give their data to big companies, they don't necessarily
know that they are giving them too much power. As a result, these
companies are offering services that respond people's needs,
triggering an addictive behaviour which leads to an increase in
product consumption. Which lead people to give away even more
information about them.&lt;/p&gt;
&lt;p&gt;We alone cannot compete with companies that are spending millions of
dollars building great products to capture users.&lt;/p&gt;
&lt;p&gt;What we can do instead is to build software that, on the one hand, is
useful for the Mozilla mission and enables us to fix Mozilla issues
quickly while building Firefox and, on the other hand, empowers
developers to build their own great software where users can choose
where they want to store and control their data.&lt;/p&gt;
&lt;p&gt;What matters the most is the vision that this software
carries. Without it, is like buiding on sand.&lt;/p&gt;
&lt;p&gt;Sure, writing lines of code is cheap and fast. You can build a
prototype in two weeks and iterate until you are happy with the
Minimum Viable Product.&lt;/p&gt;
&lt;p&gt;Note that, it might not be so cheap anymore when you start adding
documentation and maintenance costs.&lt;/p&gt;
&lt;p&gt;However, the product might be used, and might get some traction for
months or even years but it will be eventually forgotten in a git
repository somewhere forever.&lt;/p&gt;
&lt;p&gt;Writing software to solve problems is not enough to keep motivated on
the long term. One needs a greater goal than just writing code.&lt;/p&gt;
&lt;p&gt;Having said that, how can one still be motivated on building things
that are eventually to be thrown away?&lt;/p&gt;
&lt;p&gt;Different people or communities might have different guiding questions.&lt;/p&gt;
&lt;p&gt;For our team of developers the secret for solving this problem is
actually the following question: As well as solving the problem, what
can we learn while building this solution that can be useful for us
and for our community to help us go faster and build more robust
software later?&lt;/p&gt;
&lt;p&gt;For Mozilla the question is: How do I improve Firefox
so that people want to use it as their main browser?&lt;/p&gt;
&lt;p&gt;By answering these two questions, we define our goals; and we fulfil
these goals through software development.&lt;/p&gt;
&lt;p&gt;Mozilla is calling this the True North, we are calling it a vision,
some other people might call it a utopia.&lt;/p&gt;
&lt;p&gt;In both cases that vision should set the route of our ambition and
point out a direction for everyone in the team to sail to.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="how-do-you-set-course-for-a-vision"&gt;
&lt;h2&gt;How do you set course for a vision?&lt;/h2&gt;
&lt;img alt="Draken sailing to the North" class="align-center" src="http://www.servicedenuages.fr/en/../images/draken.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;&lt;abbr title="Objectives and Key results"&gt;OKRs&lt;/abbr&gt; are a way to organise the vision in steps and to move it
forward.&lt;/p&gt;
&lt;p&gt;To be able to define OKRs from your vision, you need to be able to find
the fastest way to get closer to your aim. However what we can learn
from sailing is that the fastest way is rarely the shortest.&lt;/p&gt;
&lt;p&gt;At Mozilla, we have a vision that is written down in the &lt;a class="reference external" href="https://www.mozilla.org/en-US/about/manifesto/"&gt;Mozilla
Manifesto&lt;/a&gt;, Mitchell
Baker does a great job making sure everyone stays aligned with it.&lt;/p&gt;
&lt;p&gt;However agreeing on the fastest way and turning the Mozilla vision
into OKRs is really challenging. Even more when you have a thousand
people's opinion about it.&lt;/p&gt;
&lt;p&gt;The idea is to find the smallest and ambitious enough step for which
you can mesure the success in the timeframe you set to yourself.&lt;/p&gt;
&lt;p&gt;It's the board's job to &lt;a class="reference external" href="https://air.mozilla.org/mozilla-all-hands-hawaii-2016-20161221/"&gt;set course every six months&lt;/a&gt; (or even less)
on what we should be focusing on for the next six months.&lt;/p&gt;
&lt;p&gt;However each manager have to cut down the board objectives in
something that their team can have an action on.&lt;/p&gt;
&lt;p&gt;When the focus changes, it often means changing our course and killing
projects or at least putting them on the side if teams are turning to
new priorities.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="how-do-you-define-your-priorities"&gt;
&lt;h2&gt;How do you define your priorities?&lt;/h2&gt;
&lt;img alt="Mozilla Logo as a Sailing Map — From https://uk.pinterest.com/explore/firefox-logo/" class="align-center" src="http://www.servicedenuages.fr/en/../images/true-north.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;At our team level, we are driven by the use case. We have a vision of
what we want to build. That leads to feature ideas that we add to the
backlog.&lt;/p&gt;
&lt;p&gt;However we are not building anything until we have a proper use case
for it. As soon as we have a use case it is added to our quarterly
roadmap.&lt;/p&gt;
&lt;p&gt;We end up not spending time on tasks we don't need and for each use
case we are getting closer to our goal even if it might not be the way
we'd taken initially.&lt;/p&gt;
&lt;p&gt;We also don't have to support code that we don't use. We even remove
features that are not used any more.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="our-secret-is-opensource"&gt;
&lt;h2&gt;Our secret is opensource&lt;/h2&gt;
&lt;img alt="Open Source as a way to share" class="align-center" src="http://www.servicedenuages.fr/en/../images/open-source-software.png" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;More than writing lines of code, we are researching solutions to
complex problems at scale and turning those solutions into production
ready experiments. And sometimes those experiments fail.&lt;/p&gt;
&lt;p&gt;The advantage we have at Mozilla, is that everything we do is
published as Free, Libre, Opensource Software, which means that, even
if, as Mozilla employees, we focus on something else, the work we've
done is still available for the community to care about it.&lt;/p&gt;
&lt;p&gt;Thunderbird is an example of this. Mozilla stopped spending resources
on it in July 2012 but five years later Mozilla Thunderbird is still
actively used by a large number of users every day.&lt;/p&gt;
&lt;p&gt;When building software, we solve complex issues and all the solutions
we have put together are really useful for other people who might need
to solve similar problems.&lt;/p&gt;
&lt;p&gt;For instance, Mozilla Persona lead the ground for &lt;a class="reference external" href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/Firefox_Accounts"&gt;Firefox Accounts&lt;/a&gt;
and the &lt;a class="reference external" href="https://portier.github.io/"&gt;Portier project&lt;/a&gt;, the Firefox Hello &lt;a class="reference external" href="https://github.com/mozilla-services/loop-server"&gt;loop server&lt;/a&gt; shows a
good example of how to build a WebRTC signaling server and was reused
later by &lt;a class="reference external" href="https://wiki.mozilla.org/Connected_Devices/Projects/Project_Link"&gt;Project Link&lt;/a&gt;. The &lt;a class="reference external" href="https://github.com/mozilla-services/remote-worker-server"&gt;Remote Service Worker project&lt;/a&gt; also
shows how to use &lt;a class="reference external" href="https://docs.python.org/3/library/asyncio.html"&gt;Python asyncio&lt;/a&gt; to handle a large pool of
&lt;a class="reference external" href="https://websockets.readthedocs.io/"&gt;websockets&lt;/a&gt; using &lt;a class="reference external" href="https://redis.io/"&gt;redis&lt;/a&gt; to route messages between them.&lt;/p&gt;
&lt;p&gt;These are all valuable even though they are not in production anymore
today.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;Building software as a way to learn&lt;/h2&gt;
&lt;img alt="Conference Room for DjangoCon Europe 2016" class="align-center" src="http://www.servicedenuages.fr/en/../images/conferences.jpg" style="width: 1347px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;As you can see, every effort is not pointless because we learn a great
deal from all these projects.&lt;/p&gt;
&lt;p&gt;Whether it takes us a month or a year to build something, we are
learning. And if you want to make the most value of this learning, it
is important to share it as well.&lt;/p&gt;
&lt;p&gt;Luckily, there are at least one kind of people that you already have
to inform about what you are doing and learning about as part of your
job: your colleagues.&lt;/p&gt;
&lt;p&gt;You need to:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;explain what you are trying to solve.&lt;/li&gt;
&lt;li&gt;find out how to solve the issue and agree on the solutions you are
putting together.&lt;/li&gt;
&lt;li&gt;take feedback to be able to choose the best solution even before
having written a single line of code.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In a next article we will see how we make sharing the core of the
process of building software as a distributed team.&lt;/p&gt;
&lt;p&gt;In the meantime, we can only encourage you to write about what you are
building, go to conferences and tell others about what you learned and
listen to them so that you don't have to go through the same pitfall.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;In conclusion, don't build software to build software, build it to
solve people's problems. Set a long term goal, work toward that goal and
iterate. Do not be afraid of killing things that don't work.&lt;/p&gt;
&lt;p&gt;In the meantime, make the process of building software a way to learn
new things and share what you've learn. Then you don't have to worry
about your project being decommissioned because you've already got the
take aways of building it.&lt;/p&gt;
&lt;p&gt;Make the process of building software a way to share what you've
learned and enjoy it!&lt;/p&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>Handling Python Project dependencies</title><link href="http://www.servicedenuages.fr/en/handling-python-projects-dependencies" rel="alternate"></link><published>2017-02-24T00:00:00+01:00</published><updated>2017-02-24T00:00:00+01:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2017-02-24:/en/handling-python-projects-dependencies</id><summary type="html">&lt;dl class="first last docutils"&gt;
&lt;dt&gt;Coping with project depdendencies can be a bit cumbersome.&lt;/dt&gt;
&lt;dd&gt;&lt;p class="first last"&gt;Learn how we are handling our Python project dependencies.&lt;/p&gt;
&lt;/dd&gt;
&lt;/dl&gt;
</summary><content type="html">&lt;div class="section" id="introduction"&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;If you ever started a Python project you might have heard of a
&lt;tt class="docutils literal"&gt;requirements.txt&lt;/tt&gt; file that contains a list of dependencies.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;pelican&lt;/span&gt;
&lt;span class="n"&gt;beautifulsoup4&lt;/span&gt;
&lt;span class="n"&gt;ghp&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt;
&lt;span class="nn"&gt;Pillow&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;&lt;span class="mf"&gt;4.0&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="n"&gt;markdown&lt;/span&gt;
&lt;span class="n"&gt;pysvg&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;=&lt;/span&gt;&lt;span class="mf"&gt;0.2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mf"&gt;0.3&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;However if you plan on shipping your project or library with Pypi,
installing it in another project, or in a virtualenv you need to put
them in the &lt;tt class="docutils literal"&gt;setup.py&lt;/tt&gt; file directly in order for them to be
installed automatically along with your code.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;setup&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'saucisson'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="n"&gt;version&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'1.0.0.dev0'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="n"&gt;license&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'Apache License (2.0)'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="n"&gt;packages&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;find_packages&lt;/span&gt;&lt;span class="p"&gt;(),&lt;/span&gt;
  &lt;span class="n"&gt;include_package_data&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="n"&gt;zip_safe&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;False&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="n"&gt;install_requires&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="s1"&gt;'colander &amp;gt;= 1.3.2'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'colorama'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'cornice &amp;gt;= 2.4'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'cornice_swagger &amp;gt;= 0.5'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'jsonschema'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'jsonpatch'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'python-dateutil'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'pyramid &amp;gt; 1.8'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'pyramid_multiauth &amp;gt;= 0.8'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;  &lt;span class="c1"&gt;# User on policy selected event.&lt;/span&gt;
    &lt;span class="s1"&gt;'transaction'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'pyramid_tm'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'requests'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'structlog &amp;gt;= 16.1.0'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'waitress'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;'ujson &amp;gt;= 1.35'&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This raises a lot of questions:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;How do I update project dependencies?&lt;/li&gt;
&lt;li&gt;What were the known working dependencies version at a certain release?&lt;/li&gt;
&lt;li&gt;How do I make sure a release of one of my dependencies doesn't break my release?&lt;/li&gt;
&lt;li&gt;How do I make sure that my code is not used with a unsupported version of a dependency?&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;/div&gt;
&lt;div class="section" id="avoid-using-requirements-file-to-handle-your-program-dependencies"&gt;
&lt;h2&gt;Avoid using requirements file to handle your program dependencies&lt;/h2&gt;
&lt;p&gt;Once your program (i.e &lt;tt class="docutils literal"&gt;saucisson&lt;/tt&gt;) is released, users will install
it with &lt;tt class="docutils literal"&gt;pip install saucisson&lt;/tt&gt;, which means that
&lt;tt class="docutils literal"&gt;python setup.py install&lt;/tt&gt; needs to pick up the right dependencies for it.&lt;/p&gt;
&lt;p&gt;It means that &lt;tt class="docutils literal"&gt;setup.py&lt;/tt&gt; needs to know what are your program
dependencies and not the &lt;tt class="docutils literal"&gt;requirements.txt&lt;/tt&gt; file. Instead use your
&lt;tt class="docutils literal"&gt;requirements.txt&lt;/tt&gt; to keep a known working set of your dependencies at
the time of a release.&lt;/p&gt;
&lt;p&gt;We usually add a &lt;cite&gt;build-requirements&lt;/cite&gt; makefile rule on our projects:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;VIRTUALENV&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; virtualenv --python&lt;span class="o"&gt;=&lt;/span&gt;python3


&lt;span class="nf"&gt;build-requirements&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nb"&gt;eval&lt;/span&gt; TEMPDIR :&lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;shell mktemp -d&lt;span class="k"&gt;))&lt;/span&gt;
    &lt;span class="k"&gt;$(&lt;/span&gt;VIRTUALENV&lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;TEMPDIR&lt;span class="k"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;$(&lt;/span&gt;TEMPDIR&lt;span class="k"&gt;)&lt;/span&gt;/bin/pip install -U pip  &lt;span class="c1"&gt;# Upgrade pip&lt;/span&gt;
    &lt;span class="k"&gt;$(&lt;/span&gt;TEMPDIR&lt;span class="k"&gt;)&lt;/span&gt;/bin/pip install -Ue .   &lt;span class="c1"&gt;# Develop the current project locally&lt;/span&gt;
&lt;span class="c"&gt;    # Freeze the dependencies ignoring the dependency links.&lt;/span&gt;
    &lt;span class="k"&gt;$(&lt;/span&gt;TEMPDIR&lt;span class="k"&gt;)&lt;/span&gt;/bin/pip freeze &lt;span class="p"&gt;|&lt;/span&gt; grep -v -- &lt;span class="s1"&gt;'^-e'&lt;/span&gt; &amp;gt; requirements.txt
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you run &lt;cite&gt;make build-requirements&lt;/cite&gt; before tagging your release you
will document what was the known working dependency set at the time of
the release.&lt;/p&gt;
&lt;p&gt;Then you can install your program later using this file as a
&lt;a class="reference external" href="https://pip.pypa.io/en/stable/user_guide/#constraints-files"&gt;dependency constraint file&lt;/a&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="go"&gt;pip install saucisson -c requirements.txt&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="avoid-pinning-version-in-your-setup-py"&gt;
&lt;h2&gt;Avoid pinning version in your setup.py&lt;/h2&gt;
&lt;p&gt;You might be tempted to put dependencies versions in your setup.py,
i.e. "pinning" them to a specific version.&lt;/p&gt;
&lt;p&gt;You don't need to do so because you are using a constraint file, you
are safe for future updates that might break your code.&lt;/p&gt;
&lt;p&gt;On your CI, don't use a contraint file. It will help you to detect
that you need to take some actions to support the new released version
that breaks your tests.&lt;/p&gt;
&lt;p&gt;However with that in mind, there are some cases when you still want to
pin some version:&lt;/p&gt;
&lt;div class="section" id="if-you-know-that-your-project-will-not-work-with-a-lower-version"&gt;
&lt;h3&gt;If you know that your project will not work with a lower version&lt;/h3&gt;
&lt;p&gt;If you are using a feature or API that didn't exist before or you hit
a bug that was fixed later.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;psycopg&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mf"&gt;2.5&lt;/span&gt;
&lt;span class="n"&gt;colander&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mf"&gt;1.3&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;
&lt;span class="n"&gt;ujson&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mf"&gt;1.35&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It won't change the way pip handles your dependency, because even if
you don't put this, pip will always try to install the latest version.&lt;/p&gt;
&lt;p&gt;However it will detect if another library or the project using your
library is trying to use it with a lower version that won't work with
your code.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="if-you-know-that-your-project-doesn-t-support-yet-the-next-release"&gt;
&lt;h3&gt;If you know that your project doesn't support yet the next release&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;I insist that this applies only if a new version version of a
dependency has already been released and that your test suite doesn't
run on it.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;In that case, and only in that case, you can pin the dependency's
version for the shortest possible time until you port your project to
it.&lt;/p&gt;
&lt;p&gt;It's common to encounter breaking changes when upgrading frameworks:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Pyramid&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mf"&gt;1.8&lt;/span&gt;
&lt;span class="n"&gt;django&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt;&lt;span class="mf"&gt;1.6&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;=&lt;/span&gt; &lt;span class="mf"&gt;1.8&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The danger of doing it is that you might create
&lt;tt class="docutils literal"&gt;pkg_resources.VersionConflict&lt;/tt&gt; errors.&lt;/p&gt;
&lt;p&gt;When Python starts and imports your lib it will look at the
requirements list and validate that all dependencies are installed
with their expected version. If it is not the case Python will not let
you start your application.&lt;/p&gt;
&lt;p&gt;However when you install a dependency, pip will check if it is already
installed without validating if the expected version is installed but
rather if a version is installed.&lt;/p&gt;
&lt;p&gt;If a lib already installed the dependency with a greater version in
your virtualenv, pip will not upgrade it with the mandatory lower
version.&lt;/p&gt;
&lt;p&gt;An easy way to break things is to pin a max &lt;tt class="docutils literal"&gt;requests&lt;/tt&gt; version for
instance:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;requests&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="mf"&gt;2.13&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you do that, you will end up having
&lt;tt class="docutils literal"&gt;pkg_resources.VersionConflict&lt;/tt&gt; error when running your program.&lt;/p&gt;
&lt;p&gt;What is happening is that Python is checking the dependencies and will
refuse to run if you have a greater &lt;tt class="docutils literal"&gt;requests&lt;/tt&gt; version.&lt;/p&gt;
&lt;p&gt;This can happen if another dependency already needed &lt;tt class="docutils literal"&gt;requests&lt;/tt&gt; as a
dependency and pip already installed it with a greater version.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;So really do it only if you must.&lt;/strong&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="what-about-test-dependencies"&gt;
&lt;h2&gt;What about test dependencies?&lt;/h2&gt;
&lt;p&gt;That's a good question, I am glad you asked.&lt;/p&gt;
&lt;p&gt;Test dependencies are less of an issue. You can either use
&lt;tt class="docutils literal"&gt;test_requires&lt;/tt&gt; in your &lt;tt class="docutils literal"&gt;setup.py&lt;/tt&gt; or a &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;dev-requirements.txt&lt;/span&gt;&lt;/tt&gt;
file.&lt;/p&gt;
&lt;p&gt;In the former you will need to run tests using &lt;tt class="docutils literal"&gt;python setup.py test&lt;/tt&gt;
which unfortunately doesn't install dependencies in a &lt;tt class="docutils literal"&gt;virtualenv&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;In the later you will need to make sure your test dependencies are
installed before running the tests but tools like &lt;tt class="docutils literal"&gt;tox&lt;/tt&gt; already do
that for you.&lt;/p&gt;
&lt;p&gt;Our take on this was to put test dependencies in a
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;dev-requirements.txt&lt;/span&gt;&lt;/tt&gt; file.&lt;/p&gt;
&lt;p&gt;We have a Makefile rule that knows if dev-dependencies should be
installed or not before running the &lt;tt class="docutils literal"&gt;tests&lt;/tt&gt; target.&lt;/p&gt;
&lt;p&gt;As a bonus it will automatically create a virtualenv if you don't
have one already activated:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nv"&gt;VIRTUALENV&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; virtualenv --python&lt;span class="o"&gt;=&lt;/span&gt;python3
&lt;span class="nv"&gt;VENV&lt;/span&gt; &lt;span class="o"&gt;:=&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;shell &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="nv"&gt;$$&lt;/span&gt;&lt;span class="o"&gt;{&lt;/span&gt;VIRTUAL_ENV-.venv&lt;span class="o"&gt;}&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;  &lt;span class="c1"&gt;# Use the activated virtualenv path or use .venv&lt;/span&gt;
&lt;span class="nv"&gt;PYTHON&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;VENV&lt;span class="k"&gt;)&lt;/span&gt;/bin/python
&lt;span class="nv"&gt;INSTALL_STAMP&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;VENV&lt;span class="k"&gt;)&lt;/span&gt;/.install.stamp
&lt;span class="nv"&gt;INSTALL_DEV_STAMP&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;VENV&lt;span class="k"&gt;)&lt;/span&gt;/.dev_env_installed.stamp

&lt;span class="nf"&gt;install&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nv"&gt;INSTALL_STAMP&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;

&lt;span class="nf"&gt;$(INSTALL_STAMP)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nv"&gt;PYTHON&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="n"&gt;setup&lt;/span&gt;.&lt;span class="n"&gt;py&lt;/span&gt;  &lt;span class="c"&gt;# Refresh the virtualenv if setup.py changed&lt;/span&gt;
    &lt;span class="k"&gt;$(&lt;/span&gt;VENV&lt;span class="k"&gt;)&lt;/span&gt;/bin/pip install -U pip
    &lt;span class="k"&gt;$(&lt;/span&gt;VENV&lt;span class="k"&gt;)&lt;/span&gt;/bin/pip install -Ue .
    touch &lt;span class="k"&gt;$(&lt;/span&gt;INSTALL_STAMP&lt;span class="k"&gt;)&lt;/span&gt;

&lt;span class="nf"&gt;virtualenv&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nv"&gt;PYTHON&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;  &lt;span class="c"&gt;# Create the virtualenv if needed (python executable not present)&lt;/span&gt;

&lt;span class="nf"&gt;$(PYTHON)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;$(&lt;/span&gt;VIRTUALENV&lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;VENV&lt;span class="k"&gt;)&lt;/span&gt;

&lt;span class="nf"&gt;install-dev&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nv"&gt;DEV_STAMP&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt;

&lt;span class="c"&gt;# Refresh dev dependencies if dev-requirements.txt changed&lt;/span&gt;
&lt;span class="nf"&gt;$(DEV_STAMP)&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="k"&gt;$(&lt;/span&gt;&lt;span class="nv"&gt;PYTHON&lt;/span&gt;&lt;span class="k"&gt;)&lt;/span&gt; &lt;span class="n"&gt;dev&lt;/span&gt;-&lt;span class="n"&gt;requirements&lt;/span&gt;.&lt;span class="n"&gt;txt&lt;/span&gt;
    &lt;span class="k"&gt;$(&lt;/span&gt;VENV&lt;span class="k"&gt;)&lt;/span&gt;/bin/pip install -Ur dev-requirements.txt
    touch &lt;span class="k"&gt;$(&lt;/span&gt;DEV_STAMP&lt;span class="k"&gt;)&lt;/span&gt;

&lt;span class="nf"&gt;tests-once&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt;-&lt;span class="n"&gt;dev&lt;/span&gt;
    &lt;span class="k"&gt;$(&lt;/span&gt;VENV&lt;span class="k"&gt;)&lt;/span&gt;/bin/py.test tests/

&lt;span class="nf"&gt;serve&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;install&lt;/span&gt;
    &lt;span class="k"&gt;$(&lt;/span&gt;VENV&lt;span class="k"&gt;)&lt;/span&gt;/bin/python manage.py runserver
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;As a conclusion, when working with Python dependencies there are three
process that needs to work well together.&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Installing automatically a project version in a working state,
you can do this using requirements constraint files.&lt;/li&gt;
&lt;li&gt;Keeping the project up-to-date with next version of its dependencies
without breaking previous released versions.&lt;/li&gt;
&lt;li&gt;Installing a project as part as another project without it breaking
the project with dependencies version conflicts.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Our solution to this is as follows:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Keep your project dependencies clean of any version number.&lt;/li&gt;
&lt;li&gt;At release time, document what is the tested dependency versions.&lt;/li&gt;
&lt;li&gt;Use that known working state as a way to install a given release of
the project.&lt;/li&gt;
&lt;li&gt;Run your CI without the constraint file to detect dependencies
update that might break future release of your code.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="in-our-way-to-the-future"&gt;
&lt;h2&gt;In our way to the future&lt;/h2&gt;
&lt;p&gt;In a perfect world, it would be great to know in advance what is the
next version of the library that will stop working with your code.&lt;/p&gt;
&lt;p&gt;The good news is that this future is already there and that's what
semantic versioning is trying to address.&lt;/p&gt;
&lt;div class="section" id="what-can-break-your-code"&gt;
&lt;h3&gt;What can break your code?&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Changing the name of functions or objects&lt;/li&gt;
&lt;li&gt;Changing the name of parameters or their order in the function call&lt;/li&gt;
&lt;li&gt;Changing the way to configure the project&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In one word, everything that changes the API that is exposed by the
library will break the code of people relying on it.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="what-is-semantic-versioning"&gt;
&lt;h3&gt;What is Semantic Versioning?&lt;/h3&gt;
&lt;p&gt;Semantic versioning is a way to be able to tell if a new release of a
dependency you are using is compatible with your code by looking at
its version number.&lt;/p&gt;
&lt;p&gt;Alternatively it is a way to tell people relying on your code if your
release is likely to break their code or not.&lt;/p&gt;
&lt;p&gt;In semantic versioning, the version number is made of a triplet of
numbers separated by dots: i.e &lt;tt class="docutils literal"&gt;2.11.5&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;They are call &lt;tt class="docutils literal"&gt;MAJOR.MINOR.PATCH&lt;/tt&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="major-version"&gt;
&lt;h3&gt;MAJOR version&lt;/h3&gt;
&lt;p&gt;The &lt;tt class="docutils literal"&gt;MAJOR&lt;/tt&gt; number is the version of the public API that the library
provides.&lt;/p&gt;
&lt;p&gt;The API that you provide are the public function that you expect
people that use your API to use or the plugin of your project to
implements.&lt;/p&gt;
&lt;p&gt;As soon as the &lt;tt class="docutils literal"&gt;MAJOR&lt;/tt&gt; version is greater than 0, the API is
considered to be stable and not to change unexpectidly.&lt;/p&gt;
&lt;p&gt;It is really important to set the &lt;tt class="docutils literal"&gt;MAJOR&lt;/tt&gt; version to 1 if it is not
the case yet as soon as one project is using the code in production.&lt;/p&gt;
&lt;div class="admonition note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p&gt;In case your project is providing a web API or implements a
protocol, it might be really tempting to say that the MAJOR version
is also the version of the implemented protocol.&lt;/p&gt;
&lt;p class="last"&gt;You should not do that because if your break the code API and not
the protocol API and that both are coupled you will not be able to
increment this MAJOR version. Instead the protocol version should
be tracked in another protocol version information that could also
follow semantic versioning.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="minor-version"&gt;
&lt;h3&gt;MINOR version&lt;/h3&gt;
&lt;p&gt;The &lt;tt class="docutils literal"&gt;MINOR&lt;/tt&gt; number is the most common number to change, it is
incremented when you are improving the software, adding non-breaking
features to existing API or refactoring existing code.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="patch-version"&gt;
&lt;h3&gt;PATCH version&lt;/h3&gt;
&lt;p&gt;The &lt;tt class="docutils literal"&gt;PATCH&lt;/tt&gt; number is incremented when the previous minor version
has some bugs that affects users and that should be fixed as soon as
possible. Non handled exceptions, cases that make the library fails
and should not.&lt;/p&gt;
&lt;p&gt;They are for bug fixes only and should has a really low impact on the
existing code base.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="the-case-of-semantic-versioning-dependencies"&gt;
&lt;h3&gt;The case of semantic versioning dependencies&lt;/h3&gt;
&lt;p&gt;If your project dependencies are using semantic versioning you can
theoritically know that the next major version is likely to break it.&lt;/p&gt;
&lt;p&gt;However minor should not break it and patched version must defpythontely
not break it.&lt;/p&gt;
&lt;p&gt;With projects using semantic versioning you could define your
dependencies like that:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;kinto&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt;&lt;span class="mf"&gt;5.1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;
&lt;span class="n"&gt;kinto&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;redis&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt;&lt;span class="mf"&gt;1.1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Often people are afraid to increment the MAJOR version of their
projects.&lt;/p&gt;
&lt;p&gt;If it is the case ask yourself why, it should not be a problem to do
so because if your project follows semantic versioning then that's
how it should work.&lt;/p&gt;
&lt;p&gt;Most of the time it is because you are also using your &lt;tt class="docutils literal"&gt;MAJOR&lt;/tt&gt;
number for something else so don't do it. You should not be worried
about that, it is always great to increment a version number because
it means your project is alive.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>10 reasons to give another chance to Firefox Nightly</title><link href="http://www.servicedenuages.fr/en/give-firefox-nightly-another-chance" rel="alternate"></link><published>2017-01-30T00:00:00+01:00</published><updated>2017-01-30T00:00:00+01:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2017-01-30:/en/give-firefox-nightly-another-chance</id><summary type="html">&lt;p class="first last"&gt;Help us make the best Mozilla Firefox of all the times by mid 2017!&lt;/p&gt;
</summary><content type="html">&lt;div class="section" id="what-is-nightly"&gt;
&lt;h2&gt;What is Nightly?&lt;/h2&gt;
&lt;p&gt;The Firefox Nightly build also known as Firefox Nightly is a version
of Firefox built from the source code every day at night.&lt;/p&gt;
&lt;p&gt;This means that Firefox updates itself every day!&lt;/p&gt;
&lt;img alt="You've just been upgraded to Firefox Nightly 54!" class="align-center" src="http://www.servicedenuages.fr/en/../images/nightly.png" style="width: 1283px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;div class="section" id="why-aren-t-you-using-nightly-today"&gt;
&lt;h2&gt;Why aren't you using Nightly today?&lt;/h2&gt;
&lt;p&gt;Everyone wants a stable Firefox and you don't have time for a crappy
browser experience.&lt;/p&gt;
&lt;p&gt;Although it wasn't always the case, Firefox Nightly is now more
stable than ever. The number of crashes has been reduced and it
is getting much further every day.&lt;/p&gt;
&lt;p&gt;Additionally most of the bugs that you might have will be fixed the
next day.&lt;/p&gt;
&lt;p&gt;You can always go in the &lt;cite&gt;Help &amp;gt; About Firefox&lt;/cite&gt; menu to make sure you
have the last update!&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="why-you-should-actually-give-firefox-nightly-a-try"&gt;
&lt;h2&gt;Why you should actually give Firefox Nightly a try&lt;/h2&gt;
&lt;p&gt;By installing Firefox Nightly you will:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Have new Mozilla Firefox features 18 weeks earlier&lt;/li&gt;
&lt;li&gt;Have a much faster Firefox&lt;/li&gt;
&lt;li&gt;Make a difference&lt;/li&gt;
&lt;li&gt;Help reduce the number of crashes for Mozilla Firefox users&lt;/li&gt;
&lt;li&gt;Make sure Mozilla Firefox source code is in a workable state&lt;/li&gt;
&lt;li&gt;Help add-on developers to validate that their add-ons are still working&lt;/li&gt;
&lt;li&gt;Have a better developer experience to develop your apps&lt;/li&gt;
&lt;li&gt;Make a really valuable contribution to the Mozilla project without coding&lt;/li&gt;
&lt;li&gt;Participate at building a Free, Libre, and Open Source browser that respects user privacy&lt;/li&gt;
&lt;li&gt;Have a real impact on how the Web is built nowadays.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="section" id="have-a-much-faster-firefox"&gt;
&lt;h3&gt;Have a much faster Firefox&lt;/h3&gt;
&lt;p&gt;Firefox is getting smaller!&lt;/p&gt;
&lt;p&gt;New features are now tested through add-ons using
&lt;a class="reference external" href="https://testpilot.firefox.com/"&gt;Test Pilot&lt;/a&gt; instead of getting
added to Firefox. This means less bugs and only great features by
default.&lt;/p&gt;
&lt;p&gt;Firefox is getting faster!&lt;/p&gt;
&lt;p&gt;This year 2017, Firefox is going to ship the &lt;a class="reference external" href="https://wiki.mozilla.org/Quantum"&gt;Quantum&lt;/a&gt; project which is a
next-generation Web engine. It benefits from some critical parts of
Gecko being rewritten in Rust which makes them 10 to 100 times faster
than before by using parallelization and GPU offloading.&lt;/p&gt;
&lt;p&gt;This is happening now and you will get it 3 months early.&lt;/p&gt;
&lt;p&gt;Not only that, Quantum is a lot more secure, the rewrite is a good
opportunity to have a brand new and better-tested code base which
means that you are less likely to have bugs in it.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="have-new-mozilla-firefox-features-18-weeks-before"&gt;
&lt;h3&gt;Have new Mozilla Firefox features 18 weeks before&lt;/h3&gt;
&lt;p&gt;Mozilla Firefox is on a fixed Release Calendar workflow called trains,
which means that developer can plan their features to land in a
certain version and coordinate other teams work (QA, OPS, Service
developers, Deployments, Translations) for a certain date.&lt;/p&gt;
&lt;p&gt;In case the deadline is missed, they will have to wait for the next
release 6 weeks later.&lt;/p&gt;
&lt;p&gt;Today, there are 4 versions of Firefox:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Firefox Nightly, which is a tag of Mozilla Central every day&lt;/li&gt;
&lt;li&gt;Firefox Developer Edition, which is a tag of Nightly every 6 weeks&lt;/li&gt;
&lt;li&gt;Firefox Beta, which is a release of the previous Developer edition branch&lt;/li&gt;
&lt;li&gt;Firefox Release, which is a release of the previous Beta branch&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;With Nightly, the release is everyday, which means you will be the
first one to benefit from new features, while other people will
have to wait more than 3 months before being able to use them (less
than 6 weeks in Nightly, 6 weeks for Developer Edition, 6 weeks for
Beta).&lt;/p&gt;
&lt;p&gt;Not only that, but some features are only activated in Nightly.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="make-a-difference-and-help-reduce-the-number-of-crashes-for-mozilla-firefox-users"&gt;
&lt;h3&gt;Make a difference and help reduce the number of crashes for Mozilla Firefox users&lt;/h3&gt;
&lt;p&gt;The more users we have in Nightly, the more stable future versions of
Firefox become.&lt;/p&gt;
&lt;p&gt;If everybody waits to use the last release of Firefox, it means
that Developer Edition and Beta steps don't make any sense because
they will not be used and bugs that might occur will appear directly
at the Release stage, making a poor Firefox experience for people that
don't even know what a browser is.&lt;/p&gt;
&lt;p&gt;By using Nightly, you will help us make a really great Firefox and as
a benefit you will have this great Firefox experience 3 months ahead
of schedule!&lt;/p&gt;
&lt;p&gt;Also most of the time, if you discover a problem with your Firefox
Nightly, it will be fixed in the next release the day after, while
with Firefox Release you will potentially have to wait for 6 weeks.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="help-add-on-developers-to-validate-that-their-add-ons-are-still-working"&gt;
&lt;h3&gt;Help add-on developers to validate that their add-ons are still working&lt;/h3&gt;
&lt;img alt="Add-ons for Firefox" class="align-center" src="http://www.servicedenuages.fr/en/../images/amo.png" style="width: 1283px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Firefox is transitioning from a complex and error-prone way of
writing add-ons to a standardized way of writing Web extensions, which
are most likely to be compatible with Chrome and use well known Web
technologies which makes them easier to develop.&lt;/p&gt;
&lt;p&gt;This is challenging for add-ons creators that already have a working
add-on that needs to be rewritten.&lt;/p&gt;
&lt;p&gt;As a community we can help them. If they already have a Google Chrome
add-on, it is most likely that they will be able to install it in
Firefox directly. Plus, Firefox plans to expose more add-ons API
than Chrome and we will create more in 2017 to help as much as
possible port previous add-ons to the Web extensions standard.&lt;/p&gt;
&lt;p&gt;As an early adopter we can help to test these new add-ons to keep a
good experience for our users.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="have-a-better-developer-experience-to-develop-your-web-apps"&gt;
&lt;h3&gt;Have a better developer experience to develop your Web apps&lt;/h3&gt;
&lt;p&gt;If you develop Web applications you might have had some problems to
debug them with Firefox.&lt;/p&gt;
&lt;p&gt;We have a full team of developers dedicated to make Firefox the best
tool for developping Web applications. This team is improving Web
developer tools everyday and by using Nightly it will make your life
easier.&lt;/p&gt;
&lt;p&gt;I hope that at some point you will even want to open Firefox because
it is easiser than debugging your app in Chrome. And I have good hope
that we reach this point in 2017.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="give-a-really-valuable-contribution-to-the-mozilla-project-without-coding"&gt;
&lt;h3&gt;Give a really valuable contribution to the Mozilla project without coding&lt;/h3&gt;
&lt;p&gt;Often people ask me how they can contribute to the Mozilla Firefox
project.&lt;/p&gt;
&lt;p&gt;To be honest, starting to use Nightly today is a real huge step toward
that goal.&lt;/p&gt;
&lt;p&gt;To use Firefox Nightly as a daily user is a simple and awesome way to
help Firefox because it gives us feedback on the work we are doing
ahead of time and also immediately. We don't have to wait for 18 weeks to
get feedback on our work, we can have it the day after.&lt;/p&gt;
&lt;p&gt;As of this writing, we have only few handfuls of users for Firefox
Nightly so your choice to use it makes a huge difference to us.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h3&gt;Conclusion&lt;/h3&gt;
&lt;p&gt;I hope you are now convinced that you can help us to make a better
Firefox by starting to use Firefox Nightly today.&lt;/p&gt;
&lt;p&gt;You can install the &lt;a class="reference external" href="https://nightly.mozilla.org/"&gt;desktop Firefox version&lt;/a&gt; as well as your
&lt;a class="reference external" href="https://www.mozilla.org/firefox/channel/android/"&gt;Android Firefox version&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Once you are using Firefox Nightly, &lt;strong&gt;if you see something, say something&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;You will have a good chance to see it fixed the day after, while if
you don't say anything it might never get fixed...&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://bugzilla.mozilla.org/"&gt;File a Bug in our bugtracker&lt;/a&gt; (you
can now login with your Github account).&lt;/p&gt;
&lt;p&gt;However in case of crashes, the bug report is sent automatically for
you with the detail that will hopefully help developpers to reproduce
it, so you don't need to do anything.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="bonus-how-to-configure-firefox-nightly-as-my-default-browser-in-linux"&gt;
&lt;h2&gt;Bonus: How to configure Firefox Nightly as my default browser in Linux?&lt;/h2&gt;
&lt;img alt="Setup Firefox Nightly on Ubuntu." class="align-center" src="http://www.servicedenuages.fr/en/../images/ubuntu-behavior.png" style="width: 600px; height: auto; max-width: 100%;"/&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Download the archive in &lt;a class="reference external" href="https://nightly.mozilla.org/"&gt;https://nightly.mozilla.org/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;tar jxf &lt;span class="pre"&gt;~/Downloads/firefox*.linux-x86_64.tar.bz2&lt;/span&gt; &lt;span class="pre"&gt;-C&lt;/span&gt; ~/apps/&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;Copy current Firefox desktop file: &lt;tt class="docutils literal"&gt;cp /usr/share/applications/firefox.desktop ~/apps&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;Copy current browser alternative file: &lt;tt class="docutils literal"&gt;cp &lt;span class="pre"&gt;/etc/alternatives/x-www-browser&lt;/span&gt; ~/apps&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;Copy current launcher file: &lt;tt class="docutils literal"&gt;cp /usr/lib/firefox/firefox.sh ~/apps&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;Remove the version installed by your package manager: &lt;tt class="docutils literal"&gt;sudo apt purge firefox&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;Install Firefox: &lt;tt class="docutils literal"&gt;sudo ln &lt;span class="pre"&gt;-s&lt;/span&gt; &lt;span class="pre"&gt;${HOME}/apps/firefox.sh&lt;/span&gt; /usr/bin/firefox&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;Install the desktop file: &lt;tt class="docutils literal"&gt;sudo cp ~/apps/firefox.desktop /usr/share/applications/&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;Install the icon: &lt;tt class="docutils literal"&gt;sudo cp ~/apps/firefox/browser/icons/mozicon128.png /usr/share/pixmaps/firefox.png&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;Install the browser alternative: &lt;tt class="docutils literal"&gt;cp &lt;span class="pre"&gt;~/apps/x-www-browser&lt;/span&gt; &lt;span class="pre"&gt;/etc/alternatives/x-www-browser&lt;/span&gt;&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;Display an URL in the terminal: &lt;tt class="docutils literal"&gt;echo &lt;span class="pre"&gt;https://www.mozilla.org/&lt;/span&gt;&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;Close Firefox and click on the link.&lt;/li&gt;
&lt;li&gt;Firefox Nightly should open your link.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="section" id="troubleshooting"&gt;
&lt;h3&gt;Troubleshooting&lt;/h3&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Remove any &lt;tt class="docutils literal"&gt;*.desktop&lt;/tt&gt; file talking about Firefox in &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;~/.local/share/applications/&lt;/span&gt;&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;You might want to restart your computer at some point.&lt;/li&gt;
&lt;li&gt;Ask for help and ping natim on &lt;a class="reference external" href="irc://irc.mozilla.org/"&gt;irc://irc.mozilla.org/&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>Prototyping an app with Kinto</title><link href="http://www.servicedenuages.fr/en/prototyping-an-app-with-kinto" rel="alternate"></link><published>2016-12-15T00:00:00+01:00</published><updated>2016-12-15T00:00:00+01:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2016-12-15:/en/prototyping-an-app-with-kinto</id><summary type="html">&lt;p&gt;Prototyping an app with Kinto and the admin.&lt;/p&gt;</summary><content type="html">&lt;p&gt;I own a car. And it costs a lot. But how much exactly is difficult to know, because the costs are spread between maintenance, repairs, fuel, insurance...
What if I could store each expense right on the spot, categorize it, and maybe add a description? That would be tremendously helpful, right?&lt;/p&gt;
&lt;p&gt;In order to build something like that, I'd normally have to fire up a django project, maybe use django-rest-framework to have a proper REST API for the future web or mobile application. Then choose a database like postgresql and configure it.&lt;/p&gt;
&lt;p&gt;But I'm not even sure it's a good idea! Maybe we can instead give it a try using the &lt;a href="https://github.com/Kinto/kinto-admin/"&gt;kinto-admin&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Let's get started&lt;/h2&gt;
&lt;p&gt;Let's first think about the data model:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;title: a string&lt;/li&gt;
&lt;li&gt;comment: a multiline string&lt;/li&gt;
&lt;li&gt;category: a string taken from a list of choices&lt;/li&gt;
&lt;li&gt;price: a float&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;And then how to store entries in Kinto:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;we'll have a bucket (&lt;code&gt;track-my-expenses&lt;/code&gt;) which contains a collection (&lt;code&gt;car-expenses&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;a &lt;a href="https://kinto.readthedocs.io/en/latest/api/1.x/collections.html#collection-json-schema"&gt;JSON schema&lt;/a&gt; on the collection will validate the data before it's stored in records&lt;/li&gt;
&lt;li&gt;and a &lt;a href="https://github.com/mozilla-services/react-jsonschema-form/blob/master/README.md#the-uischema-object"&gt;UI schema&lt;/a&gt; to improve the way the form is displayed in the admin (eg. a textarea for the comment instead of a single line text input).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Our proof of concept will take advantage of the &lt;a href="https://github.com/Kinto/kinto-admin/"&gt;kinto-admin&lt;/a&gt; UI which gives us a way to create/read/update/delete entries (records).&lt;/p&gt;
&lt;h2&gt;Create the bucket and the collection&lt;/h2&gt;
&lt;p&gt;For our proof of concept, we'll use Mozilla's demo server, which is wiped clean every night: https://kinto.dev.mozaws.net/v1/.&lt;/p&gt;
&lt;p&gt;Let's sign in to the &lt;a href="https://kinto.dev.mozaws.net/v1/admin/"&gt;admin&lt;/a&gt; with the user/pass of our choice.&lt;/p&gt;
&lt;p&gt;Keep in mind that there's no &lt;a href="http://kinto.readthedocs.io/en/stable/api/1.x/authentication.html#a-word-about-users"&gt;concept of user in Kinto&lt;/a&gt;. Instead, a unique id will be generated from the authentication, and the data you enter/modify will be linked to it. Permissions are based on this mechanism.&lt;/p&gt;
&lt;p&gt;&lt;img alt="kinto-admin-sign-in" src="http://www.servicedenuages.fr/en/../images/kinto-admin-sign-in.png" style="width: 2852px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;Once connected, we can &lt;a href="https://kinto.dev.mozaws.net/v1/admin/#/buckets/create"&gt;create a bucket&lt;/a&gt;:&lt;/p&gt;
&lt;p&gt;&lt;img alt="kinto-admin-connected" src="http://www.servicedenuages.fr/en/../images/kinto-admin-connected.png" style="width: 2806px; height: auto; max-width: 100%;"/&gt;
&lt;img alt="kinto-admin-create-bucket" src="http://www.servicedenuages.fr/en/../images/kinto-admin-create-bucket.png" style="width: 2832px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;And then &lt;a href="https://kinto.dev.mozaws.net/v1/admin/#/buckets/track-my-expenses/collections/create"&gt;create a collection&lt;/a&gt;:&lt;/p&gt;
&lt;p&gt;&lt;img alt="kinto-admin-create-collection" src="http://www.servicedenuages.fr/en/../images/kinto-admin-create-collection.png" style="width: 2810px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;Let's not submit this new collection just yet, we'd first like to add a &lt;a href="https://kinto.readthedocs.io/en/latest/api/1.x/collections.html#collection-json-schema"&gt;JSON schema&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Add a JSON schema&lt;/h2&gt;
&lt;p&gt;As you can see while creating a collection, we have the option of adding a JSON schema. This schema will be used to validate the data we will submit, before it's stored in a record.
The schema will also be used to automatically generate the CRUD forms for our data, straight into the admin.&lt;/p&gt;
&lt;p&gt;Following our data model, here's what the JSON schema should look like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nt"&gt;"type"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"object"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="nt"&gt;"properties"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nt"&gt;"title"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nt"&gt;"type"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"string"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;"title"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"Title"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;"description"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"Short title for an expense"&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="nt"&gt;"comment"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nt"&gt;"type"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"string"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;"title"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"Comment"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;"description"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"Provide details if needed..."&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="nt"&gt;"category"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nt"&gt;"type"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"string"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;"enum"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;"fuel"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"repair"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"insurance"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"maintenance"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"equipment"&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
      &lt;span class="nt"&gt;"title"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"Category"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;"description"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"A category for this expense"&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="nt"&gt;"price"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nt"&gt;"type"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"number"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;"title"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"Price"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="nt"&gt;"description"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"The cost for this expense"&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note the &lt;code&gt;enum&lt;/code&gt; attribute on the category field which will be rendered in the forms as a select, instead of a simple input text field.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Tip:&lt;/em&gt; You can use the &lt;a href="https://kinto.github.io/formbuilder/"&gt;form builder&lt;/a&gt; to build your form visually, and then copy the JSON schema to the admin!&lt;/p&gt;
&lt;p&gt;Let's still not submit this new collection just yet, as we'll want to add a &lt;a href="https://github.com/mozilla-services/react-jsonschema-form/blob/master/README.md#the-uischema-object"&gt;UI schema&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Add a UI schema to improve the forms&lt;/h2&gt;
&lt;p&gt;Adding a &lt;a href="https://github.com/mozilla-services/react-jsonschema-form/blob/master/README.md#the-uischema-object"&gt;UI schema&lt;/a&gt; will improve the way the admin will display our data, and the forms to add/edit it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nt"&gt;"ui:order"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
    &lt;span class="s2"&gt;"title"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;"comment"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;"category"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;"price"&lt;/span&gt;
  &lt;span class="p"&gt;],&lt;/span&gt;
  &lt;span class="nt"&gt;"comment"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nt"&gt;"ui:widget"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"textarea"&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;code&gt;ui:order&lt;/code&gt; will be used to display the fields in the order we want (JSON objects attributes aren't ordered), and we also specify that we'd like a &lt;code&gt;textarea&lt;/code&gt; for the comment field, instead of a single line input text field.&lt;/p&gt;
&lt;p&gt;Nearly done! Just before submitting this new collection, let's configure the columns to be displayed in the record list page.&lt;/p&gt;
&lt;h2&gt;Final touches&lt;/h2&gt;
&lt;p&gt;By default, the admin will only display one column in the record list page. It would be much more convenient to display the &lt;code&gt;category&lt;/code&gt; and &lt;code&gt;price&lt;/code&gt; on top of the &lt;code&gt;title&lt;/code&gt;:&lt;/p&gt;
&lt;p&gt;&lt;img alt="kinto-admin-records-list-columns" src="http://www.servicedenuages.fr/en/../images/kinto-admin-records-list-columns.png" style="width: 2032px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;h2&gt;Profit!&lt;/h2&gt;
&lt;p&gt;We now have everything we need for our proof of concept!&lt;/p&gt;
&lt;p&gt;List the current records (there's none yet):
&lt;img alt="kinto-admin-list-records" src="http://www.servicedenuages.fr/en/../images/kinto-admin-list-records.png" style="width: 2828px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;Add a new record:
&lt;img alt="kinto-admin-add-record" src="http://www.servicedenuages.fr/en/../images/kinto-admin-add-record.png" style="width: 2834px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;Display the list of (sortable) records once we added a few:
&lt;img alt="kinto-admin-list-records-many" src="http://www.servicedenuages.fr/en/../images/kinto-admin-list-records-many.png" style="width: 2834px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;As you can see, without a single line of code and very small effort, we have a functional, albeit very basic, proof of concept!&lt;/p&gt;
&lt;p&gt;While this is a nice and easy way to have a proof of concept, the admin's role is not meant to fulfill all your needs. If you wanted aggregation or filtering, you would still need a client, your own application.&lt;/p&gt;</content><category term="mozilla"></category></entry><entry><title>FullstackFest 2016</title><link href="http://www.servicedenuages.fr/en/fullstackfest-2016" rel="alternate"></link><published>2016-09-16T00:00:00+02:00</published><updated>2016-09-16T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2016-09-16:/en/fullstackfest-2016</id><summary type="html">&lt;p class="first last"&gt;Summary and feedback from Fullstack Fest 2016 in Barcelona&lt;/p&gt;
</summary><content type="html">&lt;p&gt;I had the chance to go the Fullstack Fest 2016 and really enjoyed it — thanks Mozilla!&lt;/p&gt;
&lt;p&gt;This blog post is an attempt to give you a summary and some feedback of what happened during this 4+1 days conference!&lt;/p&gt;
&lt;div class="section" id="huge-applause"&gt;
&lt;h2&gt;Huge applause!&lt;/h2&gt;
&lt;p&gt;The &lt;a class="reference external" href="http://www.codegram.com"&gt;Codegram team&lt;/a&gt; did really really well! They raised the bar for tech conferences; all the feedback I heard was extremely positive! Plus, Barcelona is a pleasant destination :)&lt;/p&gt;
&lt;p&gt;Former &lt;em&gt;RubyCon&lt;/em&gt; and &lt;em&gt;FutureJS&lt;/em&gt; events were merged into one &lt;em&gt;fullstack&lt;/em&gt; event, 2 days of backend talks, 1 gap day with social activites, and 2 days of frontend talks.&lt;/p&gt;
&lt;blockquote&gt;
Problems of Today, ideas from the future. — FullstackFest motto&lt;/blockquote&gt;
&lt;p&gt;I must congratulate the organizers for the choice of speakers and topics. It's a huge challenge to captivate 500 persons during 5 days, and they did really well! And also a big up for the impressive performance of the captioners!&lt;/p&gt;
&lt;img alt="CC-BY @fullstackfest" class="align-center" src="http://www.servicedenuages.fr/en/../images/fullstackfest-venue.jpg" style="width: 1891px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;div class="section" id="trends"&gt;
&lt;h2&gt;Trends&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Docker&lt;/li&gt;
&lt;li&gt;Amazon Lambda&lt;/li&gt;
&lt;li&gt;GraphQL&lt;/li&gt;
&lt;li&gt;Criticism of microservices&lt;/li&gt;
&lt;li&gt;Offline / high latency / decentralized Web&lt;/li&gt;
&lt;li&gt;Functional programming&lt;/li&gt;
&lt;li&gt;Reactive programming&lt;/li&gt;
&lt;li&gt;Immutability&lt;/li&gt;
&lt;li&gt;Machine learning&lt;/li&gt;
&lt;li&gt;Virtual reality&lt;/li&gt;
&lt;li&gt;Physical Web&lt;/li&gt;
&lt;/ul&gt;
&lt;img alt="CC-BY @fullstackfest" class="align-center" src="http://www.servicedenuages.fr/en/../images/fullstackfest-trends.jpg" style="width: 1351px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;div class="section" id="one-sentence-summaries"&gt;
&lt;h2&gt;One sentence summaries&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;The videos are already online! In order to help you choose which one to watch, here is the shortest summary I could come up with for each talk, videos are linked on authors names:&lt;/em&gt;&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Hardware is amazing, software is crap. Use parallelism and keep your data under your control — &lt;a class="reference external" href="https://www.youtube.com/watch?v=itKFrXghGuA&amp;amp;index=2&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Joe Armstrong&lt;/a&gt;, Erlang's inventor.&lt;/li&gt;
&lt;li&gt;Scale using «pods»: deploy several isolated stacks of your multitenant app ­— &lt;a class="reference external" href="https://www.youtube.com/watch?v=7UyDK2bDjc4&amp;amp;index=3&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Simon Eskildsen&lt;/a&gt;, Shopify&lt;/li&gt;
&lt;li&gt;Theorical knowledge can help when designing distributed systems with high availability — &lt;a class="reference external" href="https://www.youtube.com/watch?v=bUlpp8_Mevk&amp;amp;index=4&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Ines Sombra&lt;/a&gt;, Fastly&lt;/li&gt;
&lt;li&gt;Improve efficiency and security using a unikernel: a kernel whose components are built specifically for your app — &lt;a class="reference external" href="https://www.youtube.com/watch?v=XNu2lze6jS0&amp;amp;index=5&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Amir Chaudhry&lt;/a&gt;, Docker Inc&lt;/li&gt;
&lt;li&gt;Instead of making X faster, do less of X ­— &lt;a class="reference external" href="https://www.youtube.com/watch?v=b9H9AtbxpPM&amp;amp;index=6&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Tobias Pfeiffer&lt;/a&gt;, Bitcrowd&lt;/li&gt;
&lt;li&gt;Docker containers are only as secure as your best practices — &lt;a class="reference external" href="https://www.youtube.com/watch?v=oANurUSaOFs&amp;amp;index=7&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Ben Hall&lt;/a&gt;, &lt;a class="reference external" href="http://katacoda.com"&gt;http://katacoda.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Elixir provides high level abstractions that make Erlang awesome — &lt;a class="reference external" href="https://www.youtube.com/watch?v=Ba3aCm3A0o8&amp;amp;index=8&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Saša Jurić&lt;/a&gt;, Aircloak&lt;/li&gt;
&lt;li&gt;Unison is an experiment to come up with a new programming paradigm focused on distributed computing and persistence — &lt;a class="reference external" href="https://www.youtube.com/watch?v=f6yA3t0dO-k&amp;amp;index=10&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Paul Chiusano&lt;/a&gt;, Stage N&lt;/li&gt;
&lt;li&gt;HTTP2 reduces latency. It's here, use it with a one liner in your server configuration — &lt;a class="reference external" href="https://www.youtube.com/watch?v=CThgMRXS8w8&amp;amp;index=11&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Ole Michaelis&lt;/a&gt;, Jimdo&lt;/li&gt;
&lt;li&gt;Scale by publishing pre-rendered content to S3 when your data source changes — &lt;a class="reference external" href="https://www.youtube.com/watch?v=vUCr1oTtaKA&amp;amp;index=12&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Tim Perry&lt;/a&gt;, BBC&lt;/li&gt;
&lt;li&gt;Use Amazon lambda as a very cheap and ultra-efficient scaling solution — &lt;a class="reference external" href="https://www.youtube.com/watch?v=9IrFIobZUEA&amp;amp;index=13&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Austen Collins&lt;/a&gt;, serverless.com&lt;/li&gt;
&lt;li&gt;Processing natural language can be very easy with simple tricks — &lt;a class="reference external" href="https://www.youtube.com/watch?v=vRb-El8hC-U&amp;amp;index=14&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Duretti Hirpa&lt;/a&gt;, Slack&lt;/li&gt;
&lt;li&gt;It is our responsability to decentralize access and assure durability of our data. Internet of hash = bittorrent + git — &lt;a class="reference external" href="https://www.youtube.com/watch?v=jONZtXMu03w&amp;amp;index=15&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Juan Benet&lt;/a&gt;, ipfs.io&lt;/li&gt;
&lt;li&gt;Enable GraphQL on your API and rely on smart clients to do the hard work of querying and caching — &lt;a class="reference external" href="https://www.youtube.com/watch?v=eD7kLFGOgVw&amp;amp;index=16&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Marc-Andre Giroux&lt;/a&gt;, Shopify&lt;/li&gt;
&lt;li&gt;Some insights about recommendation engines and machine learning techniques — &lt;a class="reference external" href="https://www.youtube.com/watch?v=SRnM_P_ygqI&amp;amp;index=17&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Brian Sam-Bodden&lt;/a&gt;, Integrallis&lt;/li&gt;
&lt;/ul&gt;
&lt;img alt="CC-BY @fullstackfest" class="align-center" src="http://www.servicedenuages.fr/en/../images/fullstackfest-talks.jpg" style="width: 1351px; height: auto; max-width: 100%;"/&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Immutable UIs make it simpler to improve durability, utility and beauty in your software architecture — &lt;a class="reference external" href="https://www.youtube.com/watch?v=pLvrZPSzHxo&amp;amp;index=18&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Lee Byron&lt;/a&gt;, Facebook, author of Immutable.js&lt;/li&gt;
&lt;li&gt;Elm applications have no runtime errors — &lt;a class="reference external" href="https://www.youtube.com/watch?v=rDQ22Yg3Fms&amp;amp;index=19&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Jack Franklin&lt;/a&gt;, Songkick&lt;/li&gt;
&lt;li&gt;With new versions of Ecmascript, asynchronuous programs will look more and more synchronuous — &lt;a class="reference external" href="https://www.youtube.com/watch?v=3pKNRgResq0&amp;amp;index=20&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Jafar Husain&lt;/a&gt;, Netflix, author of Falcor&lt;/li&gt;
&lt;li&gt;PostCSS and CSS modules are really helpful for building a libray of UI components — &lt;a class="reference external" href="https://www.youtube.com/watch?v=j8eBXGPl_5E&amp;amp;index=21&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;David Wells&lt;/a&gt;, Serverless&lt;/li&gt;
&lt;li&gt;At last we have proper grids with CSS4 — &lt;a class="reference external" href="https://www.youtube.com/watch?v=axVw1Zduqn0&amp;amp;index=22&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Jen Kramer&lt;/a&gt;, Hardvard University&lt;/li&gt;
&lt;li&gt;Evolution of Web apps which now have views, business logic and persistence — &lt;a class="reference external" href="https://www.youtube.com/watch?v=wtURpqTgtUs&amp;amp;index=23&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Luca Marchesini&lt;/a&gt;, Kuzzle&lt;/li&gt;
&lt;li&gt;Om Next leverages Clojure to bring conventions for data immutability, data specifications and data routing — &lt;a class="reference external" href="https://www.youtube.com/watch?v=Zb18iPjDgwM&amp;amp;index=24&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;António Nuno Monteiro&lt;/a&gt;, Technische Universität Dresden&lt;/li&gt;
&lt;li&gt;The OpenBCI project allows everyone to study brainwaves using a homemade helmet —  &lt;a class="reference external" href="https://www.youtube.com/watch?v=CSfUr3m0-w8&amp;amp;index=25&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Alex Castillo&lt;/a&gt;, Netflix&lt;/li&gt;
&lt;li&gt;Flow based programming via CycleJS allows you to design and debug your apps via a high level of abstraction — &lt;a class="reference external" href="https://www.youtube.com/watch?v=R-GzJgEccEQ&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc&amp;amp;index=27"&gt;André Staltz&lt;/a&gt;, Futurice&lt;/li&gt;
&lt;li&gt;CSP channels in Javascript is the best tool for dealing with streams of data — &lt;a class="reference external" href="https://www.youtube.com/watch?v=r7yWWxdP_nc&amp;amp;index=28&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Vincenzo Chianese&lt;/a&gt;, Apiary&lt;/li&gt;
&lt;li&gt;With Service workers we won't have to wait for the server response when submitting data — &lt;a class="reference external" href="https://www.youtube.com/watch?v=xs_QRqGZ8xQ&amp;amp;index=29&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Andrew Dunkman&lt;/a&gt;, Harvest&lt;/li&gt;
&lt;li&gt;Build your apps as if there were be accessed by Martians via a high-latency connection ­— &lt;a class="reference external" href="https://www.youtube.com/watch?v=7rlEidtXlZg&amp;amp;index=30&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Slobodan Stojanovic&lt;/a&gt;, Cloud Horizon&lt;/li&gt;
&lt;li&gt;WebAssembly allows native apps to be run by the browser VM in the same stack context as JavaScript — &lt;a class="reference external" href="https://www.youtube.com/watch?v=vmzz17JGPHI&amp;amp;index=31&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Ben Smith&lt;/a&gt;, Google&lt;/li&gt;
&lt;li&gt;Render a 2D UI with React within a 3D WebGL scene — &lt;a class="reference external" href="https://www.youtube.com/watch?v=DfPPlakRvow&amp;amp;index=32&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Massimiliano Mantione&lt;/a&gt;, HyperFair&lt;/li&gt;
&lt;li&gt;Virtual reality in the browser is here! — &lt;a class="reference external" href="https://www.youtube.com/watch?v=Ciqucr_Ww9s&amp;amp;index=33&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Liv Erickson&lt;/a&gt;, Microsoft&lt;/li&gt;
&lt;li&gt;The physical Web is built on top of the open Web and will change our lives — &lt;a class="reference external" href="https://www.youtube.com/watch?v=gV72mCdomo4&amp;amp;index=34&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;Scott Jenson&lt;/a&gt;, Google&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="some-thoughts"&gt;
&lt;h2&gt;Some thoughts&lt;/h2&gt;
&lt;p&gt;The challenges of Web content durability and decentralization are very concerning. The Web of today has too many points of failure, Web engineers are responsible for making it better. For example, 500 attendees cannot collaborate on a document without going through servers outside the room! My great-great-grandchildren might not be able to find a picture of me on the Web! &lt;a class="reference external" href="https://ipfs.io/#why"&gt;But read this page&lt;/a&gt; and you'll realize this is not &lt;em&gt;only&lt;/em&gt; about the future!&lt;/p&gt;
&lt;blockquote&gt;
You are cyberwizards!  — Juan Benet&lt;/blockquote&gt;
&lt;p&gt;Both frontend and backend talks seem to agree on the fact that REST has strong limitations for high latency connections like on the mobile Web. GraphQL and Falcor are good candidates today, and can be complementary to our usual REST/CRUD endpoints.&lt;/p&gt;
&lt;p&gt;Google and Microsoft are following Amazon and its &lt;a class="reference external" href="https://aws.amazon.com/lambda/details/"&gt;Lambda&lt;/a&gt; to provide a platform of nanoservices for which you don't pay when idle, and that scale on trafic peaks. A whole app can be decomposed into functions and designed using internal events. Orchestration of those tiny pieces of code is another story (&lt;em&gt;for a CRUD endpoint, each verb is bound to a function&lt;/em&gt;), but &lt;a class="reference external" href="http://blog.serverless.com/defining-serverless/"&gt;Serverless&lt;/a&gt; wants to tackle that.&lt;/p&gt;
&lt;img alt="CC-BY @fullstackfest" class="align-center" src="http://www.servicedenuages.fr/en/../images/fullstackfest-vr.jpg" style="width: 489px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Functional programming is in the air. Pure (stateless) functions scale because they can be executed anywere without context. Without side effects, it also becomes obvious to test them. They give backend developers some good pattern for highly available services, and provide the necessary constraints for immutability to frontend developers. I believe that if functional programming is not adopted as much as it could, it is not because of the paradigm and concepts, but because of the disconcerting syntax!&lt;/p&gt;
&lt;blockquote&gt;
There is no architecture nirvana!  — Lee Byron&lt;/blockquote&gt;
&lt;p&gt;Angular/TypeScript was almost absent from the conference, but we could see a trend around type inference/checking. It really improves developer experience and reduces runtime errors in the end. With projects like Elm, developers feel safe while coding: the compiler is smart and polite, refactoring is fun! The concept of &lt;tt class="docutils literal"&gt;null&lt;/tt&gt; is replaced with a notion of &lt;em&gt;maybe &amp;lt;type&amp;gt;&lt;/em&gt; which makes apps robust.&lt;/p&gt;
&lt;p&gt;Everybody seemed to agree that JavaScript transpilation will last for a long time. The language will evolve, and we shouldn't hope for feature freeze. Plus, it really helps developers focus on modern stacks, leveraging modern features like &lt;a class="reference external" href="https://github.com/tc39/proposal-cancelable-promises"&gt;cancelable promises&lt;/a&gt;. And nowadays it is rather easy to build your app for legacy versions of JavaScript like ES5. But hey, it is a bit absurd that modern browsers have to download big bundles of code full of polyfills! It would be a lot nicer if they were delivered to legacy browsers only — &lt;cite&gt;&amp;lt;!--[if IE 10]&amp;gt;&lt;/cite&gt; oh yeah :) — or even better: shipped as something like a browser addon :)&lt;/p&gt;
&lt;p&gt;The old times where we could inspect the source code of a page ­— and learn from it — is far! It is sad, but we may have to accept it because WebAssembly goes a lot further and ships code that looks closely to assembler! It's far from the Web we know, but it's still the open Web! Note that it is very different from what we saw in the past with plugins like Java applets, now a WebAssembly function can be called from a usual JS script!&lt;/p&gt;
&lt;p&gt;The physical Web is awesome and I'm really excited about this revolution, especially how it could bring a peer-to-peer local Web, using &lt;a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Bluetooth_API"&gt;Web bluetooth&lt;/a&gt; for example. Scott told me that the Mozilla approach with &lt;a class="reference external" href="https://hacks.mozilla.org/2016/09/flyweb-pure-web-cross-device-interaction/"&gt;FlyWeb&lt;/a&gt; is slightly different because it goes through Wifi, but both teams in contact. The physical Web is an open project, and Google is pushing it strongly. I'm bothered by the &lt;em&gt;URL redirections&lt;/em&gt; strategy though because it puts the redirection intermediary in a very strong position. I believe that Google wants to be that intermediary.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="personal-feedback"&gt;
&lt;h2&gt;Personal feedback&lt;/h2&gt;
&lt;p&gt;I never attended a conference that was so close to my flat! 3min walking! It was kind of weird to meet so many prestigious IT talents in my neighbourhood! ...and so many floppy disks :)&lt;/p&gt;
&lt;img alt="CC-BY @fullstackfest" class="align-center" src="http://www.servicedenuages.fr/en/../images/fullstackfest-floppy.jpg" style="width: 1966px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;The venue was great, and very well setup for the show (&lt;a class="reference external" href="https://www.youtube.com/watch?v=vxMASndC3k4&amp;amp;index=1&amp;amp;list=PLe9psSNJBf76DOOKMkDpyo_A5PfZk7JWc"&gt;see the introductory video clip!&lt;/a&gt;). The coffee was not so good though.&lt;/p&gt;
&lt;p&gt;I really enjoyed the fact that there was only &lt;strong&gt;one track&lt;/strong&gt;. I never had to divide myself between two interesting talks, and could just sit and enjoy :)&lt;/p&gt;
&lt;p&gt;Almost every topic resonated with the challenges we face at work. We are one of the few teams at Mozilla that do both backend and frontend, and that's awesome to feel in the same boat as the whole room of attendees. For example, we implemented &lt;a class="reference external" href="https://amo2kinto-lambda.readthedocs.io"&gt;something on Amazon lambda&lt;/a&gt; recently, we are well aware of the frontend architecture challenges through our &lt;a class="reference external" href="https://github.com/Kinto/kinto-admin"&gt;Kinto-admin&lt;/a&gt;, Ethan has a functional programming background in Haskell, and Nico and Mathieu &lt;a class="reference external" href="https://github.com/n1k0/kinto-elm-experiments"&gt;are playing with Elm&lt;/a&gt;. That's why I strongly regretted that my teammates were not with me!&lt;/p&gt;
&lt;p&gt;Also, I had the opportunity to meet Luca and Anthony from the Kuzzle team! We had a lot of fun together and our conversations about generic reusable backends were super insightful — see &lt;a class="reference external" href="https://mail.mozilla.org/pipermail/kinto/2016-September/000197.html"&gt;my post on kinto ML&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Last, but not least, I would like to thank Pusher.com for organizing a hack contest using their API! They had a physical button in their booth, and I made a kind-of video booth that records the webcam when the button is pressed. I could not have won this BB8 droid without &lt;a class="reference external" href="https://hacks.mozilla.org/2016/04/record-almost-everything-in-the-browser-with-mediarecorder/"&gt;Soledad's insights on MozillaHacks&lt;/a&gt;, and I thank her again :)&lt;/p&gt;
&lt;img alt="Me holding the prize proudly!" class="align-center" src="http://www.servicedenuages.fr/en/../images/fullstackfest-contest.jpg" style="width: 1080px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;div class="section" id="some-links"&gt;
&lt;h2&gt;Some links&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://www.kontena.io"&gt;https://www.kontena.io&lt;/a&gt;: open source container platform. The features are really really attractive!&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://toxiproxy.io"&gt;http://toxiproxy.io&lt;/a&gt;: a proxy to simulate network and system conditions&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://openresty.org"&gt;https://openresty.org&lt;/a&gt;: REST via Lua in Nginx&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://en.wikipedia.org/wiki/Gossip_protocol"&gt;Gossip/epidemic protocols&lt;/a&gt; to invalidate cache&lt;/li&gt;
&lt;li&gt;Challenge unikernel security with the &lt;a class="reference external" href="http://amirchaudhry.com/bitcoin-pinata"&gt;Bitcoin piñata&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Solve deterministic problems with randomness using &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Monte_Carlo_method"&gt;the Monte Carlo method&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Decision tree learning with &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Random_forest"&gt;random forests&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Attack systems with &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Fork_bomb"&gt;fork bombs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;The $10 million australian #censusfail &lt;a class="reference external" href="http://eftm.com.au/2016/08/how-two-uni-students-built-a-better-census-site-in-just-54-hours-for-500-30752"&gt;rebuilt for $500 using AWS Lambda&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Clean natural language with &lt;a class="reference external" href="https://stanfordnlp.github.io/CoreNLP/"&gt;CoreNLP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://howdy.ai"&gt;https://howdy.ai&lt;/a&gt;: trainable bot for Slack&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://openbazaar.org"&gt;https://openbazaar.org&lt;/a&gt;: A free market for all, no fees, no restrictions&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://www.apollostack.com"&gt;http://www.apollostack.com&lt;/a&gt;: everything you need to start using GraphQL&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://www.ted.com/talks/barry_schwartz_on_the_paradox_of_choice?language=en"&gt;The paradox of choice&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://davidwells.io/19-open-source-react-component-libraries-to-use-in-your-next-project/"&gt;19 Open Source React Component Libraries to use in your next project&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/team-gryff/react-monocle"&gt;react-monocle&lt;/a&gt;: A developer tool to visualize a React application's component hierarchy&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://hyperdev.com"&gt;https://hyperdev.com&lt;/a&gt;: A fullstack JSBin&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://ux.mulesoft.com"&gt;http://ux.mulesoft.com&lt;/a&gt;: MuleSoft components library&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>jEdit bugs: Getting off the Ground with Kinto and Kinto.js</title><link href="http://www.servicedenuages.fr/en/jedit-bugs-getting-off-the-ground" rel="alternate"></link><published>2016-09-09T00:00:00+02:00</published><updated>2016-09-09T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2016-09-09:/en/jedit-bugs-getting-off-the-ground</id><summary type="html">&lt;p&gt;My experience using Kinto and Kinto.js to browse jEdit tickets offline&lt;/p&gt;</summary><content type="html">&lt;p&gt;This is a guest post by &lt;a href="https://github.com/elelay"&gt;Eric Le Lay&lt;/a&gt; on his experience using Kinto.&lt;/p&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Have you heard of &lt;a href="http://jedit.org"&gt;jEdit&lt;/a&gt; — the &lt;em&gt;programmer's text editor&lt;/em&gt;?
It's a multi-platform text editor, written in Java, with a myriad of plugins.
I've been part of the development team for ten years.
It's hosted on Sourceforge, with the code base under &lt;em&gt;Subversion&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;This is a labour of love for us, contributing during our free time. For me, that's when I'm on holidays.
I don't always have Internet access where I'm staying. Or it's via a short Ethernet cable in a dark and overheated room.
Don't lock me out of the sunny garden! Give me everything I need off-line!&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Java sources and Javadoc: install the &lt;code&gt;openjdk7-doc&lt;/code&gt; and &lt;code&gt;openjdk7-src&lt;/code&gt; packages;&lt;/li&gt;
&lt;li&gt;jEdit and plugins sources: with git-svn I get the code and history;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;bugs and feature requests: oops!&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We have 1100 open tickets and 7600 closed. None of them are available offline. That needs to change!&lt;/p&gt;
&lt;h3&gt;Grabbing a ticket archive&lt;/h3&gt;
&lt;p&gt;Sourceforge lets project admins download an archive of their project, containing tickets and other things.
A script of mine converts them to a bunch of HTML files, with a little JavaScript for navigation.
Resulting HTML files are then uploaded to
 &lt;a href="http://jedit.org/trackers/"&gt;jedit.org/trackers&lt;/a&gt; where they can be browsed online or
 &lt;a href="http://jedit.org/trackers/Export.tgz"&gt;downloaded&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;To save space, only open tickets are available.&lt;/p&gt;
&lt;p&gt;Sourceforge takes minutes to generate the project archive, so I run the export at most once per week.
It's not convenient for users either, because they have to download a new archive to get an up-to-date view of tickets.
Even downloading the latest archive doesn't give them the freshest state, because it can be a week old at worst:
lots of room for improvements!&lt;/p&gt;
&lt;h3&gt;My Goals&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;be able to incrementally update tickets;&lt;/li&gt;
&lt;li&gt;better ticket search and visualization;
   maybe even offline modification;&lt;/li&gt;
&lt;li&gt;I'd like to try Kinto :-).&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;First Steps with Kinto&lt;/h2&gt;
&lt;p&gt;I've heard about Kinto from Rémy and Alexis. As with couchdb/pouchdb, it's possible to sync the database between
the server (Kinto) and the browser (kinto.js). Kinto.js stores data in IndexedDB so it should be possible to work with a
biggish database.&lt;/p&gt;
&lt;p&gt;Each user can create his own collections (think SQL tables) in Kinto. There are even finer grained permissions,
document by document (think SQL rows).&lt;/p&gt;
&lt;h3&gt;To Do List&lt;/h3&gt;
&lt;p&gt;I've begun with the &lt;a href="http://kintojs.readthedocs.io/en/latest/tutorial/"&gt;tutorial&lt;/a&gt;.
It nicely introduces Kinto basics:
create documents, show them, modify them, sync with a remote server. It uses Mozilla's hosted test server: one
less barrier to try it out.&lt;/p&gt;
&lt;h3&gt;Tickets instead of Tasks&lt;/h3&gt;
&lt;p&gt;I've moved to a local Kinto server for my next steps: it's very easy to deploy using docker.
If you plan to batch-import documents, install the PostgreSQL backend straight away (easy to install using
docker-compose; just
&lt;a href="http://kinto.readthedocs.io/en/stable/tutorials/install.html#using-docker-compose"&gt;follow the instructions&lt;/a&gt;).
The In-Memory backend has &lt;a href="https://github.com/Kinto/kinto/issues/759"&gt;issues&lt;/a&gt; with parallel batch import requests (which
happens when you import in a node.js &lt;a href="https://github.com/elelay/jedit-trackers-kinto/blob/master/transform.js"&gt;script&lt;/a&gt;
with &lt;a href="https://www.npmjs.com/package/request"&gt;request&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;Once tickets are imported, the webapp has just to fetch them via kinto.js's &lt;code&gt;sync()&lt;/code&gt;and display them.&lt;/p&gt;
&lt;h3&gt;Local Search with kinto.js&lt;/h3&gt;
&lt;p&gt;Searching in the browser with kinto.js is not as rich as
 &lt;a href="http://kinto.readthedocs.io/en/stable/api/1.x/filtering.html"&gt;on the server&lt;/a&gt;:
it supports only a conjunction of &lt;code&gt;key: [value1, value2, ...]&lt;/code&gt; parameters. Querying the &lt;code&gt;id&lt;/code&gt;, &lt;code&gt;_status&lt;/code&gt;, &lt;code&gt;last_modified&lt;/code&gt;
is accelerated by an index (code &lt;a href="https://github.com/Kinto/kinto.js/blob/f48ea470ddb2c6398acc386439043e6cae8bffe4/src/adapters/IDB.js#L325"&gt;here&lt;/a&gt;).
All documents are then loaded and returned in an array, then filtered according to remaining query params.
Arbitrary queries are done by the application on the result of the &lt;code&gt;list()&lt;/code&gt; operation.
This is fine for small collections, but searching is not lighting fast when you reach 8k documents.&lt;/p&gt;
&lt;p&gt;An example of full-text search (from a keyword in a text field):&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;filterByKeyword&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;keyword&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;indexOf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;keyword&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;search&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;keyword&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"query"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;tickets&lt;/span&gt;
    &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;list&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;filterByKeyword&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;keyword&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
    &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;// on submit&lt;/span&gt;
&lt;span class="nx"&gt;search&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;render&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Architecture&lt;/h2&gt;
&lt;p&gt;I'm hosting my Kinto server on a C1 server at scaleway. It contains 2 collections:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;tickets, for open or recent tickets;&lt;/li&gt;
&lt;li&gt;oldTickets, for tickets closed before 2016.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I use Sourceforge's ticket id
&lt;a href="http://kintojs.readthedocs.io/en/latest/api/#custom-id-generation-using-an-id-schema"&gt;instead of an auto-generated id&lt;/a&gt;.
This way I can update the database more easily (no need to fetch the kinto document before updating it, since I know
the content and the id).&lt;/p&gt;
&lt;p&gt;Clients are web applications.&lt;/p&gt;
&lt;p&gt;An updater script forwards modifications from Sourceforge to the Kinto database.&lt;/p&gt;
&lt;p&gt;The C1 machine has an ARM processor and runs Debian Jessie. So a few deviations to the standard setup were necessary
(see the &lt;a href="https://github.com/Kinto/kinto/wiki"&gt;wiki kinto&lt;/a&gt;).&lt;/p&gt;
&lt;h2&gt;The kinto.js Client&lt;/h2&gt;
&lt;p&gt;My goal was to learn kinto.js, not your latest front-end framework, so I quite liked the vanilla take on the tutorial
and stuck with it:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;bootstrap CSS, fontawesome icons,&lt;/li&gt;
&lt;li&gt;a few utilities: moment, lodash,&lt;/li&gt;
&lt;li&gt;datatables (after devising my own row management, but not wanting to implement row details myself and having
   found a nice example &lt;a href="https://datatables.net/examples/server_side/row_details.html"&gt;for this&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="screenshot of the application" src="http://www.servicedenuages.fr/en/../images/jedit-trackers-with-kinto-app.png" style="width: 990px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;h2&gt;Initial State&lt;/h2&gt;
&lt;p&gt;When you load the &lt;a href="https://trackers.elelay.fr/trackers.html"&gt;application&lt;/a&gt; for the first time
a panel shows you ticket counts, lets you choose to include old tickets and download the database.&lt;/p&gt;
&lt;p&gt;Here is how I determine if it's the first run:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;db&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getLastModified&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;hasDB&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;noDB&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To display the server's ticket count before sync, one has to go down to the
 &lt;a href="https://github.com/Kinto/kinto-http.js"&gt;kinto-http&lt;/a&gt; package (this is being worked on, see
 &lt;a href="https://github.com/Kinto/kinto-http.js/issues/138"&gt;this issue&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;code snippet:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;fetchTotalRecords&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;api&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;bucket&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;etag&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;headers&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{};&lt;/span&gt;
    &lt;span class="nx"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;"Authorization"&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"Basic "&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;btoa&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"token:tr0ub4d@ur"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;api&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;client&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
        &lt;span class="nx"&gt;path&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"/buckets/"&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;bucket&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;"/collections/"&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;"/records"&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;etag&lt;/span&gt; &lt;span class="o"&gt;?&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"?_since="&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;etag&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;""&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="nx"&gt;method&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"HEAD"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nx"&gt;headers&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;raw&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;
    &lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"RES"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;parseInt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"total-records"&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
    &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;db&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getLastModified&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;lastMod&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;api&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;api&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;bucket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;bucket&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="c1"&gt;// you'll soon be able to replace it with api.getLastModified(lastMod)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;fetchTotalRecords&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;api&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;bucket&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;lastMod&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;renderTicketCount&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This method also works to find out if updated tickets exist on the server
( &lt;a href="http://kinto.readthedocs.io/en/latest/api/1.x/filtering.html#polling-for-changes"&gt;via the ETag&lt;/a&gt;).
The kinto server doesn't respond instantly as it should. Maybe I should also put the ETag in an &lt;code&gt;If-None-Match&lt;/code&gt;
header to speed things up.&lt;/p&gt;
&lt;h2&gt;Searching for Tickets&lt;/h2&gt;
&lt;p&gt;I've used &lt;a href="http://lunrjs.com/"&gt;lunr&lt;/a&gt; to implement client-side full text search. It builds a Lucene-like index and
then lets one query this index. The index is serialized and saved as a document in a local Kinto.js collection
to be reused on next page load.&lt;/p&gt;
&lt;p&gt;Searching the index returns an array of document ids, from which I load documents before filtering the resulting
(usually small) array with remaining query params. This is performing better than the first version of the
application, when I first loaded all documents by calling &lt;code&gt;tickets.list()&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;To search for &lt;em&gt;hello&lt;/em&gt; in the lunr index:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nx"&gt;index&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;search&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"hello"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;"ref"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;"52a4d8cb27184667e3400f42"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;"score"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;0.019459983366287688&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;"ref"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;"5690ff3f24b0d96f08df7d6a"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;"score"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;0.013994677485991343&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="p"&gt;...&lt;/span&gt;
   &lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To get a &lt;code&gt;{ data: ['array', 'of', 'tickets', 'containing', 'myText'] }&lt;/code&gt;  Promise:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;Promise&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;search&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;myText&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;hit&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;hit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;ref&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;})).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;allRes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;allRes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="p"&gt;})&lt;/span&gt;
    &lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Matching documents are fetched from IndexedDB in parallel via their Id (&lt;code&gt;collection.get()&lt;/code&gt;).
It's fast because IndexedDB is optimised for key based access, but it could be more efficient to use
&lt;code&gt;tickets.list({filters: {id: ['array', 'of', 'ids']}})&lt;/code&gt; to curb request count.&lt;/p&gt;
&lt;h2&gt;Displaying a Ticket&lt;/h2&gt;
&lt;p&gt;My application is meant to be multi-tab, browser history and bookmarks compatible.
To achieve that, the UI state is stored in the URL and interactions result in calls to &lt;code&gt;pushState()&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;encodeState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s2"&gt;"#"&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;encodeURIComponent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;stringify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;applyState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"search"&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;value&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;search&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;saveState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;history&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;pushState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"jEdit Trackers"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;encodeState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;hashIsTicket&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;match&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sr"&gt;/^#[a-z0-9-]+$/&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;addEventListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"popstate"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// called on browser history navigation&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;state&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="nx"&gt;applyState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;hashIsTicket&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="c1"&gt;// show this ticket&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="c1"&gt;// show search interface&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;A ticket can be displayed from the result list by clicking &lt;em&gt;Open&lt;/em&gt;.
Nothing fancy: the id is put in the URL's hash and the application parses the hash at startup.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;restoreInitialState&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;match&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sr"&gt;/^#[a-z0-9-]+$/&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;showTicket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;substring&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;startsWith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"#%7B"&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;state&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;decodeURIComponent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;substring&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)));&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"invalid state in hash"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
            &lt;span class="nx"&gt;state&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;defaultState&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="nx"&gt;applyState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;state&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;defaultState&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
        &lt;span class="nx"&gt;applyState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nx"&gt;restoreInitialState&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt; &lt;span class="c1"&gt;// to restore state from bookmark or link at page load&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;Updates&lt;/h1&gt;
&lt;p&gt;Documents have to be updated in Kinto whenever a ticket is modified at Sourceforge's trackers.
I do this via a server-side program.&lt;/p&gt;
&lt;h2&gt;updater.py&lt;/h2&gt;
&lt;p&gt;There is no way to get a real-time modification stream from Sourceforge.&lt;/p&gt;
&lt;p&gt;A few ideas to work around that:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;poll each tracker's RSS feed (limited to 10 tickets so one can miss updates if the script lags at some point);&lt;/li&gt;
&lt;li&gt;poll each tracker's REST API, asking for tickets modified since last time (delay &amp;lt; polling period);&lt;/li&gt;
&lt;li&gt;subscribe to the jedit-devel mailing list and fetch mails with a pop3 client (delay &amp;lt; 1 minute).&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;I've chosen solution 2. The &lt;a href="https://github.com/elelay/jedit-trackers-kinto/blob/master/updater.py"&gt;updater.py&lt;/a&gt; script:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;fetches the trackers list from Sourceforge,&lt;/li&gt;
&lt;li&gt;fetches from kinto the last update date (a document in the &lt;code&gt;updater&lt;/code&gt; collection),&lt;/li&gt;
&lt;li&gt;queries Sourceforge for tickets modified since this date,&lt;/li&gt;
&lt;li&gt;pushes updates to the &lt;code&gt;tickets&lt;/code&gt; and &lt;code&gt;oldTickets&lt;/code&gt; collections.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Tickets are returned by Sourceforge in JSON format. There is only minimal mapping to do (fetch comments via a second
request to Sourceforge).&lt;/p&gt;
&lt;h2&gt;Client Notifications&lt;/h2&gt;
&lt;p&gt;Kinto seems to provide &lt;a href="http://kinto.readthedocs.io/en/latest/tutorials/notifications-websockets.html"&gt;websockets&lt;/a&gt;
notifications but I've not looked into it.&lt;/p&gt;
&lt;p&gt;Clients are instead polling the kinto server for new tickets every minute. When there are, a little &lt;em&gt;would you like to&lt;/em&gt;
&lt;em&gt;sync?&lt;/em&gt; notification appears on the top-right of the page.&lt;/p&gt;
&lt;p&gt;Following a synchronization, I update the lunr index with modified/added/deleted documents (&lt;code&gt;index.add(document)&lt;/code&gt;,
&lt;code&gt;index.remove(document)&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Counters displayed on buttons (missed, open bugs) are then recomputed and stored in a client collection.
When there are no deletions I can update them incrementally, otherwise I have to go through the whole collection
to recompute them.&lt;/p&gt;
&lt;h1&gt;Conclusion&lt;/h1&gt;
&lt;h2&gt;Was Kinto Worth a Try?&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Definitly yes&lt;/strong&gt;. It's a sound platform and a good fit for my application. However it's not an out-of-box experience
like &lt;a href="https://www.meteor.com/"&gt;meteor&lt;/a&gt;. One has to combine it with other libraries to create a full application.
On the other hand, it makes deployment and debugging simpler.&lt;/p&gt;
&lt;p&gt;Performance is fine (batch importing the 8k tickets keeps my little server busy for 5 minutes) and the system is open.&lt;/p&gt;
&lt;p&gt;I made things a bit complicated for myself by splitting tickets into 2 collections, but not loading the old tickets
is a huge performance boost.&lt;/p&gt;
&lt;h2&gt;To Do List (not the tutorial)&lt;/h2&gt;
&lt;p&gt;I've spent 3 weeks exploring Kinto and still have things to try out. I'm also far from a full-fledged application.&lt;/p&gt;
&lt;p&gt;Some leads:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Modifying Tickets&lt;/strong&gt;
I'd like to be able to modify tickets from the application, instead of having to use the Sourceforge UI.
Modifications could be possible offline, kept in kinto.js until network connectivity is restored.&lt;/p&gt;
&lt;p&gt;Nothing prevents it but it takes a lot of development to make a nice UI.
I'll first look into &lt;a href="https://github.com/Kinto/formbuilder"&gt;FormBuilder&lt;/a&gt; before rolling out my own.
If actual interaction with trackers is too much, maybe letting users tag, star, follow tickets for themselves could be
useful (stored in kinto to sync between their devices).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;User Interface&lt;/strong&gt;
The UI could be improved greatly. I also plan to refactor the code to take advantage of react, since there exists some
 &lt;a href="https://github.com/Kinto/kinto-react-boilerplate"&gt;boilerplate&lt;/a&gt; and &lt;a href="https://github.com/Kinto/kinto-admin"&gt;kinto-admin&lt;/a&gt;
for inspiration.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Attachments&lt;/strong&gt;
Tickets are available offline, but not attachments (attachments like the log with the stack trace I need to fix a bug).
So no 100% offline experience yet! I'd like to distribute these attachments, maybe using
 &lt;a href="http://www.servicedenuages.fr/kinto-file-attachment"&gt;Kinto Attachments&lt;/a&gt;. Attachments are a total of 10MB for fresh tickets,
 plus 18MB for old ones: it seems feasible.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Full Text Search&lt;/strong&gt;
I make very basic use of lunr.js: indexing the title and description fields. But the index is already quite big and slow
to (de)serialize from IndexedDB. I wonder if I should enrich it, allowing
&lt;a href="https://github.com/olivernn/lunr.js/issues/125"&gt;more powerful queries&lt;/a&gt; or define my own query language and use indexes
on my side.&lt;/p&gt;
&lt;p&gt;Indexing should take place in a WebWorker, to not stall the application.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Performances&lt;/strong&gt;
Tickets could be indexed by number, to speed up this kind of query (ids are unique in a project,
numbers are unique in a tracker). Also, indexing on other predefined search criteria could speed things up.&lt;/p&gt;
&lt;p&gt;Manually managing indexes would be feasible (a document per index, mapping each value of the field to an array of
document ids). Then, looking for all open bugs would look like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nx"&gt;indexes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"bug"&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;resInd&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;ind&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;resInd&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;// ind = { open: ["id1", "id2", ...], ...}&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;Promise&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;all&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nx"&gt;ind&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;open&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;get&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
                  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;multiRes&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
                      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;multiRes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;;})&lt;/span&gt;
                  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Thank You!&lt;/h2&gt;
&lt;p&gt;I'd like to thank the Kinto team for their kindness and their openness: reachable on IRC (#kinto) and Slack, they
encourage issues and PRs. Many of which are even accepted ;-)&lt;/p&gt;
&lt;p&gt;My code is available on github: &lt;a href="https://github.com/elelay/jedit-trackers-kinto"&gt;elelay/jedit-trackers-kinto&lt;/a&gt;.
The application is available at &lt;a href="http://trackers.elelay.fr/trackers.html"&gt;trackers.elelay.fr&lt;/a&gt;.
Feedback is welcome via IRC (elelay) — why not even Issues and PR?&lt;/p&gt;
&lt;!-- :wrap=hard:noTabs=true:tabSize=4:indentSize=4: --&gt;</content><category term="mozilla"></category></entry><entry><title>Survoler les bugs avec Kinto</title><link href="http://www.servicedenuages.fr/en/../jedit-bugs-getting-off-the-ground" rel="alternate"></link><published>2016-09-01T00:00:00+02:00</published><updated>2016-09-01T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2016-09-01:/en/../jedit-bugs-getting-off-the-ground</id><summary type="html">&lt;p&gt;Retour d'expérience sur l'utilisation de Kinto et Kinto.js pour parcourir les tickets de jEdit hors-ligne&lt;/p&gt;</summary><content type="html">&lt;p&gt;Voici un article rédigé par &lt;a href="https://github.com/elelay"&gt;Eric Le Lay&lt;/a&gt; sur son utilisation de Kinto.&lt;/p&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;Connaissez-vous &lt;a href="http://jedit.org"&gt;jEdit&lt;/a&gt; — &lt;em&gt;l'éditeur de texte des développeurs&lt;/em&gt; ?
C'est un éditeur de texte multi-plateforme, écrit en java, disposant de nombreux plugins.
Je participe à son développement depuis une dizaine d'années.
Nous l'hébergeons sur Sourceforge ; le code principal est sous &lt;em&gt;Subversion&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Nous sommes bénévoles et le maintenons sur notre temps libre.
Pour ma part, je n'ai pas toujours accès à internet pendant les vacances. Ou via un câble Ethernet dans une pièce sombre
et surchauffée. Tout ça pour dire que j'aime avoir un maximum de choses sous la main hors-ligne :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;sources et doc de la plateforme java : pas de problème avec les packages &lt;code&gt;openjdk7-doc&lt;/code&gt; et &lt;code&gt;openjdk7-src&lt;/code&gt; ;&lt;/li&gt;
&lt;li&gt;sources de jEdit et des plugins : avec git-svn j'ai le code et son historique ;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;bugs et feature requests : oups!&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Nous avons 1100 tickets ouverts et 7600 clos. Tout ça n'est pas disponible hors-ligne. Ça doit changer !&lt;/p&gt;
&lt;h3&gt;Comment obtenir une archive des tickets ?&lt;/h3&gt;
&lt;p&gt;Sourceforge permet aux admins de télécharger une archive du projet, dont les tickets.
Actuellement un script les convertit en un paquet de fichiers HTML avec un peu de javascript pour la navigation.
Le résultat (fichiers HTML pour un usage en-ligne et archive &lt;a href="http://jedit.org/trackers/Export.tgz"&gt;téléchargeable&lt;/a&gt;)
est déployé via rsync sur &lt;a href="http://jedit.org/trackers/"&gt;jedit.org/trackers&lt;/a&gt;.
Pour limiter le volume, seuls les tickets ouverts sont disponibles.&lt;/p&gt;
&lt;p&gt;La génération de l'archive du projet par Sourceforge prend plusieurs minutes, c'est pourquoi je la lance au plus une fois
par semaine.
Pour les utilisateurs, ce n'est pas très pratique, car il faut qu'ils téléchargent une nouvelle archive pour avoir une
vue à jour des tickets. Elle peut avoir une semaine de retard : peut mieux faire.&lt;/p&gt;
&lt;h3&gt;Objectifs&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;je voudrais permettre la mise à jour incrémentale des tickets ;&lt;/li&gt;
&lt;li&gt;je voudrais enrichir la visualisation des tickets : possibilité de recherche améliorée ;
   peut-être permettre la modification hors-ligne ;&lt;/li&gt;
&lt;li&gt;je voudrais essayer Kinto :-).&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Mes premiers pas avec Kinto&lt;/h2&gt;
&lt;p&gt;J'ai entendu parler de Kinto par Rémy et Alexis. Comme avec couchdb/pouchdb, il est possible de synchroniser
la base de données entre le serveur (Kinto) et le navigateur web (kinto.js). Kinto.js stocke les données dans IndexedDB
donc il est possible de manipuler une base relativement volumineuse.&lt;/p&gt;
&lt;p&gt;Chaque utilisateur peut créer ses propres collections (l'équivalent des tables SQL) Kinto. Il est même possible de gérer les
permissions document par document (l'équivalent des lignes SQL).&lt;/p&gt;
&lt;h3&gt;Le tutoriel : ToDo list&lt;/h3&gt;
&lt;p&gt;J'ai commencé par le
&lt;a href="http://kintojs.readthedocs.io/en/latest/tutorial/"&gt;tutoriel&lt;/a&gt;. Il présente bien les opérations: créer des documents, les
afficher, les modifier, synchroniser avec le serveur. Il s'appuie sur le serveur Kinto de test de mozilla : donc un
obstacle de moins pour démarrer.&lt;/p&gt;
&lt;h3&gt;Des tickets au lieu des tâches&lt;/h3&gt;
&lt;p&gt;Je suis passé à un serveur kinto local pour mes tests : il est déployable très facilement via docker.
Si vous envisagez d'importer des documents, utilisez tout de suite le backend PostgreSQL
(aussi facile à mettre en place, avec docker-compose ;
tout est &lt;a href="http://kinto.readthedocs.io/en/stable/tutorials/install.html#using-docker-compose"&gt;expliqué&lt;/a&gt;).
Le backend en RAM pose des &lt;a href="https://github.com/Kinto/kinto/issues/759"&gt;problèmes&lt;/a&gt; lors d'import batch en parallèle (ce
qui se produit si vous importez depuis un &lt;a href="https://github.com/elelay/jedit-trackers-kinto/blob/master/transform.js"&gt;script&lt;/a&gt;
node.js utilisant &lt;a href="https://www.npmjs.com/package/request"&gt;request&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;Une fois les tickets importés, l'application web n'a plus qu'à les récupérer via la synchronisation kinto.js et les
afficher.&lt;/p&gt;
&lt;h3&gt;Recherche locale avec kinto.js&lt;/h3&gt;
&lt;p&gt;La recherche locale avec kinto.js n'est pas aussi développée que la recherche
&lt;a href="http://kinto.readthedocs.io/en/stable/api/1.x/filtering.html"&gt;sur le serveur&lt;/a&gt; :
seule la conjonction de &lt;code&gt;clé: [valeur1, valeur2, ...]&lt;/code&gt; est supportée. La recherche sur les champs &lt;code&gt;id&lt;/code&gt;, &lt;code&gt;_status&lt;/code&gt; et &lt;code&gt;last_modified&lt;/code&gt;
est accélérée par un index (code &lt;a href="https://github.com/Kinto/kinto.js/blob/f48ea470ddb2c6398acc386439043e6cae8bffe4/src/adapters/IDB.js#L325"&gt;ici&lt;/a&gt;).
Ensuite, tous les documents sont chargés et retournés sous forme de tableau puis filtrés selon les critères restants.
Le filtrage selon des critères plus complexes se fait par l'application sur le résultat de &lt;code&gt;list()&lt;/code&gt;.
Dans les cas de petites collections c'est simple et de bon goût mais avec 8000 documents la recherche
devient un peu lente.&lt;/p&gt;
&lt;p&gt;Exemple de recherche &lt;em&gt;complexe&lt;/em&gt; par mot clé (champ de texte) :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;filterByKeyword&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;keyword&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;doc&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;summary&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;indexOf&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;keyword&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;search&lt;/span&gt;&lt;span class="p"&gt;(){&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;keyword&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"query"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;tickets&lt;/span&gt;
    &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;list&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
    &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;filterByKeyword&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;keyword&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
    &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;// on submit&lt;/span&gt;
&lt;span class="nx"&gt;search&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;render&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Architecture&lt;/h2&gt;
&lt;p&gt;J'héberge mon serveur kinto sur un serveur C1 chez scaleway. Il contient deux collections :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;tickets, pour les tickets ouverts ou récemment fermés ;&lt;/li&gt;
&lt;li&gt;oldTickets, pour les tickets fermés avant 2016.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;J'utilise l'id des tickets chez Sourceforge &lt;a href="http://kintojs.readthedocs.io/en/latest/api/#custom-id-generation-using-an-id-schema"&gt;plutôt qu'une id auto-générée&lt;/a&gt;.
Je peux ainsi mettre à jour la base facilement à partir des infos de Sourceforge (pas besoin de rechercher le document
chez kinto avant de le mettre à jour puisque je connais l'id).&lt;/p&gt;
&lt;p&gt;Les clients sont des applications web.&lt;/p&gt;
&lt;p&gt;Un script de mise à jour reporte les modifications de Sourceforge dans la base.&lt;/p&gt;
&lt;p&gt;La machine étant un serveur ARM sous debian Jessie, quelques aménagements ont été nécessaires (détails sur le
&lt;a href="https://github.com/Kinto/kinto/wiki"&gt;wiki kinto&lt;/a&gt;).&lt;/p&gt;
&lt;h2&gt;Client kinto.js&lt;/h2&gt;
&lt;p&gt;Mon objectif était d'abord d'en apprendre le maximum sur kinto.js. J'ai bien aimé le coté vanilla du tutoriel (pas de
dépendance à n frameworks) et suis resté sur cette simplicité :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;le CSS de bootstrap, les icônes de fontawesome&lt;/li&gt;
&lt;li&gt;quelques utilitaires : moment, lodash,&lt;/li&gt;
&lt;li&gt;datatables (après avoir fait ma propre gestion de table, mais voulant déplier certaines lignes de la table et ayant trouvé
   un &lt;a href="https://datatables.net/examples/server_side/row_details.html"&gt;exemple tout prêt&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="Capture d'écran de l'application" src="http://www.servicedenuages.fr/en/../images/jedit-trackers-with-kinto-app.png" style="width: 990px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;h2&gt;État initial&lt;/h2&gt;
&lt;p&gt;Lorsque vous accédez pour la première fois à l'&lt;a href="https://trackers.elelay.fr/trackers.html"&gt;application&lt;/a&gt;, un panneau vous
est présenté proposant de récupérer les tickets, dont éventuellement les vieux tickets.&lt;/p&gt;
&lt;p&gt;Petite astuce pour déterminer si c'est la première fois :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;db&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getLastModified&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;hasDB&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;noDB&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Pour afficher le nombre de tickets sur le serveur avant de les récupérer, il faut descendre dans le package
&lt;a href="https://github.com/Kinto/kinto-http.js"&gt;kinto-http&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Le code correspondant (bientôt simplifié) :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;fetchTotalRecords&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;api&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;bucket&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;etag&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;headers&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{};&lt;/span&gt;
    &lt;span class="nx"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;"Authorization"&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;"Basic "&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;btoa&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"token:tr0ub4d@ur"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;api&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;client&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;execute&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
        &lt;span class="nx"&gt;path&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"/buckets/"&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;bucket&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;"/collections/"&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s2"&gt;"/records"&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;etag&lt;/span&gt; &lt;span class="o"&gt;?&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"?_since="&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;etag&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;""&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="nx"&gt;method&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"HEAD"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nx"&gt;headers&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;raw&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;
    &lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"RES"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;parseInt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;headers&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"total-records"&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
    &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;db&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getLastModified&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;lastMod&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;api&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;api&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;bucket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;bucket&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;fetchTotalRecords&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;api&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;bucket&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;lastMod&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;renderTicketCount&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Cette méthode fonctionne aussi pour déterminer s'il y a eu du nouveau sur le serveur (&lt;a href="http://kinto.readthedocs.io/en/latest/api/1.x/filtering.html#polling-for-changes"&gt;via l'ETag&lt;/a&gt;). Le serveur kinto ne
répond pas instantanément. Il faudrait peut-être passer l'etag en &lt;code&gt;If-None-Match&lt;/code&gt; en plus de &lt;code&gt;since&lt;/code&gt; pour accélérer les choses.&lt;/p&gt;
&lt;h2&gt;Recherche&lt;/h2&gt;
&lt;p&gt;Pour la recherche en texte libre coté client, j'ai utilisé &lt;a href="http://lunrjs.com/"&gt;lunr&lt;/a&gt;. Il construit un index
à la Lucene, et permet ensuite de rechercher dans cet index. L'index est sérialisé et enregistré comme un document
d'une collection kinto.js cliente pour être réutilisé à la prochaine visite.&lt;/p&gt;
&lt;p&gt;La recherche dans l'index retourne un tableau d'id de documents depuis lequel j'extrais les documents, avant de filtrer
ce petit tableau avec les autres critères. Cela a accéléré les choses par rapport à la première version de l'application,
dans laquelle je commençais toujours la recherche par un &lt;code&gt;tickets.list()&lt;/code&gt;, qui retournait tous les documents.&lt;/p&gt;
&lt;p&gt;Pour rechercher &lt;em&gt;hello&lt;/em&gt; dans l'index en mémoire :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="nx"&gt;index&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;search&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"hello"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="p"&gt;[{&lt;/span&gt;&lt;span class="s2"&gt;"ref"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;"52a4d8cb27184667e3400f42"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;"score"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;0.019459983366287688&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;"ref"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="s2"&gt;"5690ff3f24b0d96f08df7d6a"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="s2"&gt;"score"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mf"&gt;0.013994677485991343&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="p"&gt;...&lt;/span&gt;
   &lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Pour obtenir une promesse d'un objet &lt;code&gt;{ data: ['tableau', 'de', 'tickets', 'contenant', 'texteLibre'] }&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;Promise&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;index&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;search&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;texteLibre&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;hit&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;hit&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;ref&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;})).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;allRes&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;allRes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="p"&gt;})&lt;/span&gt;
    &lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Dans ce code, tous les documents sont récupérés d'IndexedDB en parallèle via leur Id (&lt;code&gt;collection.get()&lt;/code&gt;).
C'est rapide car IndexedDB est optimisé pour l'accès par clé, mais il serait peut⁻être plus efficace d'utiliser
&lt;code&gt;tickets.list({filters: {id: ['tableau', 'des', 'ids']}})&lt;/code&gt; pour limiter le nombre de requêtes.&lt;/p&gt;
&lt;h2&gt;Affichage d'un ticket&lt;/h2&gt;
&lt;p&gt;L'application est conçue pour être multi-onglet, permettre la navigation dans l'historique et la création de marques pages.
Pour cela, l'état est stocké dans l'url et les recherches entraînent des appels à &lt;code&gt;pushState()&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;encodeState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="s2"&gt;"#"&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nb"&gt;encodeURIComponent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;stringify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;applyState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nb"&gt;document&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getElementById&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"search"&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;value&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="nx"&gt;search&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;saveState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;history&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;pushState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;"jEdit Trackers"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;encodeState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;hashIsTicket&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;match&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sr"&gt;/^#[a-z0-9-]+$/&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;addEventListener&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"popstate"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// called on browser history navigation&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;state&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="nx"&gt;applyState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;hashIsTicket&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="c1"&gt;// show this ticket&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="c1"&gt;// show search interface&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;On peut afficher un ticket dans un autre onglet en cliquant sur &lt;em&gt;Ouvrir&lt;/em&gt; dans un résultat de recherche.
Rien de bien compliqué : l'id est mise dans le hash de l'url et l'application interprète ce hash au chargement.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt; &lt;span class="nx"&gt;restoreInitialState&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;match&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sr"&gt;/^#[a-z0-9-]+$/&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;showTicket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;substring&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;startsWith&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"#%7B"&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="k"&gt;try&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;state&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;decodeURIComponent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;substring&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)));&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;catch&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;e&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"invalid state in hash"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;location&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
            &lt;span class="nx"&gt;state&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;defaultState&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="nx"&gt;applyState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;state&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;defaultState&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
        &lt;span class="nx"&gt;applyState&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;state&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nx"&gt;restoreInitialState&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt; &lt;span class="c1"&gt;// to restore state from bookmark or link at page load&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;Mises à jour&lt;/h1&gt;
&lt;p&gt;Lorsqu'un ticket est modifié coté Sourceforge il faut mettre à jour le document correspondant dans Kinto.
Je le fais via un programme coté serveur.&lt;/p&gt;
&lt;h2&gt;updater.py&lt;/h2&gt;
&lt;p&gt;Il n'est pas possible d'obtenir les modifications de tickets Sourceforge en temps réel via les technologies web.&lt;/p&gt;
&lt;p&gt;Quelques idées pour les obtenir :&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;interroger périodiquement le flux RSS de chaque tracker (limité à 10 tickets donc on peut rater des mises à
 jour si le script ne s'exécute pas pendant un moment) ;&lt;/li&gt;
&lt;li&gt;interroger périodiquement l'API REST de chaque tracker, en demandant les tickets modifiés depuis la dernière
 fois (délai &amp;lt; période de polling) ;&lt;/li&gt;
&lt;li&gt;s'abonner à la mailing list jedit-devel et les récupérer avec un client pop3 (délai &amp;lt; 1 minute).&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;J'ai choisi la solution 2. Le script
&lt;a href="https://github.com/elelay/jedit-trackers-kinto/blob/master/updater.py"&gt;updater.py&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;récupère la liste des trackers chez Sourceforge,&lt;/li&gt;
&lt;li&gt;récupère de kinto la date de dernière mise à jour (document dans une collection &lt;code&gt;updater&lt;/code&gt;),&lt;/li&gt;
&lt;li&gt;interroge Sourceforge sur les tickets modifiés depuis cette date,&lt;/li&gt;
&lt;li&gt;pousse les mises à jour dans les collections &lt;code&gt;tickets&lt;/code&gt; et &lt;code&gt;oldTickets&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Les tickets sont déjà en JSON, avec un minimum de mapping à faire (récupérer les commentaires via une seconde requête
à Sourceforge).&lt;/p&gt;
&lt;h2&gt;Notifications client&lt;/h2&gt;
&lt;p&gt;Kinto semble disposer d'un mécanisme de notification via
&lt;a href="http://kinto.readthedocs.io/en/latest/tutorials/notifications-websockets.html"&gt;websockets&lt;/a&gt; mais je ne l'ai pas exploré.&lt;/p&gt;
&lt;p&gt;Les clients interrogent le serveur kinto pour les nouveaux tickets toutes les minutes. Lorsqu'il y en a, une
notification proposant de synchroniser la base s'affiche en haut à droite de l'application.&lt;/p&gt;
&lt;p&gt;Suite à la synchronisation, je mets à jour l'index lunr avec les documents modifiés/ajoutés/supprimés (&lt;code&gt;index.add(document)&lt;/code&gt;, &lt;code&gt;index.remove(document)&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Les compteurs de tickets affichés sur les boutons (ratés, bugs ouverts) sont aussi recalculés à cette occasion
et stockés dans une collection client. S'il n'y a pas de suppressions, je peux les mettre à jour incrémentalement,
sinon, il faut re-parcourir la collection pour les calculer.&lt;/p&gt;
&lt;h1&gt;Conclusion&lt;/h1&gt;
&lt;h2&gt;Ai-je bien fait d'essayer Kinto ?&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Oui, certainement&lt;/strong&gt;. C'est une bonne plateforme pour mon application. Ce n'est cependant pas une solution clé en main
comme &lt;a href="https://www.meteor.com/"&gt;meteor&lt;/a&gt;. Il faut donc l'associer à d'autres librairies pour avoir une application complète.
D'un autre coté, le déploiement est simple et le déroulement du programme est facile à suivre.&lt;/p&gt;
&lt;p&gt;Les performances sont correctes (l'import batch des 8000 tickets fait tourner mon petit serveur pendant 5 minutes)
et le système est ouvert.&lt;/p&gt;
&lt;p&gt;Je me suis un peu compliqué la vie en séparant les tickets en deux collections, mais ne charger que les tickets récents
allège vraiment l'application.&lt;/p&gt;
&lt;h2&gt;Amélioration prévues&lt;/h2&gt;
&lt;p&gt;J'ai passé 3 semaines à explorer Kinto et il reste encore des choses à tester. Je suis également loin d'une application terminée.&lt;/p&gt;
&lt;p&gt;Quelques pistes :&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Modifications des tickets&lt;/strong&gt;
Je voudrais qu'on puisse modifier les tickets depuis l'application, plutôt que de renvoyer vers Sourceforge.
Les modifications pourraient être temporairement stockées dans kinto.js en attente de réseau.&lt;/p&gt;
&lt;p&gt;La voie est libre depuis la correction d'un &lt;a href="https://sourceforge.net/p/forge/site-support/13403/"&gt;petit bug&lt;/a&gt;
qui empêchait d'interroger l'API Sourceforge en CORS depuis la France, mais ça représente pas mal de code pour
l'interface utilisateur. J'explorerai &lt;a href="https://github.com/Kinto/formbuilder"&gt;FormBuilder&lt;/a&gt; avant de coder ma
propre solution. Sans aller jusque là, il pourrait être intéressant de permettre aux utilisateurs de tagger, mettre en
favoris, suivre, certains tickets (stockage dans kinto).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Interface Utilisateur&lt;/strong&gt;
L'interface est largement améliorable. J'envisage également de restructurer le code en m'appuyant sur react, vu qu'il existe
du &lt;a href="https://github.com/Kinto/kinto-react-boilerplate"&gt;boilerplate&lt;/a&gt; et &lt;a href="https://github.com/Kinto/kinto-admin"&gt;kinto-admin&lt;/a&gt;
comme source d'inspiration.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Pièces jointes&lt;/strong&gt;
Tous les tickets sont accessibles hors-ligne, mais pas les pièces-jointes (comme le log contenant la
trace d'exécution permettant de comprendre le bug). Nous ne sommes donc pas encore à du 100% hors-ligne. J'aimerai
distribuer ces pièces-jointes, peut-être avec le mécanisme
d'&lt;a href="http://www.servicedenuages.fr/kinto-file-attachment"&gt;Attachments&lt;/a&gt; de kinto. Les pièces-jointes des tickets récents font 10Mo,
celles des anciens tickets 18Mo : ça semble donc faisable.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Recherche texte libre&lt;/strong&gt;
Je n'utilise lunr.js que de manière très basique : indexation du titre et de la description. Mais l'index est
déjà très gros et lent à (dé)sérialiser depuis IndexedDB. J'hésite entre l'enrichir, permettant une recherche sur &lt;a href="https://github.com/olivernn/lunr.js/issues/125"&gt;tous
les champs&lt;/a&gt; ou définir mon langage de requête et jouer sur des index que
je maintiendrai moi-même.&lt;/p&gt;
&lt;p&gt;L'indexation pourrait se faire dans un WebWorker, pour ne pas bloquer l'application.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Performances&lt;/strong&gt;
Les tickets pourraient être indexés par numéro (ils ne sont pas uniques au sein d'un projet, mais au sein d'un tracker) pour accélérer
ce type de recherche. De même, indexer par les autres critères de recherche prédéfinis accélèrerait les choses.&lt;/p&gt;
&lt;p&gt;Je peux gérer des index manuels (un document par index, contenant un objet associant chaque valeur possible de la clé
à un tableau d'id). Alors, rechercher tous les bugs ouverts reviendrait à&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nx"&gt;indexes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"bug"&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;resInd&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
    &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;ind&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;resInd&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="c1"&gt;// ind = { open : ["id1", "id2", ...], ...}&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;Promise&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;all&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="nx"&gt;ind&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;open&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;get&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;bind&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;tickets&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
                  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;multiRes&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt;
                      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;multiRes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;){&lt;/span&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="p"&gt;;})&lt;/span&gt;
                  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Merci !&lt;/h2&gt;
&lt;p&gt;Je tiens à remercier l'équipe travaillant autour de Kinto pour leur gentillesse
et leur ouverture : accessibles sur IRC (#kinto) et Slack, ils encouragent la création de tickets, de PR.
De nombreuses sont même acceptées ;-)&lt;/p&gt;
&lt;p&gt;Le code est disponible sur github: &lt;a href="https://github.com/elelay/jedit-trackers-kinto"&gt;elelay/jedit-trackers-kinto&lt;/a&gt;.
Il tourne sur &lt;a href="http://trackers.elelay.fr/trackers.html"&gt;trackers.elelay.fr&lt;/a&gt;.
Vos retours sont les bienvenus via IRC (elelay) — Issues et PR, sait-on jamais...&lt;/p&gt;
&lt;!-- :wrap=hard:noTabs=true:tabSize=4:indentSize=4: --&gt;</content></entry><entry><title>Kinto-admin reaches 1.0</title><link href="http://www.servicedenuages.fr/en/kinto-admin-1.0" rel="alternate"></link><published>2016-06-10T00:00:00+02:00</published><updated>2016-06-10T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2016-06-10:/en/kinto-admin-1.0</id><summary type="html">&lt;p&gt;Introducing kinto-admin, a Web UI for managing your Kinto data&lt;/p&gt;</summary><content type="html">&lt;p&gt;When choosing a database, it's a good idea to study a few important criteria: how nice is the API? Is it well documented? Will it scale? What is the tooling available? Tooling is especially important as it's what will make your life as a developer easier. We've been working on one specific tool, called &lt;a href="https://github.com/Kinto/kinto-admin/"&gt;kinto-admin&lt;/a&gt;, which wants to be to Kinto what &lt;a href="https://www.phpmyadmin.net/"&gt;phpMyAdmin&lt;/a&gt; is to MySQL. Today we're announcing the release of &lt;a href="https://github.com/Kinto/kinto-admin/releases/tag/v1.0.0"&gt;version 1.0&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img alt="kinto-admin-logged-in" src="http://www.servicedenuages.fr/en/../images/kinto-admin-logged-in.png" style="width: 1219px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;In past releases you had to write and deploy a configuration file explicitly describing the resources to expose in the admin. Kinto-admin 1.0 now allows users to discover and browse the buckets, collections and records they have access to on a given Kinto server. They can also create, update and delete them, provided they have the required permissions. No need for configuration files anymore!&lt;/p&gt;
&lt;p&gt;Collection settings are configurable from the admin, including defining their &lt;a href="http://json-schema.org/"&gt;JSON schema&lt;/a&gt; and display options such as fields to render in the records list and the widgets to use to render form fields. These settings are stored in the collection metadata on the server.&lt;/p&gt;
&lt;p&gt;&lt;img alt="kinto-admin-collection-edit" src="http://www.servicedenuages.fr/en/../images/kinto-admin-collection-edit.png" style="width: 1219px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="kinto-admin-delete-collection" src="http://www.servicedenuages.fr/en/../images/kinto-admin-delete-collection.png" style="width: 904px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;For authentication, kinto-admin currently supports &lt;a href="http://kinto.readthedocs.io/en/stable/api/1.x/authentication.html?highlight=basic%20auth#basic-auth"&gt;Basic Auth&lt;/a&gt;, and &lt;a href="https://accounts.firefox.com/"&gt;Firefox Account&lt;/a&gt; if &lt;a href="https://github.com/mozilla-services/kinto-fxa"&gt;kinto-fxa&lt;/a&gt; is installed on the server, though we're planning to add more providers in the future.&lt;/p&gt;
&lt;p&gt;We've also added native support for &lt;a href="https://github.com/Kinto/kinto-attachment"&gt;kinto-attachments&lt;/a&gt;, which means you can attach files to records and post them to the server when the capability is available.&lt;/p&gt;
&lt;p&gt;&lt;img alt="kinto-admin-edit-attachment" src="http://www.servicedenuages.fr/en/../images/kinto-admin-edit-attachment.png" style="width: 1219px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;We really hope you'll enjoy this new version as much as we loved building it. You can use &lt;a href="https://kinto.github.io/kinto-admin/"&gt;our hosted instance&lt;/a&gt; on Github, or – as kinto-admin is a pure html/css/js static Web application – host it on your own static Web server.&lt;/p&gt;
&lt;p&gt;Of course there are and will be bugs, and you're invited to file new ones on the &lt;a href="https://github.com/Kinto/kinto-admin/issues"&gt;issue tracker&lt;/a&gt;. By the way, did I mention 1.0.1 is out already?&lt;/p&gt;
&lt;h2&gt;What's next?&lt;/h2&gt;
&lt;p&gt;We're planning to add the following major improvements in the near future:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Allow building collection JSON schemas using HTML widgets instead of entering raw JSON manually (we're fully aware this is &lt;em&gt;not&lt;/em&gt; user friendly at all);&lt;/li&gt;
&lt;li&gt;Allow managing permissions for buckets, collections and records;&lt;/li&gt;
&lt;li&gt;Allow extending the admin by exposing a plugin API and a custom build system so you can tweak the way it renders and behaves;&lt;/li&gt;
&lt;li&gt;When we get plugins, we have many ideas for them and a first exciting one is to provide metrics and charts. But hey, we're not there yet :)&lt;/li&gt;
&lt;/ul&gt;</content><category term="mozilla"></category></entry><entry><title>What can Kinto do for me?</title><link href="http://www.servicedenuages.fr/en/what-can-kinto-do-for-you" rel="alternate"></link><published>2016-06-10T00:00:00+02:00</published><updated>2016-06-10T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2016-06-10:/en/what-can-kinto-do-for-you</id><summary type="html">&lt;p class="first last"&gt;Kinto, the project we are working on, can do a bunch of different
things, but it's sometimes hard to see what it is really good at,
and where it would make sense to use other solutions.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Kinto — the project we are working on since quite some time now — can do a bunch
of different things for you and be useful in many different situations.&lt;/p&gt;
&lt;p&gt;However, we found out that it is really hard to understand at a glance what it
can do, and where it could help you build your projects in a better way.&lt;/p&gt;
&lt;p&gt;Here is an attempt to fix this.&lt;/p&gt;
&lt;div class="section" id="kinto-is-not-a-framework"&gt;
&lt;h2&gt;Kinto is not a framework&lt;/h2&gt;
&lt;p&gt;First and foremost, Kinto is not a framework. It doesn't try to provide a way
to structure your projects for you. It is meant to replace the
storage layer of your application, or more accurately, the synchronisation
abilities of your applications.&lt;/p&gt;
&lt;p&gt;Said differentely, you store your data locally for your application and &lt;strong&gt;Kinto
will make this data available to different devices (or users)&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;That means that you can use Kinto with React, Angular, JQuery (in the
JavaScript world) or any framework (or no framework at all) in any language.
&lt;strong&gt;Kinto abstracts away the synchronisation of the application's data&lt;/strong&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="hmm-and-what-about-my-use-case"&gt;
&lt;h2&gt;Hmm, and what about my use-case?&lt;/h2&gt;
&lt;p&gt;The idea here is mainly to show you what is already possible with very little
efforts using the tooling we have put together. You can leverage the
&lt;a class="reference external" href="https://kintojs.readthedocs.io"&gt;Kinto.js&lt;/a&gt; client, as it allows you to work
with Kinto really easily, but ultimately you don't need it. It's just here to
make it really easy for you to integrate with the HTTP APIs exposed by Kinto.&lt;/p&gt;
&lt;div class="section" id="synchronise-your-data"&gt;
&lt;h3&gt;Synchronise your data&lt;/h3&gt;
&lt;p&gt;If there is one thing to take way with you, that would be this: if you need to
&lt;strong&gt;synchronise&lt;/strong&gt; your data between different devices, there are chances that
Kinto is a good fit.&lt;/p&gt;
&lt;p&gt;That's useful if you want to synchronise data between devices, and also between
users. You have the data on one location, and you want it in a different one.&lt;/p&gt;
&lt;p&gt;With &lt;a class="reference external" href="https://kintojs.readthedocs.io"&gt;Kinto.js&lt;/a&gt;, this is as simple as calling &lt;cite&gt;.sync()&lt;/cite&gt; on the Kinto instance.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;tasks&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Kinto&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
    &lt;span class="nx"&gt;remote&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"https://kinto.dev.mozaws.net/v1"&lt;/span&gt;
&lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"tasks"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="nx"&gt;tasks&lt;/span&gt;
  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;create&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="nx"&gt;label&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"A first task"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;done&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;_&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nx"&gt;tasks&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;sync&lt;/span&gt;&lt;span class="p"&gt;());&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="storage"&gt;
&lt;h3&gt;Storage&lt;/h3&gt;
&lt;p&gt;Okay, I lied. You are not only syncing your data between different locations,
you're actually storing it somewhere, on a location of your choice.&lt;/p&gt;
&lt;p&gt;You can access this data later on when you need it. The cool thing here is that
you can access this data using the HTTP API (that speaks JSON).&lt;/p&gt;
&lt;p&gt;We tried very hard to make the protocol as easy as possible, and are pretty
happy with our current design, but if you have ideas on how to make it evolve,
&lt;a class="reference external" href="https://kiwiirc.com/client/irc.freenode.net/?#kinto"&gt;we would be really happy to hear them&lt;/a&gt;!&lt;/p&gt;
&lt;p&gt;Here's an example of how to retrieve your data using the &lt;a class="reference external" href="https://github.com/jkbrzt/httpie"&gt;HTTPie&lt;/a&gt; client.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ http get https://kinto.dev.mozaws.net/v1/buckets/default/collections/kinto_demo_calendar/records --auth&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"null:notsecret"&lt;/span&gt;

&lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;"data"&lt;/span&gt;: &lt;span class="o"&gt;[&lt;/span&gt;
        &lt;span class="o"&gt;{&lt;/span&gt;
            &lt;span class="s2"&gt;"end"&lt;/span&gt;: &lt;span class="s2"&gt;"2016-01-07T09:30:00"&lt;/span&gt;,
            &lt;span class="s2"&gt;"id"&lt;/span&gt;: &lt;span class="s2"&gt;"1f5d1390-2647-442d-8bc4-5ecc6a4f8beb"&lt;/span&gt;,
            &lt;span class="s2"&gt;"last_modified"&lt;/span&gt;: &lt;span class="m"&gt;1451997254315&lt;/span&gt;,
            &lt;span class="s2"&gt;"start"&lt;/span&gt;: &lt;span class="s2"&gt;"2016-01-07T09:00:00"&lt;/span&gt;,
            &lt;span class="s2"&gt;"title"&lt;/span&gt;: &lt;span class="s2"&gt;"Visite maison"&lt;/span&gt;
        &lt;span class="o"&gt;}&lt;/span&gt;,
        &lt;span class="o"&gt;{&lt;/span&gt;
            &lt;span class="s2"&gt;"end"&lt;/span&gt;: &lt;span class="s2"&gt;"2016-01-06"&lt;/span&gt;,
            &lt;span class="s2"&gt;"id"&lt;/span&gt;: &lt;span class="s2"&gt;"0dadb484-259b-482d-8cb8-0e94d743d1c6"&lt;/span&gt;,
            &lt;span class="s2"&gt;"last_modified"&lt;/span&gt;: &lt;span class="m"&gt;1451997234471&lt;/span&gt;,
            &lt;span class="s2"&gt;"start"&lt;/span&gt;: &lt;span class="s2"&gt;"2016-01-05"&lt;/span&gt;,
            &lt;span class="s2"&gt;"title"&lt;/span&gt;: &lt;span class="s2"&gt;"RDV Osthéo"&lt;/span&gt;
        &lt;span class="o"&gt;}&lt;/span&gt;
    &lt;span class="o"&gt;]&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="permissions"&gt;
&lt;h3&gt;Permissions&lt;/h3&gt;
&lt;p&gt;Sometimes you want your data to remain yours, and some other times you want to
share it with friends. It really depends what the data is.&lt;/p&gt;
&lt;p&gt;One of the reasons we built Kinto was to control who has access to what on a
per record level. Without getting too much in the details, the data stored in
Kinto is organised into three concepts: Buckets contains collections wich in
turn contain records.&lt;/p&gt;
&lt;p&gt;It's then possible to apply permissions to each container, and all children
will be impacted.&lt;/p&gt;
&lt;img alt="Concepts around permissions" class="align-center" src="http://www.servicedenuages.fr/en/../images/concepts-permissions.png" style="width: 600px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;You can &lt;a class="reference external" href="http://kinto.readthedocs.org/en/latest/concepts.html"&gt;read more on our documentation&lt;/a&gt; about this if you want.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="real-time-notifications"&gt;
&lt;h3&gt;Real-time notifications&lt;/h3&gt;
&lt;p&gt;What happens when the data evolves? Let's say you are on one device doing
geo-mapping and someone else is doing the same thing on their own device. You
want to have these two devices in sync, and as such they need to know when new
data is issued by any other device.&lt;/p&gt;
&lt;p&gt;That's when real-time notifications are useful. Kinto itself doesn't decide for
you which notification system you should use, but it can integrate easily with
any notification system.&lt;/p&gt;
&lt;p&gt;We tried to ease your life by providing some solutions to &lt;a class="reference external" href="https://github.com/Kinto/kinto-pusher"&gt;integrate
with pusher&lt;/a&gt; and &lt;a class="reference external" href="https://github.com/Kinto/kinto-webpush"&gt;with WebPush&lt;/a&gt;, but you're free to use your own
notification system.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="some-examples"&gt;
&lt;h2&gt;Some examples&lt;/h2&gt;
&lt;p&gt;Let's take some examples. A few weeks ago we prepared a bunch of demos
showcasing what can Kinto do and how easy it is. In order to do that, we
decided to take a few applications we liked that are usually not doing
synchronisation and sharing. There are many out there, and we chose just a few of
them:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;A tool to build forms&lt;/strong&gt;, which makes a great alternative to Google Forms.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;A JQuery calendar application&lt;/strong&gt; which let you add new events and see them
on a calendar.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;A leaflet map&lt;/strong&gt; where you can add new markers and move them easily.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;A TODO-list application&lt;/strong&gt;, because we actually really like TODO lists.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;And then we decided to make them collaborative apps, using Kinto. The goal here
was to spend the least time possible plugging in Kinto, in order to see what was
the real potential of it.&lt;/p&gt;
&lt;p&gt;We ended up with a few cool demos. Not all of them are using the same features
of Kinto (for instance some take advantage of the push notifications while some
others don't), but overall that was pretty exciting.&lt;/p&gt;
&lt;p&gt;Here are some links if you want to try out the demos yourself:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://www.fourmilieres.net"&gt;The formbuilder&lt;/a&gt; with direct HTTP calls to
the Kinto APIs.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://leplatrem.github.io/kinto-demo-leaflet/"&gt;Kinto.js + Leaflet&lt;/a&gt;
with offline-first maps which requires service workers activated
(only works in Firefox Nightly these days).&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://leplatrem.github.io/cliquet-pusher/"&gt;Kinto.js + Leaflet + Pusher&lt;/a&gt;
with realtime multi device map markers synchronisation using Pusher.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://leplatrem.github.io/kinto-demo-calendar/"&gt;Kinto.js + fullCalendar&lt;/a&gt;
with realtime multi device synchronisation using Pusher and Firefox Account integration.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://leplatrem.github.io/kinto-telegram-wall/"&gt;Kinto.js + Telegram Bot + Pusher&lt;/a&gt;
a realtime wall that receive messages from a Telegram bot and automatically updates the
slideshow in realtime and add the new content as soon as it arrives.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="id1"&gt;
&lt;h2&gt;Hmm, and what about my use-case?&lt;/h2&gt;
&lt;p&gt;The idea here is mainly to show you what is already possible with very little
efforts using the tooling we have put together. These examples are all relying
on the &lt;a class="reference external" href="https://kintojs.readthedocs.io"&gt;Kinto.js&lt;/a&gt; client but ultimately you don't
need it. It's just here to make it really easy for you to integrate with the
HTTP APIs exposed by Kinto.&lt;/p&gt;
&lt;p&gt;So, what can Kinto do for you?&lt;/p&gt;
&lt;div class="section" id="synchronise"&gt;
&lt;h3&gt;Synchronise&lt;/h3&gt;
&lt;p&gt;If there was one only thing to choose, that would be this one. Kinto can
&lt;strong&gt;synchronise&lt;/strong&gt; your data between different devices. You have the data on one
location, and you want it in a different one.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id2"&gt;
&lt;h3&gt;Storage&lt;/h3&gt;
&lt;p&gt;As a bonus, you get this data stored somewhere so you can access it later on.&lt;/p&gt;
&lt;p&gt;The cool thing with this is that you can access this data using an HTTP (REST)
API, that speaks JSON. We tried very hard to make the protocol as easy as
possible, and to be honest we're pretty happy with our current design.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id3"&gt;
&lt;h3&gt;Permissions&lt;/h3&gt;
&lt;p&gt;Sometimes, you want your data to remain yours, and some other times you want to
share it with friends. It really depends what the data is. One of the reasons we
built Kinto was to control who has access to what on a per record level.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id4"&gt;
&lt;h3&gt;Real-time Notifications&lt;/h3&gt;
&lt;p&gt;So, what happens when the data evolves? Let's say you are on one device doing
geo-mapping and someone else is doing the same thing on their own device. You
want to have these two devices in Sync, and as such they need to know when new
data was issued by any other device.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="going-further"&gt;
&lt;h2&gt;Going further&lt;/h2&gt;
&lt;p&gt;Our vision with Kinto is really to propose a simple tool for simple needs, and
to do these simple things the best way we can.&lt;/p&gt;
&lt;p&gt;If you are interested by what Kinto has to propose, don't hesitate to
&lt;a class="reference external" href="https://kinto.readthedocs.io"&gt;have a look at the documentation&lt;/a&gt;,
try &lt;a class="reference external" href="http://kintojs.readthedocs.io/en/latest/tutorial/"&gt;the Kinto.js tutorial&lt;/a&gt;
and &lt;a class="reference external" href="https://kiwiirc.com/client/irc.freenode.net/?#kinto"&gt;get in touch&lt;/a&gt;
with us, we would be very happy to discuss what your needs are and how to make
it as easy as possible for you.&lt;/p&gt;
&lt;p&gt;Don't be shy, we are really here to help, and we want to know about your
use-cases!&lt;/p&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>How to use Kinto to A/B test a web application?</title><link href="http://www.servicedenuages.fr/en/ab-testing-with-kinto" rel="alternate"></link><published>2016-06-09T00:00:00+02:00</published><updated>2016-06-09T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2016-06-09:/en/ab-testing-with-kinto</id><summary type="html">&lt;p class="first last"&gt;A/B testing is a form of statistical hypothesis testing. Its
goal is to identify changes to web pages that increase or
maximize an outcome of interest. Let's see how we can use
Kinto to use this technique on our website.&lt;/p&gt;
</summary><content type="html">&lt;div class="section" id="background"&gt;
&lt;h2&gt;Background&lt;/h2&gt;
&lt;p&gt;The Fennec team, building Firefox for Android, is using
&lt;a class="reference external" href="https://github.com/KeepSafe/Switchboard"&gt;Switchboard from KeepSafe&lt;/a&gt;, which is an open source project that
targets Mobile app feature switching and A/B testing.&lt;/p&gt;
&lt;p&gt;For the Fennec team, the update of experiments data is a bit
cumbersome, the data is stored on a github repository and the
switchboard server needs to be updated and reloaded with newer data on
every change.&lt;/p&gt;
&lt;p&gt;They eventually saw the &lt;a class="reference external" href="https://github.com/Kinto/kinto-admin"&gt;kinto-admin&lt;/a&gt; for another project and,
because the swichboard logic can be done on client-side, they decided
to try to switch &lt;a class="reference external" href="https://github.com/mozilla-services/switchboard-experiments/"&gt;from Switchboard to Kinto&lt;/a&gt; to handle the experiments
data.&lt;/p&gt;
&lt;p&gt;It is &lt;a class="reference external" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1271860"&gt;a work in progress&lt;/a&gt; in the Fennec code base but we have
decided to explore how we could use a similar approach to use Kinto to
A/B test the web.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="introduction"&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;I am not a big fan of A/B testing because I think, most of the time,
&lt;a class="reference external" href="http://stevehanov.ca/blog/index.php?id=132"&gt;we can do better&lt;/a&gt; however in &lt;a class="reference external" href="https://vwo.com/blog/multi-armed-bandit-algorithm/"&gt;certain circumstances&lt;/a&gt; A/B testing is
still a really good idea to test a feature.&lt;/p&gt;
&lt;img alt="The Kinto Logo" src="http://www.servicedenuages.fr/en/../images/kinto-logo.png" style="width: 1700px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;In an other hand, I am a big fan of the philosophy behind &lt;a class="reference external" href="http://www.kinto-storage.org/"&gt;Kinto&lt;/a&gt; which
as you may know is a database for the web.&lt;/p&gt;
&lt;p&gt;In this article, I will take you through a little experiment I did
lately to extend the &lt;a class="reference external" href="https://github.com/mozilla-services/switchboard-experiments/"&gt;work that has been done&lt;/a&gt; to activate a feature
for some users in Firefox for Android.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="how-does-a-b-testing-works"&gt;
&lt;h2&gt;How does A/B testing works?&lt;/h2&gt;
&lt;p&gt;You just created a really nice feature and you want to test multiple
UX solutions in order to decide which one is most usable for your users.&lt;/p&gt;
&lt;p&gt;For instance, what is the best wording for the French banner?&lt;/p&gt;
&lt;p&gt;You can use A/B testing to test different variations on your user
base and select the best option.&lt;/p&gt;
&lt;p&gt;There are two technical parts on this:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;You need to display a different version of your banner to your users,
probably with the same code.&lt;/li&gt;
&lt;li&gt;You need to be able to get the conversion rate for each solution to
be able to compare them.&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class="section" id="a-word-about-the-repartition-algorithm"&gt;
&lt;h2&gt;A word about the repartition algorithm&lt;/h2&gt;
&lt;p&gt;The reason why we can use Kinto for this, is that we can run the
bucket repartition algorithm on client side.&lt;/p&gt;
&lt;p&gt;Because it is easier to think in terms of percentages, we chose to
split users in 100 buckets with a bucket ID from 0 to 99.&lt;/p&gt;
&lt;p&gt;We then need a way to get a bucket ID for our user device with a
homogeneous distribution on the bucket space.&lt;/p&gt;
&lt;p&gt;One way to do that is to generate a random UUID and to store it on the
device. But storing that value can be a bit cumbersome.&lt;/p&gt;
&lt;p&gt;To make this user bucket stateless, on mobile we can use the device ID
and on the web we can use the &lt;a class="reference external" href="https://github.com/Valve/fingerprintjs2"&gt;fingerprint.js&lt;/a&gt; project that aims to
generate a unique user id from the browser configuration.&lt;/p&gt;
&lt;p&gt;We can then use the modulo function to calculate the user bucket ID
from this device ID.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;fingerprint&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="nx"&gt;deviceID&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"1433179b5711413ba3c404075a629376"&lt;/span&gt;&lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;deviceID&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;parseInt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;fingerprint&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;deviceID&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;userBucket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;deviceID&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="c1"&gt;// userBucket = 68&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;With &lt;a class="reference external" href="https://github.com/Valve/fingerprintjs2"&gt;fingerprint.js&lt;/a&gt; specifically, it looks like that:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Fingerprint2&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;function&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;deviceIDString&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;

  &lt;span class="c1"&gt;// Convert the device ID hex string into an integer&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;deviceID&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;parseInt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;deviceIDString&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

  &lt;span class="c1"&gt;// Use a modulo on the device ID value to calculate the user bucket&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;userBucket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;deviceID&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;100&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="how-to-use-kinto-to-know-in-which-test-your-user-is"&gt;
&lt;h2&gt;How to use Kinto to know in which test your user is?&lt;/h2&gt;
&lt;p&gt;Apart from being a web service whose API is based on the simple and
universal JSON format, one of the benefits of using &lt;a class="reference external" href="http://www.kinto-storage.org/"&gt;Kinto&lt;/a&gt; is that you
will be able to use the &lt;a class="reference external" href="https://github.com/Kinto/kinto-admin"&gt;kinto-admin&lt;/a&gt; to configure your experiments.&lt;/p&gt;
&lt;img alt="Adding an experiment with the kinto-admin." src="http://www.servicedenuages.fr/en/../images/kinto-admin-screenshot.png" style="width: 1832px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;An experiment has got a &lt;tt class="docutils literal"&gt;name&lt;/tt&gt; and a &lt;tt class="docutils literal"&gt;description&lt;/tt&gt; as well as some
&lt;tt class="docutils literal"&gt;match&lt;/tt&gt; rules and a &lt;tt class="docutils literal"&gt;buckets&lt;/tt&gt; range.&lt;/p&gt;
&lt;p&gt;For the web, in my proof of concept, matching rules can be defined as
regexp on the user languages, country or user-agent.&lt;/p&gt;
&lt;p&gt;While defining an experiment we can decide to include a range of
buckets using the &lt;tt class="docutils literal"&gt;min&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;max&lt;/tt&gt; buckets attributes.&lt;/p&gt;
&lt;p&gt;An experiment is then stored in Kinto like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nt"&gt;"name"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"french-banner"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nt"&gt;"description"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"Try the new French banner"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nt"&gt;"match"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nt"&gt;"country"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"FR"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;"lang"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"fr"&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="nt"&gt;"buckets"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nt"&gt;"min"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"0"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nt"&gt;"max"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"50"&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt;
    &lt;span class="nt"&gt;"values"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nt"&gt;"url"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"https://firefoxos.mozfr.org/dotclear/public/Firefox_OS/.Gerez_votre_vie_privee_intelligemment_Mozilla_m.png"&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;From this experiment description we can extract two crutial pieces of
information that we need to track:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;user matches&lt;/strong&gt;: Is the user matching the experiment?&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;user in buckets&lt;/strong&gt;: Is the user in one of the targeted buckets?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;These two information will be used for the metrics part to decide if we
should use the new solution rather than the previous one.&lt;/p&gt;
&lt;p&gt;If you are currently in France, you can &lt;a class="reference external" href="https://mozilla-services.github.io/switchboard-experiments-kinto/"&gt;try this experiment&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The good news is that you will be able to change the experiment
settings after the release using the &lt;a class="reference external" href="https://github.com/Kinto/kinto-admin"&gt;kinto-admin&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;If you want to start with the feature off for everyone, you can just
set the same buckets configuration value for both &lt;tt class="docutils literal"&gt;min&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;max&lt;/tt&gt;
and it will turn it off.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="how-to-use-kinto-to-store-the-experiment-metrics"&gt;
&lt;h2&gt;How to use Kinto to store the experiment metrics?&lt;/h2&gt;
&lt;p&gt;First with regards to the experiment you want to do, you need a way to
trigger metrics.&lt;/p&gt;
&lt;p&gt;In the case of the previous example, the metric could be to monitor
the number of clicks on the banner when it is written in French or when
it is written in English for people in France.&lt;/p&gt;
&lt;p&gt;Using the power of Kinto permissions, we can create a collection where
people will be able to create new records in it but not change them.&lt;/p&gt;
&lt;p&gt;Using &lt;a class="reference external" href="https://httpie.org"&gt;HTTPie&lt;/a&gt; we can do it like that:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;http PUT https://kinto.dev.mozaws.net/v1/buckets/switchboard --auth admin:switchboard

&lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;'{"permissions": {"record:create": ["system.Everyone"]}}'&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    http PUT https://kinto.dev.mozaws.net/v1/buckets/switchboard/collections/metrics &lt;span class="se"&gt;\&lt;/span&gt;
        --auth admin:switchboard
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then when people match, we record our metrics:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nx"&gt;fetch&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"https://kinto.dev.mozaws.net/v1/buckets/switchboard/collections/metrics/records"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nx"&gt;method&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"POST"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="nx"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="s2"&gt;"Content-Type"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"application/json"&lt;/span&gt;
  &lt;span class="p"&gt;},&lt;/span&gt;
  &lt;span class="nx"&gt;body&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;stringify&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="nx"&gt;data&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"french-banner"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;matches&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;inBucket&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;
  &lt;span class="p"&gt;}})&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can then count the number of calls with or without the banner:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ http HEAD &lt;span class="s1"&gt;'https://kinto.dev.mozaws.net/v1/buckets/switchboard/collections/metrics/records?matches=true&amp;amp;inBucket=true'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --auth admin:switchboard &lt;span class="p"&gt;|&lt;/span&gt; grep Total-Records:
Total-Records: &lt;span class="m"&gt;300&lt;/span&gt;

$ http HEAD &lt;span class="s1"&gt;'https://kinto.dev.mozaws.net/v1/buckets/switchboard/collections/metrics/records?matches=true&amp;amp;inBucket=false'&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --auth admin:switchboard --print&lt;span class="o"&gt;=&lt;/span&gt;h &lt;span class="p"&gt;|&lt;/span&gt; grep Total-Records:
Total-Records: &lt;span class="m"&gt;20&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Because we can calculate the user bucket on client side, we do not
have to actually run the bucket repartition algorithm on the server side.&lt;/p&gt;
&lt;p&gt;We could even use Kinto to store the number of time the banner have
been displayed to make sure of the bucket repartition.&lt;/p&gt;
&lt;p&gt;The &lt;a class="reference external" href="https://github.com/Kinto/kinto-admin"&gt;kinto-admin&lt;/a&gt; makes it really easy to handle experiment
configuration variables.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="http://kinto.readthedocs.io/en/latest/tutorials/install.html#deploying-on-cloud-providers"&gt;Deploy a Kinto&lt;/a&gt; now for free on Heroku, Scalingo or your own server
and add A/B testing in your website for free.&lt;/p&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>How to load test a OAuth-protected HTTP API? (Part 2)</title><link href="http://www.servicedenuages.fr/en/load-testing-a-http-api-which-uses-oauth-for-authentication-part-2" rel="alternate"></link><published>2016-01-05T00:00:00+01:00</published><updated>2016-01-05T00:00:00+01:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2016-01-05:/en/load-testing-a-http-api-which-uses-oauth-for-authentication-part-2</id><summary type="html">&lt;p class="first last"&gt;How to loadtest OAuth APIs, part 2: how to generate Firefox Accounts tokens.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;This is part 2 of a series on loadtesting OAuth APIs.&lt;/p&gt;
&lt;div class="section" id="introduction"&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;&lt;a class="reference external" href="/en/load-testing-a-http-api-which-uses-oauth-for-authentication"&gt;In the previous article&lt;/a&gt;
we have seen that:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;We should create the OAuth Bearer Token before the load test start.&lt;/li&gt;
&lt;li&gt;We can use environment variables to specify the token to use in the load test.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In this article we will have a closer look at how to generate tokens
for Firefox Accounts and pass them to the load test.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="pyfxa-the-python-firefox-accounts-client"&gt;
&lt;h2&gt;PyFxA: The Python Firefox Accounts client&lt;/h2&gt;
&lt;p&gt;&lt;a class="reference external" href="https://github.com/mozilla/PyFxA"&gt;PyFxA&lt;/a&gt; is a Python library
providing helpers to interact with the Firefox Accounts ecosystem.&lt;/p&gt;
&lt;div class="section" id="using-pyfxa-with-httpie"&gt;
&lt;h3&gt;Using PyFxA with httpie&lt;/h3&gt;
&lt;p&gt;To ease the use of Firefox Accounts Bearer Tokens, we have created, a
while ago, an
&lt;a class="reference external" href="https://github.com/mozilla/PyFxA/blob/master/fxa/plugins/requests.py#L115-L158"&gt;authentication policy&lt;/a&gt;
for the &lt;a class="reference external" href="http://docs.python-requests.org/en/latest/"&gt;requests library&lt;/a&gt;, which
can also be used with the &lt;a class="reference external" href="http://httpie.org"&gt;httpie&lt;/a&gt; client.&lt;/p&gt;
&lt;p&gt;With this plugin, we can provide our user credentials and a valid
Bearer Token will be built for our request.&lt;/p&gt;
&lt;p&gt;Here is what it looks like with HTTPie.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;http https://profile.accounts.firefox.com/v1/profile &lt;span class="se"&gt;\&lt;/span&gt;
    --auth-type fxa-bearer &lt;span class="se"&gt;\&lt;/span&gt;
    --auth &lt;span class="s2"&gt;"email@domain.tld:password"&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="using-fxa-client-to-generate-bearer-tokens"&gt;
&lt;h3&gt;Using fxa-client to generate Bearer Tokens&lt;/h3&gt;
&lt;p&gt;The code we wrote at the time was quite similar to what we were trying
to do for the load test setup: generating a Bearer Token for a
given user.&lt;/p&gt;
&lt;p&gt;We ended-up building a CLI tool called &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa-client&lt;/span&gt;&lt;/tt&gt; that is able to
generate a BASH file that exports some environment variables:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;USAGE: fxa-client &lt;span class="o"&gt;[&lt;/span&gt;-h&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;--bearer&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;--create-user&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;--auth AUTH&lt;span class="o"&gt;]&lt;/span&gt;
                  &lt;span class="o"&gt;[&lt;/span&gt;--out OUTPUT_FILE&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;--verbose&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;--user-salt FXA_USER_SALT&lt;span class="o"&gt;]&lt;/span&gt;
                  &lt;span class="o"&gt;[&lt;/span&gt;--env &lt;span class="o"&gt;{&lt;/span&gt;stable,stage,production&lt;span class="o"&gt;}]&lt;/span&gt;
                  &lt;span class="o"&gt;[&lt;/span&gt;--user-email-prefix PREFIX&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;--account-server ACCOUNT_SERVER_URL&lt;span class="o"&gt;]&lt;/span&gt;
                  &lt;span class="o"&gt;[&lt;/span&gt;--oauth-server OAUTH_SERVER_URL&lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt;--client-id CLIENT_ID&lt;span class="o"&gt;]&lt;/span&gt;
                  &lt;span class="o"&gt;[&lt;/span&gt;--scopes SCOPES&lt;span class="o"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;With this client, instead of building a Bearer Token for the request,
we can just ask the &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa-client&lt;/span&gt;&lt;/tt&gt; to build one for our load test:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;fxa-client --auth email@domain.tld --bearer --scopes &lt;span class="s2"&gt;"profile"&lt;/span&gt;

Please enter a password &lt;span class="k"&gt;for&lt;/span&gt; email@domain.tld:
&lt;span class="c1"&gt;# ---- BEARER TOKEN INFO ----&lt;/span&gt;
&lt;span class="c1"&gt;# User: email@domain.tld&lt;/span&gt;
&lt;span class="c1"&gt;# Scopes: profile&lt;/span&gt;
&lt;span class="c1"&gt;# Account: https://api-accounts.stage.mozaws.net/v1&lt;/span&gt;
&lt;span class="c1"&gt;# Oauth: https://oauth.stage.mozaws.net/v1&lt;/span&gt;
&lt;span class="c1"&gt;# Client ID: 5882386c6d801776&lt;/span&gt;
&lt;span class="c1"&gt;# ---------------------------&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;OAUTH_BEARER_TOKEN&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"b1d4babc01502fa8d9fc0139757168bf5908f33abc66f46253d4c69468e39373"&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then we can use this Bearer Token for our request:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;http https://profile.stage.mozaws.net/v1/profile &lt;span class="se"&gt;\&lt;/span&gt;
    Authorization:&lt;span class="s2"&gt;"Bearer b1d4babc01502fa8d9fc0139757168bf5908f33abc66f46253d4c69468e39373"&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="using-fxa-client-to-create-new-test-accounts"&gt;
&lt;h3&gt;Using fxa-client to create new test accounts&lt;/h3&gt;
&lt;p&gt;We can also create a random user (on the stage environment only) and
generate a Bearer Token for it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;fxa-client --create-user --bearer --user-email-prefix my-app

&lt;span class="c1"&gt;# ---- BEARER TOKEN INFO ----&lt;/span&gt;
&lt;span class="c1"&gt;# User: my-app-6318a65dde1efc2f4c3f7b4e6cb33188@restmail.net&lt;/span&gt;
&lt;span class="c1"&gt;# Scopes: profile&lt;/span&gt;
&lt;span class="c1"&gt;# Account: https://api-accounts.stage.mozaws.net/v1&lt;/span&gt;
&lt;span class="c1"&gt;# Oauth: https://oauth.stage.mozaws.net/v1&lt;/span&gt;
&lt;span class="c1"&gt;# Client ID: 5882386c6d801776&lt;/span&gt;
&lt;span class="c1"&gt;# ---------------------------&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;OAUTH_BEARER_TOKEN&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"90abc87ed1621ee504c1252ed382abc8269d1abc29f2ff87cc5e25f00249fabc"&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;To avoid creating extraneous user accounts, it is possible to specify
a user salt (as a base64 string) that will always generate the same
user credentials and recreate the account if needed:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;fxa-client --create-user --bearer --user-email-prefix my-app --user-salt &lt;span class="nv"&gt;MySalt&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="using-fxa-client-to-work-with-browserid-assertions"&gt;
&lt;h3&gt;Using fxa-client to work with BrowserID assertions&lt;/h3&gt;
&lt;p&gt;We are currently relying on OAuth2 Bearer Tokens for our new services.&lt;/p&gt;
&lt;p&gt;However, some of the old services (Firefox Sync, Firefox Hello) still
rely on BrowserID assertions for authentication.&lt;/p&gt;
&lt;p&gt;Hopefully &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa-client&lt;/span&gt;&lt;/tt&gt; is able to generate BrowserID assertions too.&lt;/p&gt;
&lt;p&gt;In that case &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa-client&lt;/span&gt;&lt;/tt&gt; provides few specific attributes:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;optional arguments:
  --browserid, --bid    Generate a BrowserID assertion
  --audience AUDIENCE   Firefox BrowserID assertion audience.
  --duration DURATION   Firefox BrowserID assertion duration.
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The script works exactly in the same way than the one for Bearer
Tokens, except it generates a BrowserID assertion instead:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;fxa-client --create-user --browserid --user-email-prefix my-app &lt;span class="se"&gt;\&lt;/span&gt;
    --user-salt &lt;span class="nv"&gt;MySalt&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    --audience https://loop.stage.mozaws.net

&lt;span class="c1"&gt;# ---- BROWSER ID ASSERTION INFO ----&lt;/span&gt;
&lt;span class="c1"&gt;# User: my-app-b82d4afaf57cb856ccc04a58a07ce80f@restmail.net&lt;/span&gt;
&lt;span class="c1"&gt;# Audience: https://loop.stage.mozaws.net&lt;/span&gt;
&lt;span class="c1"&gt;# Account: https://api-accounts.stage.mozaws.net/v1&lt;/span&gt;
&lt;span class="c1"&gt;# ------------------------------------&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;FXA_BROWSERID_ASSERTION&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"eyJhbGciOiJSUzI1NiJ9...hIQ9vrkqA"&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;FXA_CLIENT_STATE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"828aef3bc68ac0bde10f3d4b93303088"&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And then the assertion can be used in the Authorization header of the request:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;http POST https://loop.stage.mozaws.net/v0/registration &lt;span class="se"&gt;\&lt;/span&gt;
    Authorization:&lt;span class="s2"&gt;"BrowserID eyJhbGciOiJSUzI1NiJ9...hIQ9vrkqA"&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="using-fxa-client-to-configure-a-loadtest"&gt;
&lt;h2&gt;Using fxa-client to configure a loadtest&lt;/h2&gt;
&lt;p&gt;Now that we have a quite simple way to generate Bearer Tokens, how can
we plug that with our load tests?&lt;/p&gt;
&lt;p&gt;I could not find a better way than creating a bash file that exports
the environment variables and then sourcing it in the shell that will
run the loadtest.&lt;/p&gt;
&lt;p&gt;Something like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;fxa-client --create-user --bearer --user-salt &lt;span class="nv"&gt;MySalt&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt; --out loadtest-fxa-config.sh
&lt;span class="nb"&gt;source&lt;/span&gt; loadtest-fxa-config.sh
docker run -e &lt;span class="nv"&gt;OAUTH_BEARER_TOKEN&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;OAUTH_BEARER_TOKEN&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt; loadtest
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After sourcing the &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;loadtest-fxa-config.sh&lt;/span&gt;&lt;/tt&gt; file, the env variables
are exposed. Any program (regardless of the language) can read them if
needed.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="how-to-install-fxa-client"&gt;
&lt;h2&gt;How to install fxa-client?&lt;/h2&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa-client&lt;/span&gt;&lt;/tt&gt; have been released in the last release of PyFxA 0.1.0.&lt;/p&gt;
&lt;p&gt;So just install the &lt;a class="reference external" href="https://pypi.python.org/pypi/PyFxA"&gt;PyFxA python package&lt;/a&gt;
using pip:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;pip install -U PyFxA
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="section" id="management-firefox-accounts-environments"&gt;
&lt;h3&gt;Management Firefox Accounts environments&lt;/h3&gt;
&lt;p&gt;If we want to generate tokens for other Firefox Accounts environment,
we would need to provide &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--account-server&lt;/span&gt;&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--oauth-server&lt;/span&gt;&lt;/tt&gt;
which default to the stage environment.&lt;/p&gt;
&lt;p&gt;We can find &lt;a class="reference external" href="https://developer.mozilla.org/en-US/docs/Mozilla/Tech/Firefox_Accounts/Introduction#Firefox_Accounts_deployments"&gt;all the available environment here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;However to ease the switch from one to the other we added a &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--env&lt;/span&gt;&lt;/tt&gt;
parameter that let you write:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;fxa-client --bearer --auth email@domain.tld --env production
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Rather than:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;fxa-client --bearer --auth email@domain.tld &lt;span class="se"&gt;\&lt;/span&gt;
    --account-server https://api.accounts.firefox.com/v1 &lt;span class="se"&gt;\&lt;/span&gt;
    --oauth-server https://oauth.accounts.firefox.com/v1
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="what-s-next"&gt;
&lt;h2&gt;What's next?&lt;/h2&gt;
&lt;div class="section" id="multiple-accounts-loadtest"&gt;
&lt;h3&gt;Multiple accounts loadtest&lt;/h3&gt;
&lt;p&gt;We can already run the script twice to generate a Bearer Token per
user, but it would be nice to be able to do so directly with
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa-client&lt;/span&gt;&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;I was thinking of implementing the following output:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;fxa-client --create-user --bearer --user-salt &lt;span class="nv"&gt;MySalt&lt;/span&gt;&lt;span class="o"&gt;==&lt;/span&gt; -n &lt;span class="m"&gt;2&lt;/span&gt;

&lt;span class="c1"&gt;# ---- BEARER TOKEN INFO ----&lt;/span&gt;
&lt;span class="c1"&gt;# User1: my-app-1318a65dde1efc2f4c3f7b4e6cb33188@restmail.net&lt;/span&gt;
&lt;span class="c1"&gt;# User2: my-app-2318a65dde1efc2f4c3f7b4e6cb33188@restmail.net&lt;/span&gt;
&lt;span class="c1"&gt;# Scopes: profile&lt;/span&gt;
&lt;span class="c1"&gt;# Account: https://api-accounts.stage.mozaws.net/v1&lt;/span&gt;
&lt;span class="c1"&gt;# Oauth: https://oauth.stage.mozaws.net/v1&lt;/span&gt;
&lt;span class="c1"&gt;# Client ID: 5882386c6d801776&lt;/span&gt;
&lt;span class="c1"&gt;# ---------------------------&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;OAUTH_BEARER_TOKEN&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"90abc87ed1621ee504c1252ed382abc8269d1abc29f2ff87cc5e25f00249fabc,abc9087ed1621ee504c1252ed382abc8269d1abc29f2ff87cc5e25f00249fabc"&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;That's about it. I hope that after reading this article, you are not
afraid anymore of load testing Firefox Accounts OAuth-based services!&lt;/p&gt;
&lt;p&gt;Take-aways:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa-client&lt;/span&gt;&lt;/tt&gt; let us generate a bash script with our user credentials.&lt;/li&gt;
&lt;li&gt;This bash script can be loaded before running our load test to expose
user credentials to a load test script.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Do not hesitate to reach us if you have any questions or suggestions.&lt;/p&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>The hard promise of self-hosting</title><link href="http://www.servicedenuages.fr/en/self-hosting-a-hard-promise" rel="alternate"></link><published>2015-12-22T00:00:00+01:00</published><updated>2015-12-22T00:00:00+01:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-12-22:/en/self-hosting-a-hard-promise</id><summary type="html">&lt;p class="first last"&gt;Where we talk about self-hosting, deployment, and decentralization.&lt;/p&gt;
</summary><content type="html">&lt;div class="admonition note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;This article was translated by &lt;a class="reference external" href="https://notmyidea.org"&gt;Alexis Métaireau&lt;/a&gt;,
on a train between Rennes and Paris.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;While discussing about &lt;a class="reference external" href="https://kinto.readthedocs.io/"&gt;Kinto&lt;/a&gt;, we discovered
that the future we envision for Kinto is the one of a collectively decentralized
hosting, rather than having every user having their own individual servers.&lt;/p&gt;
&lt;p&gt;Kinto wants to answer two basic needs from Web users: storage and sharing of
data, without letting them losing control over their own data.&lt;/p&gt;
&lt;p&gt;If Kinto should be a "database for the Web", then it is a pre-requesite that
every user of the Web can easily access a server running it.&lt;/p&gt;
&lt;div class="section" id="self-hosting"&gt;
&lt;h2&gt;Self-Hosting&lt;/h2&gt;
&lt;img alt="Countryside house -- House, Automn - CC-BY-ND Gunnar Magnusson https://www.flickr.com/photos/matupplevelser/4644386646" class="align-center" src="http://www.servicedenuages.fr/en/../images/autohebergement.jpg" style="width: 640px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Deploying servers isn't something easy. A lot of people are working hard on
solving this problem, but there is still a lot of work to do before having a
plug and play solution that is easy to maintain over time.&lt;/p&gt;
&lt;p&gt;Servers needs to be updated to avoid security issues and to be kept alive for
the ones who needs them.&lt;/p&gt;
&lt;p&gt;We can see it on our deployed software: we are very lucky to have "Ops" handling
this. Believe us, if these tasks were easy to automate, they would already be!
(Nobody wants to wake up in the middle of the night to solve other's problems)&lt;/p&gt;
&lt;p&gt;Unfortunately, we are not yet at a stage where the state of the art allows
everyone to self-host in a durable way.&lt;/p&gt;
&lt;p&gt;A real work is needed to propose a service that works well for the users who
needs it.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="un-centralized"&gt;
&lt;h2&gt;Un-centralized&lt;/h2&gt;
&lt;p&gt;An answer to this problem seems to be a system with multiple centers: Decentralized.&lt;/p&gt;
&lt;p&gt;Rather than having only one place where everything is stored, we could have
one or multiple servers, handled by communities (EFF, The local linux
user-group of your city, etc) which would help factorize the costs (both human-wise
and money-wise) of maintaining these services. This allows to host one server
for many users and applications.&lt;/p&gt;
&lt;p&gt;I can see you from here, mumbling: "He is nice with his community-baked servers,
but I don't want to give my personal data to anyone!". And you would be right.&lt;/p&gt;
&lt;p&gt;Kinto allows to store any kind of data. It could be data meant to be shared
or data that are yours and should remain private.&lt;/p&gt;
&lt;p&gt;One of our goals is to help making encryption dead simple so that nobody
(except you) can read your data.&lt;/p&gt;
&lt;p&gt;Kinto.js actually handles this pretty well, as &lt;a class="reference external" href="http://www.servicedenuages.fr/en/kinto-encryption-example"&gt;Michiel showed in a previous
article.&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="avoiding-the-creation-of-a-new-silo"&gt;
&lt;h2&gt;Avoiding the creation of a new silo&lt;/h2&gt;
&lt;img alt="The future of silos - CC-BY-NC-ND Sunflower Silo in Boulder County Colorado by Bo Insogna — https://www.flickr.com/photos/thelightningman/5494666930" class="align-center" src="http://www.servicedenuages.fr/en/../images/silo.jpg" style="width: 640px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;In order to avoid participating in the creation of new silo, it is important
to take care of a few things:&lt;/p&gt;
&lt;div class="section" id="identity"&gt;
&lt;h3&gt;Identity&lt;/h3&gt;
&lt;p&gt;One of the mechanisms allowing current silos (Facebook, Twitter) to continue
is their identity system. You want to share data with your cousin but you only
have her "Facebook account" to connect with her.&lt;/p&gt;
&lt;p&gt;For sure, this is a bad situation, but let's try to solve one problem at a time
(unfortunately, Mozilla Persona, the decentralized identity service is End of
Life).&lt;/p&gt;
&lt;p&gt;Let's allow people to authenticate with their best-choice solution, being it
open or not (OpenID, Firefox Accounts, Github, Twiter, Facebook, etc.) &lt;em&gt;but&lt;/em&gt;
let's give them back the choice of where their data is stored.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="interoperability"&gt;
&lt;h3&gt;Interoperability&lt;/h3&gt;
&lt;p&gt;It should matter which storage solution you chose. It is crucial that
interfaces exist to go from one to the other.&lt;/p&gt;
&lt;p&gt;Kinto exposes (before all the rest) an HTTP API (some would say RESTful) which
speaks JSON, which make it very easy to integrate with other solutions.&lt;/p&gt;
&lt;p&gt;As a first step, it could only be import / export features from one solution
to the other, but it is better to choose a format to be used for this data
exchange. Without what a de-facto standard will emerge, for the best and worst.&lt;/p&gt;
&lt;p&gt;We should start the collaboration with other "private cloud" providers, like
OwnCloud or CozyCloud.&lt;/p&gt;
&lt;p&gt;The latter started the creation of a
&lt;a class="reference external" href="https://github.com/Decentralized-Sharing-Working-Group/internet-draft"&gt;working group&lt;/a&gt;
on the matter, which wants to use MicroPub and WebMention as starting points.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="decentralized"&gt;
&lt;h3&gt;Decentralized&lt;/h3&gt;
&lt;p&gt;The creation of community servers should not block the users to use their
personnal server for the tech savvy.&lt;/p&gt;
&lt;p&gt;In which case the community servers could serve as a backup, in case of a
failure of the personnal servers (or in the other direction, the personal
servers could backup community ones).&lt;/p&gt;
&lt;p&gt;We can foresee a future where each user could have her own Kinto server, but
we need to go there step by step, and prepare the field before being ready for
a &lt;em&gt;one click&lt;/em&gt; solution for &lt;em&gt;Aunt Jeannine&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Having an easy start seem to be key here: start by using a community server and
migrate later to a personnal server once all the technical problems
(previously mentionned) have been solved.&lt;/p&gt;
&lt;p&gt;In the meantime, an approach based on top of multiple communities seems to be
a pragmatic solution in the short/mid term, bringing back some freedom to the
users.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>How to make the Kinto instances discoverable?</title><link href="http://www.servicedenuages.fr/en/discovery-of-kinto-servers" rel="alternate"></link><published>2015-12-21T00:00:00+01:00</published><updated>2015-12-21T00:00:00+01:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-12-21:/en/discovery-of-kinto-servers</id><summary type="html">&lt;p class="first last"&gt;What solution can we put together to make Kinto instances discoverable.&lt;/p&gt;
</summary><content type="html">&lt;div class="section" id="about-me"&gt;
&lt;h2&gt;About Me&lt;/h2&gt;
&lt;p&gt;Hi! I am Shweta Oak.&lt;/p&gt;
&lt;p&gt;I got the opportunity to be part of Mozilla's Kinto team.
Here, my work focuses on the discovery of Kinto servers.
I am passionate about Technology and believe in applying it to enhance the lives of people.
I like to solve problems. While solving problems, I like exploring and crafting various
solutions to find the best one. I am enthusiastic about taking up new challenges, learning
new things and discovering my potential.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="how-does-an-application-discover-the-location-of-a-kinto-server"&gt;
&lt;h2&gt;How does an application discover the location of a Kinto server?&lt;/h2&gt;
&lt;p&gt;Unlike Parse or Firebase which are centralized services, Kinto can be ran by anyone
and anywhere. However, there has to be a way for the user to choose where the data
are getting stored. In addition to configuring the frontend app for their personal
server, users can get the  location of the server in the form of a URL which can be
shared with another user in order to collaborate and share data between multiple
users on the same Kinto server.&lt;/p&gt;
&lt;p&gt;To solve this problem, the following approach can be taken:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Let the user enter the location of her Kinto instance, the first time.&lt;/li&gt;
&lt;li&gt;Store this location remotely.&lt;/li&gt;
&lt;li&gt;Use this later to discover the service.&lt;/li&gt;
&lt;/ol&gt;
&lt;img alt="The first time the user set her Kinto server URI" class="align-center" src="http://www.servicedenuages.fr/en/../images/KintoDiscovery-1st-time-sync.png" style="width: 1092px; height: auto; max-width: 100%;"/&gt;
&lt;img alt="The second time the user discover their Kinto server URI" class="align-center" src="http://www.servicedenuages.fr/en/../images/KintoDiscovery-2nd-time-sync.png" style="width: 1092px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;div class="section" id="let-the-user-enter-the-location-of-her-kinto-instance-the-first-time"&gt;
&lt;h2&gt;Let the user enter the location of her Kinto instance, the first time.&lt;/h2&gt;
&lt;p&gt;Add a way, on client side, to specify where the server is. For instance, this should
be done in JavaScript and HTML on  top of the Kinto.js client.
It is basically a user interface for how to specify the "remote server" to use. The
user has to enter the location of the server only once, the first time she uses a
Kinto instance, later on, this location will be discovered.&lt;/p&gt;
&lt;p&gt;The best way to start doing this is to do it in a webpage that uses Kinto.js and let
the user specify the server location. Once we have this, we will need to make this
project re-usable by others.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="store-this-location-remotely"&gt;
&lt;h2&gt;Store this location remotely&lt;/h2&gt;
&lt;p&gt;Then, it would be good if we were able, for a given authenticated user, to automatically
discover where their Kinto instance is located. To do that we will need to find a solution
to save this location somewhere when the user enters the location of the server for the first
time and then, the information will be discovered.&lt;/p&gt;
&lt;p&gt;We also need to keep in mind that users may have multiple Kinto instances with regards to the
application they will be using. The discovery of Kinto will be cross application too.&lt;/p&gt;
&lt;p&gt;We will now need to store this information remotely. This is where the ideas of a central
repository and of a Distributed Hash Table (DHT) come into play. Since a DHT is by far more
complex than a central repository, we will start with the use of a central server.&lt;/p&gt;
&lt;div class="section" id="b1-central-repository"&gt;
&lt;h3&gt;(B1) Central Repository&lt;/h3&gt;
&lt;p&gt;A small Javascript helper to lookup the location of the server
remotely once the user is connected. The flow would then look like
this:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Connect to your account (Github, Twitter, FxA) using OAuth.&lt;/li&gt;
&lt;li&gt;The client fetches the location of the Kinto server on a central Kinto collection using the user credentials.&lt;/li&gt;
&lt;li&gt;The Kinto.js collection is configured to use this remote.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Pros of using a central repository:&lt;/strong&gt;&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;It is really easy to setup and implement.&lt;/li&gt;
&lt;li&gt;The application searches for the user’s server by looking up the central repository.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Cons of using a central repository:&lt;/strong&gt;&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;The user needs to trust a 3rd party as the links to the information of the user is being stored in one place.&lt;/li&gt;
&lt;li&gt;There is a possibility of leak of information that someone is connected to a Kinto instance, and where this instance is.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="b2-distributed-hash-table-dht"&gt;
&lt;h3&gt;(B2) Distributed Hash Table (DHT)&lt;/h3&gt;
&lt;p&gt;Once we have this mechanism in place, we can expand it in order to
rely on a DHT rather than on a central repositories. DHT is a
distributed hash table system that provides a distributed lookup
service without a single point of failure.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Pros of using DHT:&lt;/strong&gt;&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;The user does not have to trust one server only. There are multiple servers that hold pieces of the data.&lt;/li&gt;
&lt;li&gt;It is possible to add your own server to the DHT.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;Cons of using DHT:&lt;/strong&gt;&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;It might be complex to deploy.&lt;/li&gt;
&lt;li&gt;Harder to implement and verify&lt;/li&gt;
&lt;li&gt;It might be an overkill solution.&lt;/li&gt;
&lt;li&gt;All the data in a DHT are public so we would necessarily need to encrypt the data there.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="eventually-at-the-end-we-should-expand-this-mechanism-to-other-services-locations-using-host-meta"&gt;
&lt;h2&gt;Eventually at the end we should expand this mechanism to other services locations, using Host-Meta.&lt;/h2&gt;
&lt;p&gt;In addition to discovering the location of the Kinto server, add the
possibility to discover other services, such as the identity service
provider for the remote instance (Firefox Accounts / Github /
Twitter), using something like Host-Meta.  &lt;a class="reference external" href="https://tools.ietf.org/html/rfc6415"&gt;Host-Meta is a
specification&lt;/a&gt; that is used for
looking up the metadata of a domain name. It is useful for discovery
of services associated with the host.&lt;/p&gt;
&lt;p&gt;And once we're there, all the Kinto instances will be discoverable!&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="note-to-the-reader"&gt;
&lt;h2&gt;Note to the reader:&lt;/h2&gt;
&lt;p&gt;Thanks for your interest in this article. If you think there is a better approach we can take,
than the one given above or, if there is anything you would like to share with us regarding
this article, do comment below. We look forward to exploring more solutions and making the
project even better through your feedback :)&lt;/p&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>Hacker News answers</title><link href="http://www.servicedenuages.fr/en/hackernews-feedback" rel="alternate"></link><published>2015-12-15T00:00:00+01:00</published><updated>2015-12-15T00:00:00+01:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-12-15:/en/hackernews-feedback</id><summary type="html">&lt;p class="first last"&gt;Where we answer a set of questions that arised on a Hacker News
thread.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Today, &lt;a class="reference external" href="https://news.ycombinator.com/item?id=10733164"&gt;Kinto was featured on Hackernews&lt;/a&gt;. We take this as a great
milestone for the project, even if it also comes with some sort of pressure and
stress :)&lt;/p&gt;
&lt;p&gt;Since a few questions emerged from the thread there, we thought it'd be
appropriate to provide some answers here.&lt;/p&gt;
&lt;div class="section" id="what-does-this-name-mean"&gt;
&lt;h2&gt;What does this name mean?&lt;/h2&gt;
&lt;p&gt;&lt;a class="reference external" href="http://dragonball.wikia.com/wiki/Flying_Nimbus"&gt;Kinto-un&lt;/a&gt; is the name of the
Flying Nimbus in Dragon ball. It's said that "the cloud can only be ridden by
someone with a pure heart". Oh, well.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="maintaining-a-service-is-hard"&gt;
&lt;h2&gt;Maintaining a service is hard&lt;/h2&gt;
&lt;p&gt;The main benefit of Firebase and Parse is that you don't have to run them.&lt;/p&gt;
&lt;p&gt;That is true. We want to make it very easy to deploy / use. We can even
imagine to allow developers to run a Kinto instance in one-click on
DigitalOcean, Heroku or Bitnami.
We've started &lt;a class="reference external" href="https://github.com/Natim/auto-kinto-alwaysdata"&gt;by making the integration easy on Always Data&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;By the way, if someone runs a public Kinto instance and wants to charge for its usage,
that's completely fine!&lt;/p&gt;
&lt;p&gt;At Mozilla, we just can't rely on third parties like Firebase or Parse for
critical data.&lt;/p&gt;
&lt;p&gt;If you read french, we've written &lt;a class="reference external" href="http://www.servicedenuages.fr/difficile-promesse-autohebergement"&gt;an article about our vision on self-hosting&lt;/a&gt;
(yes, we need to translate it! Any help would be welcome on this front.)&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="are-we-using-this-in-production"&gt;
&lt;h2&gt;Are we using this in production?&lt;/h2&gt;
&lt;p&gt;We have different services that are leveraging Kinto:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;The (now dead) reading-list project was using one of the first versions of
Kinto&lt;/li&gt;
&lt;li&gt;We have made &lt;a class="reference external" href="https://github.com/mozilla-services/syncto"&gt;Syncto&lt;/a&gt;:
a service which exposes the API of Kinto and talks with Firefox Sync in the
background, so that FirefoxOS developers can use the Kinto.js library&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We are currently building (for 2016):&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;the distribution of fonts and hyphenation dictionaries for Firefox Mobile (Fennec)&lt;/li&gt;
&lt;li&gt;the synchronization of addons blocklist and &lt;a class="reference external" href="https://blog.mozilla.org/security/2015/03/03/revoking-intermediate-certificates-introducing-onecrl/"&gt;Certificate Revocation Lists (OneCRL)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Kinto.js &lt;a class="reference external" href="https://github.com/mozilla/gecko-dev/commit/199296f7448fcfe12a3d84c7e16ca1752b740c0e"&gt;has landed in Firefox for that purpose&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="offline-first-support"&gt;
&lt;h2&gt;Offline-first support&lt;/h2&gt;
&lt;p&gt;One of the core ideas behind &lt;a class="reference external" href="https://github.com/Kinto/kinto.js"&gt;Kinto.js&lt;/a&gt; is
that it should be offline first: all operations can be done when online or
offline, and the data are synchronized when the connection goes back to normal.&lt;/p&gt;
&lt;p&gt;Also, as we ship to these platforms, expect to see Android and iOS offline-first
clients coming along.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="how-can-you-communicate-with-us"&gt;
&lt;h2&gt;How can you communicate with us?&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Our IRC channel &lt;tt class="docutils literal"&gt;#kinto&lt;/tt&gt; on &lt;tt class="docutils literal"&gt;irc.freenode.net&lt;/tt&gt;.  &lt;a class="reference external" href="https://kiwiirc.com/client/irc.freenode.net/?#kinto"&gt;Click here to access
the web client&lt;/a&gt; or
join using your favorite client.&lt;/li&gt;
&lt;li&gt;Our team blog &lt;a class="reference external" href="http://www.servicedenuages.fr/"&gt;http://www.servicedenuages.fr/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://mail.mozilla.org/listinfo/kinto"&gt;The Kinto mailing list&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="realtime-updates-what-about-kinto"&gt;
&lt;h2&gt;Realtime updates, what about Kinto?&lt;/h2&gt;
&lt;p&gt;When a record is modified, Kinto sends a notification on a pubsub channel. We
integrated Pusher.com and WebPush very recently.  Currently, the notification
payload contains the old and new version of the record. We plan on making
improvements, like sending diffs only. #babysteps #ftw!&lt;/p&gt;
&lt;p&gt;Also, the current mecanism does not allow to send write operations via
websockets. Those are only sent via the REST API. We were recently talking
about abstracting the protocol into something different, but it's undecided as
of now.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="you-re-missing-an-administration-panel"&gt;
&lt;h2&gt;You're missing an administration panel!&lt;/h2&gt;
&lt;p&gt;This isn't actually true! One of our current focus is on &lt;a class="reference external" href="https://github.com/Kinto/kinto-admin"&gt;an admin panel&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;It's still fairly new but already available and useful.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="why-not-building-on-top-of-couchdb-pouchdb"&gt;
&lt;h2&gt;Why not building on top of CouchDB / PouchDB?&lt;/h2&gt;
&lt;p&gt;We do realize CouchDB exists, and even think it's the best solution for a lot
of use cases. One of the first thing we did when we faced our first uses cases was to
see if CouchDB was a good choice for us, and eventually decided to not go for
it. You can read more about the rationale on our decision on &lt;a class="reference external" href="http://www.servicedenuages.fr/en/generic-storage-ecosystem"&gt;the article&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;What we are doing with Kinto differs from what Couch/Pouch provide, in a bunch
of different ways. We don't actually want to step on each other toes, and
believe that Kinto and Pouch/Couch could actually live and be happy together
(we were even discussing last week about doing a bridge to Pouch in Kinto.js)&lt;/p&gt;
&lt;p&gt;Now we need to let you with an explanation of how Kinto and Couch differs!&lt;/p&gt;
&lt;p&gt;Kinto did the choice to &lt;em&gt;not&lt;/em&gt; store the revisions that can be used for
master-master replication. One benefit out of it is that you don't need to
compress your database, resulting in smaller datasets.&lt;/p&gt;
&lt;p&gt;It also means that we have a harder time dealing with conflicts, since we
cannot perform three way merges. We decided to let the application developers
manage conflicts — with user prompts or specific business logic for example —
and it fits our use cases pretty well.&lt;/p&gt;
&lt;p&gt;Couch/Pouch also means that we had to deploy, scale and maintain technologies
that we don't master, and to which we weren't confident to contribute (CouchDB
is Erlang) whereas one of the original goals of Kinto is to be ops friendly.&lt;/p&gt;
&lt;p&gt;Couch / Pouch is built on top of the concept of one database per user, and only
syncs entire databases. This is improving now, though.&lt;/p&gt;
&lt;p&gt;As Dale Harvey pointed out, Kinto wants to handle fine-grained permissions.
After looking at how Couch is built and how complex it would have been to
include these fine-grained permissions in the protocol, we decided it would be
easier to actually do it from the ground up. We are aware of &lt;a class="reference external" href="https://github.com/thaliproject/node_acl_pouchdb"&gt;the
implementations of ACLs on top of Couch&lt;/a&gt; and don't think their
tradeoffs are worth it.&lt;/p&gt;
&lt;p&gt;There is a comparison with CouchDB (and many other solutions) &lt;a class="reference external" href="http://kinto.readthedocs.io/en/latest/overview.html#comparison"&gt;in our
documentation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Since the two solutions are solving slightly different problems, we will make
our best to guide the users towards the best for their use-case.  &lt;a class="reference external" href="https://github.com/Kinto/kinto/issues/330"&gt;We also plan
to extend this comparison table&lt;/a&gt;
to compare products rather than server solutions.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="we-are-also-developing-x-i-wonder-how-it-compares-with-x"&gt;
&lt;h2&gt;We are also developing X / I wonder how it compares with X&lt;/h2&gt;
&lt;p&gt;A few years ago, we built &lt;a class="reference external" href="https://github.com/spiral-project/daybed"&gt;Daybed&lt;/a&gt;,
a similar project which never had the chance to be famous. At the time, the
page &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Mobile_Backend_as_a_service"&gt;Mobile Backend as a service&lt;/a&gt; did not even
exist on Wikipedia.  In early 2015, we decided to reboot the idea, based on
concrete use-cases that we had at Mozilla. It was not especially mobile
oriented, but each project milestone lead us to an ecosystem that is rich
enough to be compared with MBAAS.&lt;/p&gt;
&lt;p&gt;We realize there are many (many) alternatives in the wild, like &lt;a class="reference external" href="http://gun.js.org"&gt;http://gun.js.org&lt;/a&gt;
or &lt;a class="reference external" href="http://kuzzle.io"&gt;http://kuzzle.io&lt;/a&gt; just to mention FOSS. Of course, Parse could also be
released under an open-source license some day.&lt;/p&gt;
&lt;p&gt;For us, it mainly means that Kinto was a good idea!&lt;/p&gt;
&lt;p&gt;We are a team of 5, and we don't pretend to knock down the tech of big
companies. We build Kinto with some ideals: a simple solution for simple needs
that is fully open-source.&lt;/p&gt;
&lt;p&gt;We make our best to be transparent and humble, but there are so many solutions
out there. We probably missed many of them. So please help us guide the users
to choose the best solution for their use-case in our overview page!&lt;/p&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>How to load test a OAuth-protected HTTP API? (Part 1)</title><link href="http://www.servicedenuages.fr/en/load-testing-a-http-api-which-uses-oauth-for-authentication" rel="alternate"></link><published>2015-12-02T00:00:00+01:00</published><updated>2015-12-02T00:00:00+01:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-12-02:/en/load-testing-a-http-api-which-uses-oauth-for-authentication</id><summary type="html">&lt;p class="first last"&gt;This is part 1 of a series on loadtesting oauth APIs explaining how to test the performance of an HTTP API when its access depends on an external OAuth service.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;This is part 1 of a series on loadtesting oauth APIs.&lt;/p&gt;
&lt;div class="section" id="what-is-oauth-and-how-do-you-use-it-to-authenticate-an-http-api"&gt;
&lt;h2&gt;What is OAuth and how do you use it to authenticate an HTTP API?&lt;/h2&gt;
&lt;p&gt;&lt;a class="reference external" href="https://en.wikipedia.org/wiki/OAuth"&gt;OAuth&lt;/a&gt; is a protocol that
allows a user delegate some of its permissions to a web service
through an identity provider.&lt;/p&gt;
&lt;p&gt;The user can be confident that the web service will never have their
user credentials (ID, password), instead it will get a Bearer Token
that is valid for a list of scopes and for a certain amount of time.&lt;/p&gt;
&lt;p&gt;In the app, the user click on a Sign-In button that will redirect it
to the Identity Provider login page with the list of scopes the app
needs.&lt;/p&gt;
&lt;p&gt;The user will enter her login credentials and validate the permission
list, once the credentials are correct, the Identity provider will
redirect the user to the app with the
&lt;a class="reference external" href="http://tools.ietf.org/html/rfc6750"&gt;Bearer tokens&lt;/a&gt; enclosed in the query string.&lt;/p&gt;
&lt;img alt="OAuth 2.0 Bearer Token creation flow" src="http://www.servicedenuages.fr/en/../images/oauth2-flow.png" style="width: 654px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;This Bearer Token will then be used by the app in the HTTP request
Authorization header to authenticate on the web service.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nf"&gt;GET&lt;/span&gt; &lt;span class="nn"&gt;/v1/articles&lt;/span&gt; &lt;span class="kr"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;1.1&lt;/span&gt;
&lt;span class="na"&gt;Authorization&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Bearer e7613cae7a0660dae7a2dd55c216cbaef75f43254e2a8c77f7e9c7adb549bb65&lt;/span&gt;
&lt;span class="na"&gt;Host&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;readinglist.services.mozilla.com&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="why-would-you-need-to-run-a-load-test"&gt;
&lt;h2&gt;Why would you need to run a load test?&lt;/h2&gt;
&lt;p&gt;After deploying an HTTP API you might be wondering how many users or
requests your deployment can take and what happens after it reaches
that number.&lt;/p&gt;
&lt;p&gt;Knowing the maximum load your service can handle is a great thing to
know!  It tells you when to start scaling up when your production
server is close to reaching that number of requests per second.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="so-what-s-so-complicated-about-oauth"&gt;
&lt;h2&gt;So, what's so complicated about OAuth?&lt;/h2&gt;
&lt;p&gt;Load testing a service that requires OAuth-based authentication means:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;having an OAuth account (often creating it)&lt;/li&gt;
&lt;li&gt;getting a Bearer Token with the right scopes&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Doing all this setup, will add a number of requests. Plus it will take
time to wait for the email with the activation account link.&lt;/p&gt;
&lt;p&gt;This can take a tremendous amount of time in the scope of a load test
which can slow down the all process and return inaccurate results.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="what-is-the-right-way-to-handle-this"&gt;
&lt;h2&gt;What is the right way to handle this?&lt;/h2&gt;
&lt;p&gt;During a load test, make sure that your are only doing requests on the
service you are load testing.&lt;/p&gt;
&lt;p&gt;If you are calling an identity provider or any other service during
the load test phases (either setup, tear down or scenario phase) your
load test performance will be impacted and will return inaccurate
results.&lt;/p&gt;
&lt;p&gt;You should be able to write your load test with simple cURL commands
toward your service.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="configuration-over-code"&gt;
&lt;h2&gt;Configuration over code&lt;/h2&gt;
&lt;p&gt;If your service needs Bearer tokens to be load tested, these Bearer
tokens should be provided to your load test code and not be generated
during the load test.&lt;/p&gt;
&lt;p&gt;This can be done by configuration, either within a file or with
environment variables.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="some-code-to-configure-your-load-test"&gt;
&lt;h2&gt;Some code to configure your load test&lt;/h2&gt;
&lt;p&gt;With regards to the kind of environment you want to run your load test
on (dev, stage, production), you may want to configure your load test
differently.&lt;/p&gt;
&lt;p&gt;For instance, you may want to create a specific account or use an
existing one.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="working-with-environment-variables"&gt;
&lt;h2&gt;Working with environment variables&lt;/h2&gt;
&lt;p&gt;It can be difficult to configure your load test code before running
it.&lt;/p&gt;
&lt;p&gt;One way to do it is to define environment variables that will be set
before and that will be read by your code.&lt;/p&gt;
&lt;p&gt;In order to define the environment variables you can write a Bash file
that you will be able to source before running your load test and that
will export all the needed environment variables.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;OAUTH_BEARER_TOKEN&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"dd7e6b6d0f4d44d0df5d6b73afdfbad41c48c4abdaba50e428ce070f9d4c75b5"&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There are also utilities that might help you there, for instance,
&lt;a class="reference external" href="https://docs.docker.com/engine/reference/run/#env-environment-variables"&gt;docker&lt;/a&gt;
might set them for you.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;docker run -e &lt;span class="nv"&gt;OAUTH_BEARER_TOKEN&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"abc..."&lt;/span&gt; loadtest
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="working-with-multiple-bearer-tokens"&gt;
&lt;h2&gt;Working with multiple Bearer Tokens&lt;/h2&gt;
&lt;p&gt;If you need to use multiple users, you can add other environment
variables.&lt;/p&gt;
&lt;p&gt;You can also set multiple users Bearer tokens using a comma-separated
list in the env variable and then split on it to choose one randomly
in your load test:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;OAUTH_BEARER_TOKEN&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;
&lt;span class="s2"&gt;    dd7e6b6d0f4d44d0df5d6b73afdfbad41c48c4abdaba50e428ce070f9d4c75b5,&lt;/span&gt;
&lt;span class="s2"&gt;    b6af04a44aa0f5a6b3a3affbaa41c48c4abaaba50e428ce030f9a4cb356aa36e,&lt;/span&gt;
&lt;span class="s2"&gt;    a44aa0f5a6b3a3affbaa41c1c48c4abaaba50e428ce030f9428ce070f9d4c75b&lt;/span&gt;
&lt;span class="s2"&gt;    "&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Or you also could create multiple environment variables:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;OAUTH_BEARER_TOKEN_SCOPE_PROFILE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"dd7e6b6d0f4d44d0df5d6b73afdfbad41c48c4abdaba50e428ce070f9d4c75b5"&lt;/span&gt;
&lt;span class="nb"&gt;export&lt;/span&gt; &lt;span class="nv"&gt;OAUTH_BEARER_TOKEN_SCOPE_KINTO&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"&lt;/span&gt;
&lt;span class="s2"&gt;    b6af04a44aa0f5a6b3a3affbaa41c48c4abaaba50e428ce030f9a4cb356aa36e,&lt;/span&gt;
&lt;span class="s2"&gt;    a44aa0f5a6b3a3affbaa41c1c48c4abaaba50e428ce030f9428ce070f9d4c75b&lt;/span&gt;
&lt;span class="s2"&gt;    "&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;I hope that after reading this article, you are not afraid anymore of
load testing OAuth-based services!&lt;/p&gt;
&lt;p&gt;Take-aways:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;You do not create the OAuth Bearer Token in your load test code.&lt;/li&gt;
&lt;li&gt;You can use configuration and for instance environment variables to
configure your load test Bearer Token.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a class="reference external" href="/en/load-testing-a-http-api-which-uses-oauth-for-authentication-part-2"&gt;The next article&lt;/a&gt;
will show some specific tools you can use to do this.&lt;/p&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>Kinto.js 1.0 released</title><link href="http://www.servicedenuages.fr/en/kinto-js-1-0-released" rel="alternate"></link><published>2015-10-27T00:00:00+01:00</published><updated>2015-10-27T00:00:00+01:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-10-27:/en/kinto-js-1-0-released</id><summary type="html">&lt;p class="first last"&gt;After months of development, we're proud to announce the release of Kinto.js 1.0.0 stable.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;a class="reference external" href="https://kintojs.readthedocs.io/"&gt;Kinto.js&lt;/a&gt; is an offline-first JavaScript client leveraging the &lt;a class="reference external" href="https://kinto.readthedocs.io/"&gt;Kinto API&lt;/a&gt; for data synchronization. In a world where connectivity isn't always guaranteed, local persistence in the browser has become an &lt;a class="reference external" href="http://offlinefirst.org/"&gt;identified priority&lt;/a&gt; for Web applications, especially on mobile.&lt;/p&gt;
&lt;p&gt;The basic principle is simple; save your data locally, assuming there's no network connectivity. Then as soon as it's available, retrieve remote changes and push your local data to a remote server.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;kinto&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Kinto&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="nx"&gt;remote&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"https://kinto.dev.mozaws.net/v1/"&lt;/span&gt;&lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;tasks&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;kinto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"tasks"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="nx"&gt;tasks&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;create&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;&lt;span class="nx"&gt;label&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"Test kinto.js"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;done&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;})&lt;/span&gt;
  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;_&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nx"&gt;tasks&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;sync&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
  &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;res&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;ok&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nx"&gt;alert&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"Data have been synchronized!"&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Local persistence in the browser is achieved using &lt;a class="reference external" href="https://www.w3.org/TR/IndexedDB/"&gt;IndexedDB&lt;/a&gt;, and we've tried hard to hide its inherent low-level usage complexity — mainly due to its fully asynchronous nature — through a simpler yet convenient &lt;a class="reference external" href="https://www.promisejs.org/"&gt;Promises&lt;/a&gt; based API.&lt;/p&gt;
&lt;p&gt;Kinto.js provides basic local CRUD operations for &lt;a class="reference external" href="https://kintojs.readthedocs.io/en/latest/api/#creating-a-record"&gt;creating&lt;/a&gt;, &lt;a class="reference external" href="https://kintojs.readthedocs.io/en/latest/api/#updating-a-record"&gt;updating&lt;/a&gt;, &lt;a class="reference external" href="https://kintojs.readthedocs.io/en/latest/api/#deleting-records"&gt;deleting&lt;/a&gt;, &lt;a class="reference external" href="https://kintojs.readthedocs.io/en/latest/api/#retrieving-a-single-record"&gt;retrieving&lt;/a&gt; and &lt;a class="reference external" href="https://kintojs.readthedocs.io/en/latest/api/#listing-records"&gt;listing&lt;/a&gt; records from a local collection. Each time you want to reflect its state to a remote server, you only ever have to &lt;a class="reference external" href="https://kintojs.readthedocs.io/en/latest/api/#fetching-and-publishing-changes"&gt;call the sync() method&lt;/a&gt;!&lt;/p&gt;
&lt;p&gt;We've set up a &lt;a class="reference external" href="https://kinto.github.io/kinto.js/"&gt;simple demo application&lt;/a&gt; using a public Mozilla test server instance, so you can check how it behaves by yourself if you're interested. The source code of this app is &lt;a class="reference external" href="https://github.com/Kinto/kinto.js/blob/66ef077796a8e4a8b0d9a95389a61ea57cbbfde3/demo/demo.js"&gt;available on Github&lt;/a&gt;, and is also the base use case for the &lt;a class="reference external" href="http://kintojs.readthedocs.io/en/latest/tutorial/"&gt;Kinto.js tutorial&lt;/a&gt; you should probably take if you want to get your feet wet.&lt;/p&gt;
&lt;div class="admonition note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;Please note that this public Kinto test server instance is flushed every morning at 7AM UTC, so don't rely on it for production use ;)&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="synchronizing-and-reconciling-data"&gt;
&lt;h2&gt;Synchronizing and reconciling data&lt;/h2&gt;
&lt;p&gt;Synchronizing local and remote data is a tough topic, and conflicts may occur quite easily if things are changing often from different sources (think multiple devices updating a same server); Kinto.js supports three distinct &lt;em&gt;synchronization strategies&lt;/em&gt; to handle such a situation:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;The server is authoritative: all conflicting records are overriden locally by their version from the server;&lt;/li&gt;
&lt;li&gt;The client is authoritative: all conflicting records are resolved using their local versions, and force-pushed to the server;&lt;/li&gt;
&lt;li&gt;No party is authoritative: the synchronization flow is halted, and all conflicting records are explicitely exposed, so developers can then decide how they want resolve each of them individually.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;You can read more about &lt;a class="reference external" href="https://kintojs.readthedocs.io/en/latest/api/#resolving-conflicts-manually"&gt;conflict resolution&lt;/a&gt; and &lt;a class="reference external" href="http://kintojs.readthedocs.io/en/latest/api/#synchronization-strategies"&gt;sychronization strategies&lt;/a&gt; in the dedicated sections of the project documentation.&lt;/p&gt;
&lt;p&gt;The diagram flow below describes pretty much accurately what's happening under the hood when &lt;tt class="docutils literal"&gt;sync()&lt;/tt&gt; is called:&lt;/p&gt;
&lt;img alt="Kinto.js synchronization flow" src="http://www.servicedenuages.fr/en/../images/kintojs-sync-flow.png" style="width: 654px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;div class="section" id="a-case-for-encryption"&gt;
&lt;h2&gt;A case for encryption&lt;/h2&gt;
&lt;p&gt;Remote data storage is certainly a topic raising concerns when it comes to security and privacy.&lt;/p&gt;
&lt;p&gt;To help addressing these issues, Kinto.js exposes a &lt;a class="reference external" href="http://kintojs.readthedocs.io/en/latest/api/#transformers"&gt;Remote Transformers API&lt;/a&gt;, which allow processing records before they're sent to the server and after they've been retrieved from it.&lt;/p&gt;
&lt;p&gt;This is a perfect hook for supporting end-to-end encryption, which &lt;a class="reference external" href="http://www.servicedenuages.fr/en/kinto-encryption-example"&gt;we already wrote about earlier&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="getting-started"&gt;
&lt;h2&gt;Getting started&lt;/h2&gt;
&lt;p&gt;We already mentioned the &lt;a class="reference external" href="http://kintojs.readthedocs.io/en/latest/tutorial/"&gt;Kinto.js tutorial&lt;/a&gt;, but there's more; we've created a rather opinionated  &lt;a class="reference external" href="https://github.com/Kinto/kinto-react-boilerplate"&gt;Kinto.js + React boilerplate&lt;/a&gt;, so you can bootstrap your next offline-first Web application in no time ;)&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="current-limitations"&gt;
&lt;h2&gt;Current limitations&lt;/h2&gt;
&lt;p&gt;We've listed Kinto.js current limitations — the ones we're aware of — in a &lt;a class="reference external" href="http://kintojs.readthedocs.io/en/latest/limitations/"&gt;dedicated section of the documentation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Sure, that's a bunch of work remaining, and you're obviously &lt;a class="reference external" href="http://kintojs.readthedocs.io/en/latest/hacking/"&gt;invited to contribute&lt;/a&gt; if you want to help!&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="the-future-of-kinto-js"&gt;
&lt;h2&gt;The future of Kinto.js&lt;/h2&gt;
&lt;p&gt;Of course 1.0 is a very first step towards a broader goal; foremost, we absolutely want to support bulk updates by taking advantage of IndexedDB transactions, for performance and consistency purposes.&lt;/p&gt;
&lt;p&gt;So stay tuned for next upcoming releases, and feel free to provide feedback on the &lt;a class="reference external" href="https://mail.mozilla.org/listinfo/kinto"&gt;project mailing-list&lt;/a&gt; or by &lt;a class="reference external" href="https://github.com/Kinto/kinto.js/issues/new"&gt;filing an issue on Github&lt;/a&gt; :)&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="update"&gt;
&lt;h2&gt;Update&lt;/h2&gt;
&lt;p&gt;We're not even done polishing this blog post and the &lt;a class="reference external" href="https://github.com/Kinto/kinto.js/releases/tag/v1.1.0"&gt;1.1 version is already there&lt;/a&gt;! Take it the easy way, that means the project is on steroids ;)&lt;/p&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>La difficile promesse de l'auto-hébergement</title><link href="http://www.servicedenuages.fr/en/../difficile-promesse-autohebergement" rel="alternate"></link><published>2015-10-05T00:00:00+02:00</published><updated>2015-10-05T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-10-05:/en/../difficile-promesse-autohebergement</id><summary type="html">&lt;p class="first last"&gt;Où il est question d'auto-hébergement, de déploiement et de décentralisation.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Au détour de quelques conversations, nous avons pu nous rendre compte que notre
vision de &lt;a class="reference external" href="https://kinto.readthedocs.io"&gt;Kinto&lt;/a&gt; est celle d'un hébergement
communautaire décentralisé plutôt que celle d'un ensemble de petits serveurs
personnels. Explications.&lt;/p&gt;
&lt;p&gt;Kinto veut répondre à deux besoins principaux de la plupart des utilisateurs du
Web : stocker et partager des données, sans que ceux-ci perdent le contrôle
sur leurs données.&lt;/p&gt;
&lt;p&gt;Si Kinto doit être une "base de données pour le Web", alors il est nécessaire
que l'ensemble des personnes puissent facilement avoir accès à un serveur
Kinto.&lt;/p&gt;
&lt;div class="section" id="auto-hebergement"&gt;
&lt;h2&gt;Auto-hébergement&lt;/h2&gt;
&lt;img alt="Maison de campagne -- House, Automn - CC-BY-ND Gunnar Magnusson https://www.flickr.com/photos/matupplevelser/4644386646" class="align-center" src="http://www.servicedenuages.fr/en/../images/autohebergement.jpg" style="width: 640px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Déployer des serveurs n'est pas actuellement chose aisée. Nombre
d'initiatives visent à rendre ce déploiement plus simple, mais les défis
techniques sont encore nombreux avant d'aboutir à une solution "plug and play"
qui soit aisément maintenable dans le temps.&lt;/p&gt;
&lt;p&gt;Les serveurs doivent être maintenus à jour pour éviter les failles de sécurité
et qu'ils restent disponibles pour ceux qui en ont besoin.&lt;/p&gt;
&lt;p&gt;On le voit bien sur nos systèmes déployés : il nous est nécessaire d'avoir
recours à des "administrateurs" pour ces tâches. Et croyez nous,
si ces interventions étaient facilement automatisables, elles le seraient
déjà ! (personne ne souhaite se lever au milieu de la nuit pour résoudre les
soucis des autres)&lt;/p&gt;
&lt;p&gt;Nous ne sommes malheureusement pas arrivés à un état de l'art qui permette à
tout un chacun de s'auto-héberger de manière simple et pérenne.&lt;/p&gt;
&lt;p&gt;Un réel travail est donc nécessaire afin d'avoir un service de qualité.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="acentre"&gt;
&lt;h2&gt;Acentré&lt;/h2&gt;
&lt;p&gt;Une solution praticable semble la mise en place d'un système avec plusieurs
centres, &lt;em&gt;acentré&lt;/em&gt;, donc décentralisé.&lt;/p&gt;
&lt;p&gt;Plutôt que d'avoir un seul endroit où les données sont stockées, on pourrait
imaginer avoir un ou plusieurs serveurs par communauté (Tetaneutral,
Framasoft, EFF, LUG de votre ville …), factorisant alors les coûts (humains et
monétaires) de mise en production. Cela permet donc d'administrer un seul
serveur pour plusieurs personnes / applications.&lt;/p&gt;
&lt;p&gt;Je vous vois, à deux doigts de bougonner : "Il est mignon avec ses serveurs
communautaires mais mes données personnelles je préfère quand même ne pas les
donner à n'importe qui !". Et vous auriez raison !&lt;/p&gt;
&lt;p&gt;Kinto permet de stocker n'importe quel type de données. Qu'il s'agisse de données
qui ont vocation à être partagées ou de données qui sont les vôtres et qui
doivent rester privées.&lt;/p&gt;
&lt;p&gt;Un de nos objectifs est de rendre le chiffrement des données extrêmement simple afin
que personne (sinon vous) ne soit capable de les lire.&lt;/p&gt;
&lt;p&gt;Kinto.js le permet d'ailleurs d'ores et déjà, comme Michiel le démontre &lt;a class="reference external" href="http://www.servicedenuages.fr/en/../kinto-chiffrer-ses-donnees"&gt;dans
un article paru précedemment ici&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="eviter-la-creation-d-un-nouveau-silo"&gt;
&lt;h2&gt;Éviter la création d'un nouveau silo&lt;/h2&gt;
&lt;img alt="Le futur des silos - CC-BY-NC-ND Sunflower Silo in Boulder County Colorado by Bo Insogna — https://www.flickr.com/photos/thelightningman/5494666930" class="align-center" src="http://www.servicedenuages.fr/en/../images/silo.jpg" style="width: 640px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Afin d'éviter de participer à la création d'un nouveau silo, il est important
de lever quelques points de vigilance :&lt;/p&gt;
&lt;div class="section" id="identite"&gt;
&lt;h3&gt;Identité&lt;/h3&gt;
&lt;p&gt;Un des points qui permet aux silos actuels (Facebook, Twitter) de perdurer,
c'est en partie leur système d'identification. Vous souhaitez partager des
données avec votre cousine, mais vous n'avez que son "compte Facebook" pour la
joindre.&lt;/p&gt;
&lt;p&gt;C'est très certainement un fait malheureux, mais tentons de résoudre un
problème à la fois (malheureusement, la tentative d'identité décentralisé —
Mozilla Persona — bât sérieusement de l'aile).&lt;/p&gt;
&lt;p&gt;Laissons donc les personnes s'authentifier avec la solution de leur choix,
libre ou non (OpenID, Firefox Accounts, Github, Twitter, Facebook etc.) &lt;em&gt;mais&lt;/em&gt;
redonnons leur le choix de l'endroit ou leurs données sont, elles, stockées.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="interoperabilite"&gt;
&lt;h3&gt;Interopérabilité&lt;/h3&gt;
&lt;p&gt;Peu importe la solution de stockage de données que vous choisissez, il est
indispensable qu'il existe des interfaces, des formats, pour passer de l'une
à l'autre.&lt;/p&gt;
&lt;p&gt;Kinto expose (avant tout) une API HTTP (certains diraient RESTful) qui parle
JSON, ce qui rend son intégration avec d'autres solutions aisée.&lt;/p&gt;
&lt;p&gt;Dans un premier temps, cela peut être simplement des fonctionnalités
d'import / export d'une solution vers une autre, mais il est préférable de se
mettre d'accord sur un format pour cet échange, sans quoi un standard
&lt;em&gt;de facto&lt;/em&gt; émergera, pour le meilleur et pour le pire !&lt;/p&gt;
&lt;p&gt;Il est donc primordial d'entamer un travail de collaboration
avec les autres systèmes de "clouds privés" tels que OwnCloud ou CozyCloud.&lt;/p&gt;
&lt;p&gt;Ces derniers ont d'ailleurs mis en place &lt;a class="reference external" href="https://github.com/Decentralized-Sharing-Working-Group/internet-draft"&gt;un groupe de
travail&lt;/a&gt;
sur le sujet, qui vise à utiliser MicroPub et WebMention comme briques de départ.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="decentralisation"&gt;
&lt;h3&gt;Décentralisation&lt;/h3&gt;
&lt;p&gt;La mise en place de serveurs communautaires n'empêche bien sûr pas l'utilisation
de serveurs personnels pour les utilisateurs les plus aguerris.&lt;/p&gt;
&lt;p&gt;Dans un tel cas, les serveurs communautaires peuvent alors servir de sauvegarde,
en cas de défaillance des serveurs personnels (ou vice-versa, les serveurs
personnels pouvant redonder les serveurs communautaires).&lt;/p&gt;
&lt;p&gt;Il est tout à fait imaginable d'avoir des petits serveurs Kinto pour
chaque utilisateur, mais il va falloir procéder par étapes et défricher le
terrain avant d'avoir un &lt;em&gt;one click&lt;/em&gt; pour &lt;em&gt;Tatie Jeannine&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;La clé ici est sans doute l'essaimage : commencez à utiliser le serveur Kinto
de Framasoft (ou autre) puis migrez vers votre propre serveur, une fois
l'ensemble des problèmes techniques (évoqués précédemment) résolus.&lt;/p&gt;
&lt;p&gt;En attendant, une approche reposant sur plusieurs communautés semble être une
solution pragmatique sur le court/moyen terme, rendant certaines libertés
aux utilisateurs et ouvrant la voie pour le futur.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</content></entry><entry><title>Looking for an Outreachy intern this winter</title><link href="http://www.servicedenuages.fr/en/outreach-kinto-2016" rel="alternate"></link><published>2015-10-01T00:00:00+02:00</published><updated>2015-10-01T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-10-01:/en/outreach-kinto-2016</id><summary type="html">&lt;p class="first last"&gt;This year we are participating to the GNOME Outreachy program with our
Kinto project, in order to make instances discoverable. Please, join in!&lt;/p&gt;
</summary><content type="html">&lt;blockquote class="epigraph"&gt;
&lt;p&gt;By having a program targeted specifically towards women, we found that we
reached talented and passionate participants, who were uncertain about how to
start otherwise.&lt;/p&gt;
&lt;p&gt;We are now expanding the program to people from more groups underrepresented
in FOSS. We hope this effort will help many people learn how exciting, varied
and valuable work on FOSS projects can be and how inclusive the community
really is.&lt;/p&gt;
&lt;p class="attribution"&gt;—&lt;a class="reference external" href="https://wiki.gnome.org/Outreachy"&gt;The GNOME Outreachy program wiki&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;In our team, and at Mozilla in general, we thrive to build an inclusive
community. And we believe being more inclusive starts by reaching to the people
who are often underrepresented in tech.&lt;/p&gt;
&lt;p&gt;That's why we are participating in the GNOME Outreachy program this year by
proposing an internship around Kinto and making instances discoverable.&lt;/p&gt;
&lt;p&gt;Check out the eligibility details at the end of the article if you're
interested!&lt;/p&gt;
&lt;div class="section" id="making-kinto-instances-discoverable"&gt;
&lt;h2&gt;Making Kinto instances discoverable&lt;/h2&gt;
&lt;p&gt;The &lt;a class="reference external" href="https://kinto.readthedocs.io"&gt;Kinto project&lt;/a&gt; aims to bring storage
instances to everyone, attached to their
&lt;a class="reference external" href="https://accounts.firefox.com"&gt;Firefox Accounts&lt;/a&gt; (Well, it actually supports
multiple authentication schemes, but we want to promote Firefox Accounts as a
first step).&lt;/p&gt;
&lt;p&gt;Currently, Kinto is thought of as a centralised server: there is one instance, and
everyone authenticates on this instance. Items are shared between users of a
same instance.&lt;/p&gt;
&lt;p&gt;This doesn't resonate well with many of our goals: scalability is harder
when there is one endpoint, and it's also not interoperable.&lt;/p&gt;
&lt;p&gt;For instance, imagine Alice and Bob. Bob is using Mozilla's servers to store
his data, whereas Alice deployed her own Kinto instance.&lt;/p&gt;
&lt;p&gt;There are different use cases:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Alice wants to use &lt;a class="reference external" href="https://github.com/leplatrem/routina"&gt;Routina&lt;/a&gt;, an
application that stores its data inside a Kinto instance. As such, Routina
needs a way to discover where it should store its data, and send the requests
to this server.&lt;/li&gt;
&lt;li&gt;Bob and Alice want to collaborate on a set of data (think about a webapp to
manage their shared expenses). There should be a way for Alice to host
everything and grant access to Bob on her data. The webapp should be able to
use the correct server.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Here are the different steps that could allow these scenarios:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;At the moment they authenticate, the client detects the email address used,
and relies on the domain part to do a
&lt;a class="reference external" href="https://tools.ietf.org/html/rfc7033"&gt;Web Finger&lt;/a&gt; request on the domain
&lt;a class="footnote-reference" href="#id2" id="id1"&gt;[1]&lt;/a&gt; and for the specified user.&lt;/li&gt;
&lt;li&gt;In case the identified server doesn't support WebFinger, it uses a central
repository to lookup where the Kinto server is located.&lt;/li&gt;
&lt;li&gt;Once the Kinto server is located, all requests should be issued against this
server.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In terms of code changes, here is what it looks like (rough step by step). The
details are still to be fleshed out - this is a rough first version:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Update the &lt;a class="reference external" href="https://github.com/Kinto/kinto.js"&gt;Kinto.js client&lt;/a&gt; to find the
server location. It should first rely on WebFinger.&lt;/li&gt;
&lt;li&gt;Create a central repository of server locations. This could be contained in
the FxA profile server or in a central Kinto collection.&lt;/li&gt;
&lt;li&gt;Update the Kinto.js client to fall-back to this central repository in case no
Web Finger exists.&lt;/li&gt;
&lt;li&gt;Investigate on ways to store this information directly in the web browser.
It could also be configurable by the JavaScript client (with
an UX that looks like &lt;a class="reference external" href="https://remotestorage.io/"&gt;what Remote Storage proposes&lt;/a&gt;).&lt;/li&gt;
&lt;li&gt;Work on the first user experience: how can client learn they can chose which
server to use?&lt;/li&gt;
&lt;li&gt;Ship it!&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="want-to-join"&gt;
&lt;h2&gt;Want to join?&lt;/h2&gt;
&lt;p&gt;So, if you think that this project is exciting and you would like to join,
please check that you:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Identify as a woman (cis or trans), a trans man, or genderqueer person or you
are a resident or national of the United States of any gender who is
Black/African American, Hispanic/Latin@, American Indian, Alaska Native,
Native Hawaiian, or Pacific Islander;&lt;/li&gt;
&lt;li&gt;Are or will be 18 years of age or older by December 7, 2015;&lt;/li&gt;
&lt;li&gt;Are available for a full-time, 40 hours a week internship between
December and March.&lt;/li&gt;
&lt;li&gt;Think that open source software makes a difference, and would like to work
with us on going further with making a kick-ass Kinto ecosystem;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Check the eligibility details &lt;a class="reference external" href="https://wiki.gnome.org/Outreachy#Program_Details"&gt;on the section of the GNOME wiki&lt;/a&gt; and get it touch with us!&lt;/p&gt;
&lt;p&gt;If you are not sure how to get started, the best way is to start reading &lt;a class="reference external" href="https://kinto.readthedocs.io"&gt;the
documentation&lt;/a&gt;, especially
&lt;a class="reference external" href="http://kinto.readthedocs.io/en/latest/tutorials/first-steps.html"&gt;the tutorials&lt;/a&gt;
and then reach out to us by joining the
&lt;a class="reference external" href="https://mail.mozilla.org/listinfo/kinto"&gt;Kinto development mailing list&lt;/a&gt; and
the &lt;cite&gt;#storage&lt;/cite&gt; channel on irc.mozilla.org.&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id2" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;It is also possible to use the same mechanism to discover the FxA
endpoints. But as FxA isn't a federated protocol, users from one FxA
realm would need to be explicitely accepted by the Kinto server, in its
configuration.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>How to encrypt data with Kinto.js</title><link href="http://www.servicedenuages.fr/en/kinto-encryption-example" rel="alternate"></link><published>2015-09-16T00:00:00+02:00</published><updated>2015-09-16T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-09-16:/en/kinto-encryption-example</id><summary type="html">&lt;p class="first last"&gt;How to encrypt data with Kinto.js.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;A guest post this time, by &lt;a class="reference external" href="https://michielbdejong.com/"&gt;Michiel de Jong&lt;/a&gt;
from the Firefox OS team!&lt;/p&gt;
&lt;p&gt;If you want to encrypt data that is uploaded to the cloud by an offline-first app,
it makes sense to keep the local copy of the data in-the-clear, and encrypt the
data only just before it is uploaded. That way, you can easily and efficiently display
and update the local copy of the data, without the repeated cost of encrypting
and decrypting everything all the time. Likewise, you only need to decrypt incoming data
once, when it's downloaded, and your app can then display the data as often as
needed without extra processing costs.&lt;/p&gt;
&lt;p&gt;Syncing data to and from "the cloud" is a science in itself, and
&lt;a class="reference external" href="https://github.com/Kinto/kinto.js"&gt;Kinto.js&lt;/a&gt; is a brilliant tool for this, developed
by the equally brilliant Mozilla Services team. It's nearing its 1.0 release, and you'll
hear a lot more about it on this blog in the future.&lt;/p&gt;
&lt;p&gt;It so happens that Kinto.js now supports
&lt;a class="reference external" href="http://kintojs.readthedocs.io/en/latest/api/#transformers"&gt;RemoteTransformers&lt;/a&gt;,
which are superhandy for any type of transformation you may want to do on your data
before it is saved into the locally cached copy (&lt;tt class="docutils literal"&gt;RemoteTransformer#decode&lt;/tt&gt;), and before it is uploaded to the
remote server (&lt;tt class="docutils literal"&gt;RemoteTransformer#encode&lt;/tt&gt;).&lt;/p&gt;
&lt;p&gt;This blogpost shows how to use a &lt;tt class="docutils literal"&gt;RemoteTransformer&lt;/tt&gt; for encrypting your data just
before it's sent to the cloud. It uses WebCrypto for the cryptography.&lt;/p&gt;
&lt;p&gt;Note that I am not a security expert and this is just an example I wrote in an afternoon, so
if you're going to copy-paste this code, please don't use it for anything
valuable without doing your own proper security review first! :) For instance, it does
not do any key stretching etcetera, it's just a very basic encrypt/decrypt
proof-of-concept.&lt;/p&gt;
&lt;p&gt;The main idea behind a &lt;tt class="docutils literal"&gt;RemoteTransformer&lt;/tt&gt; is that you provide two functions,
&lt;tt class="docutils literal"&gt;encode&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;decode&lt;/tt&gt;, and Kinto.js makes sure to call the encode function on
each record that gets uploaded, and to call the decode function on each record
that gets downloaded. You can also read about this
&lt;a class="reference external" href="http://kintojs.readthedocs.io/en/latest/api/#transformers"&gt;in the Kinto.js documentation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The way we tell Kinto.js that we want to use our custom
&lt;tt class="docutils literal"&gt;encode&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;decode&lt;/tt&gt; procedures, is quite simple. When creating a Kinto
collection, we pass a &lt;tt class="docutils literal"&gt;RemoteTransformer&lt;/tt&gt; as a collection-level option. The full
code example is
&lt;a class="reference external" href="/scripts/kinto-encryption-example.js"&gt;here&lt;/a&gt; (note that it only works with
&lt;a class="reference external" href="/scripts/kinto-61ad959.min.js"&gt;latest Kinto.js master&lt;/a&gt;),
but let's walk through the code step-by-step.&lt;/p&gt;
&lt;p&gt;If you're unfamiliar with ES6, you may be surprised by some of this syntax; so let's
take this opportunity to get used to it! Here's a little translation:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://babeljs.io/docs/learn-es2015/#arrows-and-lexical-this"&gt;() =&amp;gt; {}&lt;/a&gt; is similar to &lt;tt class="docutils literal"&gt;(function() &lt;span class="pre"&gt;{}).bind(this)&lt;/span&gt;&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://babeljs.io/docs/learn-es2015/#let-const"&gt;const foo = 'bar'; let foo = 'bar';&lt;/a&gt; are similar to &lt;tt class="docutils literal"&gt;var foo = 'bar'&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://babeljs.io/docs/learn-es2015/#enhanced-object-literals"&gt;{ a, b }&lt;/a&gt; is similar to &lt;tt class="docutils literal"&gt;{ a: a, b: b }&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://babeljs.io/docs/learn-es2015/#template-strings"&gt;`Hello ${foo}`&lt;/a&gt; (note the backticks) is similar to &lt;tt class="docutils literal"&gt;'Hello ' + foo&lt;/tt&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;First, we need a few helper functions, which will be used later on to convert between
&lt;a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Typed_arrays"&gt;byte arrays&lt;/a&gt;
and ASCII strings.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;// Helper functions:&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;rawStringToByteArray&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;str&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;strLen&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;str&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;byteArray&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;strLen&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nx"&gt;strLen&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;byteArray&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;str&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;charCodeAt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;byteArray&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;base64StringToByteArray&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;base64&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;rawStringToByteArray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;atob&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;base64&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;byteArrayToBase64String&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;bytes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;binary&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;''&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;bytes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;byteLength&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nx"&gt;binary&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="nb"&gt;String&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;fromCharCode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;bytes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;btoa&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;binary&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Next, we need to create a &lt;tt class="docutils literal"&gt;RemoteTransformer&lt;/tt&gt; that can encode and decode records. And for
that, we need to generate an
&lt;a class="reference external" href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard"&gt;AES&lt;/a&gt; key.
&lt;a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto"&gt;WebCrypto&lt;/a&gt; is a
fairly new part of &lt;a class="reference external" href="https://platform.html5.org/"&gt;the web platform&lt;/a&gt; and it's awesome.
We will use that key to encrypt and decrypt
the data that is passed through the &lt;tt class="docutils literal"&gt;RemoteTransformer&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;// RemoteTransformer:&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;generateAesKey&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="c1"&gt;// See http://www.w3.org/TR/WebCryptoAPI/#examples-symmetric-encryption&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;crypto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;subtle&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;generateKey&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'AES-GCM'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;128&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt;
       &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'encrypt'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'decrypt'&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;

&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;createTransformer&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;aesKey&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;encode&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;cleartext&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;rawStringToByteArray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;stringify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;IV&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;crypto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getRandomValues&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;crypto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;subtle&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;encrypt&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'AES-GCM'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;iv&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;IV&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="nx"&gt;aesKey&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nx"&gt;cleartext&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;ciphertext&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;id&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nx"&gt;ciphertext&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;byteArrayToBase64String&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;ciphertext&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
        &lt;span class="nx"&gt;IV&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;byteArrayToBase64String&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;IV&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;};&lt;/span&gt;
    &lt;span class="p"&gt;});&lt;/span&gt;
  &lt;span class="p"&gt;};&lt;/span&gt;

  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;decode&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;ciphertext&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;base64StringToByteArray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;ciphertext&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;IV&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;base64StringToByteArray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;IV&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;crypto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;subtle&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;decrypt&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'AES-GCM'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;iv&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;IV&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="nx"&gt;aesKey&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nx"&gt;ciphertext&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;recordArrayBuffer&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;

      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;String&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;fromCharCode&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;apply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
          &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;recordArrayBuffer&lt;/span&gt;&lt;span class="p"&gt;)));&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;undecryptable&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;});&lt;/span&gt;
  &lt;span class="p"&gt;};&lt;/span&gt;

  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;decode&lt;/span&gt;
  &lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We create two Kinto instances, so that we can test syncing from one instance
to the other, via the public Kinto demo instance on AWS. Creating multiple Kinto
instances within the same origin is now possible with the recently added
&lt;tt class="docutils literal"&gt;dbPrefix&lt;/tt&gt; option:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;// Kinto collection:&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;createCollection&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;transformer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;testRun&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;instanceNo&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;kinto&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Kinto&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
    &lt;span class="nx"&gt;dbPrefix&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nx"&gt;testRun&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="sb"&gt;-&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nx"&gt;instanceNo&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;remote&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'https://kinto.dev.mozaws.net/v1/'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nx"&gt;Authorization&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'Basic '&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;btoa&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'public-demo:s3cr3t'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;

  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;kinto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sb"&gt;`kinto-encryption-example-&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nx"&gt;testRun&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;remoteTransformers&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nx"&gt;transformer&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;

&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;coll1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;coll2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;prepare&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;generateAesKey&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;aesKey&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;createTransformer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;aesKey&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;transformer&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// Create two fresh empty Kinto instances for testing:&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;testRun&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nb"&gt;Date&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;getTime&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
    &lt;span class="nx"&gt;coll1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;createCollection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;transformer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;testRun&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nx"&gt;coll2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;createCollection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;transformer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;testRun&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now, let's test if we can create an item in collection 1, sync it up (the data
should be encrypted on the wire, we can check that on the Network tab of the
browser console):&lt;/p&gt;
&lt;img alt="Network tab screenshot" src="http://www.servicedenuages.fr/en/../images/kinto-encryption-example-network-tab.png" style="width: 2560px; height: auto; max-width: 100%;"/&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;syncUp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="c1"&gt;// Use first Kinto instance to demonstrate encryption:&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;coll1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;create&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
    &lt;span class="nx"&gt;URL&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'http://www.w3.org/TR/WebCryptoAPI/'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'Web Cryptography API'&lt;/span&gt;
  &lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;coll1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;sync&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
  &lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;syncResults&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Sync up'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;syncResults&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And sync it down from the cloud again using collection 2. Again, the data
coming in on the wire should be encrypted, but the decrypted results should
show up in the sync results. And finally, a 'go()' method to put it all together.&lt;/p&gt;
&lt;p&gt;The full source code is included in a script tag on this page you're reading right
now, so go ahead and try opening your browser console on this page to try it out!&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;syncDown&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="c1"&gt;// Use second Kinto instance to demonstrate decryption:&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;coll2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;sync&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;syncResults&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Sync down'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;syncResults&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;

&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;go&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Watch the Network tab!'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;prepare&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
      &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;syncUp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;syncDown&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;a&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Success'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;a&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
            &lt;span class="nx"&gt;b&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Failure'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;b&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Type go(); to start!'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Hope you are as excited about Kinto.js as I am, comments below this blogpost
and github issues on the example code very welcome! :)&lt;/p&gt;
</content><category term="mozilla"></category></entry><entry><title>Comment chiffrer ses données avec Kinto.js</title><link href="http://www.servicedenuages.fr/en/../kinto-chiffrer-ses-donnees" rel="alternate"></link><published>2015-09-16T00:00:00+02:00</published><updated>2015-09-16T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-09-16:/en/../kinto-chiffrer-ses-donnees</id><summary type="html">&lt;p class="first last"&gt;Comment utiliser Kinto.js pour chiffrer ses données dans Kinto.&lt;/p&gt;
</summary><content type="html">&lt;div class="admonition note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;Traduit de l'anglais par &lt;a class="reference external" href="https://twitter.com/Natim"&gt;Rémy Hubscher&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Voici un article rédigé par &lt;a class="reference external" href="https://michielbdejong.com/"&gt;Michiel de Jong&lt;/a&gt; de l'équipe Firefox OS.&lt;/p&gt;
&lt;p&gt;Lorsqu'on souhaite sauvegarder les données d'une application
"Offline-first" (qui fonctionne normalement hors connexion) de manière
chiffrée dans le cloud, il est raisonnable de les garder déchiffrées
localement et de les chiffrer uniquement avant de les téléverser vers
un serveur distant.&lt;/p&gt;
&lt;p&gt;Ainsi, il est facile et efficace d'y accéder pour les afficher ou
mettre à jour la copie locale, sans avoir le coût répété de les
chiffrer/déchiffrer à chaque opération.&lt;/p&gt;
&lt;p&gt;De la même manière, on peut déchiffrer les données venant du serveur
une seule fois, tout de suite après les avoir téléchargées et
l'application peut ensuite afficher les données aussi souvent que
nécessaire sans coût de calculs supplémentaires.&lt;/p&gt;
&lt;p&gt;Synchroniser les données d'une telle application vers et depuis "le
cloud" est une science en elle-même et &lt;a class="reference external" href="https://github.com/Kinto/kinto.js"&gt;Kinto.js&lt;/a&gt; est un outil brillant pour le
faire, développé par la toute aussi brillante équipe du Service de
nuages de Mozilla. La release 1.0 ne devrait plus tarder et vous en
saurez sûrement plus sur ce blog très prochainement.&lt;/p&gt;
&lt;p&gt;Il se trouve que Kinto.js supporte maintenant les &lt;a class="reference external" href="http://kintojs.readthedocs.io/en/latest/api/#transformers"&gt;RemoteTransformers&lt;/a&gt;, qui
permettent de manière très simple d'appliquer n'importe quel type de
transformations que vous souhaitez faire sur les enregistrements d'une
collection avant qu'ils ne soient stockés dans la base de données
locale (&lt;tt class="docutils literal"&gt;RemoteTransformer#decode&lt;/tt&gt;) mais aussi avant qu'ils ne
soient sauvegardés sur le serveur distant
(&lt;tt class="docutils literal"&gt;RemoteTransformer#encode&lt;/tt&gt;).&lt;/p&gt;
&lt;p&gt;Cet article de blog montre comment utiliser un &lt;tt class="docutils literal"&gt;RemoteTransformer&lt;/tt&gt;
pour chiffrer vos données juste avant de les envoyer dans les
nuages. De plus nous utilisons l'API
&lt;a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto"&gt;WebCrypto&lt;/a&gt;
pour la partie cryptographie.&lt;/p&gt;
&lt;p&gt;Notez que je ne suis pas un expert en sécurité et que ce code est
simplement un exemple écrit en une après-midi. Si vous copiez/collez
ce code, ne l'utilisez pas pour quoi que ce soit de sensible sans
avoir fait votre propre revue de sécurité au préalable ! :) Par
exemple il n'y a aucune dérivation de la clé de chiffrement, etc.,
c'est uniquement un chiffrement/déchiffrement très basique pour la
démonstration.&lt;/p&gt;
&lt;p&gt;L'idée derrière un &lt;tt class="docutils literal"&gt;RemoteTransformer&lt;/tt&gt; c'est d'exposer deux
fonctions, &lt;tt class="docutils literal"&gt;encode&lt;/tt&gt; et &lt;tt class="docutils literal"&gt;decode&lt;/tt&gt;, et Kinto.js s'assure d'appeler la
fonction &lt;tt class="docutils literal"&gt;encode&lt;/tt&gt; sur chaque enregistrement qui est téléversé dans
le cloud et d'appeler &lt;tt class="docutils literal"&gt;decode&lt;/tt&gt; sur chaque enregistrement
téléchargé. Vous pouvez en lire plus à ce sujet
&lt;a class="reference external" href="http://kintojs.readthedocs.io/en/latest/api/#transformers"&gt;dans la documentation de Kinto.js&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;La manière dont nous indiquons à Kinto.js d'utiliser nos fonctions
&lt;tt class="docutils literal"&gt;encode&lt;/tt&gt; et &lt;tt class="docutils literal"&gt;decode&lt;/tt&gt; est assez simple. Lorsqu'on créé une
collection Kinto, on passe en paramètre un &lt;tt class="docutils literal"&gt;RemoteTransformer&lt;/tt&gt;. Le
code d'exemple complet se trouve &lt;a class="reference external" href="http://www.servicedenuages.fr/en/../scripts/kinto-encryption-example.js"&gt;ici&lt;/a&gt;
(notez qu'il ne fonctionne pour l'instant qu'avec
&lt;a class="reference external" href="http://www.servicedenuages.fr/en/../scripts/kinto-61ad959.min.js"&gt;la dernière version de Kinto.js master&lt;/a&gt;),
mais regardons le code étape par étape.&lt;/p&gt;
&lt;p&gt;Si vous n'êtes pas familier avec ES6, vous pouvez être un peu surpris par sa syntaxe ; utilisons cette opportunité pour nous y habituer ! Voici une petite table de correspondance :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="http://babeljs.io/docs/learn-es2015/#arrows-and-lexical-this"&gt;() =&amp;gt; {}&lt;/a&gt; correspond à &lt;tt class="docutils literal"&gt;(function() &lt;span class="pre"&gt;{}).bind(this)&lt;/span&gt;&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://babeljs.io/docs/learn-es2015/#let-const"&gt;const foo = 'bar'; let foo = 'bar';&lt;/a&gt; correspondent à &lt;tt class="docutils literal"&gt;var foo = 'bar'&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://babeljs.io/docs/learn-es2015/#enhanced-object-literals"&gt;{ a, b }&lt;/a&gt; correspond à &lt;tt class="docutils literal"&gt;{ a: a, b: b }&lt;/tt&gt;.&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://babeljs.io/docs/learn-es2015/#template-strings"&gt;`Hello ${foo}`&lt;/a&gt; (notez les backticks) correspond à &lt;tt class="docutils literal"&gt;'Hello ' + foo&lt;/tt&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pour commencer, nous avons besoin de quelques fonctions utilitaires
que nous utiliserons plus tard pour convertir des &lt;a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Typed_arrays"&gt;byte arrays&lt;/a&gt;
en chaînes de caractères ASCII et inversemment.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;// Helper functions:&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;rawStringToByteArray&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;str&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;strLen&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;str&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;byteArray&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;strLen&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="nx"&gt;strLen&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;byteArray&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;str&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;charCodeAt&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;byteArray&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;base64StringToByteArray&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;base64&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;rawStringToByteArray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;atob&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;base64&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;byteArrayToBase64String&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;bytes&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;buffer&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;binary&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;''&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="nx"&gt;bytes&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;byteLength&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nx"&gt;binary&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="nb"&gt;String&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;fromCharCode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;bytes&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nx"&gt;i&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;btoa&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;binary&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ensuite, nous devons créer un &lt;tt class="docutils literal"&gt;RemoteTransformer&lt;/tt&gt; qui peut chiffrer et déchiffrer nos enregistrements. Et pour cela, nous avons besoin de générer une clé de chiffrement symétrique
&lt;a class="reference external" href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard"&gt;AES&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto"&gt;WebCrypto&lt;/a&gt; est
une API vraiment géniale et assez récente de
&lt;a class="reference external" href="https://platform.html5.org/"&gt;la plateforme web&lt;/a&gt;  !
Nous allons utiliser cette clé de chiffrement pour
chiffrer et déchiffrer les données qui vont passer dans notre
&lt;tt class="docutils literal"&gt;RemoteTransformer&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;// RemoteTransformer:&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;generateAesKey&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="c1"&gt;// See http://www.w3.org/TR/WebCryptoAPI/#examples-symmetric-encryption&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;crypto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;subtle&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;generateKey&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'AES-GCM'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;length&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;128&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt;
       &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'encrypt'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'decrypt'&lt;/span&gt;&lt;span class="p"&gt;]);&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;

&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;createTransformer&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;aesKey&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;encode&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;cleartext&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;rawStringToByteArray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;stringify&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;IV&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;crypto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;getRandomValues&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;window&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;crypto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;subtle&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;encrypt&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'AES-GCM'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;iv&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;IV&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="nx"&gt;aesKey&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nx"&gt;cleartext&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;ciphertext&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="nx"&gt;id&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nx"&gt;ciphertext&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;byteArrayToBase64String&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;ciphertext&lt;/span&gt;&lt;span class="p"&gt;)),&lt;/span&gt;
        &lt;span class="nx"&gt;IV&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;byteArrayToBase64String&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;IV&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;};&lt;/span&gt;
    &lt;span class="p"&gt;});&lt;/span&gt;
  &lt;span class="p"&gt;};&lt;/span&gt;

  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;decode&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;ciphertext&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;base64StringToByteArray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;ciphertext&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;IV&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;base64StringToByteArray&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;IV&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;crypto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;subtle&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;decrypt&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt; &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'AES-GCM'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;iv&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="nx"&gt;IV&lt;/span&gt; &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="nx"&gt;aesKey&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nx"&gt;ciphertext&lt;/span&gt;&lt;span class="p"&gt;).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;recordArrayBuffer&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;

      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;JSON&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;parse&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;String&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;fromCharCode&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;apply&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;null&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
          &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Uint8Array&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;recordArrayBuffer&lt;/span&gt;&lt;span class="p"&gt;)));&lt;/span&gt;
    &lt;span class="p"&gt;},&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;undecryptable&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;record&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;});&lt;/span&gt;
  &lt;span class="p"&gt;};&lt;/span&gt;

  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;decode&lt;/span&gt;
  &lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Nous créons deux instances Kinto, afin de pouvoir faire des tests de
synchronisation d'une instance à l'autre à l'aide du serveur de démo
de Kinto. Créer plusieurs instances Kinto depuis la même origine est
possible à l'aide de la toute récente option &lt;tt class="docutils literal"&gt;dbPrefix&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;// Kinto collection:&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;createCollection&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;transformer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;testRun&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;instanceNo&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;kinto&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;Kinto&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
    &lt;span class="nx"&gt;dbPrefix&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nx"&gt;testRun&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="sb"&gt;-&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nx"&gt;instanceNo&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;remote&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'https://kinto.dev.mozaws.net/v1/'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="nx"&gt;Authorization&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'Basic '&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="nx"&gt;btoa&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'public-demo:s3cr3t'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;

  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;kinto&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;collection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="sb"&gt;`kinto-encryption-example-&lt;/span&gt;&lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nx"&gt;testRun&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;&lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;remoteTransformers&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt; &lt;span class="nx"&gt;transformer&lt;/span&gt; &lt;span class="p"&gt;]&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;

&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;coll1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;coll2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;prepare&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;generateAesKey&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;aesKey&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;createTransformer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;aesKey&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;transformer&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;// Create two fresh empty Kinto instances for testing:&lt;/span&gt;
    &lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;testRun&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nb"&gt;Date&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;getTime&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;toString&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
    &lt;span class="nx"&gt;coll1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;createCollection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;transformer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;testRun&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
    &lt;span class="nx"&gt;coll2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nx"&gt;createCollection&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;transformer&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;testRun&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Maintenant, testons que nous puissions créer un nouvel enregistrement
dans la collection 1, synchronisons-le (les données envoyées au
serveur doivent être chiffrées, ce qu'on peut vérifier avec l'onglet
Réseau de la console du navigateur):&lt;/p&gt;
&lt;img alt="Onglet Réseau de la console Firefox" src="http://www.servicedenuages.fr/en/../images/kinto-encryption-example-network-tab.png" style="width: 2560px; height: auto; max-width: 100%;"/&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;syncUp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="c1"&gt;// Use first Kinto instance to demonstrate encryption:&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;coll1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;create&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
    &lt;span class="nx"&gt;URL&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'http://www.w3.org/TR/WebCryptoAPI/'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'Web Cryptography API'&lt;/span&gt;
  &lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(()&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;coll1&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;sync&lt;/span&gt;&lt;span class="p"&gt;();&lt;/span&gt;
  &lt;span class="p"&gt;}).&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;syncResults&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Sync up'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;syncResults&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Puis synchronisons la collection 2 depuis le serveur Kinto. Là encore,
les données téléchargées doivent être chiffrées mais les données
déchiffrées doivent être stockées dans la base IndexDB et affichées
dans le résultat de la synchronisation. Finalement, la fonction
&lt;tt class="docutils literal"&gt;go()&lt;/tt&gt; permet de lancer tout le processus de test.&lt;/p&gt;
&lt;p&gt;Le code source complet est inclus dans la page que vous êtes
actuellement en train de lire, alors n'hésitez-pas, ouvrez la console
du navigateur et essayez en lançant la fonction &lt;tt class="docutils literal"&gt;go()&lt;/tt&gt;!&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;syncDown&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="c1"&gt;// Use second Kinto instance to demonstrate decryption:&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;coll2&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;sync&lt;/span&gt;&lt;span class="p"&gt;().&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;syncResults&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Sync down'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;syncResults&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="p"&gt;});&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;

&lt;span class="kr"&gt;const&lt;/span&gt; &lt;span class="nx"&gt;go&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Watch the Network tab!'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nx"&gt;prepare&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
      &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;syncUp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;syncDown&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;then&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nx"&gt;a&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Success'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;a&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="nx"&gt;b&lt;/span&gt; &lt;span class="p"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Failure'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nx"&gt;b&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;span class="p"&gt;};&lt;/span&gt;
&lt;span class="nx"&gt;console&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;log&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'Type go(); to start!'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;J'espère que vous êtes autant enthousiastes au sujet de Kinto.js que je le
suis, les commentaires sur cet article ainsi que
&lt;a class="reference external" href="https://github.com/michielbdejong/kinto-encryption-example/"&gt;les tickets Github sur le dépôt de l'exemple&lt;/a&gt;
sont les bienvenus ! :)&lt;/p&gt;
</content></entry><entry><title>Signing collection to ensure data integrity</title><link href="http://www.servicedenuages.fr/en/data-signature" rel="alternate"></link><published>2015-08-26T00:00:00+02:00</published><updated>2015-08-26T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-08-26:/en/data-signature</id><summary type="html">&lt;p class="first last"&gt;How to ensure data integrity for Kinto users using collection hash signatures.&lt;/p&gt;
</summary><content type="html">&lt;div class="admonition note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;Translated from the French by &lt;a class="reference external" href="https://twitter.com/Natim"&gt;Rémy Hubscher&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Within the scope of the &lt;a class="reference external" href="https://wiki.mozilla.org/Firefox/Go_Faster"&gt;Go Faster&lt;/a&gt;
project, we want to distribute Firefox updates more often than
just with major updates (which happens once every six weeks).&lt;/p&gt;
&lt;p&gt;There are multiple kinds of data that we will need to update on the client;
for example, we would like to &lt;a class="reference external" href="https://blog.mozilla.org/security/2015/03/03/revoking-intermediate-certificates-introducing-onecrl/"&gt;update the SSL Control Revocation List (named
OneCRL)&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In that specific case, it is obviously very important to make sure that all the
retrieved data are coming from Mozilla and that no records are missing. We can
then be absolutely confident that nobody has attempted to invalidate a valid
certificate to the list (or remove one that has been revoked).&lt;/p&gt;
&lt;p&gt;A cryptographic signature can give us the guarantee that all the records where
fetched but it is still possible to prevent users from completely accessing the
service (the &lt;em&gt;Great Firewall of China&lt;/em&gt;, for example).&lt;/p&gt;
&lt;p&gt;This mechanism works in our specific use-case of the OneCRL update project, but
it can also be useful to any future project that needs to make sure that all
records on a collection have been correctly synced. We will probably need to
re-use it to update other parts of Firefox (or Fennec), but you may also want
to use it for your projects.&lt;/p&gt;
&lt;p&gt;We plan to use &lt;a class="reference external" href="https://kinto.readthedocs.io"&gt;Kinto&lt;/a&gt; in order to distribute
the data (or meta-data) associated with the files that need to be updated. It's
a good fit because it can be cached easily behind a CDN.&lt;/p&gt;
&lt;p&gt;That said, we don't want our users to trust either the CDN or the Kinto server
itself without checking. Somebody can attack the CDN or the Kinto server and
may add or remove records and update the CRL. If you think about it is a
horrible scenario.&lt;/p&gt;
&lt;p&gt;Consider the following work-flow:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;The person responsible for updating the CRL, &lt;em&gt;the updater&lt;/em&gt;, has got a
private key (or even better &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Hardware_Security_Module"&gt;an HSM&lt;/a&gt;) which
will enable them to sign a hash of the collection records.&lt;/li&gt;
&lt;li&gt;The corresponding public key ships with the client (Firefox or Fennec).&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Hashing&lt;/em&gt; and &lt;em&gt;signature&lt;/em&gt; generation are done on client side to prevent certain
attacks vectors (if somebody can access the Kinto server, for example).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The &lt;em&gt;hashing&lt;/em&gt; is a one-way operation that guarantees the same result given the
same input.&lt;/p&gt;
&lt;div class="section" id="first-data-issuance-on-kinto"&gt;
&lt;h2&gt;First data issuance on Kinto&lt;/h2&gt;
&lt;p&gt;All the data are fetched from a &lt;em&gt;secure&lt;/em&gt; source and converted into a JSON
collection. Each record is assigned a unique ID generated on client side.&lt;/p&gt;
&lt;p&gt;For instance, we could have the following record:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;"id"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"b7dded96-8df0-8af8-449a-8bc47f71b4c4"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="s2"&gt;"fingerprint"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"11:D5:D2:0A:9A:F8:D9:FC:23:6E:5C:5C:30:EC:AF:68:F5:68:FB:A3"&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then the collection &lt;em&gt;hash&lt;/em&gt; is computed, signed, and then sent to the Kinto
server. (See below for details.)&lt;/p&gt;
&lt;p&gt;The signature process is deported to a specific service in a sandbox
that ensures the certificate security which is crucial in the process.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="how-to-validate-data-integrity"&gt;
&lt;h2&gt;How to validate data integrity?&lt;/h2&gt;
&lt;p&gt;First, we need to fetch the collection records as well as the hash and
the signature.&lt;/p&gt;
&lt;p&gt;Then, we can validate that the hash signature is valid to make sure it
has been generated by a trusted source.&lt;/p&gt;
&lt;p&gt;Finally we can serialise our local collection and compute its hash to
make sure it matches the signed one.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="update-the-collection-data"&gt;
&lt;h2&gt;Update the collection data&lt;/h2&gt;
&lt;p&gt;When you need to &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete"&gt;create, read, update or delete&lt;/a&gt;
records in the collection, the client needs to make sure that the local
collection records match those of the remote server, and that they are valid.&lt;/p&gt;
&lt;p&gt;Once we are confident that the collection update is valid, the client
can compute the new collection hash and sign it.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="how-to-compute-the-collection-hash"&gt;
&lt;h2&gt;How to compute the collection hash?&lt;/h2&gt;
&lt;p&gt;To compute the collection &lt;em&gt;hash&lt;/em&gt; you need a reproducible algorithm.&lt;/p&gt;
&lt;p&gt;For instance one could be:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Sort records by their ids.&lt;/li&gt;
&lt;li&gt;Serialise fields giving the value of each keys sorted by key.&lt;/li&gt;
&lt;li&gt;Compute the &lt;em&gt;hash&lt;/em&gt; of the records list serialization.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;We do not yet know the exact algorithm that we will be using.&lt;/p&gt;
&lt;p&gt;An interesting candidate could be the &lt;a class="reference external" href="https://tools.ietf.org/html/draft-ietf-jose-json-web-signature-41"&gt;JSON Web Signature&lt;/a&gt;
standard. Meanwhile, a naive Python implementation could look like
this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;json&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;hashlib&lt;/span&gt;

&lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
   &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;"id"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"b7dded96-8df0-8af8-449a-8bc47f71b4c4"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;"fingerprint"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"11:D5:D2:0A:9A:F8:D9:FC:23:6E:5C:5C:30:EC:AF:68:F5:68:FB:A3"&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
   &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;"id"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"dded96b7-8f0d-8f8a-49a4-7f771b4c4bc4"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;"fingerprint"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"33:6E:5C:5C:30:EC:AF:68:F5:68:FB:A3:11:D5:D2:0A:9A:F8:D9:FC"&lt;/span&gt;&lt;span class="p"&gt;}]&lt;/span&gt;

&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hashlib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sha256&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dumps&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sort_keys&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;collection_hash&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here is a little sketch to summarise:&lt;/p&gt;
&lt;img alt="Summary schema of the collection signing flow." class="align-center" src="http://www.servicedenuages.fr/en/../images/kinto-signing.jpg" style="width: 600px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>Garantir l'intégrité des données via des signatures</title><link href="http://www.servicedenuages.fr/en/../donnees-et-signatures" rel="alternate"></link><published>2015-08-26T00:00:00+02:00</published><updated>2015-08-26T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-08-26:/en/../donnees-et-signatures</id><summary type="html">&lt;p class="first last"&gt;Comment garantir l'intégrité des données en utilisant les signatures.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Dans le cadre du projet &lt;a class="reference external" href="https://wiki.mozilla.org/Firefox/Go_Faster"&gt;Go Faster&lt;/a&gt;, nous souhaitons distribuer des
mises à jour de parties de &lt;em&gt;Firefox&lt;/em&gt; de manière séparée des mises à jour majeures
(qui ont lieu toutes les 6 semaines).&lt;/p&gt;
&lt;p&gt;Les données que nous souhaitons mettre à jour sur les clients sont multiples.
Entre autres, nous souhaitons gérer &lt;a class="reference external" href="https://blog.mozilla.org/security/2015/03/03/revoking-intermediate-certificates-introducing-onecrl/"&gt;la mise à jour des listes de révocation
(CRL) de certificats SSL&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Il est évidemment nécessaire de s'assurer que les données qui sont téléchargées
sur les client sont légitimes : que personne ne tente d'invalider des
certificats alors qu'ils sont valides, et que l'ensemble des mises à jour sont
bel et bien récupérées sur le client.&lt;/p&gt;
&lt;p&gt;La signature garantit qu'une mise à jour contient tous les enregistrements, mais il
est toujours possible de bloquer l'accès au service (par exemple avec le &lt;em&gt;china
great firewall&lt;/em&gt;).&lt;/p&gt;
&lt;p&gt;Ce mécanisme fonctionne pour les listes de certificats à révoquer, mais pas
uniquement. Nous comptons réutiliser ce même fonctionnement dans le futur pour
la mise à jour d'autres parties de Firefox, et vous pouvez également en tirer
parti pour d'autres cas d'utilisation.&lt;/p&gt;
&lt;p&gt;Nous souhaitons utiliser &lt;a class="reference external" href="https://kinto.readthedocs.io"&gt;Kinto&lt;/a&gt; afin
de distribuer ces jeux de données. Un des avantages est que l'on peut
facilement &lt;em&gt;cacher&lt;/em&gt; les collections derrière un CDN.&lt;/p&gt;
&lt;p&gt;Par contre, nous ne souhaitons pas que les clients fassent
confiance aveuglément, ni au serveur Kinto, ni au CDN.&lt;/p&gt;
&lt;p&gt;Effectivement, un attaquant, contrôlant l'un ou l'autre, pourrait
alors envoyer les mises à jour qu'il souhaite à l'ensemble des clients
ou supprimer des certificats révoqués. Imaginez le carnage !&lt;/p&gt;
&lt;p&gt;Afin de résoudre ce problème, considérons les conditions suivantes:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;La personne qui a le pouvoir de mettre à jour les CRL (&lt;em&gt;l'updater&lt;/em&gt;)
a accès à une cle de signature (ou mieux, &lt;a class="reference external" href="https://fr.wikipedia.org/wiki/Hardware_Security_Module"&gt;un HSM&lt;/a&gt;) qui lui permet de
signer la collection;&lt;/li&gt;
&lt;li&gt;Le pendant public de ce certificat est stocké et distribué dans Firefox;&lt;/li&gt;
&lt;li&gt;Le &lt;em&gt;hashing&lt;/em&gt; et la &lt;em&gt;signature&lt;/em&gt; sont faits côté client pour éviter certains
vecteurs d'attaque (si un attaquant a la main sur le serveur Kinto par
exemple).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Le chiffrement à sens unique, aussi appellé &lt;em&gt;hashing&lt;/em&gt; est un moyen de toujours
obtenir le même résultat à partir de la même entrée.&lt;/p&gt;
&lt;div class="section" id="premier-envoi-de-donnees-sur-kinto"&gt;
&lt;h2&gt;Premier envoi de données sur Kinto&lt;/h2&gt;
&lt;p&gt;L'ensemble des données est récupéré depuis une source &lt;em&gt;sécurisée&lt;/em&gt; puis mis dans
une collection JSON. Chaque élément contient un identifiant unique généré sur
le client.&lt;/p&gt;
&lt;p&gt;Par exemple, un enregistrement peut ressembler à :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;"id"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"b7dded96-8df0-8af8-449a-8bc47f71b4c4"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="s2"&gt;"fingerprint"&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"11:D5:D2:0A:9A:F8:D9:FC:23:6E:5C:5C:30:EC:AF:68:F5:68:FB:A3"&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Le &lt;em&gt;hash&lt;/em&gt; de la collection est ensuite calculé, signé puis envoyé au serveur
(voir plus bas pour les détails).&lt;/p&gt;
&lt;p&gt;La signature est déportée sur un service qui ne s'occupe que de ça, puisque la
sécurité du certificat qui s'occupe des signatures est extrêmement importante.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="comment-verifier-l-integrite-des-donnees"&gt;
&lt;h2&gt;Comment vérifier l'intégrité des données ?&lt;/h2&gt;
&lt;p&gt;Premièrement, il faut récupérer l'ensemble des enregistrements présents sur
le serveur, ainsi que le &lt;em&gt;hash&lt;/em&gt; et la signature associée.&lt;/p&gt;
&lt;p&gt;Ensuite, vérifier la signature du &lt;em&gt;hash&lt;/em&gt;, pour s'assurer que celui-ci provient
bien d'un tiers de confiance.&lt;/p&gt;
&lt;p&gt;Finalement, recalculer le &lt;em&gt;hash&lt;/em&gt; localement et valider qu'il correspond bien à
celui qui a été signé.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="ajouter-de-nouvelles-donnees"&gt;
&lt;h2&gt;Ajouter de nouvelles données&lt;/h2&gt;
&lt;p&gt;Pour l'ajout de nouvelles données, il est nécessaire de s'assurer que les
données que l'on a localement sont valides avant de faire quoi que ce soit
d'autre.&lt;/p&gt;
&lt;p&gt;Une fois ces données validées, il suffit de procéder comme la première fois, et
d'envoyer à nouveau le &lt;em&gt;hash&lt;/em&gt; de la collection au serveur.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="comment-calculer-ce-hash"&gt;
&lt;h2&gt;Comment calculer ce hash ?&lt;/h2&gt;
&lt;p&gt;Pour calculer le &lt;em&gt;hash&lt;/em&gt; de la collection, il est nécessaire :&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;D'ordonner l'ensemble des éléments de la collection (par leur id) ;&lt;/li&gt;
&lt;li&gt;Pour chaque élément, sérialiser les champs qui nous intéressent (les
concaténer clé + valeur)&lt;/li&gt;
&lt;li&gt;Calculer le &lt;em&gt;hash&lt;/em&gt; depuis la sérialisation.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Nous sommes encore incertains de la manière dont le hash va être calculé. Les &lt;a class="reference external" href="https://tools.ietf.org/html/draft-ietf-jose-json-web-signature-41"&gt;JSON Web Signature&lt;/a&gt; semblent
une piste intéressante. En attendant, une implementation naïve en python
pourrait ressembler à ceci :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;json&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;hashlib&lt;/span&gt;

&lt;span class="n"&gt;data&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
   &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;"id"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"b7dded96-8df0-8af8-449a-8bc47f71b4c4"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;"fingerprint"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"11:D5:D2:0A:9A:F8:D9:FC:23:6E:5C:5C:30:EC:AF:68:F5:68:FB:A3"&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
   &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;"id"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"dded96b7-8f0d-8f8a-49a4-7f771b4c4bc4"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;"fingerprint"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"33:6E:5C:5C:30:EC:AF:68:F5:68:FB:A3:11:D5:D2:0A:9A:F8:D9:FC"&lt;/span&gt;&lt;span class="p"&gt;}]&lt;/span&gt;

&lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hashlib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sha256&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;update&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;json&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;dumps&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sort_keys&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="n"&gt;collection_hash&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Enfin, un schéma pour résumer !&lt;/p&gt;
&lt;img alt="Schema résumant le processus de signature de la collection." class="align-center" src="http://www.servicedenuages.fr/en/../images/kinto-signing.jpg" style="width: 600px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
</content></entry><entry><title>Notifications in Kinto (Preamble)</title><link href="http://www.servicedenuages.fr/en/notifications-kinto-preamble" rel="alternate"></link><published>2015-08-13T00:00:00+02:00</published><updated>2015-08-13T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-08-13:/en/notifications-kinto-preamble</id><summary type="html">&lt;p&gt;Notifications are coming to Kinto! Here's the preamble.&lt;/p&gt;</summary><content type="html">&lt;p&gt;At a recent work week in the lovely French town of &lt;a href="https://www.qwant.com/?q=Douarnenez&amp;amp;t=images"&gt;Douarnenez&lt;/a&gt; we laid the groundwork for an upcoming feature in &lt;a href="https://kinto.readthedocs.io"&gt;Kinto&lt;/a&gt;: &lt;em&gt;Notifications!&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="Sunset over Douarnenez (@phrawzty)" src="http://www.servicedenuages.fr/en/../images/notifications-douarnenez.jpg" style="width: 800px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;h1&gt;tl;dr&lt;/h1&gt;
&lt;p&gt;For those that are in a hurry, here's the gist: We're going to be integrating a "notifications" system into Kinto with an eye towards simplicity, modernity, and flexibility. Our goal is to provide a solid framework that will allow other systems to take advantage of this new feature without having to jump through too many hoops. If that sounds interesting to you - read on.&lt;/p&gt;
&lt;h1&gt;Why?&lt;/h1&gt;
&lt;p&gt;The simple answer is that we have an itch to scratch at Mozilla. There is a platform called &lt;a href="https://wiki.mozilla.org/Balrog"&gt;Balrog&lt;/a&gt; which is part of the update system used by Firefox and other Mozilla products. As part of an initiative to extend and improve the update process (the "&lt;a href="https://wiki.mozilla.org/Firefox/Go_Faster"&gt;Go Faster&lt;/a&gt;" initiative), we needed to store and transmit small, discrete blocks of information both between internal systems, as well as out to all of our users in the real world. Kinto has almost all the functionality we need except for one thing: notifications.&lt;/p&gt;
&lt;p&gt;No problem. We can do that.&lt;/p&gt;
&lt;h2&gt;But wait, there's more!&lt;/h2&gt;
&lt;p&gt;Sure, Kinto is a Mozilla project - but it's meant for general use, which means that anything we design needs to be reasonably generic. With this in mind we committed to designing something that can be used in a variety of contexts; after all, we're an organisation built for and on the web, and as such, we're dedicated to using web-centric solutions.&lt;/p&gt;
&lt;p&gt;Thinking then about what sort of parameters a reasonably generic solution might entail lead us to a few basic guidelines for designing the notifications mechanism:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;We should strive to be as &lt;em&gt;agnostic&lt;/em&gt; as possible, meaning that locking into a particular service, back-end, or even programming language, should be avoided where possible.&lt;/li&gt;
&lt;li&gt;Since we're web-centric, we should capitalise on HTTP wherever possible as well.&lt;/li&gt;
&lt;li&gt;The notifications mechanism must be able to scale with a minimum of hardship; this applies to any eventual queues, workers, and so forth.&lt;/li&gt;
&lt;li&gt;Finally, it must be robust - we can't be losing messages now, can we?&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;What?&lt;/h1&gt;
&lt;p&gt;Before we go into the gritty details, let's take a moment to describe the overall picture of what we're trying to accomplish - on paper, at least, it's fairly straightforward:&lt;/p&gt;
&lt;p&gt;&lt;span class="graphviz" style="text-align: center;"&gt;&lt;img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAh0AAAC4CAIAAADITMnEAAAABmJLR0QA/wD/AP+gvaeTAAAcuklEQVR4nO3daVRTZxoH8CcEVGRTEHEBF2iVqswUezxiFcspKhQUpBpwVBAVh7pXsQruVVGhCkURaxl3UQSmUrcO7uKCSqueqhXF44RNMAoiS2QJufPhTnMoaiD6wg3w/33weG9u3vfJfbn3n7skEXEcRwAAAIzoCF0AAAC0KMgVAABgCbkCAAAsIVcAAIAl5AoAALCEXAEAAJaQKwAAwBJyBQAAWEKuAAAAS8gVAABgCbkCAAAsIVcAAIAl5AoAALCEXAEAAJZ0NVo6MTExMTGxkUoBAAAtZGlpGRER0fDlNTteSUxMTEtL07AkAABornJyciIjIzV6imbHK0Q0ZMiQhIQETZ8FAADNUUJCgo+Pj0ZPwfUVAABgCbkCAAAsIVcAAIAl5AoAALCEXAEAAJaQKwAAwJLG9xkDNFObNm0KDQ0tLi4Wi8XOzs5t2rThOK6ioiIzMzM7Ozs7O9vKykroGgFaAuQKtBaLFi2aNGlSt27drK2tU1JSVPM5jvPw8Kiurm6MTnNzcy0tLRujZQCthfNg0Ip07dqViMRice2ZIpEoJCTE0NCQeXdSqXTixInMmwXQcjhegdYuIyPD3t5eX1+fbbN5eXmjR4+uqalh2yyA9sPxCrReHMfJZLK5c+eWlJQQUVJSkpmZmUgkWrFiBb/A9u3bxWJxbGwsEVVUVISHhwcEBAwaNGjkyJF3794loqNHjwYGBlpZWRUXF/v7+3fq1MnOzu63334joj179ty7d6+goGDmzJnCvUQAIXCakEgkEolEo6cAaJU3bgUFBQX8o1u3biWiX375hZ/Mzs6eOHEi//8ZM2ZkZGTw/x81apSFhUVJSUlubi5/Ai00NDQrK+vAgQNENHjwYFVftra2Tfv6ABg7fPiwpkmB4xVodVT7eqVSWVBQ4OjoqHooMDCwR48e27dv5ydjY2O/+eYbIrpx40ZsbKytra1IJBKJRKdOnXr69Glqamr37t27d+9OREuXLu3Ro8ekSZMsLCxu374tyOsC0BLIFWi9RCKRhYXFggUL9PT0+Dl6enrz588/fvz448ePq6urHzx48PHHHxNRenr6gAED6rwpc3d35xup3WbHjh0rKyub/rUAaA/kCrR2Xl5epqamZWVlSqWSiAICAgwMDKKjo5OTk8ePH88vU1hY+PjxY7lcXvuJ/PIAUAdyBYCIaNKkSfyRh7GxcUBAwK5duw4fPuzl5cU/amtrK5fLw8LCVMvfv38/OjpafZsikUihUDRezQDaCfcZQyvy9OlTIqpznqqysjIkJKRdu3aqM1rz5s3bsmWLvb29ru7/NxBPT09ra+s1a9bk5uY6Ozvfv3//xo0bSUlJRFRRUVG7tdLSUiJSKBS6uro2Njb5+fk5OTn4JD+0KjhegdbiwoUL/C2/Uqm0X79+rq6uo0ePdnR0NDc3j4yMHDFihGrJXr16zZ07t/b9wW3btj137pyHh0dycnJQUJBMJouLizMyMoqJiZFKpUQUGhpaUlISFRWVl5dHRCtWrKioqJBIJMbGxunp6U39UgEEJeLecuflG3l7exMRfocYAKCV4H+HWKOkwPEKAACwhFwBAACWkCsAAMAScgUAAFhCrgAAAEvIFQAAYAm5AgAALCFXAACAJeQKAACwhFwBAACWkCsAAMAScgUAAFhCrgAAAEvIFQAAYAm5AgAALCFXAACAJeQKAACwhFwBAACWkCsAAMCSLtvmysvLFQoF2zYBmNPV1TUwMBC6CoCWiXGuSKVSjuPYtgnAnEgk6t+/v9BVALRMjM+DIVSgWcAfKkDjwfUVAABgCbkCAAAsIVcAAIAl5AoAALCEXAEAAJaQKwAAwBJyBQAAWEKu1CMlJWX8+PF2dnZeXl6VlZWq+devX//qq6/s7OwmTJiQkpKiabOTJk2KiIioPefgwYORkZHTp0+fMmVKVlbW6wu8D7atAQCogVyph4uLy549e4jo0aNHGzduVM0fPHjwypUriSgsLMzFxaXedp4+fVp7snv37m3atFFNxsXFRUVFzZ8/PyoqytTUtLS0tM4CmlLfHQBA42H8PS4tkqGhIRF98sknSUlJDg4OqhSxsLAgou7du9fbwpMnT0JCQvbu3auaEx4eXnuBw4cPd+7cWUdHx9DQMDIy8vUFNFJvdwAAjQfHKw21adMmc3Pz1atX5+Xl8XPEYjER6erWk80ymWz27NkvXrxQs0xBQYFIJGJSZ0O6AwBoPDheaahOnTpt2rRp2rRpixYt2r9//+txUlZWFhsbKxKJqqurHz169MEHH3z11VdGRkbJycmPHj0yMjJau3btihUrlErlmTNnUlNTc3Nz9+zZk5qaevHixVevXj1//nzt2rVEtHDhwitXrqgWIKJXr17t27dPKpWamJg8ePDA2dl58uTJRJSVlbVlyxZLS8tnz57l5eUtX778ww8/VN+dmjrPnz+fmpp66dKlI0eOhIWFXbx4sVOnTqGhof369WviVQ0AzZpIoy/g8/b2JqKEhIS3LXD37l0GRWkfOzu7O3fuENH+/fvDw8P9/f2DgoJqz5fL5d7e3u7u7jNnziSiFy9e+Pr61tTUJCYmGhoa2tnZ9e7d++jRo3xrBQUFI0eOrD1HzQI1NTUzZszo0qVLaGioSCT6+eefly9fHh0d/dlnn40ePVqpVJ48ebKmpsbR0dHCwuLIkSPqW1NTp1wuHzNmjFwunzdv3ujRo2/evBkcHPy3v/0tLi6uKVd1kxkwYIDQJQA0AwkJCT4+PholBc6DacbX19fFxWXv3r2XLl2qPX/nzp1ZWVkSiYSf7NixY2BgYG5ubmxs7OuNdOnSRX0vtReIi4tLT08PDAzkT5SNGTNm3bp1AwcOJCJvb++5c+cSkY6OTocOHaRSab2tqamzc+fOnTt3JqIZM2Z07drV3d3dzMwsIyNDfakAAHXgPJjG1qxZk5mZuWzZsqSkJNXMW7duEVHtn4r65JNPiOj27dvv2d2vv/5Kf94jQEQ6Ojqenp78//38/F69ehUfH//y5cuqqqqG/KKa+jrrXOMxNjYuLCx8z/oBoLXB8YrG2rdv//3331dWVoaEhKhm6ujoEJHqkj4RmZmZ0Z/3kr0Pfs+elZX1+kN379718vKytLQMDAxs3759Q1prvDoBAHjIlfoplUrVv7zevXuvXbv2xo0bqjn8u/7U1FTVnIKCAiJycHAgIpFIVFNT82699+nTh4h+/PFH1fnNJ0+eXL58mYiWLl2qUCiGDRtWpzw13amvEwDg/SFX6ldUVER/HjeojBo1ys/PTzU5bdq0Dz744ODBg8+fP+fnxMfH29vbT5w4kYisrKyePXvG78GJSC6XE1F5eTk/WVJSQkTV1dWq1movEBAQoK+vf+rUqRkzZsTHx0dHR//rX/8aOnQoET179kwmk6WlpZ08ebK0tJSI7ty58/TpUzXdqa+z9hcKqJ7yzokIAK2TePXq1Q1fOjExkYhUV31fJ5PJ3r8mrXL27NmYmJjs7GypVNqlS5euXbuqHnJwcLhx44aXlxcR6erqenh4lJSUJCQkPHjw4Pr160ZGRqtXr+ZvR37+/Pl///vfvn37WltbV1RU/Pjjjzdv3iwvL+fPPu3bt+/evXtlZWUikcjY2NjAwKD2AgMHDnRxccnNzb13797vv//es2fPefPmtW3blogMDQ1v3rz58OFDNzc3Kyur33//PT8/f9SoUaWlpW/rztbWdty4cW+sMz4+/uTJk/xr6du3b0JCwqlTp4iourra3t6+3o/pNDv8TQoAoN69e/eSkpI0SgrcZwytFO4zBmgI3GcMAAACQ64AAABLyBUAAGAJuQIAACwhVwAAgCXkCgAAsIRcAQAAlpArAADAEnIFAABYQq4AAABLyBUAAGAJuQIAACwhVwAAgCXkCgAAsIRcAQAAlpArAADAEnIFAABYQq4AAABLyBUAAGBJtyk7MzAw6NWrl0gkaspOm55CocjIyBC6igaxtbXV1W3Sv4GmwXGcVCotLy8XupD6LVy4MDIyUugqGsWCBQsiIiKErqJ+ly5d+vzzzxUKhdCFCEZXV/fcuXOOjo7MGmTVUIM609Vt8aFCRM1oT92MStWISCRqLi8tNzfXwcFh4cKFQhfCWERERG5urtBVNEh+fr5CoUhISBC6EMF4e3vn5+czbLB5bHsALZiVlZVEIhG6CsYSExOFLkEzLW8IBITrKwAAwBJyBQAAWEKuAAAAS8gVAABgCbkCAAAsIVe0nUwmS05OXrRo0eTJk4WupfXauXOnvb29kZHRxx9/vHv3bqHLaY3++OOPsWPHdurUydzc/B//+Afb+2KBLeSKtuvcubODg0NKSkpJSYnQtbRSISEhFy5cmDFjxvTp0x8+fDht2rTo6Gihi2pd7t+/v3z5cn9//zNnznzxxRfx8fG+vr5CFwVvhc+vNANdunQRuoTWKzc3Nycn58CBA/ykm5ubi4tLVFTUnDlzhC2sVTl9+nRcXJy+vj4R7dq169ixY9evXxe6KHgr5AqAOllZWZs3b1ZNjho1ytzcXCaTCVhSKzRv3rzakwqFYvr06UIVA/VCrgCoM3To0DpzqqqqGH6TEmhq5cqV33//PXJFmyFXADRw9erVqqqqtWvXCl1Ia5ScnBwZGZmamtq7d28iQrRoLeQKQEPV1NQsXbp0165d9vb2QtfSGjk5OfXt2/fcuXOLFy8OCAjQ1dWdMmWK0EXBG+B+MICG+vbbb52dnSdMmCB0Ia1Uhw4dPvroo9mzZ+/YsYOI9u3bJ3RF8GY4XgFokOPHjxsYGCxZskToQoA8PT2JqE2bNkIXAm+G4xWA+p0+fTo3N7d2qKSlpQlYTyORyWSJiYnr168XupB68B+KdHNzE7oQeDMcr/yFg4PD8OHDw8PDhS7kLyorK4lIqVQKXcj70s7VW6+zZ89u3Ljxyy+/3LZtGxFxHPf48WMDA4MhQ4YIXRpLGRkZ0dHR27Zts7W1Xbp0qdDl/EVkZKSJicm4ceNMTEwqKyuXLFni4+ODjxBpLeTKX/Tu3btdu3ZCV/EX6enpJ0+eJKK8vLzdu3d/+umnffv2Vf+UJ0+exMbGOjk5DR06VNifTczNzbW0tFRNauHqrVdaWpqHh4dcLj937pxqpkgkevTokZpnlZeXBwUFOTo6enp6GhoaNn6ZDNja2m7evJnPTpU6IyiUkpKSmJiYRYsWTZgwoU2bNnPmzHF2dq73WUuXLu3atau3t7eFhUUTFKltBBw75MpfHDp0SOgS6ho0aNCgQYNWrVrV8KfcuXMnKSkpKSnJ0NDQ1dXV3d194MCBOjpNfc5TKpX6+fmlpqaq5mjh6q3XkCFDysvLNX2WVCrdsWPHjh072rZt6+npOWnSJFdXV+2/HtC2bdvak6+PoFBWrVql0SbA27x5c1VV1ddff+3k5OTr6+vl5WViYtIY5WkhYccO11dasrKysp9//nnq1KlOTk4bN268efNmk3Wdl5c3evToZ8+eNVmP2qmysvLIkSNjx441NTX19fU9duyYQqEQuqgGaTEjqFQqL168GBAQ0KlTJzc3t3379r3DG4XmRfCx07pckcvlcXFxEydOHDp06LVr1wYOHNirV68rV648fPjQy8vL3Nz8o48++u2331TL//rrrw4ODnPmzFm5cqWenp7qLyY6OtrX13fWrFnt2rUT/UlNv0qlMjEx0d/f/7PPPiOio0ePBgYGWllZFRcX+/v7d+rUyc7Orna/zUV1dTURvXjxIiEhYcqUKSNGjIiMjJRKpe/QVGZmpkQiCQ4O9vPzGz58+J07d/j55eXl69at8/X1nT9/vpOTU1RUFBHt2bPn3r17BQUFM2fOpNdWLxGVlJQsWbIkJCQkKCjIxcUlKCiouLiYWtCaV6muruY4rry8PCEhwcPDo2vXrvPnz798+TLHcZo2xe8iFyxY0Lt37ydPnjg5OfXs2bO4uLiioiI8PDwgIGDQoEEjR468e/cuv/zrW0dsbKyOjg6/LZSWlkZERKgm66gzgs1aTU1NTU2NQqE4ffq0v7+/mZnZ+PHjjx07xm8dDSHUfonevqWoGUrhx47ThEQikUgkaha4o1Z2dna9XSiVSv7MtYmJyYkTJ/744w8i6tWr13fffffy5ctbt24RkZOTk2r5Pn36mJqa8v/38fGRyWQcx23dulUsFhcWFnIct2HDBiIKCgqqt+vs7GwisrW15TguNzeXPy0eGhqalZXFf+3g4MGD622kIeuhsW3atEnNiIvFYiLq2bPnzJkzHz9+3MBXxHHchx9+aGNjw3FcdXV1hw4dBgwYwP+fP8mgVCo5juO/Q/7YsWMcx6lW5uurt7S0tE+fPqtXr+Yfkslkffr0sba2Li4ufs81X7s79WtJ0wY1otqzv5Genh4RdevWbcmSJa6uruq3qdoqKyuvXr3avn17ItqwYcOZM2cCAgLKyspmzJiRkZHBLzNq1CgLC4uSkhLuLVuHjY1N7Q2/zmTtUaszghqpd1/RBNSceOSvOxobG//zn//89ttv690TCrVfUrOlcGqHUqOxI6LDhw+/7dHDhw9rmhRalyv/L6vWSunevXvtV9W5c+cOHTqoJs3NzYkoKipKqVTevXuX35w8PDx0dHSqqqq4P7dwBwcHTfvlL4+rHrKwsGjbtm1DGgkLC1OzT9EqYrE4LS2tIS+K47iIiIhDhw5xHKdUKm1sbPT09PiZRPTgwQN+GYVCsXv37hcvXnBv+stWzVm2bBkR5efnqx7iP+O2ePHi91nzKs3rNwUGDRqk0avj109RURE/+cZv9j1+/Dj3lq3D1taWaq3eOpPELlfqfSfe2DS6aaUhL4qafL+kfktRM5QkaK40g+v2RkZGtSdNTU0zMjJUk9u3b586der8+fP3798fHR3NLzxy5MijR4+eOHFi7Nix/A1In3/+uab91tkqOnbs+PTp04Y80dPTU9i7sG7fvr1//341C4jF4pqamn79+gUGBg4cOLCBzS5YsKC8vDwmJqaoqKiyspI/h3DhwgUiUt12IhaL/f39623qypUr9NeRHT58OBFdvXqV3mPNq+jr62/fvl0ul6tZxsrKSqM2NZKTkxMUFKRmAT09verqahsbm3bt2nXr1k2jxvn107FjR34yPT19wIABd/48LVnbG7eOJuPg4LBgwYKm7LEO9T+Fxw+BmZnZ4MGD+VsuNdI0+yX1W4rWaga5ot64cePs7e1nzZqVkpLi6OgYGxs7ZcqUOXPm6OvrT58+/cqVK5mZmWvWrGnK+/H79u3b8PO2jYHjuDfmCr8h9ejRw93d3d3dvWfPngMGDGh4s+np6T4+PjExMbNmzYqLi+Nn8nv8zMzMv//97w1vir85TSqV9u/fn5/D3wnK6nYdXV1dd3f3ly9fqllGo9euqXv37r0xV9q0aVNVVcX/4qFEIhk2bJi3t/d79lVYWPj48WO5XM6fH+MplUodHZ03bh3v2V3DWVpaSiSSJuvudW/MFT09PYVC0b59ey8vL29v7y+++OKnn356h1xRj9V+qbG3lEaiddftNbVq1Spra+v//Oc/hw4dqq6uXr58ORHV1NTcvXv32rVr3333XXJy8ooVK/iLCq0TfzbfzMzM29t77969J06cmDVrVs+ePTVtx8/Pr7q62tXVlWp9SJOPk9DQUO7Pq9BZWVm//PILEYlEorfd+8S/5zpx4oRqTk5ODhGNGDFC06qaBX4IDA0NfXx8Tp8+XVBQEBUVNWzYMCaN29rayuXy2mdf79+/z/+i5Ru3Dv5wp6qqiog4jlOTvmpGsNkRi8U6Ojp6enojR47cs2ePTCbbv3//mDFjGunUAqv9kvotRc1QCjt22pgrFRUVRKTaT/Hv/cvKymo/qtqvbdq0ib87Yvz48SYmJvxJz/Xr1x87duzSpUspKSlpaWmZmZk1NTX19st3oTo1z3ekUlpaSkTNaDPj/2SNjY3HjRu3b9++8+fPBwcHN/ys1+vy8/Pz8vJOnz598OBBfp3fuHFj8uTJBgYGiYmJI0aMiImJWbly5YYNG/jssbGxyc/P5zcD+uvqXbx48YABA7Zu3VpQUMA/um3btqFDh/KfoG7ua16Fvz9HX19fIpGcOHGiqKho3759I0aMeM/PEvHrR3WLkaenp7W19Zo1a6ZPn37w4MEVK1Z8/fXXU6dOpbdsHfxZ+HXr1j169CgqKor/NoeUlBSlUvnq1Suqtf7rjGBzJBKJxGKxWCx2dnbeu3dvUVHRiRMn/Pz8ah/bNZAg+yX1W4qaoRR27LQuV2QyGX+pSiqVnj179tSpU1lZWUS0bNmyoqKi6OhofnLz5s2FhYVEJJfLnZ2dw8LC/P39HR0d4+PjiWjIkCFlZWXTp093dXX99NNP+/Tp07Vr159++klNv3K5nP9apCdPnkRGRoaFhfE344aGhpaUlERFReXl5RHRihUr6uz1tJC5ubmRkZG7u/sPP/yQmpq6bNkye3v797+Iun79emNj4+XLl9vY2Cxbtqxjx47r16/v37//tWvXXFxcbt26tX79+tLS0vDwcL4viURibGycnp5Or61ehUKRlpY2ceLEKVOmLFq0aMmSJWZmZufOndPV1Y2JiWm+a17F1NS0Q4cObm5u8fHxhYWFcXFxbm5u/FHL+5DL5WvXruXXz8KFC2/fvk1Ebdu2PXfunIeHR3JyclBQkEwmi4uL48/Iv3HrCAsLGzx4cERExOzZs93d3fv37+/r61tcXJyZmRkcHExEUqk0KiqquLi49gg2Rz169Bg8eDC/U05JSZk8efI7f/eBUPslfX39t20p9PahVCgUwo6diNPkJnr+XHBCQsLbFlB/e6WJiUmjXixV2b179/Pnz7/55hsiUiqVT548OX/+/KJFizS9/PvO1K8H7dGo1xiElZOTI+D1lYard5tqpprR60pISPDx8dFoT/huBN8vvY1IJDp8+PDbLvW9w/pp9tftXxcWFhYcHMy/ayAiHR0dS0vLYcOGde/eXc179oyMjHq/dwsA4N20qv2S1p0He3+XL18moh9++EE1hDdv3gwODj5w4ICaG66b4+ABQHPRqvZLLTBX9u7dO3fu3J07d1paWg4dOtTb2/vmzZsHDhzo16+f0KUBQCvVqvZLLfA8mKmp6ZYtW7Zs2SJ0IQAA/9eq9kst8HgFAAAEhFwBAACWkCsAAMAScgUAAFhCrgAAAEvIFQAAYAm5AgAALCFXAACAJeQKAACwhFwBAACWkCsAAMAScgUAAFhCrgAAAEtN+n3GTfCLbNqgGb1MjuPe//eJtVNzGQWxWBwfH98iR2HChAlCl9Ag/G/6tsghaDh+JTBrjWFb9SotLc3Ozm7x46dQKIQuoaGkUinbvyctwXFcaWmp0FU0yIYNG7788kuhq2gUgwYNErqEBnFzc/v3v/9dU1MjdCGCEYvFbm5uDBts6uOVkpKSpuwR1CsvLxe6hNauV69evXr1ErqKVq1du3YtNdqFgusrAADAEnIFAABYQq4AAABLyBUAAGAJuQIAACwhVwAAgCXkCgAAsMQ+V5rL55yh1cKfKECjYpwrurq6Lf7j9NDciUSiFvktAwBagvHWZWtry7ZBAABoXnB9BQAAWEKuAAAAS8gVAABgCbkCAAAsIVcAAIAl5AoAALCEXAEAAJaQKwAAwJLGn4tMS0vz9vZujFIAAEDb5OTkaPoUzXJFIpFo2gEAADRfVlZWQ4YM0egpInwHHwAAMITrKwAAwBJyBQAAWEKuAAAAS8gVAABgCbkCAAAsIVcAAIAl5AoAALCEXAEAAJaQKwAAwBJyBQAAWEKuAAAAS8gVAABgCbkCAAAsIVcAAICl/wGNXPdrpwhSLgAAAABJRU5ErkJggg=="/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A &lt;em&gt;message&lt;/em&gt; is a chunk of information which is being sent from one place to another - for example, an HTTP request. Messages can come from &lt;em&gt;somewhere else&lt;/em&gt;, such as an external service, or can be generated internally.&lt;/li&gt;
&lt;li&gt;An &lt;em&gt;action&lt;/em&gt; is some sort of processing which occurs as a result of the message. This could be something simple like incrementing a counter in memory. Alternatively, it could be much more complex - triggering a test and build process, for example. These can be native functions of Kinto, local executables, features from plugins, or just about anything else.&lt;/li&gt;
&lt;li&gt;A &lt;em&gt;result&lt;/em&gt;, as the name implies, is the outcome of the &lt;em&gt;action&lt;/em&gt;. A simple example would be the aforementioned in-memory counter, expressed as an integer, and wrapped into a nice JSON package. Alternatively, it could be the meta-data results from that theoretical build and test process (the possibilities are endless).&lt;/li&gt;
&lt;li&gt;Taken as a whole, &lt;em&gt;events&lt;/em&gt; can therefore be thought of as a cycle: a message is received, an action takes place, some work is accomplished, and a new message is generated.&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;A notification is the combination of an incoming message and the action which is subseqently triggered. The result, while related directly to the action, is not itself part of the notification.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;It's a fine distinction that bears further explanation. The originator of the incoming message isn't necessarily concerned with what Kinto does with the data - in general, it's sufficient to know that Kinto has received the message and that it will be treated appropriately. In this way we can maintain simple promises between each of the components in the greater system.&lt;/p&gt;
&lt;p&gt;In any case, we'll explore some more terminology later - but for now let's move along.&lt;/p&gt;
&lt;h1&gt;How?&lt;/h1&gt;
&lt;p&gt;There are about as many ways to go about solving the problem as there are grains of sand on a beach (warning: previous statement may not be scientifically valid). The best way to determine the winning approach is simple: through single combat, &lt;a href="https://duckduckgo.com/?q=beyond+thunderdome&amp;amp;ia=about"&gt;Thunderdome-style&lt;/a&gt;. Unfortunately our manager put the kibosh on that plan for liability reasons, so instead we did the next best thing: we drew on a whiteboard.&lt;/p&gt;
&lt;p&gt;&lt;img alt="Whiteboard (@leplatrem)" src="http://www.servicedenuages.fr/en/../images/notifications-whiteboard.jpg" style="width: 675px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;In the interest of absolutely transparency, here are some of the models that we worked through and our general observations on each.&lt;/p&gt;
&lt;h2&gt;The Simple&lt;/h2&gt;
&lt;p&gt;One approach is to be as &lt;a href="https://i.imgur.com/xZQitlj.gi"&gt;hands-off&lt;/a&gt; as possible. The premise here is straightforward enough: Kinto drops notifications into a queue (like Redis or RabbitMQ). That's basically it.&lt;/p&gt;
&lt;p&gt;&lt;span class="graphviz" style="text-align: center;"&gt;&lt;img src="data:image/png;base64,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"/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Pros:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;This model implies a highly limited scope insofar as Kinto is directly concerned; we would basically treat Kinto like a lightweight transport mechanism, and the queue as a fire-and-forget target.&lt;/li&gt;
&lt;li&gt;The amount of additional code would be relatively small - in essence, only just enough to speak to a queue service and nothing more.&lt;/li&gt;
&lt;li&gt;Depending on how active the community was, we would be able to support a reasonably large number of external queuing services.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Cons:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Each queuing service would require a dedicated module to be coded and maintained, the responsibility for which would likely fall to the community as part of the larger ecosystem.&lt;/li&gt;
&lt;li&gt;It's ultimately up to the final consumer (receiver, destination, whatever) of the message to deal with the queue. In other words, if the queue is RabbitMQ, then the consumer needs to able to speak RabbitMQ too.&lt;/li&gt;
&lt;li&gt;Kinto has no control, understanding, or insight into what happens once the message is handed off to the queuing service.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The simplicity of this model, while attractive, has some fatal flaws. Chiefly, it runs contrary to our guideline of tech agnosticism as it would impose a particular external service dependency on the &lt;em&gt;consumer&lt;/em&gt;. Furthermore, this model flirts with danger in terms of robustness as the fire-and-forget model isn't exactly optimised for reliability (not all queuing mechanisms are better than others, however).&lt;/p&gt;
&lt;h2&gt;The Integrated&lt;/h2&gt;
&lt;p&gt;We then considered what might happen if we were to swing the pendulum directly to the opposite of the spectrum from the previous solution. In this model, we would tightly couple the queuing service directly within Kinto and provide an API that the consumer could subscribe to.&lt;/p&gt;
&lt;p&gt;&lt;span class="graphviz" style="text-align: center;"&gt;&lt;img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAn0AAACYCAYAAACRZV/VAAAABmJLR0QA/wD/AP+gvaeTAAAgAElEQVR4nO3deXwT1d4/8M9kabrvLWUTaFkKoiKIVEVAWVxYFSkK0qtX9odHRZ6riAugoMBVFFFUcLsFrQpiZVG4Cl4QaKEi4kJFEGkLQkuXNGmSpmnm/P7gl7ldaUrTJG0+79drXtDJZOY7yZmZb86cc0YSQggQERERUWuWofJ0BERERETU/Jj0EREREfkAJn1EREREPoBJHxEREZEPYNJHRERE5AOY9BERERH5ACZ9RERERD6ASR8RERGRD2DSR0REROQDmPQRERER+QAmfUREREQ+gEkfERERkQ9g0kdERETkA5j0EREREfkATVPeXFpaCoPB4KpYiIiICIBKpUK7du0gSZKnQ6FWpElJn8FgQGlpqatiISIiov8vNjYWWq3W02FQK8Lbu0REREQ+gEkfERERkQ9g0kdERETkA5j0EREREfkAJn1EREREPoBJHxEREZEPYNJHRERE5AOY9BERERH5ACZ9RERERD6gSU/kaIzExERoNG7bXIsjhMDp06dhMpk8HQq5kEqlglqtrjZpNBqo1WrlNUmSlP+rVCplkiRJea0qx/yqhBAQQlSbJ8uyMs9ut0OWZciyrPxfCKH83263K1NlZaXyf1mWm/cDIp8lSRL8/Pyg1WqVfx3Hh2OSJAlqtVp5j+NYqFreq5bryspKpfzabDZUVFQo/7Isu8fKlSsxb948T4fh88LCwpCTk4OwsLBq892WhTHhuzRJkvgZtSCSJEGr1SqTRqNR/q16AavruZk1kzPH+poaT811VE0Waz7KydkYHImhzWarNlVWVir/VlRU1Lk+Igc/Pz/4+/vD398fAQEBCAgIqHa+q1p+nDkWqpb3mj+K6luX3W5HeXk5LBYLysvLUV5eDqvVyrLrYmfOnEH37t2xZMkST4fis44fP45nnnkGRqPRc0kfUUujUqng5+cHPz8/6HS6av+vmaA7LhzOXrA8zdkYHD9GNBoNAgIC6t1PR/JntVpRUVFRbbLb7S6Pn7xbQEAAAgMDERQUhKCgIKW2TghRZ9lz5TFR37rUajWCgoIQGBioLCPLMsxmM8xmM0wmE8xmM5NAF4iKisKECRM8HYbPOnDgAJ555pk6X2PSRz5PkiTodDrodDqlNsLf379a7VhDSZ03JHLuUN9+Vk0May5XWVmp1KywhqV1UqlUCA4ORkhICEJDQ6FWq+s8ZrzhOKkagyPuoKAgxMbGQggBo9GoTJWVlR6MlMj1mPSRz9HpdAgMDERAQACCgoLg5+enXAjcURPRmtX1OWk0GuXCWvX1iooKmEwmWCwWmM1mJoItjCRJCA4ORnh4OEJDQyFJUrXjpyUdM1VjdiSuAGAymVBSUgKDwcA2gdQqMOmjVk2lUim3mRyJnkqlqrfmriVdqFqamp+to+1jeHi4kjCUl5fDZDIpEy+03ker1SIqKgrh4eHQaDQtNtGrT9V9cNyeFkKgtLQURUVFsFgsHoyOqGmY9FGrIkkSAgICEBwcjODgYAQEBNSqgXAsR55X8zsJCAiAv78/oqOjAQAWiwVlZWVKeysmgZ7j7++PmJgYpRasNSV6DZEkCWFhYQgPD4fJZEJhYSGMRqOnwyJqNCZ91OKp1WrllkxwcLBSk8ckr2Wq+l05ksCYmBgIIVBWVgaDwcD2Vm6k0+kQFxeHkJCQeps/+ALHfgcGBqJTp04oLy/H+fPnUVZW5uHIiJzHpM8HFRQU4MCBA9i3bx/Onz+PDRs2eDqkRtNoNAgNDUVYWJjSG6+13Waii2q2twoJCQEAmM1mGAwGlJaWwmazeTLERvvjjz+watUqHDlyBJIkISkpCf/4xz8QExPj6dAUGo0GsbGxiIyMbFTv9NbO8RnodDp07twZZWVlOH/+PMrLyz0cWf1Wr16Nhx9+mG1miUmfL4qNjUVSUhKeeeYZdOnSxdPhOE2SJAQFBSEyMhIhISFsj+fjHG004+LiYDabodfrodfrvf4W8KlTp7B69WqMGzcOs2fPRmpqKrZu3Yri4mK88847ng4PABAeHo62bdsqY+Dx2KrN8ZkEBQUhISEBFy5cwIULF7wusfr+++8xf/58T4dBXoJJn4+Ki4vzdAhO8/PzQ2RkJCIiIpShIHgRIqD6LbfAwEDExcVBr9ejqKgIVqvVw9HVLSMjA8uXL4dOpwMAPP/88/jPf/6Dn3/+2cORXWwq0b59e6XdHjXMUQZjYmIQFhaG3Nxcryl7er0e6enp6NixI44fP+7pcMgL8Nm75LX8/f3RsWNHdO/eHVFRUcoAr0z4qD4qlQoRERHo1q0bOnXqhMDAQE+HVMvkyZOVhM/Bbrfj7rvv9lBEF/n7+6Nr167K7XNqHMdj5RISErwmaV6yZAkef/xxnjNJwZo+8joBAQFo06YNgoOD2ZaIGs1RVhyDBZvNZuTn53vtc61ff/11PPHEEx5N+kJCQtCxY8c6H+dHznN8fldccQXy8/Nx4cIFj8WyevVqJCcne00CSt6BSR95DY1GgzZt2iAiIoLJHjWZo+wEBASgS5cuMBgMOHfunNd0+ti9ezdSU1Nx+PBhtG/fHgA8kviFhITgiiuu4LHmYm3atIEkSSgoKHD7tjMzM1FZWYnrr7/e7dsm78akj7xCZGQk4uLi2PuWXM5Rlhw9fwsKClBYWOjxBvf9+/dH586dcfDgQaxcuRILFy6EWq3G2LFj3RZDcHAwE75mFBsbC1mWUVhY6LZtFhcXY926dV7TKYi8C5M+8ii1Wo0OHTqwHRE1O0diExsbi9DQUOTk5Hh0rD9HEhofH4+QkBA8+eST2Lp1q9uSPj8/PyZ8bhAXFwer1eq2wZxnzZqFmTNn4vfff1fmOTqWHD9+HFqtFvHx8W6JhbwPkz7yGH9/f3Tq1AkaDYshuY8kSfD390e3bt2Ql5fnFYPr3nLLLQAuPuLMHSRJUtrwUfPr0KEDTpw44ZYfGVu2bMGnn35a52uJiYno2rUrTpw40exxkHdi713yiMDAQMTHx0Oj0fDC00gFBQXYuHEjXnjhBU+H0mJJkgS1Wo3OnTsjLCzM0+Eot/9uvvlmt2wvKioK/v7+Lf7Ys9ls2L9/v6fDaJBKpUK7du3csi2LxQIhRLUpMTERACCEYMLn41pM0vfDDz9gzpw5Su+oSZMm4csvvwQAZGVl4d5774UkSbjmmmvw4osvVus1lZSUhMcff9xToXslR3W/Jway9ff3R5cuXaBSqdx+0WnpZeG3337Dc889h+TkZKxfv97T4bQKHTp0QHBwsNu2l5qais8//1ypYayoqMDKlStx++2347777mv27atUKsTExLTohK+kpAQLFixAREQEBg4c6OlwGiRJEkJDQxEQEODpULzaxo0bMXr0aPTt2xe33XYbxo4dizlz5mD58uX4xz/+4enwWoUWc1+tb9++6Nu3L7Zt24acnBy8//77ylhX/fv3R0VFBZKTk/HBBx/UOrC6dOkCf3//Rm/zzJkz6NChg0vid7ULFy5g586d0Ov1mDNnTqPem5WVpSTMZ8+exfvvv48bb7wRPXr0cOr9BoMBr7zyCpKSkjBkyJBaY45dikqlQqdOnRoVryu19LKQmJiIl19+GW+88YanQ2k1HLc63XX7zWQy4ZNPPsFLL72EO+64A1qtFpMmTcKAAQOcXocQAsuWLUO3bt0wfPjwRtVWRkVFKU/aaKkiIiLwwgsv4N133/XaoXhqEkIgNjYWOTk5Tr+noKAA6enpyM3NxfLly5sxutoKCwuxYMECjBgxAiNHjmzWhLWwsBDJycnIy8vDhx9+qPQ6FkLgo48+wiOPPIJx48Y12/Z9iSSa0IUtLy8PpaWlTi3bu3fvy91MNT179sRvv/1Wrefd3LlzUVpainfeecdlJ7PTp08jJSUFe/fudcn6nNHQ52k0GvHNN99g69atOHz4MGRZRkBAAA4dOuS2GAHg6NGjuP/++wFcfP7ksGHDMGrUKNxwww3KAMr1iYuLQ1RUVIuqZfBEWWiIJElITExEdna2p0NpFYQQMBgMyMvL83QoTjGZTEhKSgJwsTPUjTfeiNGjR+OWW25p8EdNt27dGvVDzZvVdT3wZkIIZGdnX/IOS1lZGXbv3o3t27fj4MGDsNvtUKvVbu90tHfvXgwePBjAxeY448ePx+TJkzF06NBLtsN+7LHHkJmZiQMHDji1HSEEbr75ZmRnZ+PEiROIjIystcyePXvw1ltvIS0t7fJ2xsccOHAAN910E/Ly8mpWVmS0mJq+utjtdsycORMA8O6777oskTh79ixGjRoFu93ukvU1hdVqRUZGBr766it88803qKyshCRJXvN8UavVip07d2L79u0ICgrCrbfeijFjxmDAgAG1vg+1Wt3iEj5vKgvUfCRJQlhYGAoKCrzmEVrOstvt2L9/P/bt2weNRoOkpCSMGzcOt9xyS62OIVqtttUkfC2RJEkICQmp9eO+oqICBw4cwI4dO/D111/DZrNBpVJ5zXnHbDYjLS0N69evR2hoKMaOHYuUlBQMHTq0yefzzZs3Y//+/VixYkWdCR8ADB48GEVFRU3aDl3UYuv4y8vLcc8990CtVmPt2rV1FjxZlrFx40Y88MADyi+WLVu2YMaMGejYsSP0ej0eeOABREdH46qrrsLhw4cBAB988AF+/fVXnD9/HrNmzVLWZzAY8MQTT+DJJ5/EvHnzcNttt2HevHnQ6/Uu3TdZlvHDDz9g8eLFuPnmm/Hwww9j586dqKiogCzLXnMicHD8AjWZTNixYwemTZuGIUOGYNmyZfjhhx+U5Tw5Mryry0J5eTlWrFiBqVOnon///hg+fDh++eUXyLKMPXv2YO7cuejSpQv++usvDBkyBJ06dUJqamqD2wOAEydOYMKECZg/fz5SUlIwaNAglzyX1WazYfHixZg+fTqeeuopzJw5E8uXL0evXr0AAOvWravWztJoNGLlypW12l7Wt++uWoenCCG8olPH5ZBlGUII2Gw2ZGRkYN68eRg4cCCefPJJ/Oc//1F+JDbnLbpvv/0WOp0OISEh+O6771BaWoopU6ZAkiTccsst+PXXXwEAR44cQbt27bB27VoAlz6vXup4quu8+/LLL8Pf3x//93//p3TwuJxj1dXndAchhPIdOM7zL774IoYMGVLtPC+E8NrzvMFgwCeffILhw4ejbdu2eOSRR7Bv377LXu/mzZsBAEOHDr3kclUHLm/oWuzMuR0Avv/+eyQlJWHOnDl49tlnodVqYTKZnDqPmc1mfPjhh5g0aRJuuukmZGZmom/fvujcuTP279+P33//HXfddRdiYmLQs2fPatsFPFguRRPk5uaKn3/+2anJVRITEwUAMXjwYAFApKenNxgjAJGYmCiEEOLMmTMiODhYABBLly4VOTk5YsOGDQKAGDBggPK+qu8RQgij0Si6d+8uFi1apMwrKCgQ3bt3F/Hx8UKv1zd537Zv3y4mT54swsLCBAChVqsFgEtOAQEBTn8Hrpocn1dDk1arFQBEx44dxaxZs0RWVpaQZbnJn9PlclVZEEKIadOmid9++035e8SIEaJNmzaisLBQHDhwQAQGBgoA4sUXXxTffPONmDp1qjh+/LhT2+vWrZtISEgQQghhs9lEeHi46N27d7Xt1xXTpdjtdjF48GBx7733Kt+ByWQSISEhouppICEhodrfdc2rb98NBoPL1uEpZWVlbj+eLmfKzMxs1DEYEREhJk+eLNLT05v1GJw9e7bw9/cXpaWlQgghLBaLaNOmjbj//vuVZSorK8WgQYOEEA2fVwsKCuo9nsrKypTrgRBCFBcXiylTpoiffvqpWkyXc6yWlZU122eUmZkp/v73v4uIiAinz/NqtbrZ4qnPnj17nCpjfn5+AoDo2rWrWLhwoXjwwQfFDTfc4PR2+vfvLwAoZaYhzlyLnT23d+/eXURGRip/T5w4URQUFAghGj6PybIsTp48KQCIsLAwsX37dnHs2DEBQHTu3Fn885//FKWlpeLIkSMCgBgyZEi1dTVnudy/f78AIPLy8mq+dKDFJn1LliwRWq1W6HQ6sWvXrku+p+YFskePHrW+zDZt2gidTlfve5566ikBQJw7d67a+1JTUwUA8fjjjzdlt8T06dOdOsDqOhlczvs8NW3evLlJn1NTuaIsHDx4sN7927ZtW7X1FhcXV1u3M9tbuXKlSEtLE0JcPLEkJCQIrVZ7yf1oyFtvvSUAiKNHj14ynqoX0brmObPvrliHp9xwww0eP0aae1q8eHGzfX6Oi96aNWuUeWPGjBHBwcHCaDQKIYTYsmWLePvtt4UQzp9X6zueHOXq1KlT4qGHHhIXLlyo9npTjtXmMHfu3Mv6ziRJ8ni5aczUmHNTUlJSnWWgPo0tM1XVPNfGxMQIAGLVqlVClmXxyy+/KD88GzqPOdTc3/bt29daJjY2VoSHhyt/N3e5vFTS12Lb9D311FO46qqrcM8992Ds2LHYtWuX088ZrOtWcEREBPLz8+t9j+NWQc0nRwwaNAgAnG60Wp/HHnsMNpsNn3/+OfR6PTQajVMNdzUaDVasWNGkbTfW6dOnsXr1aqeWdexHly5dkJKSgmHDhjVzdI1zOWUhKysLvXv3vuQtV8d6IyIiGr29uXPnwmQyYc2aNSguLobVam3y82J37NgB4GIj/obiuRRn9t0d62guzz77LI4dO+bpMBpktVqxYMECp5Z1HIPR0dG477778OCDDzZbXD179sStt96Kt99+G7NmzUJOTg7sdjsqKiqQlpaGadOmITU1Ff/6178AOH9ere94chg5ciSuueYaREdHV5vflGO1OcyZMwc2mw1paWkoKiqCVqt16tiWJAmffPJJs8dXVXZ2NhYuXOjUso796NmzJ6KjoxvVLrZXr17IzMxEdnY24uLiGly+sWWmqprn2jfffBMPPvggHnnkEaxfvx6vv/56k58OVdf7IyMj8dtvvyl/e7JcttikDwDGjBmDtLQ0JCcn44477sCePXtc1ku4Jkev4NOnT+PKK69U5rdp0wYAmtwWqEePHli8eDEeffRR/Pjjj9i5cye2bt2KsrKyS/bcUqlUGDFiRJO23VhHjx69ZNLnOAFER0crYy317NkTMTExbh0PrbkUFRXh1KlTMJvNCAwMrPaaLMtN7kGelZWFiRMnYs2aNZg9ezY+/PDDJq0PAHJzcwEA+fn56Ny582WvxxX73tyf3+USQuD666/3iqF5GtLQMCVqtRp2u71W56qIiIhm3785c+bg7rvvRlZWFt5//32sWLECzz//PNatW4ebbroJnTt3Vr53V51XX3rpJYwaNQp9+vTBE088ocz3trLWpUsXLF68GNOmTVPO89u2bYPRaLzkeV6SJEyYMMGtsTY0WoHjPN+2bVtMmDABDzzwAK699lql966zBg8ejPfeew+ZmZnKk2kuxZXX4vHjx+Paa6/F7NmzsXPnTtx8881Yt24d/va3vzm9jsvhyXLZ4jpyiBpd88ePH4/Vq1ejuLgYI0aMwMmTJ12yHUmSqh2Ajl8R27dvr7acY4gHV9VgqVQq9O3bV2mA/dprr+G2226Dn5+f8hQBb+Towh8cHIyxY8fiX//6F3bv3o358+ejZ8+eAC42hm1JPXcdapaFxMREmM3mWuNmZWdn4/XXX2/y9lJSUmCz2XD77bcDcM0A2l27dgUAbNu2rdr88vLyan87vp+KigoAF4+3qj0Nndl3V6zDEyRJctvzUZuDRqOBSqWCn58fbr31VqxevRr79u3DCy+8gKSkJEiS5JaeyWPGjEHHjh2xaNEimEwm9OrVCzNnzkRWVhZmz55drUOUq86rd955JxYsWIAFCxbgq6++UuZ7Y1mzWq3VzvPfffcd1q5di9tvv115Soq3nuf9/PwAXEysHnzwQXz33Xc4e/YsVq1ahWuvvfay1nn//fejX79+WLVqFc6dO1fnMlarFampqQBcey1euHAh4uPjsWPHDqSlpcFms+Hpp58G0PB5rCk8WS5bXE2fYxR7q9WqDD0we/ZsfPfdd/j4448xaNAg7Nq1S0k0HMsbDAZlHTUvdACUk31lZSU0Gg0SEhJw7tw55OXloWPHjnj88cexadMmrF69GikpKUo19BtvvIGbbrqp0QMkO8PPzw9DhgzBkCFD8PTTTytjN2VmZnrFsC1qtRqyLMPf318ZwHPAgAH1/kopLy+HyWRCYGCgR5I/V5WFsWPHIj4+Hs899xzOnDmDoUOHIjs7G4cOHcKmTZuqrddkMiEoKKhR2zt37hwMBgO+/vprXLhwQemxdejQIbRr1w5RUVH1rqs+M2fOxKeffoqnn34aUVFR6NWrF/bt26c8/svBMfbfkiVLkJKSgm3btimJws6dOzF69OgG990V63A3IQQqKipaXNLneEKRSqXCzTffjFGjRmHw4MH1DstisViUctZc1Go1ZsyYgWeeeUa5fTV48GAkJiYiNDQU8fHxyrLOnlfrO54c5UoIgcWLFyMjIwOTJk3Ct99+iz59+jTpWG0Odf2wUKlUSEpKQlJSEp599ll8++232LZtm3Kb0lvO84GBgUhOTsbkyZMxZMgQlyWmKpUKGzZswO23346BAwfipZdewpgxY6BWq2GxWJCZmYmlS5di6dKlABpfZqqqea596aWXMHfuXISHh+Oee+7BzJkz0b59ewANn8eGDx9eLSF0cNyuLysrU+5sOWJx1OJ5slyqFy1atOhy32wwGJz+5RgbG3u5mwEA/PTTT1i1apXyJImTJ08iLCwMCQkJ+OWXX3Ds2DFkZWWhrKwMn3zyCYxGI/r06YPly5dj3759MBqNCAsLw969e5UPVavVok+fPnjrrbewceNGABe/sIEDB6KwsBDZ2dno06cPevbsCa1Wi5SUFJSUlOCtt97C0aNHsWvXLoSHh2PdunUueVD6pT5PPz8/9OjRA6NHj8a9996LuLg46PV66HQ6tzy6qaqKigps2bJFGU5m0aJFGDFihFMPcLdYLIiMjHR70mc2m7F06VKXlAWNRoNx48bh1KlT+Pe//41du3ahQ4cOeOONN6DT6bBs2TJ8/vnnAC6ONN+xY0fExcVhzZo1+OijjxrcXmRkJPbt24effvoJkydPRnx8PA4ePIjc3Fz069cPL7/8Mg4ePAi9Xo+IiAgkJiY2OCBvly5dEB8fj8OHD2Pz5s04efIkZsyYga+++gqFhYVwnAb69u2LQ4cO4YsvvsDPP/+MRx99FBkZGRg8eDCuuOIK9OrVC+PHj69z3x1tT1yxDneTJAl5eXlNbjvpLpIkYePGjbjqqqswc+ZMPP/88xg7diwSEhIaTOj8/Pya/bm7V155JSorK5VB3IGLdwHuvvvuareXGzqv2my2Oo8nnU6Hl19+WZmv0+nQtWtXhIWFIS0tDWlpaZAkCddeey0mTpzY6GO1uVit1mqPCK1Jq9WiW7duGDlyJO6991707dsXer0ekiTh0Ucfbba46mKxWLB+/XqMGjUKL7zwAtatW4fx48cjPj7+krcfd+7ciTNnzuChhx5yelvR0dGYOnUqhBBIT0/Hs88+i3feeQfvv/8+NBoNVq5cqbRHduZa7Oy5dtGiRfj666+h1+uxdu1atGnTBu+99x7Cw8MbPI9FRERg6dKlyMjIQFlZGW644QacPHkSa9asgSzLMJlMGDBgAN599118/PHHAC4eA4mJiQgJCbmsa4iz8vLy8N577+Gxxx6rOVTamRb3RI7WrDGfZ0sWGRnptoeP06W1tCcaNJeCggIUFBR4Ogy30Ol0tTr0kHucOXOmUWOt9ejRwyUVCu7U2CdykOtd6okcLa5NH7V8xcXFl/y1S43juMV3qen48eOeDtNrlZSU+EzCB1ysbdLr9T6f6LtbRUWFT/yoJ+/W4tr0UeuQn58Pu92OuLg4CCFaZAcPb3G5F28hBIqLiwGg2dt5eavCwkKcP3/e02G4XX5+PkJDQ3ncudFff/3FRJs8jjV95DGFhYU4ffq08ggpcp/ffvsNc+fOVWq45s+f3+AwIK2FEAKyLCMvL88nEz7gYpumM2fOeDoMnyCEwIULF5SOZESexKSPPKqsrAwnT56ExWLxdCg+JTExEa+++iqEEBBC4KWXXmr2noveoqKiAn/88YfP32ozGAy1em+TawkhYLFYfKr5AHk337ufQ17HZrPh1KlTCAsLQ9u2baFWq3nbiVzKUbuXn5+PkpIS1iz/f+fPn4darfZYr+nWTAiB8vJynD59muWNvAaTPvIapaWlMBqNiImJUR6nxOSPmsJxsS0pKVHakVJ1Z8+eBeCex5D5iqoJn6fH2SOqikkfeRVHbUxhYSGioqIQFRUFlUrF5I8axXHburi4GEVFRS1m/D1POXv2LKxWa7OOUedLSktLcfbsWdbwkddh0kdeyW63o6CgAIWFhYiIiEB0dDS0Wi17+lK9HGWjsrJSSfZYs+e8wsJCWK1WdOjQgT+0LoMjwXP8aCXyRkz6yKvJsoyioiIUFRUhKCgIERERCAsL4wWJFI6LrdFoRElJCcrKyljDcpmMRiNOnDiBdu3a1RzJnxpgtVpx5syZRj0ekcjdmPRRi2EymWAymfDXX38hLCwM4eHhSo9T1gD6JovFAr1eD71ez1o9F6msrERubi47VjnB8ePCcVeCPzbI2zHpoxZHlmWUlJSgpKQEarUawcHBCAkJQWhoKFQqFRPAVqjqd2o2m1FaWorS0lJUVlZ6OLLWy9GxKioqCjExMcrTXei/5VGv1yM/P5/lkFoMJn3UotntdiUBUKlUCAoKQnBwMIKDg6HT6QCwFrAlqvqd2Ww2GI1GmEwmGI1G9oZ0I1mWceHCBZSUlCgdq3w5+XPU5On1eqUNJFFLwqSPWg1ZlmE0GmE0GgEAGo0GQUFBSiLo5+cHgEmgNzp58iQef/xxaDQaaDQa6HQ6CCGU7yw4OBiSJCEkJAQAlPZmISEhCAkJQe/evT0Wu3Xf0ZsAAA+dSURBVC+orKxEfn4+Lly44HMdqxz7aLfblQ5CrNmjlopJH7ValZWVSi0gAKhUKvj7+yMoKAiBgYEIDAyEWq0GwETQnap+1rIso7y8HGazGQcOHEB+fj4kSVLakVX9ThzDsAghqrXfkyQJ+/fvVxJCaj5VO1YFBAQgMjISYWFhra5ZhaNGT5IkmM1mFBcXw2AwsM0etXhM+shnyLIMs9kMs9mszPPz84O/v3+1yVG7BDAZbIqan53NZkN5eXm1yXF7TKVS4eOPP8bs2bNx4sQJp2tSJEnC1VdfzYTPAywWC86ePYtz584pNa4tuV2tI2YhBMrKymAwGGA0GlmrR60Kkz7yaRUVFaioqIDBYFDmSZIEnU4Hf39/6HQ6+Pn5Kf+qVP99XHXV2gBfVNf+y7IMm80Gq9UKq9WKiooKJblrqC1edHQ01q9fj6effho7d+50qlZFkiQkJyc3bUeoSWRZVmrUJUlCYGAggoODERQUhICAACWRArzrWKmamFqtVpSVlaGsrAwmk4ntRqnVYtJHVIPjEUp1jbelVqvh5+enTBqNBlqtVpk0mtqHVNXkxZsuenVpKFa73Q6bzVZrciR4TR02RafTYcWKFejSpQvefPNNp5YfMWJEk7ZJriOEUIZWAqAkgYGBgfD390dAQECtmnTHcs0VT831V1ZWwmKxKM0KzGYzh/shn+G2pK8lVve7G9uLeD+73Q6LxQKLxVLvMo5EUKPRQK1WK5Pjb0dnBZVKpTz5oGoNojvIsgwhBGRZhizLqKysRGVlJex2O+x2e63/OyZ3lFFJkjB79my0b98eCxcuVOKsSaPRoHv37vj+++9x4403uv0zpIbVTAKBi9+voxlF1clxzDT1e5RlWflx4qjJd0xWq5UJXjNTq9XIyMjg9d4L1FUJIYkmnMXz8vKURvINCQoKqjMAukgIAaPRyMTPhzkSQLVaXe0xWI7OJg51JYmOJK4qx8XNkTTZ7fZ6EyhvdeTIEcyZMwdms7nOtlW9e/fGr7/+ijZt2mDs2LG466670L59ew9E2jibN29GWloacnNz0bFjR9x///0YN26cp8PyGo4fSFV/GFUt91XLu6NcO36otKZzaI8ePaDVaj0dRqPk5+dj7969ng7D54WFhdV1FyTDbUkfEdHlyM3NxYwZM3D+/Hkl8ZMkCZ06dcLWrVuRk5OD7du3Iz09Hfn5+bjmmmswZswYjBo1Cv7+/h6OvrZXX31ViTMnJwcbN26E1WrFggULcN9993k6PPIiLTHpI6/GpI+IvJ9er8fDDz+Mn376CXa7HWq1GvPmzcOUKVOUZWRZxqFDh7Bx40bs3r0b/v7+uP322zFhwgT06tXLg9H/V35+Pl555RUsW7ZMmXfgwAHMmDEDV1xxBbZv3+7B6MjbMOkjF2PSR0QtQ0VFBRYtWoStW7dCo9Fg9+7diIiIqHPZwsJC7NixA59//jl+//13JCQkYMyYMbjrrrvqfY87HDlyBFdccQWioqKqzR80aBBsNhsyMjI8FBl5IyZ95GJM+oio5RBC4IMPPoDFYsHs2bOdes+xY8ewceNGfPnll6isrMSQIUMwevRoDBo0yGs6f9xwww3o27cv3njjDU+HQl6ESR+5GJM+IvINVqsVe/bswcaNG3Hw4EHExsZi5MiRmDhxItq1a+exuH788UdMnToV69evR8+ePT0WB3kfJn3kYkz6iMj3/Pnnn0hPT0d6ejr0ej2uv/56jB49Grfddht0Op3b4pBlGQ899BCSk5Nxxx13uG271DIw6SMXY9JHRL6rauePXbt2ISgoCCNGjMDEiRORmJjY7Nt//fXXodVqMWPGjGbfFrU8TPrIxZj0EREBQEFBAbZt24bPPvsMubm56NWrF0aPHo3Ro0cjLCzM5dvbs2cP/vjjD/z97393+bqpdWDSRy7GpI+IqCZH54/t27dDlmUMHjwYEyZMwIABA1zypIGMjAzk5eXVem7w0aNHcc011zR5/dQ6MOkjF2ta0nfu3DkUFRW5MiAiIq9RVlaGHTt2YMuWLThy5Ag6deqEO++8E3fddRfatm17Wes8ePAg1q1bh6FDh1abf+bMGQQEBGDOnDmuCJ1aOLVaje7du9d6Ig9REzQt6SMi8hXHjh1Damoq3nvvPRQVFeHWW2/F9OnTMW7cOKdrYzIyMjBs2DCYzeZar0mShJMnTyI+Pt7VoRMRAUz6iIgax2q1YsuWLUhNTcVXX32FmJgYJCcnY+rUqbjqqqs8HR4RUX2Y9BERXa6zZ89iw4YNePvtt/Hnn3+iX79+mD59OiZNmoTg4GBPh0dEVBWTPiKippJlGbt370Zqaio2bdoEjUaDcePGISUlBUOHDnVJ5w8ioiZi0kdE5Ep6vR6ffvop3nrrLRw5cgSJiYl44IEH8OCDDyI2NtbT4RGR72LSR0TUXA4fPozU1FR8+OGHMBqNGDFiBFJSUnDXXXdBo9F4Ojwi8i1M+oiImlt5eTm2bt2KtWvXYteuXWjbti2mTJmCadOmISEhwdPhEZFvYNJHROROeXl5+Oijj/Dmm28iJydH6fwxefJkBAUFeTo8Imq9mPQREXmCo/PH2rVrkZ6ejsDAQEycOBFTpkzBwIEDPR0eEbU+TPqIiDytuLgYmzZtwhtvvIGffvoJvXr1QkpKCh566CFER0d7Ojwiah2Y9BEReZPDhw9j7dq1SEtLQ0VFBcaMGYMpU6bgzjvv5CO5iKgpmPQREXkji8WCbdu2KZ0/2rdvj8mTJ2PGjBno0qWLp8MjopYnQ+XpCIiIqLaAgABMmDABX3/9NbKzszF58mR88MEH6Nq1K4YPH47U1FRYLJZmjeGVV16BJEmcLjFNmDChWb8DIldiTR8RUQtht9vx7bffYu3atfj8888RHByM5ORkzJo1C3369HFqHbm5ufj000/xyCOPQKvVXnLZefPmYevWrVi6dKkrwm91UlNTUVhYiIyMDE+HQuSMDI4OSkTUQqjVagwbNgzDhg3DuXPnkJqainfeeQdr165Fv379MGXKFEyZMgWRkZH1rmPZsmV488038eWXX2Lz5s0IDw+/5DajoqJYm1WPzMxMFBYWejoMIqfx9i4RUQvUtm1bPPHEEzhx4gS+//579OvXD0899RTat2+P5ORkfPPNN6h5I8disWD9+vUAgH379qF///44deqUJ8InIg9g0kdE1ML169cPb7/9Nv766y+sWrUKf/31F4YPH44ePXpg0aJFyM3NBQB89tlnMJlMAACbzYacnBz07dsXe/fu9WT4ROQmTPqIiFqJ0NBQTJ8+Hfv27cPRo0dxxx13YPXq1UhISMCYMWOwevVqqFT/Pe3bbDYYjUYMGzYMGzZs8GDkROQOTPqIiFqhq6++Wqn127BhA8rLy5GVlQW73V5tOVmWYbPZMGXKFMyfP7/WLWEiaj2Y9BERtWI6nQ4TJ07E9ddfD43m0n33/vnPfyI5ObnZh4IhIs9g0kdE1MrJsox3330XNputweXS09MxePBgFBQUuCk6InIXJn1ERK3cjh07cP78eaeWraysxI8//ojrrrsOxcXFzRwZEbkTkz4iolZuw4YNkCQJOp0OOp0OWq0WWq0WkiTVubzNZkNeXh4++ugjGAwGN0dLRM2FgzMTEbVyM2fOxDXXXIOSkhIAQGlpKWRZhsFggN1uR2lpKaxWK0wmE8rLy2GxWFBeXo6SkhKUlpZ6OHoichUmfURErdygQYMwaNCgRr9v3rx5OHDgQDNERESewNu7RERERD6ASR8RERGRD2DSR0REROQDmPQRERER+QAmfUREREQ+gL13iYioWZSWlmLJkiU4efIk1Go1hBBISEjAU089hbCwME+HR+RzWNNHREQu9+uvv+K6666DVqvFZ599hk2bNuGTTz6BWq3Gddddh19++cXTIRL5HCZ9RETkUrIs47777kNcXBxeeOEFqFQXLzUajQYvvvgiunfvjvvuuw92u93DkRL5FiZ9RETkUu+//z5+/vlnzJs3r87X58yZg19++QUffPCBewMj8nFM+oiIyKW++OILAMBNN91U5+tXX301AGDr1q0AgHXr1kGlUinPAjYajVi5cmW1eQBQXl6OFStWYOrUqejfvz+GDx+u3CZ2xTqIWjsmfURE5FLHjx9HUFAQYmJi6ny9Xbt2CAgIQHZ2NgBg2rRpiI+PV14PCQnBY489Vm0eADz88MMYO3Ys3nnnHWRlZUGlUmHYsGEwGo0uWQdRa8ekj4iIXCovLw/R0dH1vi5JEmJjY5GTk6PM02q1tZarOu/QoUNYt24dEhMTIUkSJEnCv//9b+Tn52Pv3r0uWwdRa8YhW4iIyKU6duyIP//8E3a7HWq1utbrsizj3LlziIiIcHqdWVlZ6N27N37++efLjssV6yBqyVjTR0RELtW9e3fYbDacPXu2ztfPnTuHiooK9OnTx+l1FhUV4dSpUzCbzbVek2XZbesgasmY9BERkUvde++9AIAjR47U+fru3bsBAOPHj1fmOTpbVFRUAACEECgtLVVeT0xMhNlsxvLly6utKzs7G6+//rrL1kHUmvH2LhERudSkSZPw8ssv47XXXsPYsWNrvf7qq6/iyiuvxN/+9jdlXmJiIrKzs7FkyRKkpKRg27ZtsFqtAICdO3di9OjRiI+Px3PPPYczZ85g6NChyM7OxqFDh7Bp0yaXrYOoNWNNHxERuZQkSfj444/x+++/Y9asWbBYLAAAs9mMqVOnwmAw4IsvvoCfn5/ynuXLl2PAgAFYuXIl/ud//gcjR47ElVdeiSlTpkCv10OtVmP37t0YM2YM0tPTMW/ePBQUFODDDz9ESEiIy9ZB1JpJQgjh6SCIiMj7zJs3DwcOHEBGRsZlvd9gMOC1117DsmXL0KlTJ5hMJvzv//4vpk+f3iqSrKZ+PkRulsHbu0RE1CxCQ0Px9NNPQ5ZlLFy4EH5+fhg0aFCrSPiIWiLe3iUiomb17LPPYtGiRZBlGSNHjsR3333n6ZCIfBKTPiIianYLFy7EsWPHMG3aNMyfPx8zZ87EmjVrPB0WkU/h7V0iInKLbt26YenSpZ4Og8hnsaaPiIiIyAcw6SMiIiLyAUz6iIiIiHwAkz4iIiIiH8Ckj4iIiMgHMOkjIiIi8gFM+oiIiIh8AJM+IiIiIh/ApI+IiIjIBzDpIyIiIvIBTPqIiIiIfACTPiIiIiIfwKSPiIiIyAdoPB0AERF5J7VajczMTEiS5OlQvNbAgQM9HQKR0yQhhPB0EERE5H3y8/Oxd+9eT4fh1a688kr06tXL02EQOSODSR8RERFR65fBNn1EREREPoBJHxEREZEPYNJHRERE5AP+H/BtFDcGMAHZAAAAAElFTkSuQmCC"/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Pros:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Kinto could be shipped as a "turn-key" solution with a fully functioning stack baked right in; while there would be a queuing service involved (&lt;a href="http://www.celeryproject.org/"&gt;Celery&lt;/a&gt;, for example), it would be completely abstracted by Kinto.&lt;/li&gt;
&lt;li&gt;Since the queuing mechanism is integral, Kinto would have full visibility and control over processing and delivery.&lt;/li&gt;
&lt;li&gt;Apart from the queuing service there would be no additional services or software to deploy.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Cons:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;This would involve a fairly serious increase in the scope, complexity, and size of the Kinto code base.&lt;/li&gt;
&lt;li&gt;The tight coupling means that Kinto, in its entirety, would need to be re-deployed if changes were necessary in the queuing service.&lt;/li&gt;
&lt;li&gt;Similarly, scaling the queue would imply scaling Kinto itself&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This model has certain interesting advantages; however, the relative volume of additional code that would need to be developed is reason enough to give us pause (&lt;a href="https://en.wikipedia.org/wiki/Scope_creep"&gt;scope creep&lt;/a&gt; is a real problem). Like the previous model, this also runs afoul of our tech agnosticism guideline since we would be locking Kinto to a given queuing service directly. Finally, we have (admittedly theoretical) concerns about how this model would scale - it feels like a waste to increase two resources when only one needs to grow, for example.&lt;/p&gt;
&lt;h2&gt;The Broker&lt;/h2&gt;
&lt;p&gt;The final approach is a bit of a mix of the previous two. In this model, we implement a formal "broker" that is part of the Kinto &lt;em&gt;eco-system&lt;/em&gt;, but external to Kinto itself. The broker could be anything from a few lines of Python sitting on a &lt;a href="https://en.wikipedia.org/wiki/Named_pipe"&gt;pipe&lt;/a&gt; to a proper micro-service stack. This decouples the queuing mechanism from Kinto while preserving a strong &lt;em&gt;promise&lt;/em&gt; of interoperability and control.&lt;/p&gt;
&lt;p&gt;&lt;span class="graphviz" style="text-align: center;"&gt;&lt;img src="data:image/png;base64,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"/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Pros:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Provides a clean and easily understandable separation of responsibilities.&lt;/li&gt;
&lt;li&gt;Frees both Kinto and the consumer from any particular service dependency since the transport is pure HTTP between all the components.&lt;/li&gt;
&lt;li&gt;Permits the broker to scale independently from Kinto.&lt;/li&gt;
&lt;li&gt;Requires only a moderate amount of new code in Kinto itself.&lt;/li&gt;
&lt;li&gt;Effectively allows for a highly flexible solution where just about anything imaginable could be plugged in.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Cons:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The broker must speak HTTP and respond properly to a specification of our choosing.&lt;/li&gt;
&lt;li&gt;Functionally requires deploying and maintaining two services (the difficulty of which varies according the complexity of the broker).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We like this model because it satisfies most of our guidelines (and violates none). To be fair, the requirement for "robustness" is a little hand-wavey in this case. We are effectively handing the responsibility to another component; however, since interoperability is a promise, we can maintain an acceptable degree of confidence in the process.&lt;/p&gt;
&lt;p&gt;Another interesting aspect of this model is that by by decoupling the broker from Kinto, one can more easily introduce business logic that would be inappropriate within Kinto itself. A notable example of this is error handling - the manner in which we deal with, say, Balrog delivery issues isn't necessarily universal, and wouldn't make any sense outside of our particular use case.&lt;/p&gt;
&lt;p&gt;A final point worth mentioning here is that the broker could, in principle, be the &lt;em&gt;consumer itself&lt;/em&gt;, which fits into some of the potential use-cases at Mozilla quite nicely.&lt;/p&gt;
&lt;h1&gt;Roadmap&lt;/h1&gt;
&lt;p&gt;As you may have guessed, we've decided to go with the third option (The Broker). From here we have a plan to get from idea to reality, starting with a proof of concept, then through to a &lt;a href="https://en.wikipedia.org/wiki/Minimum_viable_product"&gt;minimum viable product&lt;/a&gt;, and then iterating through improvements until we get to something that's useful to a wider audience.&lt;/p&gt;
&lt;p&gt;Concretely speaking the proof of concept will require:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Defining the &lt;em&gt;types&lt;/em&gt; of events; functionally, this means specifying the behaviour and scope of &lt;code&gt;pre-&lt;/code&gt; and &lt;code&gt;post-&lt;/code&gt; patterns, as well as the structure of the payload.&lt;/li&gt;
&lt;li&gt;Construct a framework for synchronous internal Python events using &lt;a href="http://docs.pylonsproject.org/projects/pyramid//en/latest/narr/events.html"&gt;Pyramid events&lt;/a&gt; (something we have &lt;a href="https://github.com/spiral-project/daybed/blob/master/daybed/events.py"&gt;experience with already&lt;/a&gt;).&lt;/li&gt;
&lt;li&gt;Implement a "listener" in Kinto for those events in order to execute an action.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;From there, we'll move on to the minimum viable product:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Build a minimalist HTTP service that receives a notification via an HTTP &lt;code&gt;POST&lt;/code&gt;, performs an action, and communicates the result to Balrog directly.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Once the model is validated we'll begin the iterative improvement process. This will likely take the form of a "standard broker" which we create and maintain as part of the formal ecosystem. We also like the idea of subscribers registering themselves to the broker using an endpoint (such as webhooks), but that's a discussion for future time.&lt;/p&gt;
&lt;h1&gt;Feedback&lt;/h1&gt;
&lt;p&gt;As always, we're interested in feedback from the community - feel free to use the Disqus form below to join the conversation!&lt;/p&gt;</content><category term="mozilla"></category></entry><entry><title>Les notifications dans Kinto (Préambule)</title><link href="http://www.servicedenuages.fr/en/../notifications-kinto-preamble" rel="alternate"></link><published>2015-08-13T00:00:00+02:00</published><updated>2015-08-13T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-08-13:/en/../notifications-kinto-preamble</id><summary type="html">&lt;p&gt;Les notifications arrivent dans Kinto ! Voici nos pistes de réflexions.&lt;/p&gt;</summary><content type="html">&lt;blockquote&gt;
&lt;p&gt;Traduit de l'anglais par &lt;a href="https://twitter.com/Natim"&gt;Rémy Hubscher&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Lors de notre dernière &lt;em&gt;workweek&lt;/em&gt; dans l'adorable ville de
&lt;a href="https://www.qwant.com/?q=Douarnenez&amp;amp;t=images"&gt;Douarnenez&lt;/a&gt; nous avons
défini les fondations de la prochaine fonctionnalité de
&lt;a href="https://kinto.readthedocs.io"&gt;Kinto&lt;/a&gt; : &lt;em&gt;les notifications !&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt="Coucher de soleil sur Douarnenez (@phrawzty)" src="http://www.servicedenuages.fr/en/../images/notifications-douarnenez.jpg" style="width: 800px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;h1&gt;tl;dr&lt;/h1&gt;
&lt;p&gt;Pour les pressés, un petit résumé : Nous allons ajouter
un système de "notifications" à Kinto, sans perdre de vue la
simplicité et la flexibilité. Notre objectif est de
proposer un protocole qui permette à d'autres systèmes de se brancher
très simplement sur les notifications d'événements de Kinto.&lt;/p&gt;
&lt;h1&gt;Pourquoi ?&lt;/h1&gt;
&lt;p&gt;La réponse la plus simple est que nous en avons besoin. Nous
avons une plateforme appelée &lt;a href="https://wiki.mozilla.org/Balrog"&gt;Balrog&lt;/a&gt;
qui fait partie du système de mise à jour utilisé par Firefox et par
d'autres produits Mozilla.&lt;/p&gt;
&lt;p&gt;Dans l'idée d'améliorer et d'étendre le processus de mise à jour (sous
la houlette du projet "&lt;a href="https://wiki.mozilla.org/Firefox/Go_Faster"&gt;Go Faster&lt;/a&gt;"),
nous avons besoin de stocker et de transmettre de petits blocs d'information à
la fois entre des systèmes internes mais aussi avec l'ensemble de nos
utilisateurs.&lt;/p&gt;
&lt;p&gt;Kinto répond parfaitement au besoin, mis à part en ce qui concerne la
notification des utilisateurs lors d'une mise à jour.&lt;/p&gt;
&lt;p&gt;Aucun problème. Il ne reste plus qu'à ajouter la fonctionnalité.&lt;/p&gt;
&lt;h2&gt;Mais attention à ne pas oublier une petite chose !&lt;/h2&gt;
&lt;p&gt;Bien sûr, Kinto est un projet Mozilla - mais il a été conçu comme une
solution générique, ce qui veut dire que tout ce que nous ajoutons
doit rester raisonnablement générique.&lt;/p&gt;
&lt;p&gt;C'est pourquoi nous avons souhaité proposer une solution réutilisable
dans différents contextes ; nous sommes une organisation qui construit
avec et pour le web c'est pourquoi la solution que nous proposons est
avant tout orientée web.&lt;/p&gt;
&lt;p&gt;En faisant le tour des paramètrages qu'une solution raisonnablement
générique devrait proposer, nous avons défini les exigences suivantes
pour notre système de notifications :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;S'efforcer d'être agnostique autant que possible, c'est-à-dire ne
  pas forcer les développeurs à utiliser une solution
  spécifique. (service, backend voire même langage de programmation)&lt;/li&gt;
&lt;li&gt;Puisque nous sommes orienté web, utiliser le protocole HTTP dès que possible.&lt;/li&gt;
&lt;li&gt;Le système de notification doit être capable de passer à l'échelle
  facilement ; cela s'applique à tous les éventuels systèmes de
  queuing, workers, etc.&lt;/li&gt;
&lt;li&gt;Pour finir ce doit être un système robuste, nous ne souhaitons pas perdre de messages.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;Qu'est-ce que nous essayons de faire ?&lt;/h1&gt;
&lt;p&gt;Avant de rentrer dans les menus détails, prenons un moment pour
décrire ce que nous essayons de faire - sur le papier, au moins, c'est
assez simple :&lt;/p&gt;
&lt;p&gt;&lt;span class="graphviz" style="text-align: center;"&gt;&lt;img src="data:image/png;base64,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"/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Un &lt;em&gt;message&lt;/em&gt; est un morceau d'information qui est envoyé d'un
  endroit à l'autre - par exemple, une requête HTTP. Les messages
  peuvent venir d'autre part, comme par exemple d'un service externe,
  ou être générés en interne.&lt;/li&gt;
&lt;li&gt;Une &lt;em&gt;action&lt;/em&gt; est un processus qui est déclenché en fonction du
  message. Ça peut être aussi simple qu'incrémenter un compteur en
  mémoire. Ça peut aussi être quelque chose de plus complexe comme par
  exemple déclencher une suite de tests. Ça peut aussi être exécuter
  une fonctionnalité de Kinto, un programme local, une fonctionnalité
  ajoutée par un plugin ou tout autre chose.&lt;/li&gt;
&lt;li&gt;Un &lt;em&gt;résultat&lt;/em&gt;, comme son nom l'indique, est ce qui résulte de
  l'&lt;em&gt;action&lt;/em&gt;. Un exemple simple pourrait être la valeur du compteur,
  dont nous avons parlé tout à l'heure, sous la forme d'un entier dans
  un paquet JSON. Mais ça peut également être le résultat de la suite
  de tests (les possibilités sont sans limites).&lt;/li&gt;
&lt;li&gt;Pris dans leur ensemble, les &lt;em&gt;évènements&lt;/em&gt; peuvent être vus comme un
  cycle : un message est reçu, une action a lieu qui génère un nouveau
  message.&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;Une notification est donc la combinaison d'un message et d'une
  action déclenchée suite à un évènement. Le résultat, bien que
  directement lié à l'action ne fait pas partie de la notification.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Cette petite distinction nécessite une explication. L'instigateur du
message n'est pas forcément concerné par ce que Kinto va faire avec.&lt;/p&gt;
&lt;p&gt;En général, il est suffisant de savoir que Kinto a reçu un message et
qu'il sera traité. Cela permet de bien découpler les différents
éléments du système.&lt;/p&gt;
&lt;p&gt;Nous allons continuer à explorer le sens des termes par la suite. Pour
le moment, continuons.&lt;/p&gt;
&lt;h1&gt;Comment ?&lt;/h1&gt;
&lt;p&gt;Il y autant de manière de faire qu'il y a de grains de sables sur la
plage (ceci dit, nous ne l'avons pas vérifié de manière
scientifique). Le meilleur moyen de déterminer l'approche gagnante
reste le duel (à la Mad Max). Malheureusement notre manager a mis son
véto sur ce moyen pour des questions de responsabilité, à la place
nous avons préféré faire des dessins sur un tableau blanc...&lt;/p&gt;
&lt;p&gt;&lt;img alt="Whiteboard (@leplatrem)" src="http://www.servicedenuages.fr/en/../images/notifications-whiteboard.jpg" style="width: 675px; height: auto; max-width: 100%;"/&gt;&lt;/p&gt;
&lt;p&gt;Dans un esprit de transparence, voici quelques unes des solutions étudiées :&lt;/p&gt;
&lt;h2&gt;L'approche simple&lt;/h2&gt;
&lt;p&gt;La première approche et de pousser chacune des notifications dans une
file d'attente (dans Redis ou RabbitMQ par exemple) et c'est tout.&lt;/p&gt;
&lt;p&gt;&lt;span class="graphviz" style="text-align: center;"&gt;&lt;img src="data:image/png;base64,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"/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Avantages:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Ce modèle impacte peu Kinto, Kinto passe simplement le message à la
  queue et l'oublie immédiatement.&lt;/li&gt;
&lt;li&gt;La quantité de code est assez faible - il ne nécessite que le code
  nécessaire pour parler au système de queue.&lt;/li&gt;
&lt;li&gt;Si la communauté Kinto est active il serait possible d'étendre
  rapidement le support à un nombre raisonnable de service externes de
  files d'attente.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Inconvénients:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Chaque service de queue nécessirait un module spécifique à coder et
  qui devrait être maintenu par la communauté.&lt;/li&gt;
&lt;li&gt;L'utilisateur final (destinataire, destination ou autre) du message
  serait responsable de l'intégration avec le protocole du système de
  queue.  Autrement dit, si Kinto est configuré pour utiliser
  RabbitMQ, il faudra que le consommateur des messages parle RabbitMQ
  également.&lt;/li&gt;
&lt;li&gt;Kinto n'a aucun contrôle ni compréhension de ce qui arrive au
  message une fois qu'il a été passé au système de queuing.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;La simplicité du modèle, bien qu'attractive, possède des défauts
importants. Notamment, il va à l'encontre des règles que nous nous
sommes fixées du point de vue d'être agnostique techniquement
puisqu'il impose une technologie au consommateur des messages.&lt;/p&gt;
&lt;p&gt;C'est un modèle un peu dangereux car il n'y a aucune garantie que les
messages arrivent à leur destinataire (bien que tous les systèmes de
queue ne soient pas tous logés à la même enseigne à ce sujet).&lt;/p&gt;
&lt;h2&gt;L'approche intégrée&lt;/h2&gt;
&lt;p&gt;L'approche opposée est d'intégrer le système de queue directement dans
Kinto et de proposer une interface sur laquelle le consommateur puisse
s'enregistrer.&lt;/p&gt;
&lt;p&gt;&lt;span class="graphviz" style="text-align: center;"&gt;&lt;img src="data:image/png;base64,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"/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Avantages :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Kinto serait livré comme une solution clé en main et bien qu'on
  utilise un système de queuing
  (&lt;a href="http://www.celeryproject.org/"&gt;Celery&lt;/a&gt;, par exemple), ce serait
  complètement transparent pour l'utilisateur.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Avec ce système complètement intégré, Kinto aurait une visibilité
  complète du processus et pourrait vérifier que les messages arrivent
  bien à destination.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;À l'exception du service de queue, il n'y aurait aucun autre service à déployer.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Inconvénient :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Cela ferait considérablement augmenter la portée, la complexité et
  la taille de Kinto.&lt;/li&gt;
&lt;li&gt;Le fait que le système soit intégré directement dans Kinto nécessite
  de redéployer Kinto si le système de notification change.&lt;/li&gt;
&lt;li&gt;De la même manière, passer à l'échelle le système de notification
  voudrait dire passer Kinto à l'échelle.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ce modèle a certains avantages ; cependant, la quantité de code
nécessaire est une raison suffisante pour se poser deux fois la
question (le véritable problème étant de ne pas transformer Kinto en
une &lt;a href="https://fr.wikipedia.org/wiki/D%C3%A9rive_des_objectifs"&gt;usine à gaz&lt;/a&gt;).
Comme pour la solution précédente, nous lions l'utilisateur à un
système de queues sans respecter notre règle d'agnosticisme technique.
Enfin, le passage à l'échelle n'apparait pas extrêmement flexible
(bien que ça reste de la théorie) - il semble dommage d'augmenter deux
ressources quand une pourrait suffire.&lt;/p&gt;
&lt;h2&gt;Le courtier (Broker)&lt;/h2&gt;
&lt;p&gt;L'approche finale est en fait un mélange des deux précédentes, nous
implémentons un "courtier" (broker) supporté par l'écosystème Kinto,
mais qui est facilement interchangeable et qui est externe au service
Kinto.&lt;/p&gt;
&lt;p&gt;Ce broker peut être écrit en quelques lignes de Python et intégré
comme le font les jolies &lt;em&gt;stacks&lt;/em&gt; basées sur des &lt;em&gt;micro-services&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Cela permet de découpler le système de queues de Kinto tout en
garantissant l'interoperabilité et le contrôle des messages.&lt;/p&gt;
&lt;p&gt;&lt;span class="graphviz" style="text-align: center;"&gt;&lt;img src="data:image/png;base64,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"/&gt;&lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Avantages :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Proposer une solution propre et qui expose simplement la répartition
  des responsabilités.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Libère à la fois Kinto et le consommateur de toute dépendances
  puisque le transport entre tous les composants se fait en HTTP.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;Permet de passer à l'échelle le Broker indépendamment de Kinto.&lt;/li&gt;
&lt;li&gt;Ne nécessite que très peu de code du côté de Kinto.&lt;/li&gt;
&lt;li&gt;Permet un ensemble de solutions très flexibles qui permettent de
  connecter à peu près n'importe quel consommateur.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Inconvénients:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Le courtier (broker) doit parler HTTP et implémenter un protocole de
  notre choix.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Cette solution nécessite de déployer et de maintenir deux services
  (difficulté qui varie en fonction de la complexité du broker).&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Nous aimons particulièrement ce modèle car il respecte les règles que
nous nous sommes fixées (sans concessions). Pour être tout-à-fait
honnête, le côté "robuste" est un peu approximatif dans ce cas car
nous passons la responsabilité à un autre service.  Cependant grâce au
côté interopérable de la solution nous pouvons avoir un certain degré
de confiance dans le processus.&lt;/p&gt;
&lt;p&gt;Un autre aspect intéressant de cette solution, qui découple le broker
de Kinto, est de permettre à n'importe qui d'y implémenter des règles
métiers alors que ce serait inapproprié de les implémenter dans Kinto.&lt;/p&gt;
&lt;p&gt;Un exemple notable est la gestion des erreurs. La manière dont nous
traitons les erreurs de notification Balrog n'est pas forcément
universelle et aurait peu de sens hors du cadre de notre cas
d'utilisation.&lt;/p&gt;
&lt;p&gt;Pour finir, ça vaut le coup de mentionner ici que le broker
pourrait être directement consommateur (s'il est assez rapide pour ne
pas ralentir Kinto), on a déjà des cas d'utilisations à Mozilla.&lt;/p&gt;
&lt;h1&gt;Feuille de route&lt;/h1&gt;
&lt;p&gt;Comme vous vous en doutez, nous avons opté pour la troisième solution
(Le courtier). Notre feuille de route pour passer de l'idée à la
réalisation, en commençant par un prototype, puis par un
&lt;a href="https://en.wikipedia.org/wiki/Minimum_viable_product"&gt;MVP&lt;/a&gt; et pour
finir en améliorant par itération jusqu'à arriver à une solution
utilisable par la communauté.&lt;/p&gt;
&lt;p&gt;Concrètement le prototype nécessite :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;De définir les types d'évènements, s'il faut que l'évènement soit
  déclenché avant ou après ainsi que la structure des informations
  envoyées lors d'un évènement.&lt;/li&gt;
&lt;li&gt;D'activer des évènements Python synchrones en utilisant &lt;a href="http://docs.pylonsproject.org/projects/pyramid//en/latest/narr/events.html"&gt;le système
  d'évènements de
  Pyramid&lt;/a&gt;
  (ce que nous avions déjà fait &lt;a href="https://github.com/spiral-project/daybed/blob/master/daybed/events.py"&gt;dans
  Daybed&lt;/a&gt;).&lt;/li&gt;
&lt;li&gt;D'implémenter un backend de notifications dans Kinto permettant de
  s'enregistrer sur ces évènements.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ensuite, pour la partie MVP, nous ajouterons :&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Réaliser un service HTTP minimaliste (basé sur une ioloop) qui
  recevra les notifications via un &lt;code&gt;POST&lt;/code&gt; HTTP, qui réalisera une
  action et enverra le résultat directement à Balrog.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Une fois le modèle validé on continuera à l'améliorer de manière
itérative, probablement sous la forme d'un "broker standard"
configurable qui sera maintenu comme partie de l'écosystème.&lt;/p&gt;
&lt;p&gt;Nous aimons bien l'idée d'avoir des consommateurs qui viendraient
s'enregistrer seuls directement sur le broker comme des webhooks, mais
ce sera l'objet d'une discussion future.&lt;/p&gt;
&lt;h1&gt;Impressions&lt;/h1&gt;
&lt;p&gt;Comme toujours, nous souhaitons avoir vos retours.&lt;/p&gt;
&lt;p&gt;Nous écrivons avant tout ces articles pour échanger avec vous, alors
n'hésitez surtout pas à poster vos questions, remarques,
interrogations via les commentaires par exemple.&lt;/p&gt;</content></entry><entry><title>Making the case for Cliquet?</title><link href="http://www.servicedenuages.fr/en/why-cliquet" rel="alternate"></link><published>2015-07-14T00:00:00+02:00</published><updated>2015-07-14T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-07-14:/en/why-cliquet</id><summary type="html">&lt;p class="first last"&gt;Based on Pyramid, Cliquet is a project that allows you to concentrate on
the essentials when building APIs.&lt;/p&gt;
</summary><content type="html">&lt;div class="admonition note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;Translated from the French by &lt;a class="reference external" href="https://twitter.com/phrawzty"&gt;Dan Phrawzty&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;tl;dr Cliquet is a Python toolkit for building APIs that implements best
practices in terms of production use and the HTTP protocol.&lt;/strong&gt;&lt;/p&gt;
&lt;div class="section" id="the-origins"&gt;
&lt;h2&gt;The Origins&lt;/h2&gt;
&lt;p&gt;The objective for the first trimester of 2015 was to build a service for
storage and the &lt;a class="reference external" href="http://www.servicedenuages.fr/en/../service-de-nuages"&gt;synchronisation of a reading list&lt;/a&gt;. At the outset of the project we
tried assembling all of the best practices and recommendations from different
teams and currently deployed projects. Also, we wanted to take advantage of the
&lt;em&gt;Firefox Sync&lt;/em&gt; protocol for offline sync since it's robust and proven.&lt;/p&gt;
&lt;p&gt;Rather than write &lt;a class="reference external" href="http://blog.octo.com/en/design-a-rest-api/"&gt;yet another&lt;/a&gt;
&lt;a class="reference external" href="http://www.vinaysahni.com/best-practices-for-a-pragmatic-restful-api"&gt;article&lt;/a&gt;
we decided to assemble what was already out there into a more formalised
protocol.&lt;/p&gt;
&lt;p&gt;At the time we had two projects in the pipeline that obeyed more or less the
same rules, so we decided go with a common implementation of these best
practices (and resulting protocol) in the form of a re-usable toolkit.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Cliquet&lt;/em&gt; was born.&lt;/p&gt;
&lt;img alt="Cliquet logo" class="align-center" src="http://www.servicedenuages.fr/en/../images/cliquet-logo.png" style="width: 300px; height: auto; max-width: 100%;"/&gt;
&lt;div class="section" id="the-intentions"&gt;
&lt;h3&gt;The Intentions&lt;/h3&gt;
&lt;blockquote class="epigraph"&gt;
What JSON structure should I use for my API? Which syntax for filtering
the querystring? How do I deal with concurrent writes? And what about
synchronising data on the client-side?&lt;/blockquote&gt;
&lt;p&gt;Today, when a new project wants to take advantage of a REST API for storing and
consuming data, it is entirely reasonable to use the stock HTTP protocol and
to concentrate only on the bare essentials. This goes for the clients as well,
since the majority of code that handles interaction with the server is
reusable.&lt;/p&gt;
&lt;blockquote class="epigraph"&gt;
How can I verify if the service is operational? How about StatsD?  Is
Sentry configured properly? How can I deploy a new version without breaking
client apps?&lt;/blockquote&gt;
&lt;p&gt;Cliquet provides everything you need to get you started in production - by
design, the transition from prototype to operational service is smooth and
rapid. Out of the box, the service will have facilities for monitoring and
configuration, as well as aides for deployment and version deprecation. As
these realities evolve in the real world, so does the toolkit.&lt;/p&gt;
&lt;blockquote class="epigraph"&gt;
Which storage backend should I use for the JSON documents? What happens if
the Ops team mandates that we use PostgreSQL? And what if we want to
switch to a Redis, or even memory-based backend, for local testing and
development?&lt;/blockquote&gt;
&lt;p&gt;One word: abstraction. This concept lies at the heart of our our entire
implementation. Those two projects mentioned previously were, at their most
simple, HTTP services that exposed a CRUD REST API backed by persistent JSON
data stores. Since neither Pyramid nor Cornice (which we'll touch on later)
were quite ready to handle this situation, we decided to introduce some classes
to abstract the rudiments of both the REST model and of storage backends in
general.&lt;/p&gt;
&lt;p&gt;An important tenet in all of our projects is that of flexibility. This means
that we try to make things optional where we can (and malleable where we
can't) - Cliquet is no different. &lt;em&gt;Everything is configurable&lt;/em&gt; right from the
&lt;tt class="docutils literal"&gt;.ini&lt;/tt&gt; file! What's more, all of the projects that use the toolkit are
deployed in exactly the same way - only the &lt;em&gt;configuration&lt;/em&gt; is different.&lt;/p&gt;
&lt;img alt="A meeting in Paris..." class="align-center" src="http://www.servicedenuages.fr/en/../images/cliquet-notes-whiteboard.jpg" style="width: 500px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="the-protocol"&gt;
&lt;h2&gt;The Protocol&lt;/h2&gt;
&lt;blockquote class="epigraph"&gt;
Is a REST API sufficient? Is it really necessary to re-read the HTTP spec
every time? Why are we reinventing the same protocol over and over?&lt;/blockquote&gt;
&lt;p&gt;As a group, web developers tend to spend way too much energy on reinventing
the wheel with every project, which is especially heinous since many of the
decisions are arbitrary at best. This behaviour can at least partially
explained by the sheer immensity of the HTTP specification, and all which it
contains, including header formats, CORS support, content negotiation and mime
types - not to mention trickier topics like the difference between authentication
and authorisation, and how to interpret HTTP status codes...&lt;/p&gt;
&lt;p&gt;In Cliquet, these are the principal questions we sought to answer definitively:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;REST resources&lt;/strong&gt;: The two URLs of a resource (one each for collections and
records) accept verbs and precise headers.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Formats&lt;/strong&gt;: The structure of the JSON responses, as well as the &lt;a class="reference external" href="http://www.servicedenuages.fr/en/pagination-continuation-token"&gt;pagination
of lists&lt;/a&gt;, or the syntax for
filtering and sorting of resources via the
&lt;a class="reference external" href="https://en.wikipedia.org/wiki/Query_string"&gt;querystring&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Timestamps&lt;/strong&gt;: A revision counter that is auto-incremented with every write
operation in a collection.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Synchronisation&lt;/strong&gt;: Levers to retrieve and send changes to the data (without
loss or collision) using timestamps.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Permissions&lt;/strong&gt;: Specifically, user-level permissions on a collection or a
record. (&lt;em&gt;This is a work in progress&lt;/em&gt;) &lt;a class="footnote-reference" href="#id3" id="id1"&gt;[1]&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Batch operations&lt;/strong&gt;: A URL that accepts a series of JSON-formatted requests
and provides the response(s).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;From an operational perspective we looked at the following:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;Version control&lt;/strong&gt;: The cohabitation of multiple versions in production
along with alerts in the headers for versions which are end-of-life.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Deferred requests&lt;/strong&gt;: Client headers that can be activated during periods of
maintenance or heavy usage - the idea being to help save the server from
extraneous load.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Error channel&lt;/strong&gt;: All errors returned by the server have the same JSON
format and a specific identifier.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Utilities&lt;/strong&gt;: Various URLs that expose select metadata, public settings, and
other highly monitorable information (to keep your local sysadmin happy).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The Cliquet protocol is thus a compilation of:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Best practices for HTTP APIs (it's what we do for a living, after all);&lt;/li&gt;
&lt;li&gt;Advice from senior system administrators whose jobs it is to maintain
services for the many millions of Firefox users;&lt;/li&gt;
&lt;li&gt;Feedback from the &lt;em&gt;Firefox Sync&lt;/em&gt; team regarding concurrency management and
"offline-first" design.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Want to know more? No problem since it's &lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/api/index.html"&gt;documented in great detail&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In an ideal world this protocol would be versioned and formalised in an RFC.
Perhaps there would even be several implementations in different languages.
&lt;a class="footnote-reference" href="#id4" id="id2"&gt;[2]&lt;/a&gt;&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id3" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;See our dedicated article on &lt;a class="reference external" href="http://www.servicedenuages.fr/en/handling-permissions"&gt;permissions in Cliquet&lt;/a&gt;.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id4" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id2"&gt;[2]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Bear in mind that we're a very small team!&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="the-toolkit"&gt;
&lt;h2&gt;The Toolkit&lt;/h2&gt;
&lt;div class="section" id="technical-choices"&gt;
&lt;h3&gt;Technical Choices&lt;/h3&gt;
&lt;p&gt;Cliquet, the protocol, is currently implemented in Python (&lt;em&gt;2.7, 3.4+, pypy&lt;/em&gt;)
with &lt;a class="reference external" href="http://trypyramid.com/"&gt;Pyramid&lt;/a&gt; &lt;a class="footnote-reference" href="#id6" id="id5"&gt;[3]&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Pyramid&lt;/strong&gt; is a web framework that is responsible for all things HTTP; it
is usable by projects of all sizes, great and small.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Cornice&lt;/strong&gt; is an extension for Pyramid written by Alexis and Tarek that
consists of reusable &lt;em&gt;boilerplate&lt;/em&gt; code. The goal here is to avoid reinventing
the wheel each time when building a REST API with Pyramid. Cornice handles
the plumbing for things like HTTP verbs and methods, header validation,
content negotiation, HTTP return codes, CORS headers, JSON schema validation,
and so forth.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Cliquet&lt;/strong&gt;, in turn, uses both Pyramid and Cornice to implement the protocol
and provide the necessary abstractions; both remain available for expanding
and extending from what comes in the box.&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id6" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id5"&gt;[3]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;We started with an implementation using &lt;em&gt;Python-Eve&lt;/em&gt; (Flask) but we weren't
satisified with the API configuration process - too much hand-waving and
black magic for our taste.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="concepts"&gt;
&lt;h3&gt;Concepts&lt;/h3&gt;
&lt;p&gt;Conceptually the toolkit reflects the protocol - there are some interesting
additional elements, however:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;Backends&lt;/strong&gt;: Abstractions for storage, caching, and permissions (ex.
&lt;em&gt;PostgreSQL, Redis, in-memory, etc.&lt;/em&gt;)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Monitoring&lt;/strong&gt;: JSON-formatted logs and real-time instrumentation (StatsD)
to keep tabs on performance and health.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Configuration&lt;/strong&gt;: The configuration itself can be loaded from environment
variables or the &lt;tt class="docutils literal"&gt;.ini&lt;/tt&gt; file - or a combination of both.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Flexibility&lt;/strong&gt;: Most of the components can be turned on or off (or
substituted completely) via the configuration alone.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Profiling&lt;/strong&gt;: Built-in development utilities to help find &lt;a class="reference external" href="https://en.wiktionary.org/wiki/bottleneck"&gt;bottlenecks&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;img alt="Cliquet concepts" class="align-center" src="http://www.servicedenuages.fr/en/../images/cliquet-concepts.png" style="width: 500px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;By proportion, the number of lines of code that are necessary to support REST
outweighs that of any other component in Cliquet. This is a feature; Cliquet
provides a wide range of functionality and can therefore be used in any
number of contexts (even without manipulating data).&lt;/p&gt;
&lt;p&gt;The primary objective of the toolkit is aid the developer in building their
application with a minimum of fuss. You mix and match only what you need, and
every component is guaranteed to be production-ready.&lt;/p&gt;
&lt;p&gt;For example, the persistence furnished by default is &lt;em&gt;schemaless&lt;/em&gt; (e.g. JSONB)
but there's no reason a relational storage model couldn't be implemented. Since
all of the moving parts can be replaced directly via the configuration, it's
entirely feasible to extend Cliquet with business logic or other exotic
elements. We've got even more ideas in the "ecosystem" portion of &lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/ecosystem.html"&gt;our
documentation&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In a few weeks well be introducing the idea of "events" (or "signals")
which will allow plugins to interface in a much cleaner way.&lt;/p&gt;
&lt;p&gt;We put a high value on code &lt;em&gt;readability&lt;/em&gt;, as well as the importance of
patterns, tests, and documentation. If you have any feedback, suggestions,
accolades, or criticisms, don't hesitate to &lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/issues"&gt;let us know&lt;/a&gt;!&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="cliquet-in-action"&gt;
&lt;h2&gt;Cliquet in Action!&lt;/h2&gt;
&lt;p&gt;We wrote a &lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/quickstart.html"&gt;quickstart guide&lt;/a&gt; that requires
no knowledge of &lt;em&gt;Pyramid&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Here are some examples to illustrate how straightforward Cliquet can be!&lt;/p&gt;
&lt;div class="section" id="step-1"&gt;
&lt;h3&gt;Step 1&lt;/h3&gt;
&lt;p&gt;Activate Cliquet:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;cliquet&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pyramid.config&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Configurator&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;global_config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;config&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Configurator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;cliquet&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'1.0'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;make_wsgi_app&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;From here, most of the features of Cliquet are active and ready to be used.&lt;/p&gt;
&lt;p&gt;For example, the &lt;em&gt;hello&lt;/em&gt; (&lt;tt class="docutils literal"&gt;/v1/&lt;/tt&gt;) or &lt;em&gt;monitoring&lt;/em&gt; (&lt;tt class="docutils literal"&gt;/v1/__heartbeat__&lt;/tt&gt;)
URLs, but also the storage and cache backends that are available in the classic
views in either Pyramid or Cornice.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="step-2"&gt;
&lt;h3&gt;Step 2&lt;/h3&gt;
&lt;p&gt;Add some views:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;global_config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;config&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Configurator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;cliquet&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'1.0'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;scan&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"myproject.views"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;make_wsgi_app&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The first step in defining a CRUD resource is to define the schema with
Colander:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;cliquet&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;schema&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;BookmarkSchema&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;schema&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ResourceSchema&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;schema&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;URL&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="nd"&gt;@resource.register&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Bookmark&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BaseResource&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;mapping&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;BookmarkSchema&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;From here, the CRUD resource is available at &lt;tt class="docutils literal"&gt;/v1/bookmarks&lt;/tt&gt; with all the
synchronisation, filtering, sorting, paging, and timestamp features ready to
go. By default the records are private (per user).&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="err"&gt;http&lt;/span&gt; &lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="s2"&gt;"http://localhost:8000/v1/bookmarks"&lt;/span&gt;
&lt;span class="err"&gt;HTTP/&lt;/span&gt;&lt;span class="mf"&gt;1.1&lt;/span&gt; &lt;span class="mi"&gt;200&lt;/span&gt; &lt;span class="err"&gt;OK&lt;/span&gt;
&lt;span class="err"&gt;...&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nt"&gt;"data"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
        &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nt"&gt;"url"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"http://cliquet.readthedocs.io"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="nt"&gt;"id"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"cc103eb5-0c80-40ec-b6f5-dad12e7d975e"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="nt"&gt;"last_modified"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1437034418940&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="step-3"&gt;
&lt;h3&gt;Step 3&lt;/h3&gt;
&lt;p&gt;There's lots of room to change things up, such as the URLs and HTTP verbs, or
even modifying the fields before they're saved.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nd"&gt;@resource.register&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;collection_path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'/user/bookmarks'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                   &lt;span class="n"&gt;record_path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'/user/bookmarks/{{id}}'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                   &lt;span class="n"&gt;collection_methods&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'GET'&lt;/span&gt;&lt;span class="p"&gt;,))&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Bookmark&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BaseResource&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;mapping&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;BookmarkSchema&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;process_record&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;old&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;old&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'device'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="n"&gt;old&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'device'&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
            &lt;span class="n"&gt;device&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'User-Agent'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'device'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;device&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;new&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For more information, see the &lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/reference/resource.html"&gt;resource documentation&lt;/a&gt; .&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="step-4-optional"&gt;
&lt;h3&gt;Step 4 (optional)&lt;/h3&gt;
&lt;p&gt;Let's try using Cliquet &lt;em&gt;abstractions&lt;/em&gt; in a Cornice &lt;em&gt;view&lt;/em&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;cliquet&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Service&lt;/span&gt;

&lt;span class="n"&gt;score&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Service&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"score"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'/score/{game}'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="n"&gt;description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"Store game score"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="nd"&gt;@score.post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;schema&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ScoreSchema&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;post_score&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;collection_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'scores-'&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;match_dict&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'game'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;user_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;authenticated_userid&lt;/span&gt;
    &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;validated&lt;/span&gt;  &lt;span class="c1"&gt;# c.f. Cornice.&lt;/span&gt;

    &lt;span class="n"&gt;storage&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;registry&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;storage&lt;/span&gt;
    &lt;span class="n"&gt;record&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;storage&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;collection_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="feedback"&gt;
&lt;h2&gt;Feedback&lt;/h2&gt;
&lt;p&gt;Have something you'd like to say? Want to get involved? Great! We love
community contributions and would be glad to help you get started.&lt;/p&gt;
&lt;div class="section" id="areas-for-improvement"&gt;
&lt;h3&gt;Areas for improvement&lt;/h3&gt;
&lt;p&gt;We're quite proud of what we've built in a relatively short time frame, and as
we noted in a &lt;a class="reference external" href="http://www.servicedenuages.fr/en/summer-perspectives"&gt;previous article&lt;/a&gt;, there's a lot of potential
just waiting to be tapped. Nonetheless, we are aware of a few areas where we
could improve things - maybe you'd like to help?&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;API Documenatation&lt;/strong&gt;: Right now we don't have a good solution for a project
based on Cliquet to easily integrate all of the API documentation.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Documentation in general&lt;/strong&gt;: It's difficult to write, organise, and maintain
documentation, especially when it's aimed at a general public that runs the
gamut from absolute beginner to expert. We are victims of the "&lt;a class="reference external" href="https://en.wikipedia.org/wiki/Curse_of_knowledge"&gt;curse of
knowledge&lt;/a&gt;".&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Protocol&lt;/strong&gt;: At some point we're going to have to properly version the
protocol, which means making a division within versions of Cliquet itself;
this will be necessary if we want to move the ecosystem forward.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Conservatism&lt;/strong&gt;: We're fans of stability and robustness, but we don't live
in a vacuum and must therefore sometimes bend to the realities of the real
world. Moving forward with Python 3 is a part of this (async is a good
target).&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Releases&lt;/strong&gt;: The flip side of factoring. Occasionally we add features or
otherwise evolve the toolkit as a response to the requirements of a specific
project. As a result, we end up having to do waterfall-style project
releases.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="common-questions"&gt;
&lt;h3&gt;Common Questions&lt;/h3&gt;
&lt;div class="section" id="why-python"&gt;
&lt;h4&gt;Why Python?&lt;/h4&gt;
&lt;p&gt;The simple answer is that we like Python! Seriously though, the fact of the
matter was that our timetable was pretty tight - we didn't have time to learn a
new language.&lt;/p&gt;
&lt;p&gt;That and the fact the whole time had just spent on a year on a Node.js project
from which we needed to recover.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="why-not-django"&gt;
&lt;h4&gt;Why not Django?&lt;/h4&gt;
&lt;p&gt;We definitely considered it, especially given the number of fans of the &lt;em&gt;Django
REST Framework&lt;/em&gt; in the team. Ultimately we decided that the flexibility of
Pyramid's lightweight framework was a better fit.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="why-not-an-async-framework-in-python-3"&gt;
&lt;h4&gt;Why not an async framework in Python 3?&lt;/h4&gt;
&lt;p&gt;At the time, the Mozilla Operations team supported only Python 2.7 in
production (much to our chagrin).&lt;/p&gt;
&lt;p&gt;For Reading List &lt;a class="reference external" href="https://github.com/mozilla-services/readinglist/blob/1.7.0/readinglist/__init__.py#L19-L26"&gt;we activated gevent&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;That said, since our only goal is to implement a well-defined protocol, we may
some day write Cliquet in &lt;em&gt;aiohttp&lt;/em&gt; or &lt;em&gt;Go&lt;/em&gt; if the opportunity presents itself.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="why-not-json-api"&gt;
&lt;h4&gt;Why not JSON-API?&lt;/h4&gt;
&lt;p&gt;Like we mentioned in a &lt;a class="reference external" href="http://www.servicedenuages.fr/en/apidays-barcelona-retours"&gt;previous post (fr)&lt;/a&gt;, JSON-API is a specification that
touches on a lot of what we wanted - we didn't know about it when we started
with our own protocol. Since our proposition is pretty minimalist in
comparison, the idea of integrating JSON-API hasn't progressed beyond the
&lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/issues/254"&gt;discussion phase&lt;/a&gt;
yet.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="is-cliquet-a-rest-framework-for-pyramid"&gt;
&lt;h4&gt;Is Cliquet a REST framework for Pyramid?&lt;/h4&gt;
&lt;p&gt;No.&lt;/p&gt;
&lt;p&gt;Beyond the CRUD resources classes in Cliquet (which implement a highly
specific protocol), you must use Cornice or Pyramid directly.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="is-cliquet-sufficiently-generic-for-non-mozilla-projects"&gt;
&lt;h4&gt;Is Cliquet sufficiently generic for non-Mozilla projects?&lt;/h4&gt;
&lt;p&gt;Yes!&lt;/p&gt;
&lt;p&gt;It's designed from the ground up such that every component can be
turned on or off, or substituted entirely, right from the configuration file
(or from the environment).&lt;/p&gt;
&lt;p&gt;If the combination of HTTP, JSON, and CRUD resources satisfies your use case,
then Cliquet is a pretty safe bet for you new application. Combined with
a design based on production best practices and handy abstractions, Cliquet
offers a straightforward way to quickly get up and running with a Pyramid /
Cornice webapp.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="do-the-json-resources-support-complex-relational-models"&gt;
&lt;h4&gt;Do the JSON resources support complex relational models?&lt;/h4&gt;
&lt;p&gt;The built-in persistence layer is relatively simple and should fit almost any
use case where the data have no particular relationship; however, you could
take advantage of the full power of the protocol by using a custom Collection
class to manage these relations.&lt;/p&gt;
&lt;p&gt;As an aside, this might be a good excuse to implement the protocol within the
Django REST framework. :-)&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="is-it-possible-to-do-xyz"&gt;
&lt;h4&gt;Is it possible to do XYZ?&lt;/h4&gt;
&lt;p&gt;We'd like to prepare a series of recipes and tutorials, but for that, we need
to collect idea from the community. Some potential ideas include:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Hooks for GitHub authentication.&lt;/li&gt;
&lt;li&gt;Modifying the JSON logging format.&lt;/li&gt;
&lt;li&gt;Storing mapping (topographical, geo, etc) data.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="can-cliquet-deal-with-files"&gt;
&lt;h4&gt;Can Cliquet deal with files?&lt;/h4&gt;
&lt;p&gt;No. Well, &lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/issues/236"&gt;not yet&lt;/a&gt;
at least.&lt;/p&gt;
&lt;p&gt;We're holding off until we have a concrete need for this functionality at
Mozilla. Should file storage become a thing, it would likely use &lt;a class="reference external" href="http://remotestorage.io/"&gt;Remote
Storage&lt;/a&gt; in order to hook into that
growing ecosystem.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="will-feature-xyz-be-implemented"&gt;
&lt;h4&gt;Will feature XYZ be implemented?&lt;/h4&gt;
&lt;p&gt;Cliquet is already quite well stocked with features. In general, rather than
implementing new functionality, we'd rather work on ensuring that the base
abstractions and extension mechanisms are robust enough to allow for a diverse
plugin-style ecosystem.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>Pourquoi avons-nous fait Cliquet ?</title><link href="http://www.servicedenuages.fr/en/../pourquoi-cliquet" rel="alternate"></link><published>2015-07-14T00:00:00+02:00</published><updated>2015-07-14T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-07-14:/en/../pourquoi-cliquet</id><summary type="html">&lt;p class="first last"&gt;Basé sur Pyramid, Cliquet est un projet qui permet de se concentrer sur l'essentiel
lors de la conception d'APIs.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;strong&gt;tldr; Cliquet est un toolkit Python pour construire des APIs, qui implémente
les bonnes pratiques en terme de mise en production et de protocole HTTP.&lt;/strong&gt;&lt;/p&gt;
&lt;div class="section" id="les-origines"&gt;
&lt;h2&gt;Les origines&lt;/h2&gt;
&lt;p&gt;L'objectif pour le premier trimestre 2015 était de construire un service de
stockage et de &lt;a class="reference external" href="http://www.servicedenuages.fr/en/../service-de-nuages"&gt;synchronisation de listes de lecture&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Au démarrage du projet, nous avons tenté de rassembler toutes les bonnes pratiques
et recommandations, venant de différentes équipes et surtout des derniers projets déployés.&lt;/p&gt;
&lt;p&gt;De même, nous voulions tirer parti du protocole de &lt;em&gt;Firefox Sync&lt;/em&gt;, robuste et éprouvé,
pour la synchronisation des données «offline».&lt;/p&gt;
&lt;p&gt;Plutôt qu'écrire un &lt;a class="reference external" href="http://blog.octo.com/en/design-a-rest-api/"&gt;énième&lt;/a&gt;
&lt;a class="reference external" href="http://www.vinaysahni.com/best-practices-for-a-pragmatic-restful-api"&gt;article&lt;/a&gt; de blog,
nous avons préféré les rassembler dans ce qu'on a appellé «un protocole».&lt;/p&gt;
&lt;p&gt;Comme pour l'architecture envisagée nous avions deux projets à construire, qui
devaient obéir globalement à ces mêmes règles, nous avons décidé de mettre en
commun l'implémentation de ce protocole et de ces bonnes pratiques dans un
«toolkit».&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Cliquet&lt;/em&gt; est né.&lt;/p&gt;
&lt;img alt="Cliquet logo" class="align-center" src="http://www.servicedenuages.fr/en/../images/cliquet-logo.png" style="width: 300px; height: auto; max-width: 100%;"/&gt;
&lt;div class="section" id="les-intentions"&gt;
&lt;h3&gt;Les intentions&lt;/h3&gt;
&lt;blockquote class="epigraph"&gt;
Quelle structure JSON pour mon API ? Quelle syntaxe pour filtrer la liste
via la querystring ? Comment gérer les écritures concurrentes ?
Et synchroniser les données dans mon application cliente ?&lt;/blockquote&gt;
&lt;p&gt;Désormais, quand un projet souhaite bénéficier d'une API REST pour stocker et consommer
des données, il est possible d'utiliser le &lt;strong&gt;protocole HTTP&lt;/strong&gt; proposé
et de se concentrer sur l'essentiel. Cela vaut aussi pour les clients, où
la majorité du code d'interaction avec le serveur est réutilisable.&lt;/p&gt;
&lt;blockquote class="epigraph"&gt;
Comment pouvons-nous vérifier que le service est opérationnel ? Quels indicateurs StatsD ?
Est-ce que Sentry est bien configuré ? Comment déployer une nouvelle version
sans casser les applications clientes ?&lt;/blockquote&gt;
&lt;p&gt;Comme &lt;em&gt;Cliquet&lt;/em&gt; fournit tout ce qui est nécessaire pour être conforme avec les
exigences de la &lt;strong&gt;mise en production&lt;/strong&gt;, le passage du prototype au service opérationnel
est très rapide ! De base le service répondra aux attentes en terme supervision, configuration,
déploiement et dépréciation de version. Et si celles-ci évoluent, il suffira
de faire évoluer le toolkit.&lt;/p&gt;
&lt;blockquote class="epigraph"&gt;
Quel backend de stockage pour des documents JSON ? Comment faire si l'équipe
de production impose PostgreSQL ? Et si on voulait passer à Redis ou en
mémoire pour lancer les tests ?&lt;/blockquote&gt;
&lt;p&gt;En terme d'implémentation, nous avons choisi de &lt;strong&gt;fournir des abstractions&lt;/strong&gt;.
En effet, nous avions deux services dont le coeur consistait
à exposer un &lt;em&gt;CRUD&lt;/em&gt; en &lt;em&gt;REST&lt;/em&gt;, persistant des données JSON dans un backend.
Comme &lt;em&gt;Pyramid&lt;/em&gt; et &lt;em&gt;Cornice&lt;/em&gt; ne fournissent rien de tout prêt pour ça,
nous avons voulu introduire des classes de bases pour abstraire les notions
de resource REST et de backend de stockage.&lt;/p&gt;
&lt;p&gt;Dans le but de tout rendre optionnel et «pluggable», &lt;strong&gt;tout est configurable&lt;/strong&gt;
depuis le fichier &lt;tt class="docutils literal"&gt;.ini&lt;/tt&gt; de l'application. Ainsi tous les projets qui utilisent
le toolkit se déploieront de la même manière : seuls quelques éléments de configuration
les distingueront.&lt;/p&gt;
&lt;img alt="Une réunion à Paris..." class="align-center" src="http://www.servicedenuages.fr/en/../images/cliquet-notes-whiteboard.jpg" style="width: 500px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="le-protocole"&gt;
&lt;h2&gt;Le protocole&lt;/h2&gt;
&lt;blockquote class="epigraph"&gt;
Est-ce suffisant de parler d'«API REST» ? Est-ce bien nécessaire de
relire la spec HTTP à chaque fois ? Pourquoi réinventer un protocole complet
à chaque fois ?&lt;/blockquote&gt;
&lt;p&gt;Quand nous développons un (micro)service Web, nous dépensons généralement beaucoup
trop d'énergie à (re)faire des choix (arbitraires).&lt;/p&gt;
&lt;p&gt;Nul besoin de lister ici tout ce qui concerne la dimension
de la spécification HTTP pure, qui nous impose le format des headers,
le support de CORS, la négocation de contenus (types mime), la différence entre
authentification et autorisation, la cohérence des code status...&lt;/p&gt;
&lt;p&gt;Les choix principaux du protocole concernent surtout :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;Les resources REST&lt;/strong&gt; : Les deux URLs d'une resource (pour la collection
et les enregistrements) acceptent des verbes et des headers précis.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Les formats&lt;/strong&gt; : le format et la structure JSON des réponses est imposé, ainsi
que la &lt;a class="reference external" href="http://www.servicedenuages.fr/en/pagination-continuation-token"&gt;pagination des listes&lt;/a&gt;
ou la syntaxe pour filtrer/trier les resources via la &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Query_string"&gt;querystring&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Les timestamps&lt;/strong&gt; : un numéro de révision qui s'incrémente à chaque opération
d'écriture sur une collection d'enregistrements.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;La synchronisation&lt;/strong&gt; : une série de leviers pour récupérer et renvoyer des
changements sur les données, sans perte ni collision, en utilisant les timestamps.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Les permissions&lt;/strong&gt; : les droits d'un utilisateur sur une collection ou un enregistrement
(&lt;em&gt;encore frais et sur le point d'être documenté&lt;/em&gt;) &lt;a class="footnote-reference" href="#id3" id="id1"&gt;[1]&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Opérations par lot&lt;/strong&gt;: une URL qui permet d'envoyer une série de requêtes
décrites en JSON et d'obtenir les réponses respectives.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Dans la dimension opérationnelle du protocole, on trouve :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;La gestion de version&lt;/strong&gt; : cohabitation de plusieurs versions en production,
avec alertes dans les entêtes pour la fin de vie des anciennes versions.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Le report des requêtes&lt;/strong&gt; : entêtes interprétées par les clients, activées en cas de
maintenance ou de surchage, pour ménager le serveur.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Le canal d'erreurs&lt;/strong&gt; : toutes les erreurs renvoyées par le serveur ont le même
format JSON et ont un numéro précis.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Les utilitaires&lt;/strong&gt; : URLs diverses pour répondre aux besoins exprimés par
l'équipe d'administrateurs (monitoring, metadonnées, paramètres publiques).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ce protocole est une compilation des bonnes pratiques pour les APIs HTTP (&lt;em&gt;c'est notre métier !&lt;/em&gt;),
des conseils des administrateurs système dont c'est le métier de mettre à disposition des services
pour des millions d'utilisateurs et des retours d'expérience de l'équipe
de &lt;em&gt;Firefox Sync&lt;/em&gt; pour la gestion de la concurrence et de l'«offline-first».&lt;/p&gt;
&lt;p&gt;Il est &lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/api/index.html"&gt;documenté en détail&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Dans un monde idéal, ce protocole serait versionné, et formalisé dans une RFC.
En rêve, il existerait même plusieurs implémentations avec des technologies différentes
(Python, Go, Node, etc.). &lt;a class="footnote-reference" href="#id4" id="id2"&gt;[2]&lt;/a&gt;&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id3" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Voir notre &lt;a class="reference external" href="http://www.servicedenuages.fr/en/../la-gestion-des-permissions"&gt;article dédié sur les permissions&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id4" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id2"&gt;[2]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Rappel: nous sommes une toute petite équipe !&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="le-toolkit"&gt;
&lt;h2&gt;Le toolkit&lt;/h2&gt;
&lt;div class="section" id="choix-techniques"&gt;
&lt;h3&gt;Choix techniques&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;Cliquet&lt;/em&gt; implémente le protocole en Python (&lt;em&gt;2.7, 3.4+, pypy&lt;/em&gt;), avec &lt;a class="reference external" href="http://trypyramid.com/"&gt;Pyramid&lt;/a&gt; &lt;a class="footnote-reference" href="#id6" id="id5"&gt;[3]&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Pyramid&lt;/strong&gt; est un framework Web qui va prendre en charge tout la partie HTTP,
et qui s'avère pertinent aussi bien pour des petits projets que des plus
ambitieux.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Cornice&lt;/strong&gt; est une extension de &lt;em&gt;Pyramid&lt;/em&gt;, écrite en partie par Alexis et Tarek,
qui permet d'éviter d'écrire tout le code &lt;em&gt;boilerplate&lt;/em&gt; quand on construit une
API REST avec Pyramid.&lt;/p&gt;
&lt;p&gt;Avec &lt;em&gt;Cornice&lt;/em&gt;, on évite de réécrire à chaque fois le code qui va
cabler les verbes HTTP aux méthodes, valider les entêtes, choisir le sérialiseur
en fonction des entêtes de négociation de contenus, renvoyer les codes HTTP
rigoureux, gérer les entêtes CORS, fournir la validation JSON à partir de schémas...&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Cliquet&lt;/strong&gt; utilise les deux précédents pour implémenter le protocole et fournir
des abstractions, mais on a toujours &lt;em&gt;Pyramid&lt;/em&gt; et &lt;em&gt;Cornice&lt;/em&gt; sous la main pour
aller au delà de ce qui est proposé !&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id6" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id5"&gt;[3]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Au tout début nous avons commencé une implémentation avec &lt;em&gt;Python-Eve&lt;/em&gt;
(Flask), mais n'étions pas satisfaits de l'approche pour la configuration
de l'API. En particulier du côté magique.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="concepts"&gt;
&lt;h3&gt;Concepts&lt;/h3&gt;
&lt;p&gt;Bien évidemment, les concepts du toolkit reflètent ceux du protocole mais il y
a des éléments supplémentaires:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;Les backends&lt;/strong&gt; : abstractions pour le stockage, le cache et les permissions
(&lt;em&gt;ex. PostgreSQL, Redis, en-mémoire, ...&lt;/em&gt;)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;La supervision&lt;/strong&gt; : logging JSON et indicateurs temps-réel (&lt;em&gt;StatsD&lt;/em&gt;) pour suivre les
performances et la santé du service.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;La configuration&lt;/strong&gt; : chargement de la configuration depuis les variables
d'environnement et le fichier &lt;tt class="docutils literal"&gt;.ini&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;La flexibilité&lt;/strong&gt; : dés/activation ou substitution de la majorité des composants
depuis la configuration.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Le profiling&lt;/strong&gt; : utilitaires de développement pour trouver les &lt;a class="reference external" href="https://fr.wiktionary.org/wiki/goulet_d%E2%80%99%C3%A9tranglement"&gt;goulets
d'étranglement&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;img alt="Cliquet concepts" class="align-center" src="http://www.servicedenuages.fr/en/../images/cliquet-concepts.png" style="width: 500px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Proportionnellement, l'implémentation du protocole pour les resources REST est
la plus volumineuse dans le code source de &lt;em&gt;Cliquet&lt;/em&gt;.
Cependant, comme nous l'avons décrit plus haut, &lt;em&gt;Cliquet&lt;/em&gt; fournit tout un
ensemble d'outillage et de bonnes pratiques, et reste
donc tout à fait pertinent pour n'importe quel type d'API, même sans
manipulation de données !&lt;/p&gt;
&lt;p&gt;L'objectif de la boîte à outils est de faire en sorte qu'un développeur puisse constuire
une application simplement, en étant sûr qu'elle réponde aux exigeances de la
mise en production, tout en ayant la possibilité de remplacer certaines parties
au fur et à mesure que ses besoins se précisent.&lt;/p&gt;
&lt;p&gt;Par exemple, la persistence fournie par défault est &lt;em&gt;schemaless&lt;/em&gt; (e.g &lt;em&gt;JSONB&lt;/em&gt;),
mais rien n'empêcherait d'implémenter le stockage dans un modèle relationnel.&lt;/p&gt;
&lt;p&gt;Comme les composants peuvent être remplacés depuis la configuration, il est
tout à fait possible d'étendre &lt;em&gt;Cliquet&lt;/em&gt; avec des notions métiers ou des
technologies exotiques ! Nous avons posé quelques idées dans &lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/ecosystem.html"&gt;la documentation
de l'éco-système&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Dans les prochaines semaines, nous allons introduire la notion d'«évènements» (ou signaux),
qui permettraient aux extensions de s'interfacer beaucoup plus proprement.&lt;/p&gt;
&lt;p&gt;Nous attachons beaucoup d'importance à la clareté du code, la pertinence des
&lt;em&gt;patterns&lt;/em&gt;, des tests et de la documentation. Si vous avez des commentaires,
des critiques ou des interrogations, n'hésitez pas à &lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/issues"&gt;nous en faire part&lt;/a&gt; !&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="cliquet-a-l-action"&gt;
&lt;h2&gt;Cliquet, à l'action.&lt;/h2&gt;
&lt;p&gt;Nous avons écrit un &lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/quickstart.html"&gt;guide de démarrage&lt;/a&gt;,
qui n'exige pas de connaître &lt;em&gt;Pyramid&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Pour illustrer la simplicité et les concepts, voici quelques extraits !&lt;/p&gt;
&lt;div class="section" id="etape-1"&gt;
&lt;h3&gt;Étape 1&lt;/h3&gt;
&lt;p&gt;Activer &lt;em&gt;Cliquet&lt;/em&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="hll"&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;cliquet&lt;/span&gt;
&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;pyramid.config&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Configurator&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;global_config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;config&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Configurator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="hll"&gt;    &lt;span class="n"&gt;cliquet&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'1.0'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;make_wsgi_app&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;À partir de là, la plupart des outils de &lt;em&gt;Cliquet&lt;/em&gt; sont activés et accessibles.&lt;/p&gt;
&lt;p&gt;Par exemple, les URLs &lt;em&gt;hello&lt;/em&gt; (&lt;tt class="docutils literal"&gt;/v1/&lt;/tt&gt;) ou &lt;em&gt;supervision&lt;/em&gt; (&lt;tt class="docutils literal"&gt;/v1/__heartbeat__&lt;/tt&gt;).
Mais aussi les backends de stockage, de cache, etc.
qu'il est possible d'utiliser dans des vues classiques &lt;em&gt;Pyramid&lt;/em&gt; ou &lt;em&gt;Cornice&lt;/em&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="etape-2"&gt;
&lt;h3&gt;Étape 2&lt;/h3&gt;
&lt;p&gt;Ajouter des vues:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;global_config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;config&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Configurator&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;settings&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="n"&gt;cliquet&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;initialize&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;'1.0'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="hll"&gt;    &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;scan&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;"myproject.views"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;config&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;make_wsgi_app&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Pour définir des resources CRUD, il faut commencer par définir un schéma,
avec &lt;em&gt;Colander&lt;/em&gt;, et ensuite déclarer une resource:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;cliquet&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;schema&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;BookmarkSchema&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;schema&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ResourceSchema&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;schema&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;URL&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="hll"&gt;&lt;span class="nd"&gt;@resource.register&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;span class="hll"&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Bookmark&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BaseResource&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;span class="hll"&gt;    &lt;span class="n"&gt;mapping&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;BookmarkSchema&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Désormais, la resource CRUD est disponible sur &lt;tt class="docutils literal"&gt;/v1/bookmarks&lt;/tt&gt;, avec toutes
les fonctionnalités de synchronisation, filtrage, tri, pagination, timestamp, etc.
De base les enregistrements sont privés, par utilisateur.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="err"&gt;$&lt;/span&gt; &lt;span class="err"&gt;http&lt;/span&gt; &lt;span class="err"&gt;GET&lt;/span&gt; &lt;span class="s2"&gt;"http://localhost:8000/v1/bookmarks"&lt;/span&gt;
&lt;span class="err"&gt;HTTP/&lt;/span&gt;&lt;span class="mf"&gt;1.1&lt;/span&gt; &lt;span class="mi"&gt;200&lt;/span&gt; &lt;span class="err"&gt;OK&lt;/span&gt;
&lt;span class="err"&gt;...&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="nt"&gt;"data"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;
        &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="nt"&gt;"url"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"http://cliquet.readthedocs.io"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="nt"&gt;"id"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;"cc103eb5-0c80-40ec-b6f5-dad12e7d975e"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
            &lt;span class="nt"&gt;"last_modified"&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;1437034418940&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="etape-3"&gt;
&lt;h3&gt;Étape 3&lt;/h3&gt;
&lt;p&gt;Évidemment, il est possible choisir les URLS, les verbes HTTP supportés, de modifier
des champs avant l'enregistrement, etc.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="hll"&gt;&lt;span class="nd"&gt;@resource.register&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;collection_path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'/user/bookmarks'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;span class="hll"&gt;                   &lt;span class="n"&gt;record_path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'/user/bookmarks/{{id}}'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;span class="hll"&gt;                   &lt;span class="n"&gt;collection_methods&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'GET'&lt;/span&gt;&lt;span class="p"&gt;,))&lt;/span&gt;
&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Bookmark&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;BaseResource&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;mapping&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;BookmarkSchema&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="hll"&gt;    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;process_record&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;old&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;span class="hll"&gt;        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;old&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'device'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="n"&gt;old&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'device'&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
&lt;/span&gt;&lt;span class="hll"&gt;            &lt;span class="n"&gt;device&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;headers&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;get&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'User-Agent'&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;span class="hll"&gt;            &lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'device'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;device&lt;/span&gt;
&lt;/span&gt;&lt;span class="hll"&gt;        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;new&lt;/span&gt;
&lt;/span&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/reference/resource.html"&gt;Plus d'infos dans la documentation dédiée&lt;/a&gt; !&lt;/p&gt;
&lt;div class="admonition note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;Il est possible de définir des resources sans validation de schema.
&lt;a class="reference external" href="https://github.com/mozilla-services/kinto/blob/master/kinto/views/records.py"&gt;Voir le code source de Kinto&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="etape-4-optionelle"&gt;
&lt;h3&gt;Étape 4 (optionelle)&lt;/h3&gt;
&lt;p&gt;Utiliser les abstractions de &lt;em&gt;Cliquet&lt;/em&gt; dans une vue &lt;em&gt;Cornice&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Par exemple, une vue qui utilise le backend de stockage:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;cliquet&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Service&lt;/span&gt;

&lt;span class="n"&gt;score&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Service&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"score"&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;'/score/{game}'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
                &lt;span class="n"&gt;description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;"Store game score"&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="nd"&gt;@score.post&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;schema&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;ScoreSchema&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;post_score&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;collection_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;'scores-'&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;match_dict&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;'game'&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
    &lt;span class="n"&gt;user_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;authenticated_userid&lt;/span&gt;
    &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;validated&lt;/span&gt;  &lt;span class="c1"&gt;# c.f. Cornice.&lt;/span&gt;

&lt;span class="hll"&gt;    &lt;span class="n"&gt;storage&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;request&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;registry&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;storage&lt;/span&gt;
&lt;/span&gt;&lt;span class="hll"&gt;    &lt;span class="n"&gt;record&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;storage&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;create&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;collection_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;user_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;record&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="vos-retours"&gt;
&lt;h2&gt;Vos retours&lt;/h2&gt;
&lt;p&gt;N'hésitez pas à nous faire part de vos retours ! Cela vous a donné envie
d'essayer ? Vous connaissez un outil similaire ?
Y-a-t-il des points qui ne sont pas clairs ? Manque de cas d'utilisation concrets ?
Certains aspects mal pensés ? Trop contraignants ? Trop de magie ? Overkill ?&lt;/p&gt;
&lt;p&gt;Nous prenons tout.&lt;/p&gt;
&lt;div class="section" id="points-faibles"&gt;
&lt;h3&gt;Points faibles&lt;/h3&gt;
&lt;p&gt;Nous sommes très fiers de ce que nous avons construit, en relativement peu
de temps. Et comme nous l'exposions dans &lt;a class="reference external" href="http://www.servicedenuages.fr/en/../perspectives-pour-lete"&gt;l'article précédent&lt;/a&gt;, il y a du potentiel !&lt;/p&gt;
&lt;p&gt;Cependant, nous sommes conscients d'un certain nombre de points
qui peuvent être vus comme des faiblesses.&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;strong&gt;La documentation d'API&lt;/strong&gt; : actuellement, nous n'avons pas de solution pour qu'un
projet qui utilise &lt;em&gt;Cliquet&lt;/em&gt; puisse intégrer facilement toute
&lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/api/index.html"&gt;la documentation de l'API&lt;/a&gt;
obtenue.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;La documentation&lt;/strong&gt; : il est très difficile d'organiser la documentation, surtout
quand le public visé est aussi bien débutant qu'expérimenté. Nous sommes probablement
victimes du «&lt;a class="reference external" href="https://en.wikipedia.org/wiki/Curse_of_knowledge"&gt;curse of knowledge&lt;/a&gt;».&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Le protocole&lt;/strong&gt; : on sent bien qu'on va devoir versionner le protocole. Au
moins pour le désolidariser des versions de &lt;em&gt;Cliquet&lt;/em&gt;, si on veut aller au
bout de la philosophie et de l'éco-système.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Le conservatisme&lt;/strong&gt; : Nous aimons la stabilité et la robustesse. Mais surtout
nous ne sommes pas tout seuls et devons nous plier aux contraintes de la mise
en production ! Cependant, nous avons très envie de faire de l'async avec Python 3 !&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Publication de versions&lt;/strong&gt; : le revers de la médaille de la factorisation. Il
arrive qu'on préfère faire évoluer le toolkit (e.g. ajouter une option) pour
un point précis d'un projet. En conséquence, on doit souvent releaser les
projets en cascade.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="quelques-questions-courantes"&gt;
&lt;h3&gt;Quelques questions courantes&lt;/h3&gt;
&lt;blockquote&gt;
Pourquoi Python ?&lt;/blockquote&gt;
&lt;p&gt;On prend beaucoup de plaisir à écrire du Python, et le calendrier annoncé
initialement était très serré: pas question de tituber avec une technologie
mal maitrisée !&lt;/p&gt;
&lt;p&gt;Et puis, après avoir passé près d'un an sur un projet Node.js, l'équipe avait
bien envie de refaire du Python.&lt;/p&gt;
&lt;blockquote&gt;
Pourquoi pas Django ?&lt;/blockquote&gt;
&lt;p&gt;On y a pensé, surtout parce qu'il y a plusieurs fans de &lt;em&gt;Django REST Framework&lt;/em&gt;
dans l'équipe.&lt;/p&gt;
&lt;p&gt;On l'a écarté principalement au profit de la légèreté et la modularité de
&lt;em&gt;Pyramid&lt;/em&gt;.&lt;/p&gt;
&lt;blockquote&gt;
Pourquoi pas avec un framework asynchrone en Python 3+ ?&lt;/blockquote&gt;
&lt;p&gt;Pour l'instant nos administrateurs système nous imposent des déploiements en
Python 2.7, à notre grand désarroi /o\&lt;/p&gt;
&lt;p&gt;Pour &lt;em&gt;Reading List&lt;/em&gt;, nous &lt;a class="reference external" href="https://github.com/mozilla-services/readinglist/blob/1.7.0/readinglist/__init__.py#L19-L26"&gt;avions activé&lt;/a&gt;
&lt;em&gt;gevent&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Puisque l'approche consiste à implémenter un protocole bien déterminé, nous n'excluons
pas un jour d'écrire un &lt;em&gt;Cliquet&lt;/em&gt; en &lt;em&gt;aiohttp&lt;/em&gt; ou &lt;em&gt;Go&lt;/em&gt; si cela s'avèrerait pertinent.&lt;/p&gt;
&lt;blockquote&gt;
Pourquoi pas JSON-API ?&lt;/blockquote&gt;
&lt;p&gt;Comme nous l'expliquions &lt;a class="reference external" href="http://www.servicedenuages.fr/en/apidays-barcelona-retours"&gt;au retour des APIdays&lt;/a&gt;,
JSON-API est une spécification qui rejoint plusieurs de nos intentions.&lt;/p&gt;
&lt;p&gt;Quand nous avons commencé le protocole, nous ne connaissions pas JSON-API.
Pour l'instant, comme notre proposition est beaucoup plus minimaliste, le
rapprochement n'a &lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/issues/254"&gt;pas dépassé le stade de la discussion&lt;/a&gt;.&lt;/p&gt;
&lt;blockquote&gt;
Est-ce que Cliquet est un framework REST pour Pyramid ?&lt;/blockquote&gt;
&lt;p&gt;Non.&lt;/p&gt;
&lt;p&gt;Au delà des classes de resources CRUD de Cliquet, qui implémentent un
protocole bien précis, il faut utiliser Cornice ou Pyramid directement.&lt;/p&gt;
&lt;blockquote&gt;
Est-ce que Cliquet est suffisamment générique pour des projets hors Mozilla ?&lt;/blockquote&gt;
&lt;p&gt;Premièrement, nous faisons en sorte que tout soit contrôlable depuis la
configuration &lt;tt class="docutils literal"&gt;.ini&lt;/tt&gt; pour permettre la dés/activation ou substitution des
composants.&lt;/p&gt;
&lt;p&gt;Si le protocole HTTP/JSON des resources CRUD vous satisfait,
alors Cliquet est probablement le plus court chemin pour construire une
application qui tient la route.&lt;/p&gt;
&lt;p&gt;Mais l'utilisation des resources CRUD est facultative, donc Cliquet reste pertinent
si les bonnes pratiques en terme de mise en production ou les abstractions fournies
vous paraissent valables !&lt;/p&gt;
&lt;p&gt;Cliquet reste un moyen simple d'aller très vite pour mettre sur pied
une application Pyramid/Cornice.&lt;/p&gt;
&lt;blockquote&gt;
Est-ce que les resources JSON supporte les modèles relationnels complexes ?&lt;/blockquote&gt;
&lt;p&gt;La couche de persistence fournie est très simple, et devrait
répondre à la majorité des cas d'utilisation où les données n'ont pas de
relations.&lt;/p&gt;
&lt;p&gt;En revanche, il est tout à fait possible de bénéficier de tous les aspects
du protocole en utilisant une classe &lt;tt class="docutils literal"&gt;Collection&lt;/tt&gt; maison, qui se chargerait
elle de manipuler les relations.&lt;/p&gt;
&lt;p&gt;Le besoin de relations pourrait être un bon prétexte pour implémenter le
protocole avec Django REST Framework :)&lt;/p&gt;
&lt;blockquote&gt;
Est-il possible de faire ci ou ça avec Cliquet ?&lt;/blockquote&gt;
&lt;p&gt;Nous aimerions collecter des besoins pour écrire un ensemble de «recettes/tutoriels». Mais
pour ne pas travailler dans le vide, nous aimerions &lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/issues"&gt;connaitre vos idées&lt;/a&gt; !
(&lt;em&gt;ex. brancher l'authentification Github, changer le format du logging JSON, stocker des
données cartographiques, ...&lt;/em&gt;)&lt;/p&gt;
&lt;blockquote&gt;
Est-ce que Cliquet peut manipuler des fichiers ?&lt;/blockquote&gt;
&lt;p&gt;&lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/issues/236"&gt;Nous l'envisageons&lt;/a&gt;,
mais pour l'instant nous attendons que le besoin survienne en interne pour se
lancer.&lt;/p&gt;
&lt;p&gt;Si c'est le cas, le protocole utilisé sera &lt;a class="reference external" href="http://remotestorage.io/"&gt;Remote Storage&lt;/a&gt;,
afin notamment de s'intégrer dans l'éco-système grandissant.&lt;/p&gt;
&lt;blockquote&gt;
Est-ce que la fonctionnalité X va être implémentée ?&lt;/blockquote&gt;
&lt;p&gt;&lt;em&gt;Cliquet&lt;/em&gt; est déjà bien garni. Plutôt qu'implémenter la fonctionnalité X,
il y a de grandes chances que nous agissions pour s'assurer que les abstractions
et les mécanismes d'extension fournis permettent de l'implémenter sous forme
d'extension.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</content></entry><entry><title>Summer Perspectives</title><link href="http://www.servicedenuages.fr/en/summer-perspectives" rel="alternate"></link><published>2015-07-07T00:00:00+02:00</published><updated>2015-07-07T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-07-07:/en/summer-perspectives</id><summary type="html">&lt;p class="first last"&gt;Work in progress and upcoming functionality over the coming months.&lt;/p&gt;
</summary><content type="html">&lt;div class="admonition note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;Translated from the French by &lt;a class="reference external" href="https://dark.ca/"&gt;Dan Phrawzty&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Mozilla has a tradition of "work weeks" whereby the members of our many distributed teams get together in a single physical location a few times per year; occasionally these work weeks involve the entire company, as was the case most recently in &lt;a class="reference external" href="http://www.openstreetmap.org/node/268148288#map=4/50.12/-122.95"&gt;Whistler, BC, Canada&lt;/a&gt;.&lt;/p&gt;
&lt;img alt='"All Hands" talk about Lego, by @davidcrob - CC0' class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-talks.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;It was a great opportunity for our team to come together, to share our vision and ideas concerning data storage, and to collect use-cases for &lt;a class="reference external" href="https://kinto.readthedocs.io"&gt;Kinto&lt;/a&gt;.&lt;/p&gt;
&lt;div class="section" id="workshops-and-self-promotion"&gt;
&lt;h2&gt;Workshops and Self-Promotion&lt;/h2&gt;
&lt;p&gt;Nicolas presented &lt;a class="reference external" href="https://github.com/mozilla-services/kinto.js"&gt;Kinto.js&lt;/a&gt; at a dedicated workshop in Whistler, the content of which now forms a &lt;a class="reference external" href="http://kintojs.readthedocs.io/en/latest/tutorial/"&gt;introductory tutorial&lt;/a&gt;. The resulting application, simple though it appears, is a great way to learn the basic concepts behind synchronisation in Kinto. Furthermore, we didn't even need to set up a server - Rémy set one up that &lt;a class="reference external" href="https://kinto.dev.mozaws.net/v1/"&gt;resets itself every day&lt;/a&gt;!&lt;/p&gt;
&lt;p&gt;As an aside, we chose to use Vanilla-JS for two reasons: firstly because it allowed us to avoid the framework wars, but also because it proves that we can do so much more with HTML5 and ES6 than was possible a few years ago.&lt;/p&gt;
&lt;p&gt;Furthermore, this small workshop helped us to realise that we still have large gaps in our documentation, particularly as regards the eco-system and the long-term, global vision for our family of projects. This is an area where we have resolved to do better.&lt;/p&gt;
&lt;img alt="Kinto.js workshop - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-workshop.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;div class="section" id="mozilla-payments"&gt;
&lt;h2&gt;Mozilla Payments&lt;/h2&gt;
&lt;p&gt;As noted in a &lt;a class="reference external" href="http://www.servicedenuages.fr/la-gestion-des-permissions"&gt;previous blog post&lt;/a&gt; we developed a permissions model which allows Kinto fulfill the the requirements of payment and subscription tracker (our fist use-case).&lt;/p&gt;
&lt;p&gt;For this project, Kinto is going to be used by a Django app via a Python client.&lt;/p&gt;
&lt;p&gt;Now that the development is done we have to deliver - that means integrating, hosting, and really pushing the usefulness of the stack. The solution is should be ready to go by the end of the year.&lt;/p&gt;
&lt;div class="section" id="coming-soon"&gt;
&lt;h3&gt;Coming Soon&lt;/h3&gt;
&lt;p&gt;Following the recent successful implementation of a permissions model, we'd like to take some time out to implement a feature that is important to us: allowing read access to &lt;em&gt;shared&lt;/em&gt; records in a collection. If this is interesting to you, feel free to follow &lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/issues/354"&gt;the issue&lt;/a&gt; or (better yet) contribute a patch!&lt;/p&gt;
&lt;img alt="Whistler Alta Lake - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-lake.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="firefox-os-and-storage"&gt;
&lt;h2&gt;Firefox OS and Storage&lt;/h2&gt;
&lt;p&gt;We've collaborated frequently with the Firefox OS team over the years, notably regarding the &lt;a class="reference external" href="https://github.com/mozilla-services/msisdn-gateway"&gt;MISISDN Gateway&lt;/a&gt; (basically a way to link BrowserID and SMS together) and &lt;a class="reference external" href="https://github.com/mozilla-services/loop-server"&gt;Firefox Hello&lt;/a&gt;.&lt;/p&gt;
&lt;div class="section" id="in-app-sync"&gt;
&lt;h3&gt;In-App Sync&lt;/h3&gt;
&lt;p&gt;Kinto as a simple solution for synchronising data in Firefox OS? Nice! We've had this partnership in mind for some time (remember &lt;a class="reference external" href="http://daybed.readthedocs.io/"&gt;Daybed&lt;/a&gt;?), and now we've got a great opportunity at our fingertips.&lt;/p&gt;
&lt;p&gt;We'll need to clearly and plainly lay out the limitations and simplistic models inherent in our solution (notably regarding concurrency management), but we believe that it fits the use-case fairly well, so it should not disapoint. :)&lt;/p&gt;
&lt;p&gt;We're particularly motivated as both &lt;a class="reference external" href="https://github.com/daleharvey"&gt;Dale Harvey&lt;/a&gt; (one of the authors of &lt;a class="reference external" href="http://pouchdb.com/"&gt;PouchDB&lt;/a&gt;) and &lt;a class="reference external" href="https://github.com/michielbdejong"&gt;Michel de Jong&lt;/a&gt; (one of the authors of &lt;a class="reference external" href="http://remotestorage.io/"&gt;Remote Storage&lt;/a&gt;) have given us plenty of encouragement from an early stage.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="cut-the-rope"&gt;
&lt;h3&gt;Cut The Rope&lt;/h3&gt;
&lt;p&gt;Kinto is likely to be used to synchronise the configuration settings and scores of the very popular game &lt;a class="reference external" href="https://marketplace.firefox.com/app/cut-the-rope/"&gt;Cut The Rope&lt;/a&gt;. It'll be good to have a practical use-case on such a visible platform.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="syncto"&gt;
&lt;h3&gt;Syncto&lt;/h3&gt;
&lt;p&gt;&lt;a class="reference external" href="https://docs.services.mozilla.com/storage/apis-1.5.html"&gt;Firefox Sync&lt;/a&gt; is what enables synchronisation between Firefox (favourites, extensions, browser history, etc.) and many other targets in an encrypted fashion. The current Javascript client implementation is relatively complex and, frankly, somewhat dated (the proposed re-write has yet to occur).&lt;/p&gt;
&lt;p&gt;We'd like to implement a bridge between &lt;em&gt;Kinto&lt;/em&gt; and &lt;em&gt;Firefox Sync&lt;/em&gt; via &lt;em&gt;Kinto.js&lt;/em&gt; - which is more simple and more modern than the existing reference client - in order to store synced data in IndexedDB. On the server side, we feel that this shouldn't be too hard since our project is itself inspired by Sync's proven protocol model; from a client perspective, most of the work will be in plumbing crypto into BrowserID authentication.&lt;/p&gt;
&lt;p&gt;Alexis jumped at the chance to start work on a &lt;a class="reference external" href="https://github.com/mozilla-services/syncclient"&gt;Python Firefox Sync client&lt;/a&gt; which will serve as the base for any future service.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="cloud-storage"&gt;
&lt;h3&gt;Cloud Storage&lt;/h3&gt;
&lt;p&gt;Eden Chung and Sean Lee did a presentation on their advancements regarding the integration of remote storage services (notably DropBox and Baidu Yun) in Firefox OS. Their current proof-of-concept is based on &lt;a class="reference external" href="https://en.wikipedia.org/wiki/Filesystem_in_Userspace"&gt;FUSE&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We were also thinking about introducing the idea of attachments in Kinto by implementing the &lt;a class="reference external" href="https://tools.ietf.org/html/draft-dejong-remotestorage-05"&gt;remote storage specification&lt;/a&gt;; however, for the moment our existing use-cases just aren't calling for it.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id2"&gt;
&lt;h3&gt;Coming Soon&lt;/h3&gt;
&lt;p&gt;In addition to the work that we've already done on the server side, we're going to have to deal with concurrency management in our Javascript client in order to allow simultaneous writes and background synchronisation.&lt;/p&gt;
&lt;p&gt;We are always looking for feedback - and, of course, code contributions - on both the &lt;a class="reference external" href="https://github.com/mozilla-services/kinto/"&gt;server&lt;/a&gt; and &lt;a class="reference external" href="https://github.com/mozilla-services/kinto.js/"&gt;client&lt;/a&gt;!&lt;/p&gt;
&lt;img alt="Firefox OS Cloud Storage Presentation - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-cloud-storage.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="firefox-application-content"&gt;
&lt;h2&gt;Firefox Application Content&lt;/h2&gt;
&lt;p&gt;The Firefox development and release process is currently based on a six-week cycle. One of the objectives is to decouple certain specific content elements (such as safety rules, dictionaries and translations, etc.) from these relatively long cycles &lt;a class="footnote-reference" href="#id4" id="id3"&gt;[1]&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The proposed solution is versioned, read-only JSON and binary blobs that can be synchronised with live browsers. There are already a number of tools to manage this sort of thing (examples include &lt;a class="reference external" href="https://wiki.mozilla.org/Balrog"&gt;Balrog&lt;/a&gt; and &lt;a class="reference external" href="https://github.com/mozilla-services/shavar"&gt;Shavar&lt;/a&gt;), but for the moment no choice has been made. During conversations with the team in charge of this project it became evident that Kinto could be useful here too - which is motivating us even more to evolve our project!&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id4" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id3"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;The good news is that all the existing 3rd-party functionality will be
revived in the form of add-ons.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;img alt="Landscape - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-landscape.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;div class="section" id="awesome-bar"&gt;
&lt;h2&gt;Awesome Bar&lt;/h2&gt;
&lt;p&gt;The &lt;em&gt;Firefox Labs&lt;/em&gt; team, best known for raising red pandas in &lt;a class="reference external" href="https://i.imgur.com/NPG7CxB.gif"&gt;test tubes&lt;/a&gt;, is interested in our solution as well, notably as regards the evolution of the &lt;a class="reference external" href="https://support.mozilla.org/en-US/kb/awesome-bar-search-firefox-bookmarks-history-tabs"&gt;Awesome Bar&lt;/a&gt; which would meld URLs, browser history, and search functions.&lt;/p&gt;
&lt;p&gt;We can't say too much right now, but the aforementioned shared collections feature in &lt;em&gt;Kinto&lt;/em&gt; would fit so very nicely into the future of the Firefox browser. :)&lt;/p&gt;
&lt;div class="section" id="id6"&gt;
&lt;h3&gt;Coming Soon&lt;/h3&gt;
&lt;p&gt;In all likelihood we will need to implement indexing and full-text searching (read: Elasticsearch) before the end of the year. This fits nicely into our roadmap since it's something that we had in Daybed already.&lt;/p&gt;
&lt;img alt="Firefox Labs Meeting - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-labs.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="browser-html"&gt;
&lt;h2&gt;Browser.html&lt;/h2&gt;
&lt;p&gt;The Search team has been exploring and extending the very notion of a platform, and is currently working on implementing a web browser in Javascript and HTML5 with &lt;a class="reference external" href="https://facebook.github.io/react/"&gt;React&lt;/a&gt;, the result of which is affectionatly known as &lt;a class="reference external" href="https://github.com/mozilla/browser.html"&gt;browser.html&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Kinto aligns very well with the needs of that project as regards the synchronisation of user data. This could be as simple as a replication of Sync itself, but it could also be something more interesting, such as entire collections of any arbitrary data - for example, browser preferences, or an Alexa-top-500-style mechanism that would allow URL completion without the need to send a search request.&lt;/p&gt;
&lt;p&gt;But why stop with just the local browser? We could synchronise entire React states between peripherals, thus allowing a seamless browser experience across every device!&lt;/p&gt;
&lt;div class="section" id="id8"&gt;
&lt;h3&gt;Coming Soon&lt;/h3&gt;
&lt;p&gt;If Browser.html must store navigation data, we believe that it should do so using strong encryption directly in the Javascript client. Luckily we're not the only ones thinking about this, and there are already &lt;a class="reference external" href="http://www.w3.org/TR/WebCryptoAPI/"&gt;several possible standards&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;To avoid pinging the server at regular intervals in order to synchronise the changes (effectively DDoS'ing ourselves!), the introduction of &lt;a class="reference external" href="https://w3c.github.io/push-api/"&gt;push notifications&lt;/a&gt; seems like a natural choice. This would be the final building block in our quest to build a complete "Mobile / Web backed as a service".&lt;/p&gt;
&lt;img alt="Roadmap - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-roadmap.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;We're in pretty much the ideal situation right now: &lt;a class="reference external" href="https://github.com/mozilla-services/kinto/wiki/Roadmap"&gt;everything&lt;/a&gt; that we've imagined, worked on, prototyped, and shipped corresponds to the needs and desires of a number of teams at Mozilla.&lt;/p&gt;
&lt;p&gt;Our challenges ahead are:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Co-ordinate with the other teams efficiently.&lt;/li&gt;
&lt;li&gt;Avoid &lt;a class="reference external" href="https://i.imgur.com/jeFYGQ5.jpg"&gt;disappointment&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;Maintain a high level of productivity.&lt;/li&gt;
&lt;li&gt;Continue to improve and promote our solutions.&lt;/li&gt;
&lt;li&gt;Focus on quick wins that move us forward.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Finally, we will work to encourage meaningful community contributions to help us build a free, generic, simple, and self-hostable solution for storing data on the web.&lt;/p&gt;
&lt;img alt="Friday Night Party - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-top-roof.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>Perspectives pour l'été</title><link href="http://www.servicedenuages.fr/en/../perspectives-pour-lete" rel="alternate"></link><published>2015-07-07T00:00:00+02:00</published><updated>2015-07-07T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-07-07:/en/../perspectives-pour-lete</id><summary type="html">&lt;p class="first last"&gt;Le travail en cours et les fonctionnalités à venir pour les prochains mois.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Mozilla a pour coutume d'organiser régulièrement des semaines de travail où tous les employés
sont réunis physiquement. Pour cette dernière édition, nous avons pu retrouver
nos collègues du monde entier à &lt;a class="reference external" href="http://www.openstreetmap.org/node/268148288#map=4/50.12/-122.95"&gt;Whistler, en Colombie Britannique au Canada&lt;/a&gt; !&lt;/p&gt;
&lt;img alt="«All Hands» talk about Lego, by @davidcrob - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-talks.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Ce fût l'occasion pour notre équipe de se retrouver, et surtout de partager notre
vision et nos idées dans le domaine du stockage, afin de collecter des cas d'utilisation pour
notre solution &lt;a class="reference external" href="https://kinto.readthedocs.io"&gt;Kinto&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Dans cet article, nous passons en revue les pistes que nous avons pour
les prochains mois.&lt;/p&gt;
&lt;div class="section" id="ateliers-et-promotion"&gt;
&lt;h2&gt;Ateliers et promotion&lt;/h2&gt;
&lt;p&gt;Nicolas a présenté &lt;a class="reference external" href="https://github.com/mozilla-services/kinto.js"&gt;Kinto.js&lt;/a&gt; dans un atelier dédié, avec comme support de
présentation le &lt;a class="reference external" href="http://kintojs.readthedocs.io/en/latest/tutorial/"&gt;tutorial d'introduction&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;L'application résultante, pourtant toute simple, permet d'appréhender les
concepts de synchronisation de Kinto. Le tout sans installation prélable,
puisque Rémy a mis en place un &lt;a class="reference external" href="https://kinto.dev.mozaws.net/v1/"&gt;serveur de dev effacé tous les jours&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Nous avions mis un point d'honneur à faire du Vanilla.JS, déjà pour éviter les
combats de clochers autour des frameworks, mais aussi pour mettre en évidence qu'avec
HTML5 et ES6, on n'était plus aussi démunis qu'il y a quelques années.&lt;/p&gt;
&lt;p&gt;Ce petit atelier nous a permis de nous rendre compte qu'on avait encore de
grosses lacunes en terme de documentation, surtout en ce qui concerne
l'éco-système et la vision globale des projets (Kinto, Kinto.js, Cliquet, ...).
Nous allons donc faire de notre mieux pour combler ce manque.&lt;/p&gt;
&lt;img alt="Kinto.js workshop - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-workshop.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;div class="section" id="mozilla-payments"&gt;
&lt;h2&gt;Mozilla Payments&lt;/h2&gt;
&lt;p&gt;Comme &lt;a class="reference external" href="http://www.servicedenuages.fr/la-gestion-des-permissions"&gt;décrit précédemment&lt;/a&gt;, nous avons mis en place un système de permissions pour répondre aux besoins de suivi des paiements et abonnements.&lt;/p&gt;
&lt;p&gt;Pour ce projet, Kinto sera utilisé depuis une application Django, via un client Python.&lt;/p&gt;
&lt;p&gt;Maintenant que les développements ont été livrés, il faut transformer l'essai, réussir l'intégration, l'hébergement et la montée en puissance. La solution doit être livrée à la fin de l'année.&lt;/p&gt;
&lt;div class="section" id="a-venir"&gt;
&lt;h3&gt;À venir&lt;/h3&gt;
&lt;p&gt;Nous aimerions en profiter pour implémenter une fonctionnalité qui nous tient à coeur : la construction de la liste des enregistrements accessibles en lecture sur une collection partagée.&lt;/p&gt;
&lt;img alt="Whistler Alta Lake - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-lake.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="firefox-os-et-stockage"&gt;
&lt;h2&gt;Firefox OS et stockage&lt;/h2&gt;
&lt;p&gt;Nous avons eu beaucoup d'échanges avec l'équipe de Firefox OS, avec qui nous avions
déjà eu l'occasion de collaborer, pour le &lt;a class="reference external" href="https://github.com/mozilla-services/msisdn-gateway"&gt;serveur d'identification BrowserID par SMS&lt;/a&gt; et pour &lt;a class="reference external" href="https://github.com/mozilla-services/loop-server"&gt;Firefox Hello&lt;/a&gt;.&lt;/p&gt;
&lt;div class="section" id="in-app-sync"&gt;
&lt;h3&gt;In-App sync&lt;/h3&gt;
&lt;p&gt;Kinto, la solution simple promue pour la synchronisation de données dans les applications
Firefox OS ? La classe ! C'est ce qu'on avait en tête depuis longtemps, déjà à
l'époque avec &lt;a class="reference external" href="http://daybed.readthedocs.io/"&gt;Daybed&lt;/a&gt;. Voici donc une belle opportunité à saisir !&lt;/p&gt;
&lt;p&gt;Il va falloir expliciter les limitations et hypothèses simplificatrices de notre
solution, surtout en termes de gestion de la concurrence. Nous sommes persuadés
que ça colle avec la plupart des besoins, mais il ne faudrait pas décevoir :)&lt;/p&gt;
&lt;p&gt;Le fait que &lt;a class="reference external" href="https://github.com/daleharvey"&gt;Dale&lt;/a&gt;, un des auteurs de &lt;a class="reference external" href="http://pouchdb.com/"&gt;PouchDB&lt;/a&gt; et &lt;a class="reference external" href="https://github.com/michielbdejong"&gt;Michiel de Jong&lt;/a&gt;, un des auteurs de &lt;a class="reference external" href="http://remotestorage.io/"&gt;Remote Storage&lt;/a&gt;, nous aient encouragés sur nos premiers pas nous a bien motivé !&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="cut-the-rope"&gt;
&lt;h3&gt;Cut the Rope&lt;/h3&gt;
&lt;p&gt;Kinto devrait être mis à profit pour synchroniser les paramètres et les scores
du &lt;a class="reference external" href="http://mozilla.cuttherope.net/"&gt;jeu&lt;/a&gt;. Un premier exercice et une première vitrine sympas !&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="syncto"&gt;
&lt;h3&gt;« SyncTo »&lt;/h3&gt;
&lt;p&gt;&lt;a class="reference external" href="https://docs.services.mozilla.com/storage/apis-1.5.html"&gt;Firefox Sync&lt;/a&gt; est la solution qui permet de synchroniser les données de Firefox (favoris, extensions, historique, complétion des formulaires, mots de passe, ...) entre plusieurs périphériques, de manière chiffrée.&lt;/p&gt;
&lt;p&gt;L'implémentation du client en JavaScript est relativement complexe et date un peu maintenant.
Le code existant n'est pas vraiment portable dans &lt;em&gt;Firefox OS&lt;/em&gt; et les tentatives de réécriture
n'ont pas abouti.&lt;/p&gt;
&lt;p&gt;Nous souhaitons implémenter un pont entre &lt;em&gt;Kinto&lt;/em&gt; et &lt;em&gt;Firefox Sync&lt;/em&gt;, de manière
à pouvoir utiliser le client &lt;em&gt;Kinto.js&lt;/em&gt;, plus simple et plus moderne, pour récupérer
les contenus et les stocker dans IndexedDB. Le delta à implémenter côté serveur est faible car nous nous étions
inspirés du protocole déjà éprouvé de Sync. Côté client, il s'agira surtout de
câbler l'authentification BrowserId et la Crypto.&lt;/p&gt;
&lt;p&gt;Alexis a sauté sur l'occasion pour commencer l'écriture d'&lt;a class="reference external" href="https://github.com/mozilla-services/syncclient"&gt;un client python pour Firefox Sync&lt;/a&gt;, qui servira de brique de base pour l'écriture du service.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="cloud-storage"&gt;
&lt;h3&gt;Cloud Storage&lt;/h3&gt;
&lt;p&gt;Eden Chuang et Sean Lee ont présenté les avancées sur l'intégration de services de stockages
distants (&lt;em&gt;DropBox, Baidu Yun&lt;/em&gt;) dans &lt;em&gt;Firefox OS&lt;/em&gt;. Actuellement, leur preuve de
concept repose sur &lt;a class="reference external" href="https://fr.wikipedia.org/wiki/Filesystem_in_Userspace"&gt;FUSE&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Nous avons évidemment en tête d'introduire la notion de fichiers attachés dans
&lt;em&gt;Kinto&lt;/em&gt;, en implémentant la specification
&lt;a class="reference external" href="https://tools.ietf.org/html/draft-dejong-remotestorage-05"&gt;*Remote Storage*&lt;/a&gt;,
mais pour l'instant les cas d'utilisations ne se sont pas encore présentés officiellement.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id2"&gt;
&lt;h3&gt;À venir&lt;/h3&gt;
&lt;p&gt;Nous serons probablement amenés à introduire la gestion de la concurrence dans
le client JS, en complément de ce qui a été fait sur le serveur, pour permettre
les écritures simultanées et synchronisation en tâche de fond.&lt;/p&gt;
&lt;p&gt;Nous sommes par ailleurs perpétuellement preneurs de vos retours — et bien
entendu de vos contributions — tant sur le code &lt;a class="reference external" href="https://github.com/mozilla-services/kinto/"&gt;serveur&lt;/a&gt;
que &lt;a class="reference external" href="https://github.com/mozilla-services/kinto.js/"&gt;client&lt;/a&gt;  !&lt;/p&gt;
&lt;img alt="Firefox OS Cloud Storage Presentation - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-cloud-storage.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="contenus-applicatifs-de-firefox"&gt;
&lt;h2&gt;Contenus applicatifs de Firefox&lt;/h2&gt;
&lt;p&gt;Aujourd'hui Firefox a un cycle de release de six semaines. Un des objectifs
consiste à désolidariser certains contenus applicatifs de ces cycles
relativement longs (ex. &lt;em&gt;règles de securité, dictionnaires, traductions, ...&lt;/em&gt;) &lt;a class="footnote-reference" href="#id4" id="id3"&gt;[1]&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Il s'agit de données JSON et binaire qui doivent être versionnées et synchronisées par
les navigateurs (&lt;em&gt;lecture seule&lt;/em&gt;).&lt;/p&gt;
&lt;p&gt;Il y a plusieurs outils officiels qui existent pour gérer ça (&lt;em&gt;Balrog&lt;/em&gt;, &lt;em&gt;Shavar&lt;/em&gt;, ...),
et pour l'instant, aucun choix n'a été fait. Mais lors des conversations avec
l'équipe en charge du projet, ce fût vraiment motivant de voir que même pour
ce genre de besoins internes, &lt;em&gt;Kinto&lt;/em&gt; est tout aussi pertinent !&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id4" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id3"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;La bonne nouvelle c'est que toutes les fonctionnalités &lt;em&gt;third-party&lt;/em&gt; qui ont
été intégrées récemment vont redevenir des &lt;em&gt;add-ons&lt;/em&gt; \o/.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;img alt="Landscape - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-landscape.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;div class="section" id="awesome-bar"&gt;
&lt;h2&gt;Awesome bar&lt;/h2&gt;
&lt;p&gt;L'équipe &lt;em&gt;Firefox Labs&lt;/em&gt;, le laboratoire qui élève des pandas roux en éprouvette,
serait vraiment intéressé par notre solution, notamment pour abreuver en données
un prototype pour améliorer &lt;em&gt;Awesome bar&lt;/em&gt;, qui fusionnerait URL, historique et recherche.&lt;/p&gt;
&lt;p&gt;Nous ne pouvons pas en dire beaucoup plus pour l'instant, mais les fonctionnalités
de collections d'enregistrements partagées entre utilisateurs de &lt;em&gt;Kinto&lt;/em&gt;
correspondent parfaitement à ce qui est envisagé pour le futur du navigateur :)&lt;/p&gt;
&lt;div class="section" id="id5"&gt;
&lt;h3&gt;À venir&lt;/h3&gt;
&lt;p&gt;Nous serons donc probablement amenés, avant de la fin de l'année, à introduire des
fonctionnalités d'indexation et de recherche &lt;em&gt;full-text&lt;/em&gt; (comprendre &lt;em&gt;ElasticSearch&lt;/em&gt;).
Cela rejoint nos plans précédents, puisque c'est quelque chose que nous avions dans
&lt;em&gt;Daybed&lt;/em&gt;, et qui figurait sur notre feuille de route !&lt;/p&gt;
&lt;img alt="Firefox Labs Meeting - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-labs.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="browser-html"&gt;
&lt;h2&gt;Browser.html&lt;/h2&gt;
&lt;p&gt;L'équipe &lt;em&gt;Recherche&lt;/em&gt; explore les notions de plateforme, et travaille notamment
sur l'implémentation d'un navigateur en JS/HTML avec &lt;em&gt;React&lt;/em&gt;:
&lt;a class="reference external" href="https://github.com/mozilla/browser.html"&gt;browser.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Kinto&lt;/em&gt; correspond parfaitement aux attentes
de l'équipe pour synchroniser les données associées à un utilisateur.&lt;/p&gt;
&lt;p&gt;Il pourrait s'agir de données de navigation (comme Sync), mais aussi de collections
d'enregistrements diverses, comme par exemple les préférences du navigateur
ou un équivalent à &lt;em&gt;Alexa.com Top 500&lt;/em&gt; pour fournir la complétion d'URL sans
interroger le moteur de recherche.&lt;/p&gt;
&lt;p&gt;L'exercice pourrait être poussé jusqu'à la synchronisation d'états &lt;em&gt;React&lt;/em&gt;
entre périphériques (par exemple pour les onglets).&lt;/p&gt;
&lt;div class="section" id="id7"&gt;
&lt;h3&gt;À venir&lt;/h3&gt;
&lt;p&gt;Si &lt;em&gt;browser.html&lt;/em&gt; doit stocker des données de navigation, il faudra ajouter
des fonctionnalités de chiffrement sur le client JS. Ça tombe bien, c'est un
sujet passionant, et &lt;a class="reference external" href="http://www.w3.org/TR/WebCryptoAPI/"&gt;il y a plusieurs standards&lt;/a&gt; !&lt;/p&gt;
&lt;p&gt;Pour éviter d'interroger le serveur à intervalle régulier afin de synchroniser les
changements, l'introduction des &lt;a class="reference external" href="https://w3c.github.io/push-api/"&gt;*push notifications*&lt;/a&gt; semble assez naturelle.
Il s'agirait alors de la dernière pierre qui manque à l'édifice pour obtenir
un «&lt;em&gt;Mobile/Web backend as a service&lt;/em&gt;» complet.&lt;/p&gt;
&lt;img alt="Roadmap - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-roadmap.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Nous sommes dans une situation idéale, puisque ce que nous avions imaginé
sur &lt;a class="reference external" href="https://github.com/mozilla-services/kinto/wiki/Roadmap"&gt;notre feuille de route&lt;/a&gt; correspond à ce qui nous est demandé par les
différentes équipes.&lt;/p&gt;
&lt;p&gt;L'enjeu consiste maintenant à se coordonner avec tout le monde, ne pas décevoir,
tenir la charge, continuer à améliorer et à faire la promotion du produit, se concentrer
sur les prochaines étapes et embarquer quelques contributeurs à nos cotés pour
construire une solution libre, générique, simple et auto-hébergeable pour le stockage
de données sur le Web :)&lt;/p&gt;
&lt;img alt="Friday Night Party - CC0" class="align-center" src="http://www.servicedenuages.fr/en/../images/whistler-top-roof.jpg" style="width: 1024px; height: auto; max-width: 100%;"/&gt;
&lt;/div&gt;
</content></entry><entry><title>Achievement unlocked</title><link href="http://www.servicedenuages.fr/en/kinto-1.0" rel="alternate"></link><published>2015-06-17T00:00:00+02:00</published><updated>2015-06-17T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-06-17:/en/kinto-1.0</id><summary type="html">&lt;p class="first last"&gt;We just released cliquet 2.0 and Kinto 1.0 !&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Today we released Cliquet 2.0 &lt;a class="footnote-reference" href="#id5" id="id1"&gt;[1]&lt;/a&gt; and Kinto 1.0 &lt;a class="footnote-reference" href="#id6" id="id2"&gt;[2]&lt;/a&gt; (a.k.a Cloud Storage).&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://kinto.readthedocs.io/en/latest/"&gt;Kinto&lt;/a&gt; is a service to
store, synchronize and share arbitrary data attached to a Firefox Account.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://cliquet.readthedocs.io/en/latest/"&gt;Cliquet&lt;/a&gt; is a toolkit to
ease the implementation of HTTP micro-services, such as data-driven REST APIs
with synchronization needs.&lt;/p&gt;
&lt;p&gt;You can read more about our rationale for building this solution at
&lt;a class="reference external" href="http://www.servicedenuages.fr/eco-systeme-et-stockage-generique-en.html"&gt;http://www.servicedenuages.fr/eco-systeme-et-stockage-generique-en.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Both projects received a lot of diligence during the last months. Even
though most of the work we had done for Reading List could be
used, we rebuilt many parts and introduced some long awaited features,
like permissions management.&lt;/p&gt;
&lt;p&gt;Of course, exactly like when you refurbish a ceiling at home, we can't
resist to see loads of things that shall still be improved! Especially
about documentation and performance :)&lt;/p&gt;
&lt;p&gt;We can already foresee how the ecosystem will look like, and it's
promising. There is already a JavaScript client &lt;a class="footnote-reference" href="#id7" id="id3"&gt;[3]&lt;/a&gt;, which aims to
synchronize browser local data with a Kinto instance.&lt;/p&gt;
&lt;p&gt;We strongly welcome any feedback, be it about the code, the
documentation or security aspects of the solution. If you wish to reach
to us, you can use the #storage channel of the Mozilla IRC network.&lt;/p&gt;
&lt;p&gt;And, this is just the beginning! Future plans are described in our road
map &lt;a class="footnote-reference" href="#id8" id="id4"&gt;[4]&lt;/a&gt;.&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id5" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Cliquet is a toolkit to ease the implementation of HTTP
microservices, such as data-driven REST APIs —  &lt;a class="reference external" href="https://cliquet.readthedocs.io"&gt;https://cliquet.readthedocs.io&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id6" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id2"&gt;[2]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Kinto is a server allowing you to store and synchronize arbitrary data,
attached to your Firefox account. — &lt;a class="reference external" href="https://kinto.readthedocs.io"&gt;https://kinto.readthedocs.io&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id7" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id3"&gt;[3]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Cliquetis, the javascript library to consume the Kinto HTTP API —
&lt;a class="reference external" href="https://github.com/mozilla-services/cliquetis"&gt;https://github.com/mozilla-services/cliquetis&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id8" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id4"&gt;[4]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Kinto roadmap: &lt;a class="reference external" href="https://github.com/mozilla-services/kinto/wiki/roadmap"&gt;https://github.com/mozilla-services/kinto/wiki/roadmap&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</content><category term="mozilla"></category></entry><entry><title>Achievement unlocked</title><link href="http://www.servicedenuages.fr/en/../kinto-1.0" rel="alternate"></link><published>2015-06-17T00:00:00+02:00</published><updated>2015-06-17T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-06-17:/en/../kinto-1.0</id><summary type="html">&lt;p class="first last"&gt;Après près de 3 mois intensifs, nous venons de &lt;em&gt;tagguer&lt;/em&gt; Cliquet 2.0
et Kinto 1.0 !&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Aujourd'hui, c'est jour de fête : nous venons de publier Cliquet &lt;strong&gt;2.0&lt;/strong&gt;
&lt;a class="footnote-reference" href="#id5" id="id1"&gt;[1]&lt;/a&gt; et Kinto &lt;strong&gt;1.0&lt;/strong&gt; &lt;a class="footnote-reference" href="#id6" id="id2"&gt;[2]&lt;/a&gt;.&lt;/p&gt;
&lt;blockquote class="epigraph"&gt;
&lt;p&gt;L'aboutissement de 3 années de R&amp;amp;D !&lt;/p&gt;
&lt;p class="attribution"&gt;—Rémy&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a class="reference external" href="https://kinto.readthedocs.io/en/latest/"&gt;Kinto&lt;/a&gt; est un service pour
stocker, synchroniser et partager des données arbitraires, attachées à un
compte Firefox (mais le système d'authentification est &lt;em&gt;pluggable&lt;/em&gt;).&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://cliquet.readthedocs.io/en/latest/"&gt;Cliquet&lt;/a&gt; est une boite à outils pour faciliter l'implémentation de
micro-services HTTP tels que les APIs &lt;em&gt;REST&lt;/em&gt; ayant des besoins de synchronisation.&lt;/p&gt;
&lt;p&gt;Vous pouvez lire plus à propos des raisons qui nous ont poussé à proposer cette nouvelle solution
et de notre ambition sur &lt;a class="reference external" href="http://www.servicedenuages.fr/eco-systeme-et-stockage-generique.html"&gt;http://www.servicedenuages.fr/eco-systeme-et-stockage-generique.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Nous sommes fiers du travail que nous avons pu réaliser durant ces derniers
mois sur ces deux projets. Bien que la plupart du travail que nous ayons
réalisé pour le serveur de liste de lecture (Reading List) ait pu être utilisé,
beaucoup de parties ont été repensées et nous avons introduit des
fonctionnalités que l'on attendait depuis longtemps, comme la gestion des
permissions.&lt;/p&gt;
&lt;p&gt;Bien sur, exactement comme après un ré-aménagement de salon, on ne peut
s'empêcher de voir toutes les choses qui doivent toujours être améliorées,
notamment sur la documentation et les performances.&lt;/p&gt;
&lt;p&gt;On peut déjà entrevoir à quoi l'écosystème va ressembler, et c'est prometteur.
Il y a déjà un client JavaScript &lt;a class="footnote-reference" href="#id7" id="id3"&gt;[3]&lt;/a&gt; dont l'objectif est de synchroniser les
données locales du navigateur avec une instance de Kinto.&lt;/p&gt;
&lt;p&gt;N'hésitez vraiment pas à nous solliciter pour discuter avec vous si vous avez
des problématiques proches : nous accueillons avec plaisir toutes sortes de
retours, que ce soit à propos du code, de la documentation, de la sécurité de
la solution ou de la manière de communiquer avec le monde extérieur. Si vous
souhaitez nous contacter, vous pouvez laisser un commentaire ici ou nous
contacter sur le canal &lt;a class="reference external" href="irc://irc.mozilla.org/#storage"&gt;#storage&lt;/a&gt; sur le réseau IRC de Mozilla.&lt;/p&gt;
&lt;p&gt;Et ce n'est que le début ! Le futur se dessine dans notre feuille de route
&lt;a class="footnote-reference" href="#id8" id="id4"&gt;[4]&lt;/a&gt;.&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id5" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;Cliquet&lt;/strong&gt; est une boite à outils pour faciliter l'implémentation de
microservices HTTP tels que les APIs &lt;em&gt;REST&lt;/em&gt; ayant des besoins de
synchronisation.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id6" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id2"&gt;[2]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;strong&gt;Kinto&lt;/strong&gt; est un service pour stocker, synchroniser et partager des données
arbitraires, attachées à un compte Firefox (mais le système d'authentification
est &lt;em&gt;pluggable&lt;/em&gt;).&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id7" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id3"&gt;[3]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Cliquetis, la bibliothèque JavaScript pour consommer l'API HTTP de Kinto —
&lt;a class="reference external" href="https://github.com/mozilla-services/cliquetis"&gt;https://github.com/mozilla-services/cliquetis&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table class="docutils footnote" frame="void" id="id8" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id4"&gt;[4]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;La feuille de route de Kinto: &lt;a class="reference external" href="https://github.com/mozilla-services/kinto/wiki/roadmap"&gt;https://github.com/mozilla-services/kinto/wiki/roadmap&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</content></entry><entry><title>Handling permissions</title><link href="http://www.servicedenuages.fr/en/handling-permissions" rel="alternate"></link><published>2015-05-12T00:00:00+02:00</published><updated>2015-05-12T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-05-12:/en/handling-permissions</id><summary type="html">&lt;p class="first last"&gt;Where we clarify the vocabulary around permissions and explain what
we plan to implement for our generic data storage solution, Kinto.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;When creating a generic data storage (Kinto), permissions handling is one of
the big challenges: who should get access to what, and how should we define
these rules?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;tl;dr: Some feedback about the permissions vocabulary and our ideas about how
to implement permissions management in a generic data storage system&lt;/strong&gt;&lt;/p&gt;
&lt;div class="section" id="the-problem-at-hand"&gt;
&lt;h2&gt;The problem at hand&lt;/h2&gt;
&lt;p&gt;The problem we're facing is simple: data is stored online and we need a way to
share this data with other people.&lt;/p&gt;
&lt;p&gt;Looking at the use cases, it's possible to split our users in two categories:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;End users (you);&lt;/li&gt;
&lt;li&gt;Applications which interact on their behalf.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Different parties don't have the same rights: some should be able to read,
others should write, yet another should be able to create new records, and all
this permission handling should be fine-grained: it should be possible to read
one record but not the other, for instance.&lt;/p&gt;
&lt;p&gt;We started from the fact that no available solution was offering an appealing
solution to these needs.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="a-vocabulary-problem"&gt;
&lt;h2&gt;A vocabulary problem&lt;/h2&gt;
&lt;p&gt;The principal problem that got in our way during our thinking was the
vocabulary.&lt;/p&gt;
&lt;div class="section" id="principals"&gt;
&lt;h3&gt;Principals&lt;/h3&gt;
&lt;p&gt;A &lt;em&gt;principal&lt;/em&gt;, is an entity that can be authenticated by a computer system.
It is the actor who does the action. &lt;a class="footnote-reference" href="#id2" id="id1"&gt;[1]&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;It could either be someone, a computer, a service or a group of any of such
things. This is conceptually wider than the classical "user id*".&lt;/p&gt;
&lt;p&gt;Permissions are then associated to these &lt;em&gt;principals&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;For instance, a user is identified in an unique way when he connects to the
authentication system, which role is to define a list of &lt;em&gt;principals&lt;/em&gt; for the
authenticating user.&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id2" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;To read more about &lt;em&gt;principals&lt;/em&gt; :
&lt;a class="reference external" href="https://en.wikipedia.org/wiki/Principal_%28computer_security%29"&gt;https://en.wikipedia.org/wiki/Principal_%28computer_security%29&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="the-difference-between-a-role-and-a-group"&gt;
&lt;h3&gt;The difference between a role and a group&lt;/h3&gt;
&lt;p&gt;From scratch, it's not easy to precisely define the difference between these two
concepts which allow to associate permissions to a group of &lt;em&gt;principals&lt;/em&gt;. &lt;a class="footnote-reference" href="#id4" id="id3"&gt;[2]&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;The difference is mainly semantic, but we can see a difference in the "direction"
of the relationship between these two concepts.&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;A role is a list of permissions associated to a &lt;em&gt;principal&lt;/em&gt;;&lt;/li&gt;
&lt;li&gt;A group is a list of &lt;em&gt;principals&lt;/em&gt; we can associate to a permission.&lt;/li&gt;
&lt;/ul&gt;
&lt;table class="docutils footnote" frame="void" id="id4" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id3"&gt;[2]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;More information at:
&lt;a class="reference external" href="http://stackoverflow.com/questions/7770728/group-vs-role-any-real-difference"&gt;http://stackoverflow.com/questions/7770728/group-vs-role-any-real-difference&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="the-difference-between-permission-acl-and-ace"&gt;
&lt;h3&gt;The difference between permission, ACL and ACE&lt;/h3&gt;
&lt;blockquote class="epigraph"&gt;
&lt;p&gt;An ACL is a list of Access Control Entry (ACE) enabling or disabling
acces rights to a person or a group.&lt;/p&gt;
&lt;p class="attribution"&gt;—&lt;a class="reference external" href="https://en.wikipedia.org/wiki/Access_Control_List"&gt;https://en.wikipedia.org/wiki/Access_Control_List&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;I would even say, in our case, "to a &lt;em&gt;principal&lt;/em&gt;". For instance:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;create_record: alexis,remy,tarek
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This ACE gives the &lt;tt class="docutils literal"&gt;create&lt;/tt&gt; permission on the &lt;tt class="docutils literal"&gt;record&lt;/tt&gt; object to the users
Tarek, Rémy and Alexis.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="permissions-delegation"&gt;
&lt;h2&gt;Permissions delegation&lt;/h2&gt;
&lt;p&gt;Imagine the following example, where Alice stores two types of data online:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;a list of contacts ;&lt;/li&gt;
&lt;li&gt;a list of tasks, which can be associated to her contacts.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Alice has all the rights on its data.&lt;/p&gt;
&lt;p&gt;However, she's using two applications which should have a restricted access:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;One application to handle contacts, to which she wants to delegate the entire
management: &lt;tt class="docutils literal"&gt;contacts:write&lt;/tt&gt; ;&lt;/li&gt;
&lt;li&gt;Another application to handle the tasks, to which she wants to delegate the
management of the tasks, and the reading of the contacts: &lt;tt class="docutils literal"&gt;contacts:read
tasks:write&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;She wants to prevent her contacts application to access the tasks and the tasks
app should not be able to update existing contacts, just eventually creating
new ones.&lt;/p&gt;
&lt;p&gt;She then needs a way to delegate some of her permissions to a third party (the
app).&lt;/p&gt;
&lt;p&gt;That's precisely the role of &lt;a class="reference external" href="http://tools.ietf.org/html/rfc6749#page-23"&gt;OAuth2 scopes&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;During the connection of a user, a window will ask her which access she wants
to give to the application that will act on her behalf.&lt;/p&gt;
&lt;p&gt;The service will then have access to these &lt;em&gt;scopes&lt;/em&gt; by looking at the
used authentication token. This information should be considered as a user
input (that is, we cannot trust it). It is what the user &lt;em&gt;wants&lt;/em&gt;, not what the
user &lt;em&gt;should have access to&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;It's possible that the user don't have access to the requested data. The
service should use two levels of permissions: the user ones, and the ones that
were delegated to the application.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="namespaces"&gt;
&lt;h2&gt;Namespaces&lt;/h2&gt;
&lt;p&gt;In our initial implementation of &lt;em&gt;Kinto&lt;/em&gt; (our generic data storage service),
the &lt;em&gt;namespace&lt;/em&gt; was implicit: stored data was necessarily tied to the connected
user.&lt;/p&gt;
&lt;p&gt;User data were then impossible to share.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Namespaces&lt;/em&gt; are a simple way to handle the data sharing problem.&lt;/p&gt;
&lt;p&gt;We chose to re-use the GitHub and BitBucket mode, which uses "organisations" as
&lt;em&gt;namespaces&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;In our case, it's possible to create "buckets", which are one of these
&lt;em&gt;namespaces&lt;/em&gt;. A bucket is a container for collections and user groups.&lt;/p&gt;
&lt;p&gt;ACLs on these collections can be given to certain groups of the bucket, and
directly to other &lt;em&gt;principals&lt;/em&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="our-api-proposal"&gt;
&lt;h2&gt;Our API proposal&lt;/h2&gt;
&lt;div class="section" id="manipulated-objects"&gt;
&lt;h3&gt;Manipulated objects&lt;/h3&gt;
&lt;p&gt;To handle permissions, we identified the following objects:&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="23%"/&gt;
&lt;col width="77%"/&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Object&lt;/th&gt;
&lt;th class="head"&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;bucket&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;We can see them as &lt;em&gt;namespaces&lt;/em&gt;. They allow to have
different collections having the same name but stored
in different &lt;em&gt;buckets&lt;/em&gt; so that data are distinct.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;collection&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;A list of records.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;record&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;A record from a collection&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;group&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;A group of principals&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;To define ACLs, there is a hierarchy: objects inherit the ACLs from their
parents.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;           +---------------+
           | Bucket        |
           +---------------+
    +-----&amp;gt;+ - id          +&amp;lt;---+
    |      | - permissions |    |
    |      +---------------+    |
    |                           |
    |                           |
    |                           |
    |                           |
    |                           |
+---+-----------+        +------+---------+
| Collection    |        | Group          |
+---------------+        +----------------+
| - id          |        |  - id          |
| - permissions |        |  - members     |
+------+--------+        |  - permissions |
       ^                 +----------------+
       |
       |
+------+---------+
| Record         |
+----------------+
|  - id          |
|  - data        |
|  - permissions |
+----------------+
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="permissions"&gt;
&lt;h3&gt;Permissions&lt;/h3&gt;
&lt;p&gt;For all of these objects, we identified the following permissions:&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="23%"/&gt;
&lt;col width="77%"/&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Permission&lt;/th&gt;
&lt;th class="head"&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;read&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;The permission to read the content of
the object and all its children.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;write&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;The permission to modify and
administration an object and all its
children objects. The &lt;em&gt;write&lt;/em&gt;
permission allows reading, modification
and deletion of objects, and the
handling of permissions on this object.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;create&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;The permission to create the specified
child object. For instance:
&lt;tt class="docutils literal"&gt;collections:create&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;To each specified permission on an object is associated a list of &lt;em&gt;principals&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;For the &lt;tt class="docutils literal"&gt;create&lt;/tt&gt; permission, we are forced to specify which child the
permission applies to since an object can have different kind of child nodes.
For instance: &lt;tt class="docutils literal"&gt;collections:create&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;groups:create&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;We don't have a &lt;cite&gt;delete&lt;/cite&gt; and &lt;cite&gt;update&lt;/cite&gt; permission so far, because we don't have
any use case which needs them. Whoever with the &lt;tt class="docutils literal"&gt;write&lt;/tt&gt; permission can also
delete a record.&lt;/p&gt;
&lt;p&gt;Permissions from an object are inherited from its parent. For instance,
a record created in a collection available to anyone will also be available to
anyone.&lt;/p&gt;
&lt;p&gt;Said differently, it's not possible that an object has a more restrictive
permission that its parent.&lt;/p&gt;
&lt;p&gt;Here is a complete list of permissions:&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="21%"/&gt;
&lt;col width="32%"/&gt;
&lt;col width="47%"/&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Object&lt;/th&gt;
&lt;th class="head"&gt;Associated permissions&lt;/th&gt;
&lt;th class="head"&gt;Comment&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;Configuration
(.ini)&lt;/td&gt;
&lt;td&gt;&lt;cite&gt;buckets:create&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;&lt;em&gt;Principals&lt;/em&gt; who can create
a bucket are defined in the
service configuration (for
instance "authenticated users")&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="4"&gt;&lt;tt class="docutils literal"&gt;bucket&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;cite&gt;write&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;The "admin" permission for the
&lt;em&gt;bucket&lt;/em&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;read&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;The permission to read all the
content of all objects in the
&lt;em&gt;bucket&lt;/em&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;collections:create&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission to create
collections in the &lt;em&gt;bucket&lt;/em&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;groups:create&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission to create groups
in the &lt;em&gt;bucket&lt;/em&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="3"&gt;&lt;tt class="docutils literal"&gt;collection&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;cite&gt;write&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission to administrate all
objects in the collection.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;read&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission to consult all
objects in the collection.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;records:create&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission to create new
records in the collection.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;record&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;cite&gt;write&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission to modify or share
the record.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;read&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission to read the record.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;group&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;cite&gt;write&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission to administrate the
group.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;read&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission to know the members of
the group.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="id5"&gt;
&lt;h3&gt;&lt;em&gt;principals&lt;/em&gt;&lt;/h3&gt;
&lt;p&gt;Actors connecting to the storage service can authenticate themselves.&lt;/p&gt;
&lt;p&gt;They then receive a list of &lt;em&gt;principals&lt;/em&gt;:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;: the &lt;em&gt;principal&lt;/em&gt; given to all actors (authenticated or not);&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;: the &lt;em&gt;principal&lt;/em&gt; given to all authenticated actors;&lt;/li&gt;
&lt;li&gt;A &lt;em&gt;principal&lt;/em&gt; identifying the actor, for instance &lt;tt class="docutils literal"&gt;fxa:32aa95a474c984d41d395e2d0b614aa2&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In order to avoid identifiers collisions, the actor &lt;em&gt;principal&lt;/em&gt; is built from
the authentication type used (&lt;tt class="docutils literal"&gt;system&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;basic&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;ipaddr&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;hawk&lt;/tt&gt;,
&lt;tt class="docutils literal"&gt;fxa&lt;/tt&gt;) and the identifier.&lt;/p&gt;
&lt;p&gt;Depending the &lt;em&gt;bucket&lt;/em&gt; on which the action is taking place, the groups the user
is a member of are also added to her list of principals (e.g.
&lt;tt class="docutils literal"&gt;group:moderators&lt;/tt&gt;)&lt;/p&gt;
&lt;p&gt;So, if Bob connects with his &lt;em&gt;Firefox Account&lt;/em&gt; on the &lt;tt class="docutils literal"&gt;servicedenuages_blog&lt;/tt&gt;
bucket, on which he is a member of the &lt;tt class="docutils literal"&gt;moderators&lt;/tt&gt; group, he would have the
following list of principals:
&lt;tt class="docutils literal"&gt;Everyone, Authenticated, fxa:32aa95a474c984d41d395e2d0b614aa2, group:moderators&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;It's then possible to assign a permission to Bob by using one of these
&lt;em&gt;principals&lt;/em&gt;.&lt;/p&gt;
&lt;div class="admonition note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;The &lt;tt class="docutils literal"&gt;&amp;lt;userid&amp;gt;&lt;/tt&gt; &lt;strong&gt;principal&lt;/strong&gt; depends on the authentication &lt;em&gt;back-end&lt;/em&gt; used (e.g.
&lt;tt class="docutils literal"&gt;github:leplatrem&lt;/tt&gt;).&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="a-few-examples"&gt;
&lt;h3&gt;A few examples&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Blog&lt;/strong&gt;&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="35%"/&gt;
&lt;col width="18%"/&gt;
&lt;col width="46%"/&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Object&lt;/th&gt;
&lt;th class="head"&gt;Permissions&lt;/th&gt;
&lt;th class="head"&gt;Principals&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;bucket:blog&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;blog&lt;/span&gt; owner id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;collection:articles&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;group:moderators&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;read&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;record:569e28r98889&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;co-author&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Wiki&lt;/strong&gt;&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="35%"/&gt;
&lt;col width="18%"/&gt;
&lt;col width="46%"/&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Object&lt;/th&gt;
&lt;th class="head"&gt;Permissions&lt;/th&gt;
&lt;th class="head"&gt;Principals&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;bucket:wiki&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;wiki&lt;/span&gt; administrator id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;collection:articles&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;read&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Polls&lt;/strong&gt;&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="34%"/&gt;
&lt;col width="31%"/&gt;
&lt;col width="35%"/&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Object&lt;/th&gt;
&lt;th class="head"&gt;Permissions&lt;/th&gt;
&lt;th class="head"&gt;Principals&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;bucket:poll&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;admin&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;collection:create&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;collection:&amp;lt;poll&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;poll&lt;/span&gt; author id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;record:create&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Collaborative maps&lt;/strong&gt;&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="34%"/&gt;
&lt;col width="31%"/&gt;
&lt;col width="35%"/&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Object&lt;/th&gt;
&lt;th class="head"&gt;Permissions&lt;/th&gt;
&lt;th class="head"&gt;Principals&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;bucket:maps&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;admin&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;collection:create&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;collection:&amp;lt;map&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;map&lt;/span&gt; author id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;read&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;record:&amp;lt;record&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;maintainer&lt;/span&gt; id&amp;gt;&lt;/tt&gt;
(&lt;em&gt;ex. event staff member
maintaining venues&lt;/em&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Platforms&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Of course, there are many ways to modelize common use cases. For instance, it's
possible to imagine a wiki platform (ala wikia.com) where wikis are private by
default and some pages can be published:&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="32%"/&gt;
&lt;col width="30%"/&gt;
&lt;col width="38%"/&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Object&lt;/th&gt;
&lt;th class="head"&gt;Permissions&lt;/th&gt;
&lt;th class="head"&gt;Principals&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td rowspan="3"&gt;&lt;tt class="docutils literal"&gt;bucket:freewiki&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;administrator&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;collection:create&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;group:create&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;collection:&amp;lt;wiki&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;wiki&lt;/span&gt; owner id&amp;gt;&lt;/tt&gt;,
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;group:&amp;lt;editors&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;read&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;group:&amp;lt;readers&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;record:&amp;lt;page&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;read&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="the-http-api"&gt;
&lt;h3&gt;The HTTP API&lt;/h3&gt;
&lt;p&gt;During the creation of an object, the user is given the &lt;tt class="docutils literal"&gt;write&lt;/tt&gt; permission on
the object:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nf"&gt;PUT&lt;/span&gt; &lt;span class="nn"&gt;/v1/buckets/servicedenuages_blog&lt;/span&gt; &lt;span class="kr"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;1.1&lt;/span&gt;
&lt;span class="na"&gt;Authorization&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Bearer 0b9c2625dc21ef05f6ad4ddf47c5f203837aa32ca42fced54c2625dc21efac32&lt;/span&gt;
&lt;span class="na"&gt;Accept&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;application/json&lt;/span&gt;

HTTP/1.1 201 Created
Content-Type: application/json; charset=utf-8

{
    "id": "servicedenuages_blog",
    "permissions": {
        "write": ["fxa:49d02d55ad10973b7b9d0dc9eba7fdf0"]
    }
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It's possible to add permissions using the &lt;tt class="docutils literal"&gt;PATCH&lt;/tt&gt; HTTP method.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nf"&gt;PATCH&lt;/span&gt; &lt;span class="nn"&gt;/v1/buckets/servicedenuages_blog/collections/articles&lt;/span&gt; &lt;span class="kr"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;1.1&lt;/span&gt;
&lt;span class="na"&gt;Authorization&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Bearer 0b9c2625dc21ef05f6ad4ddf47c5f203837aa32ca42fced54c2625dc21efac32&lt;/span&gt;
&lt;span class="na"&gt;Accept&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;application/json&lt;/span&gt;

{
    "permissions": {
        "read": ["+system.Everyone"]
    }
}

HTTP/1.1 201 Created
Content-Type: application/json; charset=utf-8

{
    "id": "servicedenuages_blog",
    "permissions": {
        "write": ["fxa:49d02d55ad10973b7b9d0dc9eba7fdf0"],
        "read": ["system.Everyone"]
    }
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;For &lt;tt class="docutils literal"&gt;PATCH&lt;/tt&gt;, we are thinking about using a syntax prefixed with a &lt;tt class="docutils literal"&gt;+&lt;/tt&gt; or
a &lt;tt class="docutils literal"&gt;-&lt;/tt&gt; to add or remove &lt;em&gt;principals&lt;/em&gt; on an ACL.&lt;/p&gt;
&lt;p&gt;It is also possible to do a &lt;tt class="docutils literal"&gt;PUT&lt;/tt&gt; to reset the ACLs, knowing that the &lt;tt class="docutils literal"&gt;PUT&lt;/tt&gt;
will then add the current user to the list. It's possible to use a &lt;tt class="docutils literal"&gt;PATCH&lt;/tt&gt; to
remove herself from the list. Adding the current user allows to avoid
situations where nobody has access to the data anymore.&lt;/p&gt;
&lt;div class="admonition note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;The &lt;tt class="docutils literal"&gt;create&lt;/tt&gt; permission is used for a &lt;tt class="docutils literal"&gt;POST&lt;/tt&gt; but also for a &lt;tt class="docutils literal"&gt;PUT&lt;/tt&gt;
when the record doesn't exist.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="the-specific-case-of-user-data"&gt;
&lt;h3&gt;The specific case of user data&lt;/h3&gt;
&lt;p&gt;One of the current feature of &lt;em&gt;Kinto&lt;/em&gt; is to handle record collections by user.&lt;/p&gt;
&lt;p&gt;On &lt;em&gt;*nix&lt;/em&gt; systems, it's possible, for an application, to save configuration
for the current user in her personal folder, without bothering about its
specific location, using &lt;tt class="docutils literal"&gt;~&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;In our case, if an application want to save contacts for a user, it can use
a shortcut to reference the &lt;em&gt;personal&lt;/em&gt; bucket of the user:
&lt;tt class="docutils literal"&gt;/buckets/personal/collections/contacts&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;This URL will return a &lt;tt class="docutils literal"&gt;HTTP 307&lt;/tt&gt; to the current user &lt;em&gt;bucket&lt;/em&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nf"&gt;POST&lt;/span&gt; &lt;span class="nn"&gt;/v1/buckets/personal/collections/contacts/records&lt;/span&gt; &lt;span class="kr"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;1.1&lt;/span&gt;

{
   "name": "Rémy",
   "emails": ["remy@example.com"],
   "phones": ["+330820800800"]
}

HTTP/1.1 307 Temporary Redirect
Location: /v1/buckets/fxa:49d02d55ad10973b7b9d0dc9eba7fdf0/collections/contacts/records
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Like so, it's possible for Alice to share her contacts with Bob. She just have
to give the &lt;tt class="docutils literal"&gt;read&lt;/tt&gt; permission to Bob on her collection and give him the
complete URL:
&lt;tt class="docutils literal"&gt;/v1/buckets/fxa:49d02d55ad10973b7b9d0dc9eba7fdf0/collections/contacts/records&lt;/tt&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id6"&gt;
&lt;h3&gt;Permissions delegation&lt;/h3&gt;
&lt;p&gt;In &lt;em&gt;Kinto&lt;/em&gt;, we defined a format to restrict permissions using OAuth2 scopes:
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;storage:&amp;lt;bucket_id&amp;gt;:&amp;lt;collection_id&amp;gt;:&amp;lt;permissions_list&amp;gt;&lt;/span&gt;&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Taking back the previous &lt;em&gt;tasks&lt;/em&gt; example, it is possible for Bob to create
a specific OAuth2 token with the following &lt;em&gt;scopes&lt;/em&gt;:
&lt;tt class="docutils literal"&gt;profile storage:todolist:tasks:write storage:personal:contacts:read+records:create&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Like so, even if Bob has the &lt;tt class="docutils literal"&gt;write&lt;/tt&gt; permission on his contacts, the
application using this token will only be able to read the existing contacts
and add new ones.&lt;/p&gt;
&lt;p&gt;One part of the complexity is to manage presenting these &lt;em&gt;scopes&lt;/em&gt; in a readable
way to the user, so she or he is able to chose which permissions to give to the
applications acting on her behalf.&lt;/p&gt;
&lt;p&gt;So, here is where we're at with our thinking!&lt;/p&gt;
&lt;p&gt;If you have things to add or discuss with this proposal, don't hesitate to
interrupt us while it's still possible!&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>La gestion des permissions</title><link href="http://www.servicedenuages.fr/en/../la-gestion-des-permissions" rel="alternate"></link><published>2015-05-12T00:00:00+02:00</published><updated>2015-05-12T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-05-12:/en/../la-gestion-des-permissions</id><summary type="html">&lt;p class="first last"&gt;Démystification du vocabulaire des permissions et proposition d'implémentation pour Kinto&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Dans le cadre de la création d'un service de stockage de données personnelles
(Kinto), la gestion des permissions est un des gros challenges : qui doit avoir
accès à quoi, et comment le définir ?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;tl;dr: Quelques retours sur le vocabulaire des systèmes de permission et sur nos idées pour l'implementation des permissions dans un stockage générique.&lt;/strong&gt;&lt;/p&gt;
&lt;div class="section" id="la-problematique"&gt;
&lt;h2&gt;La problématique&lt;/h2&gt;
&lt;p&gt;La problématique est simple : des données sont stockées en ligne, et il
faut un moyen de pouvoir les partager avec d'autres personnes.&lt;/p&gt;
&lt;p&gt;En regardant les cas d'utilisations, on se rend compte qu'on a plusieurs types
d'utilisateurs :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;les utilisateurs "finaux" (vous) ;&lt;/li&gt;
&lt;li&gt;les applications qui interagissent en leurs noms.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Tous les intervenants n'ont donc pas les mêmes droits : certains doivent
pouvoir lire, d'autres écrire, d'autres encore créer de nouveaux
enregistrements, et le contrôle doit pouvoir s'effectuer de manière fine : il
doit être possible de lire un enregistrement mais pas un autre, par exemple.&lt;/p&gt;
&lt;p&gt;Nous sommes partis du constat que les solutions disponibles n'apportaient pas
une réponse satisfaisante à ces besoins.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="un-probleme-de-vocabulaire"&gt;
&lt;h2&gt;Un problème de vocabulaire&lt;/h2&gt;
&lt;p&gt;Le principal problème rencontré lors des réflexions fût le vocabulaire.&lt;/p&gt;
&lt;p&gt;Voici ci-dessous une explication des différents termes.&lt;/p&gt;
&lt;div class="section" id="le-concept-de-principal"&gt;
&lt;h3&gt;Le concept de « principal »&lt;/h3&gt;
&lt;p&gt;Un &lt;em&gt;principal&lt;/em&gt;, en sécurité informatique, est une entité qui peut être
authentifiée par un système informatique. &lt;a class="footnote-reference" href="#id2" id="id1"&gt;[1]&lt;/a&gt; En Français il s'agit
du « commettant », l'acteur qui commet l'action (oui, le terme est conceptuel !)&lt;/p&gt;
&lt;p&gt;Il peut s'agir aussi bien d'un individu, d'un ordinateur, d'un
service ou d'un groupe regroupant l'une de ces entités, ce qui
est plus large que le classique « &lt;em&gt;user id&lt;/em&gt; ».&lt;/p&gt;
&lt;p&gt;Les permissions sont alors associées à ces &lt;em&gt;principals&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Par exemple, un utilisateur est identifié de manière unique lors de la
connexion par le système d'authentification dont le rôle est de
définir une liste de &lt;em&gt;principals&lt;/em&gt; pour l'utilisateur se connectant.&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id2" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Pour en savoir plus sur les &lt;em&gt;principals&lt;/em&gt; :
&lt;a class="reference external" href="https://en.wikipedia.org/wiki/Principal_%28computer_security%29"&gt;https://en.wikipedia.org/wiki/Principal_%28computer_security%29&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="la-difference-entre-role-et-groupe"&gt;
&lt;h3&gt;La différence entre rôle et groupe&lt;/h3&gt;
&lt;p&gt;De but en blanc, il n'est pas évident de définir précisément la
différence entre ces deux concepts qui permettent d'associer
des permissions à un groupe de &lt;em&gt;principals&lt;/em&gt;. &lt;a class="footnote-reference" href="#id4" id="id3"&gt;[2]&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;La différence est principalement sémantique. Mais on peut y voir une
différence dans la « direction » de la relation entre les deux concepts.&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Un rôle est une liste de permissions que l'on associe à un &lt;em&gt;principal&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;Un groupe est une liste de &lt;em&gt;principals&lt;/em&gt; que l'on peut associer à une permission.&lt;/li&gt;
&lt;/ul&gt;
&lt;table class="docutils footnote" frame="void" id="id4" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id3"&gt;[2]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Plus d'informations :
&lt;a class="reference external" href="http://stackoverflow.com/questions/7770728/group-vs-role-any-real-difference"&gt;http://stackoverflow.com/questions/7770728/group-vs-role-any-real-difference&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="la-difference-entre-permission-acl-ace"&gt;
&lt;h3&gt;La différence entre permission, ACL, ACE&lt;/h3&gt;
&lt;blockquote class="epigraph"&gt;
&lt;p&gt;Une ACL est une liste d’Access Control Entry (ACE) ou entrée de contrôle d'accès
donnant ou supprimant des droits d'accès à une personne ou un groupe.&lt;/p&gt;
&lt;p class="attribution"&gt;—&lt;a class="reference external" href="https://fr.wikipedia.org/wiki/Access_Control_List"&gt;https://fr.wikipedia.org/wiki/Access_Control_List&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Je dirais même plus, dans notre cas, « à un &lt;em&gt;principal&lt;/em&gt; ». Par exemple:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;create_record: alexis,remy,tarek
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Cet ACE donne la permission &lt;tt class="docutils literal"&gt;create&lt;/tt&gt; sur l'objet &lt;tt class="docutils literal"&gt;record&lt;/tt&gt; aux
utilisateurs Tarek, Rémy et Alexis.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="la-delegation-de-permissions"&gt;
&lt;h2&gt;La délégation de permissions&lt;/h2&gt;
&lt;p&gt;Imaginez l'exemple suivant, où un utilisateur stocke deux types de données en
ligne :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;des contacts ;&lt;/li&gt;
&lt;li&gt;une liste de tâches à faire qu'il peut associer à ses contacts.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;L'utilisateur a tous les droits sur ses données.&lt;/p&gt;
&lt;p&gt;Cependant il utilise deux applications qui doivent elles avoir un accès restreint :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;une application de gestion des contacts à qui il souhaite déléguer
la gestion intégrale de ses contacts : &lt;tt class="docutils literal"&gt;contacts:write&lt;/tt&gt; ;&lt;/li&gt;
&lt;li&gt;une application de gestion des tâches à qui il souhaite déléguer la
gestion des tâches : &lt;tt class="docutils literal"&gt;contacts:read tasks:write&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Il souhaite que son application de contacts ne puisse pas accéder à
ses tâches et que son application de tâches ne puisse pas modifier ses
contacts existants, juste éventuellement en créer de nouveaux.&lt;/p&gt;
&lt;p&gt;Il lui faut donc un moyen de déléguer certains de ses droits à un tiers
(l'application).&lt;/p&gt;
&lt;p&gt;C'est précisément le rôle des &lt;a class="reference external" href="http://tools.ietf.org/html/rfc6749#page-23"&gt;scopes OAuth2&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Lors de la connexion d'un utilisateur, une fenêtre lui demande quels
accès il veut donner à l'application qui va agir en son nom.&lt;/p&gt;
&lt;p&gt;Le service aura ensuite accès à ces &lt;em&gt;scopes&lt;/em&gt; en regardant le jeton
d'authentification utilisé. Cette information doit être
considérée comme une entrée utilisateur (c'est à dire qu'on ne peut
pas lui faire confiance). Il s'agit de ce que l'utilisateur souhaite.&lt;/p&gt;
&lt;p&gt;Or, il est également possible que l'utilisateur n'ait pas accès aux données
qu'il demande. Le service doit donc utiliser deux niveaux de permissions :
celles de l'utilisateur, et celles qui ont été déléguées à l'application.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="espace-de-noms"&gt;
&lt;h2&gt;Espace de noms&lt;/h2&gt;
&lt;p&gt;Dans notre implémentation initiale de &lt;em&gt;Kinto&lt;/em&gt; (notre service de stockage en
construction), l'espace de nom était implicite : les données stockées étaient
nécessairement celles de l'utilisateur connecté.&lt;/p&gt;
&lt;p&gt;Les données d'un utilisateur étaient donc cloisonnées et impossible à partager.&lt;/p&gt;
&lt;p&gt;L'utilisation d'espaces de noms est une manière simple de gérer le partage des données.&lt;/p&gt;
&lt;p&gt;Nous avons choisi de reprendre le modèle de GitHub et de Bitbucket, qui
utilisent les « organisations » comme espaces de noms.&lt;/p&gt;
&lt;p&gt;Dans notre cas, il est possible de créer des "buckets", qui correspondent à ces
espaces de noms. Un bucket est un conteneur de collections et de groupes
utilisateurs.&lt;/p&gt;
&lt;p&gt;Les ACLs sur ces collections peuvent être attribuées à certains groupes du
&lt;em&gt;bucket&lt;/em&gt; ainsi qu'à d'autres &lt;em&gt;principals&lt;/em&gt; directement.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="notre-proposition-d-api"&gt;
&lt;h2&gt;Notre proposition d'API&lt;/h2&gt;
&lt;div class="section" id="les-objets-manipules"&gt;
&lt;h3&gt;Les objets manipulés&lt;/h3&gt;
&lt;p&gt;Pour mettre en place la gestion des permissions, nous avons identifié les
objets suivants :&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="23%"/&gt;
&lt;col width="77%"/&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Objet&lt;/th&gt;
&lt;th class="head"&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;bucket&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;On peut les voir comme des espaces de noms. Ils
permettent d'avoir différentes collections portant
le même nom mais stockées dans différents &lt;em&gt;buckets&lt;/em&gt; de
manière à ce que les données soient distinctes.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;collection&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Une liste d'enregistrements.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;record&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Un enregistrement d'une collection.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;group&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Un groupe de commetants (« &lt;em&gt;principals&lt;/em&gt; »).&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Pour la définition des ACLs, il y a une hiérarchie et les objets « héritent » des
ACLs de leur parents :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;           +---------------+
           | Bucket        |
           +---------------+
    +-----&amp;gt;+ - id          +&amp;lt;---+
    |      | - permissions |    |
    |      +---------------+    |
    |                           |
    |                           |
    |                           |
    |                           |
    |                           |
+---+-----------+        +------+---------+
| Collection    |        | Group          |
+---------------+        +----------------+
| - id          |        |  - id          |
| - permissions |        |  - members     |
+------+--------+        |  - permissions |
       ^                 +----------------+
       |
       |
+------+---------+
| Record         |
+----------------+
|  - id          |
|  - data        |
|  - permissions |
+----------------+
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="les-permissions"&gt;
&lt;h3&gt;Les permissions&lt;/h3&gt;
&lt;p&gt;Pour chacun de ces objets nous avons identifié les permissions suivantes :&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="23%"/&gt;
&lt;col width="77%"/&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Permission&lt;/th&gt;
&lt;th class="head"&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;read&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;La permission de lire le contenu de
l'objet et de ses sous-objets.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;write&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;La permission de modifier et
d'administrer un objet et ses sous-
objets. La permission &lt;em&gt;write&lt;/em&gt; permet la
lecture, modification et suppression
d'un objet ainsi que la gestion de ses
permissions.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;strong&gt;create&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;La permission de créer le sous-objet
spécifié. Par exemple:
&lt;tt class="docutils literal"&gt;collections:create&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;À chaque permission spécifiée sur un objet est associée une liste de
&lt;em&gt;principals&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Dans le cas de la permission &lt;tt class="docutils literal"&gt;create&lt;/tt&gt; on est obligé de spécifier
l'objet enfant en question car un objet peut avoir plusieurs types
d'enfants. Par exemple : &lt;tt class="docutils literal"&gt;collections:create&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;groups:create&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Nous n'avons pour l'instant pas de permission pour &lt;cite&gt;delete&lt;/cite&gt; et &lt;cite&gt;update&lt;/cite&gt;,
puisque nous n'avons pas trouvé de cas d'utilisation qui les nécessitent.
Quiconque avec le droit d'écriture peut donc supprimer un enregistrement.&lt;/p&gt;
&lt;p&gt;Les permissions d'un objet sont héritées de son parent. Par exemple,
un enregistrement créé dans une collection accessible à tout le monde
en lecture sera lui aussi accessible à tout le monde.&lt;/p&gt;
&lt;p&gt;Par conséquent, les permissions sont cumulées. Autrement dit, il n'est pas
possible qu'un objet ait des permissions plus restrictives que son parent.&lt;/p&gt;
&lt;p&gt;Voici la liste exhaustive des permissions :&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="21%"/&gt;
&lt;col width="32%"/&gt;
&lt;col width="47%"/&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Objet&lt;/th&gt;
&lt;th class="head"&gt;Permissions associées&lt;/th&gt;
&lt;th class="head"&gt;Commentaire&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;Configuration
(.ini)&lt;/td&gt;
&lt;td&gt;&lt;cite&gt;buckets:create&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Les &lt;em&gt;principals&lt;/em&gt; ayant le droit
de créer un bucket sont définis
dans la configuration du serveur.
(&lt;em&gt;ex. utilisateurs authentifiés&lt;/em&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="4"&gt;&lt;tt class="docutils literal"&gt;bucket&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;cite&gt;write&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;C'est en quelque sorte le droit
d'administration du &lt;em&gt;bucket&lt;/em&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;read&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;C'est le droit de lire le contenu
de tous les objets du &lt;em&gt;bucket&lt;/em&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;collections:create&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission de créer des
collections dans le &lt;em&gt;bucket&lt;/em&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;groups:create&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission de créer des groupes
dans le &lt;em&gt;bucket&lt;/em&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="3"&gt;&lt;tt class="docutils literal"&gt;collection&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;cite&gt;write&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission d'administrer tous les
objets de la collection.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;read&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission de consulter tous les
objets de la collection.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;records:create&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission de créer des nouveaux
enregistrement dans la collection.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;record&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;cite&gt;write&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission de modifier ou de
partager l'enregistrement.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;read&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission de consulter
l'enregistrement.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;group&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;cite&gt;write&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission d'administrer le
groupe&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;cite&gt;read&lt;/cite&gt;&lt;/td&gt;
&lt;td&gt;Permission de consulter les
membres du groupe.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="les-principals"&gt;
&lt;h3&gt;Les « &lt;em&gt;principals&lt;/em&gt; »&lt;/h3&gt;
&lt;p&gt;Les acteurs se connectant au service de stockage peuvent s'authentifier.&lt;/p&gt;
&lt;p&gt;Ils reçoivent alors une liste de &lt;em&gt;principals&lt;/em&gt; :&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;: le &lt;em&gt;principal&lt;/em&gt; donné à tous les acteurs (authentifiés ou pas) ;&lt;/li&gt;
&lt;li&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;: le &lt;em&gt;principal&lt;/em&gt; donné à tous les acteurs authentifiés ;&lt;/li&gt;
&lt;li&gt;un &lt;em&gt;principal&lt;/em&gt; identifiant l'acteur, par exemple &lt;tt class="docutils literal"&gt;fxa:32aa95a474c984d41d395e2d0b614aa2&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Afin d'éviter les collisions d'identifiants, le &lt;em&gt;principal&lt;/em&gt; de l'acteur dépend
de son type d'authentification (&lt;tt class="docutils literal"&gt;system&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;basic&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;ipaddr&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;hawk&lt;/tt&gt;,
&lt;tt class="docutils literal"&gt;fxa&lt;/tt&gt;) et de son identifiant (unique par acteur).&lt;/p&gt;
&lt;p&gt;En fonction du &lt;em&gt;bucket&lt;/em&gt; sur lequel se passe l'action, les groupes dont
fait partie l'utilisateur sont également ajoutés à sa liste de
&lt;tt class="docutils literal"&gt;principals&lt;/tt&gt;. &lt;tt class="docutils literal"&gt;group:moderators&lt;/tt&gt; par exemple.&lt;/p&gt;
&lt;p&gt;Ainsi, si Bob se connecte avec &lt;em&gt;Firefox Accounts&lt;/em&gt; sur le &lt;em&gt;bucket&lt;/em&gt;
&lt;tt class="docutils literal"&gt;servicedenuages_blog&lt;/tt&gt; dans lequel il fait partie du groupe
&lt;tt class="docutils literal"&gt;moderators&lt;/tt&gt;, il aura la liste de &lt;em&gt;principals&lt;/em&gt; suivante :
&lt;tt class="docutils literal"&gt;Everyone, Authenticated, fxa:32aa95a474c984d41d395e2d0b614aa2, group:moderators&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Il est donc possible d'assigner une permission à Bob en utilisant l'un de
ces quatre &lt;em&gt;principals&lt;/em&gt;.&lt;/p&gt;
&lt;div class="admonition note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;Le &lt;em&gt;principal&lt;/em&gt; &lt;tt class="docutils literal"&gt;&amp;lt;userid&amp;gt;&lt;/tt&gt; dépend du &lt;em&gt;back-end&lt;/em&gt; d'authentification (e.g.
&lt;tt class="docutils literal"&gt;github:leplatrem&lt;/tt&gt;).&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="quelques-exemples"&gt;
&lt;h3&gt;Quelques exemples&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Blog&lt;/strong&gt;&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="35%"/&gt;
&lt;col width="18%"/&gt;
&lt;col width="46%"/&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Objet&lt;/th&gt;
&lt;th class="head"&gt;Permissions&lt;/th&gt;
&lt;th class="head"&gt;Principals&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;bucket:blog&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;blog&lt;/span&gt; owner id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;collection:articles&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;group:moderators&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;read&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;record:569e28r98889&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;co-author&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Wiki&lt;/strong&gt;&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="35%"/&gt;
&lt;col width="18%"/&gt;
&lt;col width="46%"/&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Object&lt;/th&gt;
&lt;th class="head"&gt;Permissions&lt;/th&gt;
&lt;th class="head"&gt;Principals&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;bucket:wiki&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;wiki&lt;/span&gt; administrator id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;collection:articles&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;read&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Sondages&lt;/strong&gt;&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="34%"/&gt;
&lt;col width="31%"/&gt;
&lt;col width="35%"/&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Objet&lt;/th&gt;
&lt;th class="head"&gt;Permissions&lt;/th&gt;
&lt;th class="head"&gt;Principals&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;bucket:poll&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;admin&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;collection:create&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;collection:&amp;lt;poll&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;poll&lt;/span&gt; author id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;record:create&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Cartes colaboratives&lt;/strong&gt;&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="34%"/&gt;
&lt;col width="31%"/&gt;
&lt;col width="35%"/&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Objet&lt;/th&gt;
&lt;th class="head"&gt;Permissions&lt;/th&gt;
&lt;th class="head"&gt;Principals&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;bucket:maps&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;admin&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;collection:create&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;collection:&amp;lt;map&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;map&lt;/span&gt; author id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;read&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;record:&amp;lt;record&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;maintainer&lt;/span&gt; id&amp;gt;&lt;/tt&gt;
(&lt;em&gt;ex. event staff member
maintaining venues&lt;/em&gt;)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;strong&gt;Plateformes&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Bien sûr, il y a plusieurs façons de modéliser les cas d'utilisation typiques.
Par exemple, on peut imaginer une plateforme de wikis (à la wikia.com), où les
wikis sont privés par défaut et certaines pages peuvent être rendues publiques :&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="32%"/&gt;
&lt;col width="30%"/&gt;
&lt;col width="38%"/&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;Objet&lt;/th&gt;
&lt;th class="head"&gt;Permissions&lt;/th&gt;
&lt;th class="head"&gt;Principals&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td rowspan="3"&gt;&lt;tt class="docutils literal"&gt;bucket:freewiki&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;administrator&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;collection:create&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;group:create&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Authenticated&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td rowspan="2"&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;collection:&amp;lt;wiki&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;write&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;fxa:&amp;lt;wiki&lt;/span&gt; owner id&amp;gt;&lt;/tt&gt;,
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;group:&amp;lt;editors&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;read&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;group:&amp;lt;readers&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;record:&amp;lt;page&lt;/span&gt; id&amp;gt;&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;read&lt;/tt&gt;&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;Everyone&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;div class="section" id="l-api-http"&gt;
&lt;h3&gt;L'API HTTP&lt;/h3&gt;
&lt;p&gt;Lors de la création d'un objet, l'utilisateur se voit
attribué la permission &lt;tt class="docutils literal"&gt;write&lt;/tt&gt; sur l'objet :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nf"&gt;PUT&lt;/span&gt; &lt;span class="nn"&gt;/v1/buckets/servicedenuages_blog&lt;/span&gt; &lt;span class="kr"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;1.1&lt;/span&gt;
&lt;span class="na"&gt;Authorization&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Bearer 0b9c2625dc21ef05f6ad4ddf47c5f203837aa32ca42fced54c2625dc21efac32&lt;/span&gt;
&lt;span class="na"&gt;Accept&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;application/json&lt;/span&gt;

HTTP/1.1 201 Created
Content-Type: application/json; charset=utf-8

{
    "id": "servicedenuages_blog",
    "permissions": {
        "write": ["fxa:49d02d55ad10973b7b9d0dc9eba7fdf0"]
    }
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Il est possible d'ajouter des permissions à l'aide de &lt;tt class="docutils literal"&gt;PATCH&lt;/tt&gt; :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nf"&gt;PATCH&lt;/span&gt; &lt;span class="nn"&gt;/v1/buckets/servicedenuages_blog/collections/articles&lt;/span&gt; &lt;span class="kr"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;1.1&lt;/span&gt;
&lt;span class="na"&gt;Authorization&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;Bearer 0b9c2625dc21ef05f6ad4ddf47c5f203837aa32ca42fced54c2625dc21efac32&lt;/span&gt;
&lt;span class="na"&gt;Accept&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="l"&gt;application/json&lt;/span&gt;

{
    "permissions": {
        "read": ["+system.Everyone"]
    }
}

HTTP/1.1 201 Created
Content-Type: application/json; charset=utf-8

{
    "id": "servicedenuages_blog",
    "permissions": {
        "write": ["fxa:49d02d55ad10973b7b9d0dc9eba7fdf0"],
        "read": ["system.Everyone"]
    }
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Pour le &lt;tt class="docutils literal"&gt;PATCH&lt;/tt&gt; nous utilisons la syntaxe préfixée par un &lt;tt class="docutils literal"&gt;+&lt;/tt&gt; ou
par un &lt;tt class="docutils literal"&gt;-&lt;/tt&gt; pour ajouter ou enlever des &lt;em&gt;principals&lt;/em&gt; sur un ACL.&lt;/p&gt;
&lt;p&gt;Il est également possible de faire un &lt;tt class="docutils literal"&gt;PUT&lt;/tt&gt; pour réinitialiser les ACLs,
sachant que le &lt;tt class="docutils literal"&gt;PUT&lt;/tt&gt; va ajouter l'utilisateur courant à la
liste automatiquement mais qu'il pourra se retirer avec un &lt;tt class="docutils literal"&gt;PATCH&lt;/tt&gt;.
Ajouter l'utilisateur courant permet d'éviter les situations où plus
personne n'a accès aux données.&lt;/p&gt;
&lt;div class="admonition note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;La permission &lt;tt class="docutils literal"&gt;create&lt;/tt&gt; est valable pour &lt;tt class="docutils literal"&gt;POST&lt;/tt&gt; mais aussi pour &lt;tt class="docutils literal"&gt;PUT&lt;/tt&gt;
lorsque l'enregistrement n'existe pas.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="le-cas-specifique-des-donnees-utilisateurs"&gt;
&lt;h3&gt;Le cas spécifique des données utilisateurs&lt;/h3&gt;
&lt;p&gt;Une des fonctionnalités actuelles de &lt;em&gt;Kinto&lt;/em&gt; est de pouvoir gérer des
collections d'enregistrements par utilisateur.&lt;/p&gt;
&lt;p&gt;Sous &lt;em&gt;*nix&lt;/em&gt; il est possible, pour une
application, de sauvegarder la configuration de l'utilisateur courant
dans son dossier personnel sans se soucier de l'emplacement sur
le disque en utilisant &lt;tt class="docutils literal"&gt;~/&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Dans notre cas si une application souhaite sauvegarder les contacts d'un
utilisateur, elle peut utiliser le raccourci &lt;tt class="docutils literal"&gt;~&lt;/tt&gt; pour faire référence au
&lt;em&gt;bucket&lt;/em&gt; &lt;strong&gt;personnel&lt;/strong&gt; de l'utilisateur : &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;/buckets/~/collections/contacts&lt;/span&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Cette URL retournera le code &lt;tt class="docutils literal"&gt;HTTP 307&lt;/tt&gt; vers le &lt;em&gt;bucket&lt;/em&gt; de l'utilisateur courant :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nf"&gt;POST&lt;/span&gt; &lt;span class="nn"&gt;/v1/buckets/~/collections/contacts/records&lt;/span&gt; &lt;span class="kr"&gt;HTTP&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="m"&gt;1.1&lt;/span&gt;

{
   "name": "Rémy",
   "emails": ["remy@example.com"],
   "phones": ["+330820800800"]
}

HTTP/1.1 307 Temporary Redirect
Location: /v1/buckets/fxa:49d02d55ad10973b7b9d0dc9eba7fdf0/collections/contacts/records
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ainsi il est tout à fait possible à Alice de partager ses contacts
avec Bob. Il lui suffit pour cela de donner la permission &lt;tt class="docutils literal"&gt;read&lt;/tt&gt; à
Bob sur sa collection et de donner l'URL complète
&lt;tt class="docutils literal"&gt;/v1/buckets/fxa:49d02d55ad10973b7b9d0dc9eba7fdf0/collections/contacts/records&lt;/tt&gt;
à Bob.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="la-delegation-des-permissions"&gt;
&lt;h3&gt;La délégation des permissions&lt;/h3&gt;
&lt;p&gt;Dans le cas de &lt;em&gt;Kinto&lt;/em&gt;, nous avons défini un format pour restreindre les
permissions via les scopes OAuth2:
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;storage:&amp;lt;bucket_id&amp;gt;:&amp;lt;collection_id&amp;gt;:&amp;lt;permissions_list&amp;gt;&lt;/span&gt;&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;Ainsi, si on reprend l'exemple précédent de la liste de tâches, il est possible pour
Bob de créer un token OAuth spécifique avec les &lt;em&gt;scopes&lt;/em&gt; suivants :
&lt;tt class="docutils literal"&gt;profile storage:todolist:tasks:write &lt;span class="pre"&gt;storage:~:contacts:read+records:create&lt;/span&gt;&lt;/tt&gt;&lt;/p&gt;
&lt;p&gt;Donc, bien que Bob a la permission &lt;tt class="docutils literal"&gt;write&lt;/tt&gt; sur ses contacts,
l'application utilisant ce token pourra uniquement lire les contacts
existants et en ajouter de nouveaux.&lt;/p&gt;
&lt;p&gt;Une partie de la complexité est donc de réussir à présenter ces &lt;em&gt;scopes&lt;/em&gt; de
manière lisible à l'utilisateur, afin qu'il choisisse quelles permissions
donner aux applications qui agissent en son nom.&lt;/p&gt;
&lt;p&gt;Voilà où nous en sommes de notre réflexion !&lt;/p&gt;
&lt;p&gt;Si vous avez des choses à ajouter, des points de désaccord ou autres
réflexions, n'hésitez pas à nous interrompre pendant qu'il est encore temps !&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
</content></entry><entry><title>Ecosystem &amp; generic storage</title><link href="http://www.servicedenuages.fr/en/generic-storage-ecosystem" rel="alternate"></link><published>2015-04-30T00:00:00+02:00</published><updated>2015-04-30T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-04-30:/en/generic-storage-ecosystem</id><summary type="html">&lt;p class="first last"&gt;Should we build yet another generic storage system? Panorama of some
existing solutions and our use cases.&lt;/p&gt;
</summary><content type="html">&lt;div class="admonition note"&gt;
&lt;p class="first admonition-title"&gt;Note&lt;/p&gt;
&lt;p class="last"&gt;This article was translated from French by Julien/Sphinx. We thank him a lot
for this effort! Note, that at the beginning of this year,
&lt;a class="reference external" href="https://medium.com/@Sphinx/mdn-pr%C3%A9sentation-de-la-documentation-javascript-70541cecae54"&gt;he also translated MDN to French&lt;/a&gt;!
&lt;strong&gt;Big up !&lt;/strong&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;tl;dr We have to build a service to track payments, and we're hesitant
to go on with our own solution for storage and synchronization.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;As we wrote in &lt;a class="reference external" href="http://www.servicedenuages.fr/en/../service-de-nuages"&gt;the previous article (FR)&lt;/a&gt;,
we want to build a solution for generic data storage. We're rebooting &lt;a class="reference external" href="http://daybed.readthedocs.io"&gt;Daybed&lt;/a&gt;
at Mozilla!&lt;/p&gt;
&lt;p&gt;Our goal is simple: allow developers, whether they are from Mozilla or from the whole world,
to easily synchronize and save data associated to a user.&lt;/p&gt;
&lt;p id="storage-specs"&gt;Here are the aspects of the architecture that seem essential to us:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;The solution must rely on a protocol, not on a particular implementation;&lt;/li&gt;
&lt;li&gt;Self-hosting of the whole solution must be dead simple;&lt;/li&gt;
&lt;li&gt;Authentication must be pluggable or decentralized (OAuth2, FxA, Persona);&lt;/li&gt;
&lt;li&gt;The server should be able to validate records;&lt;/li&gt;
&lt;li&gt;An authorization/permissions system must allow collection protection or
fine-grained record sharing;&lt;/li&gt;
&lt;li&gt;Conflict resolution could happen server-side;&lt;/li&gt;
&lt;li&gt;Clients should be "&lt;em&gt;offline-first&lt;/em&gt;";&lt;/li&gt;
&lt;li&gt;Clients should be able to easily merge/reconcile data;&lt;/li&gt;
&lt;li&gt;Clients should be usable in the browser &lt;em&gt;and&lt;/em&gt; server-side;&lt;/li&gt;
&lt;li&gt;Every component should be simple and easily substitutable.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The first question we were asked was: "&lt;em&gt;Why aren't you just using PouchDB or Remote Storage?&lt;/em&gt;"&lt;/p&gt;
&lt;div class="section" id="remote-storage"&gt;
&lt;h2&gt;Remote Storage&lt;/h2&gt;
&lt;p&gt;Remote Storage is an open standard for user storage. &lt;a class="reference external" href="http://tools.ietf.org/html/draft-dejong-remotestorage-04"&gt;The specification&lt;/a&gt;
is based on existing and proven standards: Webfinger, OAuth2, CORS and REST.&lt;/p&gt;
&lt;p&gt;The API is pretty simple and &lt;a class="reference external" href="http://blog.cozycloud.cc/news/2014/08/12/when-unhosted-meets-cozy-cloud/"&gt;prestigious projects are using it&lt;/a&gt;.
There exist several &lt;a class="reference external" href="https://github.com/jcoglan/restore"&gt;server implementations&lt;/a&gt;
and there is even a &lt;a class="reference external" href="https://www.npmjs.com/package/remotestorage-server"&gt;Node skeleton&lt;/a&gt;
to build a custom server.&lt;/p&gt;
&lt;img alt="Remote Storage widget" class="align-left" src="http://www.servicedenuages.fr/en/../images/remotestorage-widget.png" style="width: 243px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;The &lt;a class="reference external" href="https://github.com/remotestorage/remotestorage.js/"&gt;remoteStorage.js client&lt;/a&gt;
allows us to integrate this solution into Web apps. This client is in charge of the "local store",
caching, syncing and providing users a widget so that they can choose the server
which will receive the data (using Webfinger).&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://github.com/michielbdejong/ludbud"&gt;ludbud&lt;/a&gt;, a refined version of
&lt;em&gt;remoteStorage.js&lt;/em&gt; limits itself to the abstraction of the remote data storage.
At the end, it would be possible to have a single library and to store data
in either a &lt;em&gt;Remote Storage&lt;/em&gt; server, an &lt;em&gt;ownCloud&lt;/em&gt; server, or even on the bad guys'
like &lt;em&gt;Google Drive&lt;/em&gt; or &lt;em&gt;Dropbox&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;At first glance, the specification seemed to fit with what we want to do:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;The approach taken by the protocol is sound;&lt;/li&gt;
&lt;li&gt;The ecosystem is well thought out;&lt;/li&gt;
&lt;li&gt;The political vision fits: give back the control of the data to the users
(see &lt;a class="reference external" href="http://unhosted.org/"&gt;unhosted&lt;/a&gt;);&lt;/li&gt;
&lt;li&gt;Technical choices are compatible with what we've already started (CORS, REST, OAuth2);&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;However, regarding data manipulation, there are several differences with what we want to do:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;The API seems oriented around "files" (folders and documents) and not "data" (collections and records);&lt;/li&gt;
&lt;li&gt;There is no record validation following some schema (though &lt;a class="reference external" href="https://remotestorage.io/doc/code/files/baseclient/types-js.html"&gt;some implementations&lt;/a&gt; of the protocol are actually doing this);&lt;/li&gt;
&lt;li&gt;There is no option to sort/filter records with regards to their attributes;&lt;/li&gt;
&lt;li&gt;The permission system &lt;a class="reference external" href="https://groups.google.com/forum/#!topic/unhosted/5_NOGq8BPTo"&gt;is limited to private/public&lt;/a&gt; (and
&lt;a class="reference external" href="https://github.com/remotestorage/spec/issues/58#issue-27249452"&gt;the author is going for a git-like model&lt;/a&gt;) &lt;a class="footnote-reference" href="#id3" id="id1"&gt;[1]&lt;/a&gt;;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To summarize, it would seem that what we want to achieve with the storage of
records is complementary to &lt;em&gt;Remote Storage&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;If there are some needs about "file oriented" persistence, it would be dull to
reinvent this solution. So there is a great chance that we will integrate
&lt;em&gt;Remote Storage&lt;/em&gt; some day and that it will become a facet of our solution.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="pouchdb"&gt;
&lt;h2&gt;PouchDB&lt;/h2&gt;
&lt;p&gt;&lt;a class="reference external" href="http://pouchdb.com/"&gt;PouchDB&lt;/a&gt; is a Javascript library allowing to manipulate
records locally and synchronize them to a distant database.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;PouchDB&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'dbname'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="nx"&gt;db&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;put&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
 &lt;span class="nx"&gt;_id&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'dave@gmail.com'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'David'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="nx"&gt;age&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;68&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;

&lt;span class="nx"&gt;db&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;replicate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;to&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'http://example.com/mydb'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The project is seeing some traction and benefits from a lot of contributors. The
ecosystem is rich and adoption by projects &lt;a class="reference external" href="https://github.com/hoodiehq/wip-hoodie-store-on-pouchdb"&gt;such as Hoodie&lt;/a&gt; confirms the tool's
relevance for frontend developers.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;PouchDB&lt;/em&gt; handles a local "store" whose persistence
&lt;a class="reference external" href="http://pouchdb.com/2014/07/25/pouchdb-levels-up.html"&gt;is built on top&lt;/a&gt;
of the &lt;a class="reference external" href="https://github.com/level/levelup#relationship-to-leveldown"&gt;LevelDown API&lt;/a&gt;
to persist data in &lt;a class="reference external" href="https://github.com/Level/levelup/wiki/Modules#storage-back-ends"&gt;any backend&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Even if &lt;em&gt;PouchDB&lt;/em&gt; is mainly done for "&lt;em&gt;offline-first&lt;/em&gt;" applications, it
can be used inside browsers and on the server side, via Node.&lt;/p&gt;
&lt;div class="section" id="synchronization"&gt;
&lt;h3&gt;Synchronization&lt;/h3&gt;
&lt;p&gt;Local data synchronization (or replication) is done on a remote
&lt;a class="reference external" href="http://couchdb.apache.org/"&gt;CouchDB&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The &lt;a class="reference external" href="https://github.com/pouchdb/pouchdb-server"&gt;PouchDB Server&lt;/a&gt; project
implements the CouchDB API in NodeJS. Because &lt;em&gt;PouchDB&lt;/em&gt; itself is used, we
obtain a service which is behaving like a &lt;em&gt;CouchDB&lt;/em&gt;, but stores data
anywhere (in a &lt;em&gt;Redis&lt;/em&gt; or a &lt;em&gt;PostgreSQL&lt;/em&gt; database for instance).&lt;/p&gt;
&lt;p&gt;The synchronisation is complete. In other words, all records that are on
the server will end up being synchronised with the client. It is possible to filter
synchronized collections but &lt;a class="reference external" href="http://pouchdb.com/2015/04/05/filtered-replication.html"&gt;its purpose is not to secure data access&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;In order to do so, it is recommended to create &lt;a class="reference external" href="https://github.com/nolanlawson/pouchdb-authentication#some-people-can-read-some-docs-some-people-can-write-those-same-docs"&gt;a database per user&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This isn't necessarily a problem since CouchDB &lt;a class="reference external" href="https://mail-archives.apache.org/mod_mbox/couchdb-user/201401.mbox/%3C52CEB873.7080404@ironicdesign.com%3E"&gt;can handle hundreds of thousands
of databases without any problem&lt;/a&gt;.
However, depending on use cases, clustering and isolation (by role, application,
collection, ...) might not be dealt with easily.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="the-payments-use-case"&gt;
&lt;h2&gt;The "Payments" use case&lt;/h2&gt;
&lt;img alt="Put Payments Here  -- Before the Internet - CC-NC-SA Katy Silberger https://www.flickr.com/photos/katysilbs/11163812186" src="http://www.servicedenuages.fr/en/../images/put-payments.jpg" style="width: 640px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;During the next weeks, we will have to setup a prototype that keeps an history
of a user's payments and subscriptions.&lt;/p&gt;
&lt;p&gt;The requirements are simple:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;The "Payment" application tracks payments and subscriptions of a user
for a given application;&lt;/li&gt;
&lt;li&gt;The "Data" application consults the service to check if a user paid or
has subscribed;&lt;/li&gt;
&lt;li&gt;The user consults the service to get a list of all payments/subscriptions
related to her.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Only the "Payment" application should have the right to create/modify/delete
records. The two others can only have read-only access to these records.&lt;/p&gt;
&lt;p&gt;A given application cannot access to some other application payments and a given user cannot access to some other user's payments.&lt;/p&gt;
&lt;div class="section" id="with-remotestorage"&gt;
&lt;h3&gt;With RemoteStorage&lt;/h3&gt;
&lt;img alt="Remote Love - CC-BY-NC Julie https://www.flickr.com/photos/mamajulie2008/2609549461" class="align-center" src="http://www.servicedenuages.fr/en/../images/remote-love.jpg" style="width: 640px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;The idea of &lt;em&gt;Remote Storage&lt;/em&gt; is to separate the application from the data that
the user created with the application.&lt;/p&gt;
&lt;p&gt;In our use case, the "Payment" app is dealing with the data concerning a user.
However, this data does not directly belong to the user. A user should be able
to delete some records but he/she cannot create or edit some existing payments!&lt;/p&gt;
&lt;p&gt;The concept of permissions, limited to private/public is not suitable here.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="with-pouchdb"&gt;
&lt;h3&gt;With PouchDB&lt;/h3&gt;
&lt;p&gt;It will be necessary to create a &lt;em&gt;database&lt;/em&gt; per user in order to separate the
records in a secure way. Only the "Payment" app will be granted full rights
on the different databases.&lt;/p&gt;
&lt;p&gt;But this won't be enough.&lt;/p&gt;
&lt;p&gt;An app must not see payments from another application so it would also be
necessary to create a database per application.&lt;/p&gt;
&lt;p&gt;When a user will need to access payments, it will be mandatory to join every
&lt;em&gt;database&lt;/em&gt; of every application for this current user. When the marketing
department will want to build stats for all apps, one will have to join hundreds
of thousands of databases.&lt;/p&gt;
&lt;p&gt;This doesn't seem appropriate: most of the time, there are only few
payments/subscriptions for a given user. Should we have hundreds of thousands of
databases, each of which will have less than 5 records?&lt;/p&gt;
&lt;p&gt;Moreover, the server side of "Payment" is implemented with Python. Using a
JavaScript wrapper (as &lt;a class="reference external" href="https://pythonhosted.org/Python-PouchDB/"&gt;python-pouchdb&lt;/a&gt;) would not thrill us.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="a-new-ecosystem"&gt;
&lt;h2&gt;A new ecosystem?&lt;/h2&gt;
&lt;img alt="Wagon wheel - CC-BY-NC-SA arbyreed https://www.flickr.com/photos/19779889@N00/16161808220" src="http://www.servicedenuages.fr/en/../images/wagon-wheel.jpg" style="width: 640px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;It is obvious that &lt;em&gt;PouchDB&lt;/em&gt; and &lt;em&gt;Remote Storage&lt;/em&gt; are rich projects with dynamic communities. Therefore, it's reasonable to wonder if one should develop another solution.&lt;/p&gt;
&lt;p&gt;When we created the &lt;em&gt;Reading List&lt;/em&gt; server, we built it with
&lt;a class="reference external" href="http://cliquet.readthedocs.io/"&gt;Cliquet&lt;/a&gt;. We had a chance to setup &lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/api/"&gt;a very simple protocol&lt;/a&gt;, strongly inspired by
&lt;a class="reference external" href="http://en.wikipedia.org/wiki/Firefox_Sync"&gt;Firefox Sync&lt;/a&gt;, to sync records.&lt;/p&gt;
&lt;p&gt;The reason clients for &lt;em&gt;Reading List&lt;/em&gt; were implemented in few weeks, whether in
JavaScript, Java (Android) or ASM (Firefox addon), is that the "&lt;em&gt;offline first&lt;/em&gt;"
principle of the service is trivial.&lt;/p&gt;
&lt;div class="section" id="tradeoffs"&gt;
&lt;h3&gt;Tradeoffs&lt;/h3&gt;
&lt;p&gt;Of course, we don't intend to compete with &lt;em&gt;CouchDB&lt;/em&gt; and are making some
concessions:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;By default, record collections are isolated by user;&lt;/li&gt;
&lt;li&gt;There is no history of revisions;&lt;/li&gt;
&lt;li&gt;There is no diff between each revision;&lt;/li&gt;
&lt;li&gt;By default, there is no automatic conflict resolution;&lt;/li&gt;
&lt;li&gt;There is no stream synchronization.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If we are not mistaken, these tradeoffs exclude the possibility of
implementing &lt;a class="reference external" href="https://github.com/pouchdb/pouchdb/blob/master/lib/adapters/http/http.js#L721-L946"&gt;a PouchDB adapter&lt;/a&gt; for the HTTP-based synchronisation protocol of &lt;em&gt;Cliquet&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Too bad since it would have been a great opportunity to capitalize on the user
experience of &lt;em&gt;PouchDB&lt;/em&gt; regarding the synchronisation client.&lt;/p&gt;
&lt;p&gt;However, we have some interesting features:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;No map-reduce;&lt;/li&gt;
&lt;li&gt;Partial and/or ordered and/or paginated synchronisation;&lt;/li&gt;
&lt;li&gt;The client can choose, with headers, to delete the data or to accept the
server version;&lt;/li&gt;
&lt;li&gt;A single server is deployed for N apps;&lt;/li&gt;
&lt;li&gt;Self hosting is dead simple;&lt;/li&gt;
&lt;li&gt;The client can choose not to use local storage at all;&lt;/li&gt;
&lt;li&gt;The JavaScript client will have its local store management delegated (we're
thinking about &lt;a class="reference external" href="https://github.com/mozilla/localForage"&gt;LocalForage&lt;/a&gt; or
&lt;a class="reference external" href="https://github.com/dfahlander/Dexie.js"&gt;Dexie.js&lt;/a&gt;);&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;And we are complying with &lt;a class="reference external" href="#storage-specs"&gt;the specs we drew at the beginning of the article&lt;/a&gt;!&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="philosophical-arguments"&gt;
&lt;h3&gt;Philosophical arguments&lt;/h3&gt;
&lt;p&gt;It's &lt;a class="reference external" href="http://en.wikipedia.org/wiki/Law_of_the_instrument"&gt;unrealistic to think that we can achieve everything with a single tool&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We have other use cases that seem to fit with &lt;em&gt;PouchDB&lt;/em&gt; (&lt;em&gt;no concept of
permission or sharing, JavaScript environment, ...&lt;/em&gt;). We'll take advantage of it
when relevant!&lt;/p&gt;
&lt;p&gt;The ecosystem we want to build should address the use cases that are badly
handled by &lt;em&gt;PouchDB&lt;/em&gt;. It should be:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Based on our very simple protocol;&lt;/li&gt;
&lt;li&gt;Minimalist and with multiple purposes (&lt;em&gt;like our very French 2CV&lt;/em&gt;);&lt;/li&gt;
&lt;li&gt;Naive (&lt;em&gt;no rocket-science&lt;/em&gt;);&lt;/li&gt;
&lt;li&gt;Without magic (&lt;em&gt;explicit and easy to reimplement from scratch&lt;/em&gt;);&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/rationale.html"&gt;The philosophy and the features of our Python toolkit, Cliquet&lt;/a&gt;, will of course be honoured :)&lt;/p&gt;
&lt;p&gt;As for &lt;em&gt;Remote Storage&lt;/em&gt;, whenever we face the need, we will proud to join
this initiative. However, as for now, it seems risky to start by bending the
solution to our own needs.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="practical-arguments"&gt;
&lt;h3&gt;Practical arguments&lt;/h3&gt;
&lt;p&gt;Before being willingly to deploy a &lt;em&gt;CouchDB&lt;/em&gt; solution, Mozilla &lt;em&gt;ops&lt;/em&gt; will ask us
to precisely prove that it's not doable with stacks we already have running internally (e.g.
MySQL, Redis, PostgreSQL).&lt;/p&gt;
&lt;p&gt;We will also have to guarantee a minimum 5 years lifetime regarding the data. With
&lt;em&gt;Cliquet&lt;/em&gt;, using the PostgreSQL backend, our data is persisted in &lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/blob/40aa33/cliquet/storage/postgresql/schema.sql#L14-L28"&gt;a flat PostgreSQL schema&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This wouldn't be the case with a LevelDown adapter that handles revisions split
in a key-value scheme.&lt;/p&gt;
&lt;p&gt;If we base our service on Cliquet, like we did with &lt;a class="reference external" href="http://kinto.readthedocs.io"&gt;Kinto&lt;/a&gt;, all the automation work of deploying
(&lt;em&gt;monitoring, RPM builds, Puppet...&lt;/em&gt;) that was done for &lt;em&gt;Reading List&lt;/em&gt; will be
completely reusable.&lt;/p&gt;
&lt;p&gt;As said before, if we go with another totally new stack, we will have to start
again from scratch, including productionalizing, profiling, optimizing, all of which has
already been done during the first quarter of this year for Reading List.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="next-steps"&gt;
&lt;h2&gt;Next steps&lt;/h2&gt;
&lt;p&gt;It's still time to change our strategy :) And we welcome any feedback!
It's always a difficult decision to make... &lt;tt class="docutils literal"&gt;&amp;lt;/troll call&amp;gt;&lt;/tt&gt;&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Twist an existing ecosystem vs build a new custom one;&lt;/li&gt;
&lt;li&gt;Master the whole system or to integrate our solution;&lt;/li&gt;
&lt;li&gt;Contribute vs redo;&lt;/li&gt;
&lt;li&gt;Guide vs follow.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We really seek to join the &lt;a class="reference external" href="https://nobackend.org/"&gt;no-backend&lt;/a&gt; initiative.
This first step might lead us to converge in the end! Maybe our service will end
up being compatible with Remote Storage, maybe PouchDB will become more agnostic
regarding the synchronisation protocol...&lt;/p&gt;
&lt;img alt="XKCD — Standards https://xkcd.com/927/" src="http://www.servicedenuages.fr/en/../images/standards.png" style="width: 500px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Using this new ecosystem for the "Payments" project will allow us to setup a
suitable permission system (&lt;em&gt;probably built on OAuth scopes&lt;/em&gt;). We are also
looking forward to &lt;a class="reference external" href="http://blog.daybed.io/daybed-revival.html"&gt;capitalizing on our Daybed experience for this project&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;We'll also extract some parts of the clients source code that were implemented
for &lt;em&gt;Reading List&lt;/em&gt; in order to provide a minimalist JavaScript client.&lt;/p&gt;
&lt;p&gt;By going this way, we are taking several risks:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;reinventing a wheel we don't know;&lt;/li&gt;
&lt;li&gt;failing to make the &lt;em&gt;Cliquet&lt;/em&gt; ecosystem a community project;&lt;/li&gt;
&lt;li&gt;failing to place &lt;em&gt;Cliquet&lt;/em&gt; in the niche for the use cases that are not
covered with &lt;em&gt;PouchDB&lt;/em&gt; :)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;As &lt;a class="reference external" href="http://pouchdb.com/2015/04/05/filtered-replication.html"&gt;Giovanni Ornaghi said&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
Rolling out your set of webservices, push notifications, or background services
might give you more control, but at the same time it will force you to engineer,
write, test, and maintain a whole new ecosystem.&lt;/blockquote&gt;
&lt;p&gt;And this ecosystem is precisely the one that &lt;em&gt;Mozilla Cloud Services&lt;/em&gt; team
is in charge of!&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id3" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;The &lt;a class="reference external" href="https://sharesome.5apps.com/"&gt;Sharesome project&lt;/a&gt; allows for some
public sharing of one's resources from one's &lt;em&gt;Remote Storage&lt;/em&gt;.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>Eco-système et stockage générique</title><link href="http://www.servicedenuages.fr/en/../stockage-generique-ecosysteme" rel="alternate"></link><published>2015-04-30T00:00:00+02:00</published><updated>2015-04-30T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-04-30:/en/../stockage-generique-ecosysteme</id><summary type="html">&lt;p class="first last"&gt;Devons nous construire un nouveau système de stockage générique ?
Petit tour de quelques solutions existantes et de nos cas
d'utilisation.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;&lt;strong&gt;tl;dr Nous devons construire un service de suivi de paiements, et nous
hésitons à continuer à nous entêter avec notre propre solution de
stockage/synchronisation.&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Comme nous l'écrivions &lt;a class="reference external" href="http://www.servicedenuages.fr/en/../service-de-nuages"&gt;dans l'article précédent&lt;/a&gt;, nous souhaitons construire une
solution de stockage générique. On refait &lt;a class="reference external" href="http://daybed.readthedocs.io"&gt;Daybed&lt;/a&gt;
chez Mozilla !&lt;/p&gt;
&lt;p&gt;Notre objectif est simple: permettre aux développeurs d'application, internes
à Mozilla ou du monde entier, de faire persister et synchroniser facilement des
données associées à un utilisateur.&lt;/p&gt;
&lt;p id="storage-specs"&gt;Les aspects de l'architecture qui nous semblent incontournables:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;La solution doit reposer sur un protocole, et non sur une implémentation ;&lt;/li&gt;
&lt;li&gt;L'auto-hébergement de l'ensemble doit être simplissime ;&lt;/li&gt;
&lt;li&gt;L'authentification doit être &lt;em&gt;pluggable&lt;/em&gt;, voire décentralisée (OAuth2, FxA,
Persona) ;&lt;/li&gt;
&lt;li&gt;Les enregistrements doivent pouvoir être validés par le serveur ;&lt;/li&gt;
&lt;li&gt;Les données doivent pouvoir être stockées dans n'importe quel backend ;&lt;/li&gt;
&lt;li&gt;Un système de permissions doit permettre de protéger des collections, ou de
partager des enregistrements de manière fine ;&lt;/li&gt;
&lt;li&gt;La résolution de conflits doit pouvoir avoir lieu sur le serveur ;&lt;/li&gt;
&lt;li&gt;Le client doit être pensé «&lt;em&gt;offline-first&lt;/em&gt;» ;&lt;/li&gt;
&lt;li&gt;Le client doit pouvoir réconcilier les données simplement ;&lt;/li&gt;
&lt;li&gt;Le client doit pouvoir être utilisé aussi bien dans le navigateur que côté
serveur ;&lt;/li&gt;
&lt;li&gt;Tous les composants se doivent d´être simples et substituables facilement.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;La première question qui nous a été posée fût «&lt;em&gt;Pourquoi vous n'utilisez pas
PouchDB ou Remote Storage ?&lt;/em&gt;»&lt;/p&gt;
&lt;div class="section" id="remote-storage"&gt;
&lt;h2&gt;Remote Storage&lt;/h2&gt;
&lt;p&gt;Remote Storage est un standard ouvert pour du stockage par utilisateur.  &lt;a class="reference external" href="http://tools.ietf.org/html/draft-dejong-remotestorage-04"&gt;La
specification&lt;/a&gt; se
base sur des standards déjà existants et éprouvés:  Webfinger, OAuth 2, CORS et
REST.&lt;/p&gt;
&lt;p&gt;L'API est simple, des &lt;a class="reference external" href="http://blog.cozycloud.cc/news/2014/08/12/when-unhosted-meets-cozy-cloud/"&gt;projets prestigieux l'utilisent&lt;/a&gt;.
Il y a plusieurs &lt;a class="reference external" href="https://github.com/jcoglan/restore"&gt;implémentations&lt;/a&gt; du
serveur, et il existe &lt;a class="reference external" href="https://www.npmjs.com/package/remotestorage-server"&gt;un squelette Node&lt;/a&gt; pour construire un
serveur sur mesure.&lt;/p&gt;
&lt;img alt="Remote Storage widget" class="align-left" src="http://www.servicedenuages.fr/en/../images/remotestorage-widget.png" style="width: 243px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Le client &lt;a class="reference external" href="https://github.com/remotestorage/remotestorage.js/"&gt;remoteStorage.js&lt;/a&gt; permet d'intégrer la
solution dans les applications Web.  Il se charge du «store local», du cache,
de la synchronization, et fournit un widget qui permet aux utilisateurs des
applications de choisir le serveur qui recevra les données (via Webfinger).&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://github.com/michielbdejong/ludbud"&gt;ludbud&lt;/a&gt;, la version épurée de
&lt;em&gt;remoteStorage.js&lt;/em&gt;, se limite à l'abstraction du stockage distant.  Cela
permettrait à terme, d'avoir une seule bibliothèque pour stocker dans un
serveur &lt;em&gt;remoteStorage&lt;/em&gt;, &lt;em&gt;ownCloud&lt;/em&gt; ou chez les méchants comme &lt;em&gt;Google Drive&lt;/em&gt;
ou &lt;em&gt;Dropbox&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Au premier abord, la spécification correspond à ce que nous voulons accomplir:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;La philosophie du protocole est saine;&lt;/li&gt;
&lt;li&gt;L'éco-système est bien fichu;&lt;/li&gt;
&lt;li&gt;La vision politique colle: redonner le contrôle des données aux utilisateurs
(voir &lt;a class="reference external" href="http://unhosted.org/"&gt;unhosted&lt;/a&gt;);&lt;/li&gt;
&lt;li&gt;Les choix techniques compatibles avec ce qu'on a commencé (CORS, REST, OAuth 2);&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;En revanche, vis à vis de la manipulation des données, il y a plusieurs
différences avec ce que nous souhaitons faire:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;L'API suit globalement une métaphore «fichiers» (dossier/documents), plutôt
que «données» (collection/enregistrements) ;&lt;/li&gt;
&lt;li&gt;Il n'y a pas de validation des enregistrements selon un schéma (même si
&lt;a class="reference external" href="https://remotestorage.io/doc/code/files/baseclient/types-js.html"&gt;certaines implémentations&lt;/a&gt; du
protocole le font) ;&lt;/li&gt;
&lt;li&gt;Il n'y a pas la possibilité de trier/filtrer les enregistrements selon des attributs ;&lt;/li&gt;
&lt;li&gt;Les permissions &lt;a class="reference external" href="https://groups.google.com/forum/#!topic/unhosted/5_NOGq8BPTo"&gt;se limitent à privé/public&lt;/a&gt; (et
&lt;a class="reference external" href="https://github.com/remotestorage/spec/issues/58#issue-27249452"&gt;l'auteur envisage plutôt un modèle à la Git&lt;/a&gt;) &lt;a class="footnote-reference" href="#id3" id="id1"&gt;[1]&lt;/a&gt; ;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;En résumé, il semblerait que ce que nous souhaitons faire avec le stockage
d'enregistrements validés est complémentaire avec &lt;em&gt;Remote Storage&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Si des besoins de persistence orientés «fichiers» se présentent, a priori nous aurions tort
de réinventer les solutions apportées par cette spécification. Il y a donc de grandes
chances que nous l´intégrions à terme, et que &lt;em&gt;Remote Storage&lt;/em&gt; devienne une facette
de notre solution.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="pouchdb"&gt;
&lt;h2&gt;PouchDB&lt;/h2&gt;
&lt;p&gt;&lt;a class="reference external" href="http://pouchdb.com/"&gt;PouchDB&lt;/a&gt; est une bibliothèque JavaScript qui permet
de manipuler des enregistrements en local et de les synchroniser vers une base distante.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;var&lt;/span&gt; &lt;span class="nx"&gt;db&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="nx"&gt;PouchDB&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'dbname'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;

&lt;span class="nx"&gt;db&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;put&lt;/span&gt;&lt;span class="p"&gt;({&lt;/span&gt;
 &lt;span class="nx"&gt;_id&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'dave@gmail.com'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="nx"&gt;name&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;'David'&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
 &lt;span class="nx"&gt;age&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;68&lt;/span&gt;
&lt;span class="p"&gt;});&lt;/span&gt;

&lt;span class="nx"&gt;db&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;replicate&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="nx"&gt;to&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'http://example.com/mydb'&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Le projet a le vent en poupe, bénéficie de nombreux contributeurs,
l'éco-système est très riche et l'adoption par des projets &lt;a class="reference external" href="https://github.com/hoodiehq/wip-hoodie-store-on-pouchdb"&gt;comme Hoodie&lt;/a&gt; ne fait que
confirmer la pertinence de l'outil pour les développeurs frontend.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;PouchDB&lt;/em&gt; gère un « store » local, dont la persistence est abstraite et &lt;a class="reference external" href="http://pouchdb.com/2014/07/25/pouchdb-levels-up.html"&gt;repose
sur&lt;/a&gt; l'API &lt;a class="reference external" href="https://github.com/level/levelup#relationship-to-leveldown"&gt;LevelDown&lt;/a&gt; pour persister
les données dans &lt;a class="reference external" href="https://github.com/Level/levelup/wiki/Modules#storage-back-ends"&gt;n'importe quel backend&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Même si &lt;em&gt;PouchDB&lt;/em&gt; adresse principalement les besoins des applications
«&lt;em&gt;offline-first&lt;/em&gt;», il peut être utilisé aussi bien dans le navigateur que côté
serveur, via Node.&lt;/p&gt;
&lt;div class="section" id="synchronisation"&gt;
&lt;h3&gt;Synchronisation&lt;/h3&gt;
&lt;p&gt;La synchronisation (ou réplication) des données locales s'effectue sur un
&lt;a class="reference external" href="http://couchdb.apache.org/"&gt;CouchDB&lt;/a&gt; distant.&lt;/p&gt;
&lt;p&gt;Le projet &lt;a class="reference external" href="https://github.com/pouchdb/pouchdb-server"&gt;PouchDB Server&lt;/a&gt;
implémente l'API de CouchDB en NodeJS. Comme &lt;em&gt;PouchDB&lt;/em&gt; est utilisé, on obtient
un service qui se comporte comme un &lt;em&gt;CouchDB&lt;/em&gt; mais qui stocke ses données
n'importe où, dans un &lt;em&gt;Redis&lt;/em&gt; ou un &lt;em&gt;PostgreSQL&lt;/em&gt; par exemple.&lt;/p&gt;
&lt;p&gt;La synchronisation est complète. Autrement dit, tous les enregistrements qui
sont sur le serveur se retrouvent synchronisés dans le client. Il est possible
de filtrer les collections synchronisées, mais cela &lt;a class="reference external" href="http://pouchdb.com/2015/04/05/filtered-replication.html"&gt;n'a pas pour objectif de
sécuriser l'accès aux données&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;L'approche recommandée pour cloisonner les données par utilisateur consiste
à créer &lt;a class="reference external" href="https://github.com/nolanlawson/pouchdb-authentication#some-people-can-read-some-docs-some-people-can-write-those-same-docs"&gt;une base de données par utilisateur&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Ce n'est pas forcément un problème, CouchDB &lt;a class="reference external" href="https://mail-archives.apache.org/mod_mbox/couchdb-user/201401.mbox/%3C52CEB873.7080404@ironicdesign.com%3E"&gt;supporte des centaines de milliers
de bases sans sourciller&lt;/a&gt;.
Mais selon les cas d'utilisation, le cloisement n'est pas toujours facile
à déterminer (par rôle, par application, par collection, ...).&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="le-cas-d-utilisation-payments"&gt;
&lt;h2&gt;Le cas d'utilisation « Payments »&lt;/h2&gt;
&lt;img alt="Put Payments Here  -- Before the Internet - CC-NC-SA Katy Silberger https://www.flickr.com/photos/katysilbs/11163812186" src="http://www.servicedenuages.fr/en/../images/put-payments.jpg" style="width: 640px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Dans les prochaines semaines, nous devrons mettre sur pied un prototype pour
tracer l'historique des paiements et abonnements d'un utilisateur.&lt;/p&gt;
&lt;p&gt;Le besoin est simple:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;l'application « Payment » enregistre les paiements et abonnements d'un
utilisateur pour une application donnée;&lt;/li&gt;
&lt;li&gt;l'application « Donnée » interroge le service pour vérifier qu'un utilisateur
a payé ou est abonné;&lt;/li&gt;
&lt;li&gt;l'utilisateur interroge le service pour obtenir la liste de tous ses
abonnements.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Seule l'application « Payment » a le droit de créer/modifier/supprimer des
enregistrements, les deux autres ne peuvent que consulter en lecture seule.&lt;/p&gt;
&lt;p&gt;Une application donnée ne peut pas accéder aux paiements des autres
applications, et un utilisateur ne peut pas accéder aux paiements des autres
utilisateurs.&lt;/p&gt;
&lt;div class="section" id="avec-remotestorage"&gt;
&lt;h3&gt;Avec RemoteStorage&lt;/h3&gt;
&lt;img alt="Remote Love - CC-BY-NC Julie https://www.flickr.com/photos/mamajulie2008/2609549461" class="align-center" src="http://www.servicedenuages.fr/en/../images/remote-love.jpg" style="width: 640px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Clairement, l'idée de &lt;em&gt;RemoteStorage&lt;/em&gt; est de dissocier l'application executée,
et les données créées par l'utilisateur avec celle-ci.&lt;/p&gt;
&lt;p&gt;Dans notre cas, c'est l'application « Payment » qui manipule des données
concernant un utilisateur. Mais celles-ci ne lui appartiennent pas directement:
certes un utilisateur doit pouvoir les supprimer, surtout pas en créer ou les
modifier!&lt;/p&gt;
&lt;p&gt;La notion de permissions limitée à privé/publique ne suffit pas dans ce cas
précis.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="avec-pouchdb"&gt;
&lt;h3&gt;Avec PouchDB&lt;/h3&gt;
&lt;p&gt;Il va falloir créer une &lt;em&gt;base de données&lt;/em&gt; par utilisateur, afin d'isoler les
enregistrements de façon sécurisée.  Seule l'application « Payment » aura tous
les droits sur les databases.&lt;/p&gt;
&lt;p&gt;Mais cela ne suffit pas.&lt;/p&gt;
&lt;p&gt;Il ne faut pas qu'une application puisse voir les paiements des autres
applications, donc il va aussi falloir recloisonner, et créer une &lt;em&gt;base de
données&lt;/em&gt; par application.&lt;/p&gt;
&lt;p&gt;Quand un utilisateur voudra accéder à l'ensemble de ses paiements, il faudra
agréger les &lt;em&gt;databases&lt;/em&gt; de toutes les applications. Quand l'équipe marketing
voudra faire des statistiques sur l'ensemble des applications, il faudra
agrégér des centaines de milliers de &lt;em&gt;databases&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Ce qui est fort dommage, puisqu'il est probable que les paiements ou
abonnements d'un utilisateur pour une application se comptent sur les doigts
d'une main. Des centaines de milliers de bases contenant moins de
5 enregistrements ?&lt;/p&gt;
&lt;p&gt;De plus, dans le cas de l'application « Payment », le serveur est implémenté en
Python. Utiliser un wrapper JavaScript comme le fait &lt;a class="reference external" href="https://pythonhosted.org/Python-PouchDB/"&gt;python-pouchdb&lt;/a&gt; cela ne nous fait pas trop rêver.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="un-nouvel-eco-systeme"&gt;
&lt;h2&gt;Un nouvel éco-système ?&lt;/h2&gt;
&lt;img alt="Wagon wheel - CC-BY-NC-SA arbyreed https://www.flickr.com/photos/19779889@N00/16161808220" src="http://www.servicedenuages.fr/en/../images/wagon-wheel.jpg" style="width: 640px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Évidemment, quand on voit la richesse des projets &lt;em&gt;PouchDB&lt;/em&gt; et &lt;em&gt;Remote Storage&lt;/em&gt;
et la dynamique de ces communautés, il est légitime d'hésiter avant de
développer une solution alternative.&lt;/p&gt;
&lt;p&gt;Quand nous avons créé le serveur &lt;em&gt;Reading List&lt;/em&gt;, nous l'avons construit avec
&lt;a class="reference external" href="http://cliquet.readthedocs.io/"&gt;Cliquet&lt;/a&gt;, ce fût l'occasion de mettre au
point &lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/api/"&gt;un protocole très simple&lt;/a&gt;, fortement inspiré de
&lt;a class="reference external" href="http://en.wikipedia.org/wiki/Firefox_Sync"&gt;Firefox Sync&lt;/a&gt;, pour faire de la
synchronisation d'enregistrements.&lt;/p&gt;
&lt;p&gt;Et si les clients &lt;em&gt;Reading List&lt;/em&gt; ont pu être implémentés en quelques semaines,
que ce soit en JavaScript, Java (Android) et ASM (Add-on Firefox), c'est que le
principe «&lt;em&gt;offline first&lt;/em&gt;» du service est trivial.&lt;/p&gt;
&lt;div class="section" id="les-compromis"&gt;
&lt;h3&gt;Les compromis&lt;/h3&gt;
&lt;p&gt;Évidemment, nous n'avons pas la prétention de concurrencer &lt;em&gt;CouchDB&lt;/em&gt;. Nous faisons plusieurs
concessions:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;De base, les collections d'enregistrements sont cloisonnées par utilisateur;&lt;/li&gt;
&lt;li&gt;Pas d'historique des révisions;&lt;/li&gt;
&lt;li&gt;Pas de diff sur les enregistrements entre révisions;&lt;/li&gt;
&lt;li&gt;De base, pas de résolution de conflit automatique;&lt;/li&gt;
&lt;li&gt;Pas de synchronisation par flux (&lt;em&gt;streams&lt;/em&gt;);&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Jusqu'à preuve du contraire, ces compromis excluent la possibilité
d'implémenter un &lt;a class="reference external" href="https://github.com/pouchdb/pouchdb/blob/master/lib/adapters/http/http.js#L721-L946"&gt;adapter PouchDB&lt;/a&gt;
pour la synchronisation avec le protocole HTTP de &lt;em&gt;Cliquet&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Dommage puisque capitaliser sur l'expérience client de &lt;em&gt;PouchDB&lt;/em&gt; au niveau
synchro client semble être une très bonne idée.&lt;/p&gt;
&lt;p&gt;En revanche, nous avons plusieurs fonctionnalités intéressantes:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Pas de map-reduce;&lt;/li&gt;
&lt;li&gt;Synchronisation partielle et/ou ordonnée et/ou paginée    ;&lt;/li&gt;
&lt;li&gt;Le client choisit, via des headers, d'écraser la donnée ou de respecter la version du serveur ;&lt;/li&gt;
&lt;li&gt;Un seul serveur à déployer pour N applications ;&lt;/li&gt;
&lt;li&gt;Auto-hébergement simplissime ;&lt;/li&gt;
&lt;li&gt;Le client peut choisir de ne pas utiliser de « store local » du tout ;&lt;/li&gt;
&lt;li&gt;Dans le client JS, la gestion du « store local » sera externalisée (on pense
à &lt;a class="reference external" href="https://github.com/mozilla/localForage"&gt;LocalForage&lt;/a&gt; ou &lt;a class="reference external" href="https://github.com/dfahlander/Dexie.js"&gt;Dexie.js&lt;/a&gt;) ;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Et, on répond au reste des &lt;a class="reference external" href="#storage-specs"&gt;specifications mentionnées au début de l'article&lt;/a&gt; !&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="les-arguments-philosophiques"&gt;
&lt;h3&gt;Les arguments philosophiques&lt;/h3&gt;
&lt;p&gt;Il est &lt;a class="reference external" href="http://en.wikipedia.org/wiki/Law_of_the_instrument"&gt;illusoire de penser qu'on peut tout faire avec un seul outil&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Nous avons d'autres cas d'utilisations dans les cartons qui semblent correspondre au scope de &lt;em&gt;PouchDB&lt;/em&gt;
(&lt;em&gt;pas de notion de permissions ou de partage, environnement JavaScript, ...&lt;/em&gt;). Nous saurons en tirer
profit quand cela s'avèrera pertinent !&lt;/p&gt;
&lt;p&gt;L'éco-système que nous voulons construire tentera de couvrir les cas d'utilisation
qui sont mal adressés par &lt;em&gt;PouchDB&lt;/em&gt;. Il se voudra:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Basé sur notre protocole très simple ;&lt;/li&gt;
&lt;li&gt;Minimaliste et multi-usages (&lt;em&gt;comme la fameuse 2CV&lt;/em&gt;) ;&lt;/li&gt;
&lt;li&gt;Naïf (&lt;em&gt;pas de rocket science&lt;/em&gt;) ;&lt;/li&gt;
&lt;li&gt;Sans magie (&lt;em&gt;explicite et facile à réimplémenter from scratch&lt;/em&gt;) ;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a class="reference external" href="http://cliquet.readthedocs.io/en/latest/rationale.html"&gt;La philosophie et les fonctionnalités du toolkit python Cliquet&lt;/a&gt; seront bien entendu
à l'honneur :)&lt;/p&gt;
&lt;p&gt;Quant à &lt;em&gt;Remote Storage&lt;/em&gt;, dès que le besoin se présentera, nous serons très fier
de rejoindre l'initiative, mais pour l'instant cela nous paraît risqué de démarrer
en tordant la solution.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="les-arguments-pratiques"&gt;
&lt;h3&gt;Les arguments pratiques&lt;/h3&gt;
&lt;p&gt;Avant d'accepter de déployer une solution à base de &lt;em&gt;CouchDB&lt;/em&gt;, les &lt;em&gt;ops&lt;/em&gt; de Mozilla
vont nous demander de leur prouver par A+B que ce n'est pas faisable avec
les stacks qui sont déjà rodées en interne (i.e. MySQL, Redis, PostgreSQL).&lt;/p&gt;
&lt;p&gt;De plus, on doit s'engager sur une pérennité d'au moins 5 ans pour les données.
Avec &lt;em&gt;Cliquet&lt;/em&gt;, en utilisant le backend PostgreSQL, les données sont persistées
à plat dans un &lt;a class="reference external" href="https://github.com/mozilla-services/cliquet/blob/40aa33/cliquet/storage/postgresql/schema.sql#L14-L28"&gt;schéma PostgreSQL tout bête&lt;/a&gt;.
Ce qui ne sera pas le cas d'un adapteur LevelDown qui va manipuler des notions
de révisions éclatées dans un schéma clé-valeur.&lt;/p&gt;
&lt;p&gt;Si nous basons le service sur &lt;em&gt;Cliquet&lt;/em&gt;, comme c'est le cas avec &lt;a class="reference external" href="http://kinto.readthedocs.io"&gt;Kinto&lt;/a&gt;,
tout le travail d'automatisation de la mise en production (&lt;em&gt;monitoring,
builds RPM, Puppet...&lt;/em&gt;) que nous avons fait pour &lt;em&gt;Reading List&lt;/em&gt; est
complètement réutilisable.&lt;/p&gt;
&lt;p&gt;De même, si on repart avec une stack complètement différente, nous allons
devoir recommencer tout le travail de rodage, de profiling et d'optimisation
effectué au premier trimestre.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="les-prochaines-etapes"&gt;
&lt;h2&gt;Les prochaines étapes&lt;/h2&gt;
&lt;p&gt;Et il est encore temps de changer de stratégie :) Nous aimerions avoir un
maximum de retours !  C'est toujours une décision difficile à prendre...
&lt;tt class="docutils literal"&gt;&amp;lt;/appel à troll&amp;gt;&lt;/tt&gt;&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Tordre un éco-système existant vs. constuire sur mesure ;&lt;/li&gt;
&lt;li&gt;Maîtriser l'ensemble vs. s'intégrer ;&lt;/li&gt;
&lt;li&gt;Contribuer vs. refaire ;&lt;/li&gt;
&lt;li&gt;Guider vs. suivre.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Nous avons vraiment l'intention de rejoindre l'initiative &lt;a class="reference external" href="https://nobackend.org/"&gt;no-backend&lt;/a&gt;, et ce premier pas n'exclue pas que nous convergions
à terme ! Peut-être que nous allons finir par rendre notre service compatible
avec &lt;em&gt;Remote Storage&lt;/em&gt;, et peut-être que &lt;em&gt;PouchDB&lt;/em&gt; deviendra plus agnostique
quand au protocole de synchronisation...&lt;/p&gt;
&lt;img alt="XKCD — Standards https://xkcd.com/927/" src="http://www.servicedenuages.fr/en/../images/standards.png" style="width: 500px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Utiliser ce nouvel écosystème pour le projet « Payments » va nous permettre de
mettre au point un système de permissions (&lt;em&gt;probablement basé sur les scopes OAuth&lt;/em&gt;) qui
correspond au besoin exprimé. Et nous avons bien l'intention de puiser dans
&lt;a class="reference external" href="http://blog.daybed.io/daybed-revival.html"&gt;notre expérience avec Daybed sur le sujet&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Nous extrairons aussi le code des clients implémentés pour &lt;em&gt;Reading List&lt;/em&gt; afin
de faire un client JavaScript minimaliste.&lt;/p&gt;
&lt;p&gt;En partant dans notre coin, nous prenons plusieurs risques:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;réinventer une roue dont nous n'avons pas connaissance ;&lt;/li&gt;
&lt;li&gt;échouer à faire de l'éco-système &lt;em&gt;Cliquet&lt;/em&gt; un projet communautaire ;&lt;/li&gt;
&lt;li&gt;échouer à positionner &lt;em&gt;Cliquet&lt;/em&gt; dans la niche des cas non couverts par PouchDB :)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Comme &lt;a class="reference external" href="http://pouchdb.com/2015/04/05/filtered-replication.html"&gt;le dit Giovanni Ornaghi&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
Rolling out your set of webservices, push notifications, or background services
might give you more control, but at the same time it will force you to engineer,
write, test, and maintain a whole new ecosystem.&lt;/blockquote&gt;
&lt;p&gt;C'est justement l'éco-système dont est responsable l'équipe &lt;em&gt;Mozilla Cloud Services&lt;/em&gt;!&lt;/p&gt;
&lt;table class="docutils footnote" frame="void" id="id3" rules="none"&gt;
&lt;colgroup&gt;&lt;col class="label"/&gt;&lt;col/&gt;&lt;/colgroup&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td class="label"&gt;&lt;a class="fn-backref" href="#id1"&gt;[1]&lt;/a&gt;&lt;/td&gt;&lt;td&gt;Il existe le &lt;a class="reference external" href="https://sharesome.5apps.com/"&gt;projet Sharesome&lt;/a&gt; qui
permet de partager publiquement des ressources de son &lt;em&gt;remote Storage&lt;/em&gt;.&lt;/td&gt;&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
</content></entry><entry><title>Service de nuages !</title><link href="http://www.servicedenuages.fr/en/service-de-nuages" rel="alternate"></link><published>2015-04-16T00:00:00+02:00</published><updated>2015-04-16T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-04-16:/en/service-de-nuages</id><summary type="html">&lt;p class="first last"&gt;A quick overview of our work in the first quarter of 2015.
Readinglist, Kinto, Cliquet.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;A bunch of changes since the beginning of the year for the "cloud-services"
frenchies!&lt;/p&gt;
&lt;p&gt;First of all, two new recruits are here to complement the team:
&lt;a class="reference external" href="https://nicolas.perriault.net/"&gt;n1k0&lt;/a&gt; and &lt;a class="reference external" href="http://mathieu-leplatre.info"&gt;Mathieu&lt;/a&gt; are now helping out &lt;a class="reference external" href="http://ziade.org/"&gt;Tarek&lt;/a&gt;, &lt;a class="reference external" href="http://natim.ionyse.com"&gt;Rémy&lt;/a&gt; and &lt;a class="reference external" href="http://notmyidea.org"&gt;Alexis&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;The starting of this year has seen the launch of &lt;a class="reference external" href="https://www.mozilla.org/en-US/firefox/hello/"&gt;Firefox Hello&lt;/a&gt; which allowed us to scale up
&lt;a class="reference external" href="https://github.com/mozilla-services/loop-server"&gt;the server&lt;/a&gt;,
written in Node.js®.&lt;/p&gt;
&lt;div class="section" id="a-readinglist-server"&gt;
&lt;h2&gt;A readinglist server&lt;/h2&gt;
&lt;p&gt;In parallel, a project about &lt;a class="reference external" href="https://readinglist.readthedocs.io"&gt;synchronizing reading lists&lt;/a&gt; (&lt;em&gt;Reading List&lt;/em&gt;) started.
The idea is to be able to bookmark pages to "read for later" and continue the
reading on any synchronized device (Firefox for Android or Firefox Desktop). An
open source counterpart to &lt;a class="reference external" href="http://getpocket.com"&gt;Pocket&lt;/a&gt;, in some regards, which is possible to host
yourself.&lt;/p&gt;
&lt;img alt="Capture of Firefox nightly with the readinglist." src="http://www.servicedenuages.fr/en/../images/readinglist-screenshot.png" style="width: 953px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;To build this service, we could have reused &lt;a class="reference external" href="https://github.com/mozilla-services/server-syncstorage"&gt;Firefox sync&lt;/a&gt; , after all it's
a robust synchronisation service, built on top of &lt;a class="reference external" href="http://cornice.readthedocs.io/"&gt;Cornice&lt;/a&gt;. But &lt;em&gt;Sync&lt;/em&gt; hasn't
been thought to guarantee strong data integrity and it was too complex to change that
deeply.&lt;/p&gt;
&lt;p&gt;We could also have created yet another application to expose an API and
persist data in a database.&lt;/p&gt;
&lt;p&gt;But, this little new team isn't here just by luck.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="the-daybed-team"&gt;
&lt;h2&gt;The «Daybed Team»&lt;/h2&gt;
&lt;p&gt;We share a vision: a generic data storage service! Maybe it brings to memories
&lt;a class="reference external" href="https://daybed.io"&gt;a certain project named Daybed&lt;/a&gt;?&lt;/p&gt;
&lt;p&gt;For client applications, JavaScript or other, using this service should be as
easy as a pie! The application handles its data locally (offline-first) and
synchronizes upon request.&lt;/p&gt;
&lt;p&gt;Here, the heart of the &lt;em&gt;Reading List&lt;/em&gt; service is a "CRUD" API (Create, Retrieve,
Update, Delete), which handles synchronisation and authentication. We made the
bet to do a "simple" API, with the less specific code as possible, which would
create the basis of a generic service. Also because it's likely that other
similar projects will follow.&lt;/p&gt;
&lt;p&gt;A bunch of experience was accumulated within the team, on one hand with the
creation and evolution of &lt;em&gt;Firefox Sync&lt;/em&gt; and on the other hand with &lt;em&gt;Daybed&lt;/em&gt;
our side-project. We try to not reproduce the same mistakes while keeping
concepts which proved to be valid.&lt;/p&gt;
&lt;p&gt;For instance, we kept the &lt;em&gt;timestamp&lt;/em&gt; mechanism of &lt;em&gt;Sync&lt;/em&gt;, which is used to
synchronize collections. As these problematics are recurring or even impossible
to avoid, we decided to build on top of this synchronization protocol and to
dissociate it from the readinglist project.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="the-one-way-mechanism"&gt;
&lt;h2&gt;The one-way mechanism&lt;/h2&gt;
&lt;p&gt;As a first stone to build the cathedral, we created &lt;a class="reference external" href="https://cliquet.readthedocs.io"&gt;Cliquet&lt;/a&gt;, which main idea is to have an
implementation of this protocol in Python, while factorizing all our good
practices (notably for putting everything in production).&lt;/p&gt;
&lt;img alt="Cliquet's logo" class="align-right" src="http://www.servicedenuages.fr/en/../images/cliquet-logo.png" style="width: 300px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;The good thing with protocols (as opposed to monoliths) is that if you prefer
Asyncio, io.js or Go, we will encourage you to publish your alternative
implementation!&lt;/p&gt;
&lt;p&gt;With &lt;em&gt;Cliquet&lt;/em&gt;, the code of the readinglist service consists into defining
a schema for the records and force some field values on certain calls. The size
of the project is dramatically reduced to a dozen lines of code.&lt;/p&gt;
&lt;p&gt;As to the future generic data storage service, &lt;a class="reference external" href="http://kinto.readthedocs.io"&gt;the project&lt;/a&gt; just started but it really is!
It can already be used as a storage backend in a &lt;em&gt;Cliquet&lt;/em&gt; application, and
this was &lt;a class="reference external" href="https://github.com/mozilla-services/kinto/blob/0.2.1/kinto/views/collection.py"&gt;implemented in only 20 lines of code&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Oh, and this time we will build features only from real use cases which are
coming along the way. It might seem silly, but on &lt;em&gt;Daybed&lt;/em&gt; we never made that point.&lt;/p&gt;
&lt;p&gt;In future articles, we want to describe the good practices we put together in
the protocol (or &lt;em&gt;Cliquet&lt;/em&gt;), certain specific technical points and present our
vision with examples and tutorials.&lt;/p&gt;
&lt;p&gt;See you soon, then!&lt;/p&gt;
&lt;/div&gt;
</content><category term="mozilla"></category></entry><entry><title>Service de nuages !</title><link href="http://www.servicedenuages.fr/en/../service-de-nuages" rel="alternate"></link><published>2015-04-16T00:00:00+02:00</published><updated>2015-04-16T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-04-16:/en/../service-de-nuages</id><summary type="html">&lt;p class="first last"&gt;Retour sur le premier trimestre 2015: Readinglist, Kinto, Cliquet.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Pas mal de changements depuis le début de l'année pour l'équipe
«cloud-services» francophone!&lt;/p&gt;
&lt;p&gt;Tout d'abord, nouvelle importante, l'équipe s'étoffe avec des profils assez
complémentaires: &lt;a class="reference external" href="https://nicolas.perriault.net/"&gt;n1k0&lt;/a&gt; et &lt;a class="reference external" href="http://mathieu-leplatre.info"&gt;Mathieu&lt;/a&gt; sont venus prêter main forte à &lt;a class="reference external" href="http://ziade.org/"&gt;Tarek&lt;/a&gt;, &lt;a class="reference external" href="http://natim.ionyse.com"&gt;Rémy&lt;/a&gt; et &lt;a class="reference external" href="http://notmyidea.org"&gt;Alexis&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Le début de l'année a vu le lancement de &lt;a class="reference external" href="https://www.mozilla.org/en-US/firefox/hello/"&gt;Firefox Hello&lt;/a&gt; ce qui nous a permis de passer
à l'échelle &lt;a class="reference external" href="https://github.com/mozilla-services/loop-server"&gt;le serveur&lt;/a&gt;,
écrit en Node.js®, pour l'occasion.&lt;/p&gt;
&lt;div class="section" id="un-serveur-de-listes-de-lecture"&gt;
&lt;h2&gt;Un serveur de listes de lecture&lt;/h2&gt;
&lt;p&gt;En parallèle, un projet de &lt;a class="reference external" href="https://readinglist.readthedocs.io"&gt;synchronisation de liste de lecture&lt;/a&gt; (&lt;em&gt;Reading List&lt;/em&gt;) a vu le jour.  L'idée
étant de pouvoir marquer des pages "à lire pour plus tard" et de continuer la
lecture sur n'importe quel périphérique synchronisé (Firefox pour Android ou
Firefox Desktop). Un équivalent libre à &lt;a class="reference external" href="http://getpocket.com"&gt;Pocket&lt;/a&gt; en quelque sorte, qu'il est
possible d'héberger soit-même.&lt;/p&gt;
&lt;img alt="Capture d'écran de Firefox nightly avec readinglist." src="http://www.servicedenuages.fr/en/../images/readinglist-screenshot.png" style="width: 953px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;Pour le construire, nous aurions pu réutiliser &lt;a class="reference external" href="https://github.com/mozilla-services/server-syncstorage"&gt;Firefox Sync&lt;/a&gt;, après tout
c'est un service de synchronisation de données très robuste, construit avec &lt;a class="reference external" href="http://cornice.readthedocs.io/"&gt;Cornice&lt;/a&gt;.
Mais seulement, &lt;em&gt;Sync&lt;/em&gt; n'a pas été pensé pour garantir la pérennité des données,
et la marche était trop haute pour changer ça en profondeur.&lt;/p&gt;
&lt;p&gt;Nous aurions pu aussi nous contenter de faire une énième application qui expose
une API et persiste des données dans une base de données.&lt;/p&gt;
&lt;p&gt;Mais cette nouvelle petite équipe n'est pas là par hasard :)&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="la-daybed-team"&gt;
&lt;h2&gt;La «Daybed Team»&lt;/h2&gt;
&lt;p&gt;On partage une vision: un service générique de stockage de données ! Peut-être
que ça vous rappelle &lt;a class="reference external" href="https://daybed.io"&gt;un certain projet nommé Daybed&lt;/a&gt; ?
Pour les applications clientes, JavaScript, mobiles ou autres, l'utilisation de
ce service doit être un jeu d'enfant ! L'application gère ses données
localement (aka offline-first), et synchronise à la demande.&lt;/p&gt;
&lt;p&gt;Ici, le cœur du serveur &lt;em&gt;Reading List&lt;/em&gt; est justement une API "CRUD" (Create,
Retrieve, Update, Delete), qui gère de la synchronisation et de
l'authentification. Nous avons donc pris le parti de faire une API "simple",
avec le moins de spécificités possible, qui poserait les bases d'un service
générique. Notamment parce qu'il y a d'autres projets dans la même trempe qui vont suivre.&lt;/p&gt;
&lt;p&gt;Pas mal d'expérience ayant été accumulée au sein de l'équipe, avec d'une part la
création de &lt;em&gt;Firefox Sync&lt;/em&gt;, et d'autre part avec &lt;em&gt;Daybed&lt;/em&gt;, notre side-project, nous
tentons de ne pas reproduire les mêmes erreurs, tout en gardant les concepts
qui ont fait leurs preuves.&lt;/p&gt;
&lt;p&gt;Par exemple, nous avons conservé le mécanisme de collections d'enregistrements
et de &lt;em&gt;timestamp&lt;/em&gt; de &lt;em&gt;Sync&lt;/em&gt;. Comme ces problématiques sont récurrentes, voire
incontournables, nous avons décidé de reprendre le protocole de synchronisation,
de l'étendre légèrement et surtout de le dissocier du projet de listes de lecture.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="le-mecanisme-qui-force-a-aller-de-l-avant"&gt;
&lt;h2&gt;Le mécanisme qui force à aller de l'avant&lt;/h2&gt;
&lt;p&gt;Comme première pierre à l'édifice, nous avons donné naissance au projet
&lt;a class="reference external" href="https://cliquet.readthedocs.io"&gt;Cliquet&lt;/a&gt;, dont l'idée principale est de
fournir une implémentation de ce protocole en python, tout en factorisant
l'ensemble de nos bonnes pratiques (pour la prod notamment).&lt;/p&gt;
&lt;img alt="Logo du projet Cliquet" class="align-right" src="http://www.servicedenuages.fr/en/../images/cliquet-logo.png" style="width: 300px; height: auto; max-width: 100%;"/&gt;
&lt;p&gt;L'avantage d'avoir un protocole plutôt qu'un monolithe, c'est que si vous
préférez Asyncio, io.js ou Go, on vous encouragera à publier votre
implémentation alternative !&lt;/p&gt;
&lt;p&gt;Avec &lt;em&gt;Cliquet&lt;/em&gt;, le code du serveur liste de lecture consiste principalement
à définir un schéma pour les enregistrements, puis à forcer des valeurs de
champs sur certains appels. Cela réduit ce projet à quelques dizaines de lignes
de code.&lt;/p&gt;
&lt;p&gt;Quant au futur service de stockage générique, &lt;a class="reference external" href="http://kinto.readthedocs.io"&gt;le projet&lt;/a&gt; en est encore à ses balbutiements mais c'est
bel et bien en route ! Il permet déjà d'être branché comme backend de stockage
dans une application &lt;em&gt;Cliquet&lt;/em&gt;, et ça &lt;a class="reference external" href="https://github.com/mozilla-services/kinto/blob/0.2.1/kinto/views/collection.py"&gt;implémenté en 20 lignes de code&lt;/a&gt;!&lt;/p&gt;
&lt;p&gt;Ah, et cette fois, nous ne construirons les fonctionnalités qu'à partir des
besoins concrets qui surviennent. Ça paraît tout bête, mais sur &lt;em&gt;Daybed&lt;/em&gt; on
l'a pas vu venir :)&lt;/p&gt;
&lt;p&gt;Dans les prochains articles, nous avons prévu de décrire les bonnes pratiques
rassemblées dans le protocole (ou &lt;em&gt;Cliquet&lt;/em&gt;), certains points techniques précis
et de vous présenter notre vision via des exemples et tutoriaux.&lt;/p&gt;
&lt;p&gt;À bientôt, donc !&lt;/p&gt;
&lt;/div&gt;
</content></entry><entry><title>Le printemps</title><link href="http://www.servicedenuages.fr/en/spring" rel="alternate"></link><published>2015-04-15T00:00:00+02:00</published><updated>2015-04-15T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-04-15:/en/spring</id><summary type="html">&lt;p&gt;It's spring already, and a good time to tidy-up a bit our minds!&lt;/p&gt;
&lt;p&gt;We've been stacking interesting experiences without really sharing them in
writings, so now's the time.&lt;/p&gt;
&lt;p&gt;There were a francophone conference about Hawk the past year, and some articles
in English in the Mozilla blog, but sometimes the …&lt;/p&gt;</summary><content type="html">&lt;p&gt;It's spring already, and a good time to tidy-up a bit our minds!&lt;/p&gt;
&lt;p&gt;We've been stacking interesting experiences without really sharing them in
writings, so now's the time.&lt;/p&gt;
&lt;p&gt;There were a francophone conference about Hawk the past year, and some articles
in English in the Mozilla blog, but sometimes the English language doesn't let
us express ourselves in a compelling way.&lt;/p&gt;
&lt;p&gt;That's why, in this beginning of spring 2015, we propose a set of articles
written in French and translated in English whenever we can, about what we do in
our little &lt;em&gt;Service des nuages&lt;/em&gt; team at Mozilla.&lt;/p&gt;
&lt;img alt="Our very own logo" src="http://www.servicedenuages.fr/en/../images/service_de_nuages.png" style="width: 2268px; height: auto; max-width: 100%;"/&gt;
</content><category term="mozilla"></category></entry><entry><title>Le printemps</title><link href="http://www.servicedenuages.fr/en/../printemps" rel="alternate"></link><published>2015-04-15T00:00:00+02:00</published><updated>2015-04-15T00:00:00+02:00</updated><author><name>Service de Nuages</name></author><id>tag:www.servicedenuages.fr,2015-04-15:/en/../printemps</id><summary type="html">&lt;p&gt;C'est le printemps et n'en déplaise à certains, il est temps de faire
un peu de ménage.&lt;/p&gt;
&lt;p&gt;Voilà quelques temps que nous accumulons les expériences et que nous
ne les partagions plus tellement par écrit.&lt;/p&gt;
&lt;p&gt;Il y a bien eu une conférence francophone sur Hawk l'an passé et
quelques articles …&lt;/p&gt;</summary><content type="html">&lt;p&gt;C'est le printemps et n'en déplaise à certains, il est temps de faire
un peu de ménage.&lt;/p&gt;
&lt;p&gt;Voilà quelques temps que nous accumulons les expériences et que nous
ne les partagions plus tellement par écrit.&lt;/p&gt;
&lt;p&gt;Il y a bien eu une conférence francophone sur Hawk l'an passé et
quelques articles en anglais sur le blog de Mozilla, mais
parfois la barrière de la langue ne permet pas une entière
satisfaction sur ces retours d'expérience.&lt;/p&gt;
&lt;p&gt;C'est ainsi qu'en ce début de printemps 2015 nous dépoussiérons nos
esprits et que nous vous proposons un ensemble d'articles en français
sur ce que nous faisons dans notre petite équipe du Service de Nuages
de Mozilla.&lt;/p&gt;
&lt;img alt="Logo du service des nuages" src="http://www.servicedenuages.fr/en/../images/service_de_nuages.png" style="width: 2268px; height: auto; max-width: 100%;"/&gt;
</content></entry></feed>